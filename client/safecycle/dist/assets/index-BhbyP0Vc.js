function Q5(a,n){for(var h=0;h<n.length;h++){const m=n[h];if(typeof m!="string"&&!Array.isArray(m)){for(const y in m)if(y!=="default"&&!(y in a)){const b=Object.getOwnPropertyDescriptor(m,y);b&&Object.defineProperty(a,y,b.get?b:{enumerable:!0,get:()=>m[y]})}}}return Object.freeze(Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))m(y);new MutationObserver(y=>{for(const b of y)if(b.type==="childList")for(const M of b.addedNodes)M.tagName==="LINK"&&M.rel==="modulepreload"&&m(M)}).observe(document,{childList:!0,subtree:!0});function h(y){const b={};return y.integrity&&(b.integrity=y.integrity),y.referrerPolicy&&(b.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?b.credentials="include":y.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function m(y){if(y.ep)return;y.ep=!0;const b=h(y);fetch(y.href,b)}})();var Xo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zg(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function J5(a){if(a.__esModule)return a;var n=a.default;if(typeof n=="function"){var h=function m(){return this instanceof m?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};h.prototype=n.prototype}else h={};return Object.defineProperty(h,"__esModule",{value:!0}),Object.keys(a).forEach(function(m){var y=Object.getOwnPropertyDescriptor(a,m);Object.defineProperty(h,m,y.get?y:{enumerable:!0,get:function(){return a[m]}})}),h}var aD={exports:{}},kx={},lD={exports:{}},an={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fg=Symbol.for("react.element"),eN=Symbol.for("react.portal"),tN=Symbol.for("react.fragment"),rN=Symbol.for("react.strict_mode"),nN=Symbol.for("react.profiler"),iN=Symbol.for("react.provider"),oN=Symbol.for("react.context"),sN=Symbol.for("react.forward_ref"),aN=Symbol.for("react.suspense"),lN=Symbol.for("react.memo"),uN=Symbol.for("react.lazy"),o3=Symbol.iterator;function cN(a){return a===null||typeof a!="object"?null:(a=o3&&a[o3]||a["@@iterator"],typeof a=="function"?a:null)}var uD={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},cD=Object.assign,hD={};function kp(a,n,h){this.props=a,this.context=n,this.refs=hD,this.updater=h||uD}kp.prototype.isReactComponent={};kp.prototype.setState=function(a,n){if(typeof a!="object"&&typeof a!="function"&&a!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,a,n,"setState")};kp.prototype.forceUpdate=function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};function fD(){}fD.prototype=kp.prototype;function qS(a,n,h){this.props=a,this.context=n,this.refs=hD,this.updater=h||uD}var HS=qS.prototype=new fD;HS.constructor=qS;cD(HS,kp.prototype);HS.isPureReactComponent=!0;var s3=Array.isArray,dD=Object.prototype.hasOwnProperty,ZS={current:null},pD={key:!0,ref:!0,__self:!0,__source:!0};function mD(a,n,h){var m,y={},b=null,M=null;if(n!=null)for(m in n.ref!==void 0&&(M=n.ref),n.key!==void 0&&(b=""+n.key),n)dD.call(n,m)&&!pD.hasOwnProperty(m)&&(y[m]=n[m]);var P=arguments.length-2;if(P===1)y.children=h;else if(1<P){for(var o=Array(P),R=0;R<P;R++)o[R]=arguments[R+2];y.children=o}if(a&&a.defaultProps)for(m in P=a.defaultProps,P)y[m]===void 0&&(y[m]=P[m]);return{$$typeof:Fg,type:a,key:b,ref:M,props:y,_owner:ZS.current}}function hN(a,n){return{$$typeof:Fg,type:a.type,key:n,ref:a.ref,props:a.props,_owner:a._owner}}function XS(a){return typeof a=="object"&&a!==null&&a.$$typeof===Fg}function fN(a){var n={"=":"=0",":":"=2"};return"$"+a.replace(/[=:]/g,function(h){return n[h]})}var a3=/\/+/g;function uw(a,n){return typeof a=="object"&&a!==null&&a.key!=null?fN(""+a.key):n.toString(36)}function pv(a,n,h,m,y){var b=typeof a;(b==="undefined"||b==="boolean")&&(a=null);var M=!1;if(a===null)M=!0;else switch(b){case"string":case"number":M=!0;break;case"object":switch(a.$$typeof){case Fg:case eN:M=!0}}if(M)return M=a,y=y(M),a=m===""?"."+uw(M,0):m,s3(y)?(h="",a!=null&&(h=a.replace(a3,"$&/")+"/"),pv(y,n,h,"",function(R){return R})):y!=null&&(XS(y)&&(y=hN(y,h+(!y.key||M&&M.key===y.key?"":(""+y.key).replace(a3,"$&/")+"/")+a)),n.push(y)),1;if(M=0,m=m===""?".":m+":",s3(a))for(var P=0;P<a.length;P++){b=a[P];var o=m+uw(b,P);M+=pv(b,n,h,o,y)}else if(o=cN(a),typeof o=="function")for(a=o.call(a),P=0;!(b=a.next()).done;)b=b.value,o=m+uw(b,P++),M+=pv(b,n,h,o,y);else if(b==="object")throw n=String(a),Error("Objects are not valid as a React child (found: "+(n==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return M}function W0(a,n,h){if(a==null)return a;var m=[],y=0;return pv(a,m,"","",function(b){return n.call(h,b,y++)}),m}function dN(a){if(a._status===-1){var n=a._result;n=n(),n.then(function(h){(a._status===0||a._status===-1)&&(a._status=1,a._result=h)},function(h){(a._status===0||a._status===-1)&&(a._status=2,a._result=h)}),a._status===-1&&(a._status=0,a._result=n)}if(a._status===1)return a._result.default;throw a._result}var Qo={current:null},mv={transition:null},pN={ReactCurrentDispatcher:Qo,ReactCurrentBatchConfig:mv,ReactCurrentOwner:ZS};function _D(){throw Error("act(...) is not supported in production builds of React.")}an.Children={map:W0,forEach:function(a,n,h){W0(a,function(){n.apply(this,arguments)},h)},count:function(a){var n=0;return W0(a,function(){n++}),n},toArray:function(a){return W0(a,function(n){return n})||[]},only:function(a){if(!XS(a))throw Error("React.Children.only expected to receive a single React element child.");return a}};an.Component=kp;an.Fragment=tN;an.Profiler=nN;an.PureComponent=qS;an.StrictMode=rN;an.Suspense=aN;an.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pN;an.act=_D;an.cloneElement=function(a,n,h){if(a==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+a+".");var m=cD({},a.props),y=a.key,b=a.ref,M=a._owner;if(n!=null){if(n.ref!==void 0&&(b=n.ref,M=ZS.current),n.key!==void 0&&(y=""+n.key),a.type&&a.type.defaultProps)var P=a.type.defaultProps;for(o in n)dD.call(n,o)&&!pD.hasOwnProperty(o)&&(m[o]=n[o]===void 0&&P!==void 0?P[o]:n[o])}var o=arguments.length-2;if(o===1)m.children=h;else if(1<o){P=Array(o);for(var R=0;R<o;R++)P[R]=arguments[R+2];m.children=P}return{$$typeof:Fg,type:a.type,key:y,ref:b,props:m,_owner:M}};an.createContext=function(a){return a={$$typeof:oN,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},a.Provider={$$typeof:iN,_context:a},a.Consumer=a};an.createElement=mD;an.createFactory=function(a){var n=mD.bind(null,a);return n.type=a,n};an.createRef=function(){return{current:null}};an.forwardRef=function(a){return{$$typeof:sN,render:a}};an.isValidElement=XS;an.lazy=function(a){return{$$typeof:uN,_payload:{_status:-1,_result:a},_init:dN}};an.memo=function(a,n){return{$$typeof:lN,type:a,compare:n===void 0?null:n}};an.startTransition=function(a){var n=mv.transition;mv.transition={};try{a()}finally{mv.transition=n}};an.unstable_act=_D;an.useCallback=function(a,n){return Qo.current.useCallback(a,n)};an.useContext=function(a){return Qo.current.useContext(a)};an.useDebugValue=function(){};an.useDeferredValue=function(a){return Qo.current.useDeferredValue(a)};an.useEffect=function(a,n){return Qo.current.useEffect(a,n)};an.useId=function(){return Qo.current.useId()};an.useImperativeHandle=function(a,n,h){return Qo.current.useImperativeHandle(a,n,h)};an.useInsertionEffect=function(a,n){return Qo.current.useInsertionEffect(a,n)};an.useLayoutEffect=function(a,n){return Qo.current.useLayoutEffect(a,n)};an.useMemo=function(a,n){return Qo.current.useMemo(a,n)};an.useReducer=function(a,n,h){return Qo.current.useReducer(a,n,h)};an.useRef=function(a){return Qo.current.useRef(a)};an.useState=function(a){return Qo.current.useState(a)};an.useSyncExternalStore=function(a,n,h){return Qo.current.useSyncExternalStore(a,n,h)};an.useTransition=function(){return Qo.current.useTransition()};an.version="18.3.1";lD.exports=an;var rr=lD.exports;const gD=zg(rr),mN=Q5({__proto__:null,default:gD},[rr]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _N=rr,gN=Symbol.for("react.element"),yN=Symbol.for("react.fragment"),vN=Object.prototype.hasOwnProperty,xN=_N.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,bN={key:!0,ref:!0,__self:!0,__source:!0};function yD(a,n,h){var m,y={},b=null,M=null;h!==void 0&&(b=""+h),n.key!==void 0&&(b=""+n.key),n.ref!==void 0&&(M=n.ref);for(m in n)vN.call(n,m)&&!bN.hasOwnProperty(m)&&(y[m]=n[m]);if(a&&a.defaultProps)for(m in n=a.defaultProps,n)y[m]===void 0&&(y[m]=n[m]);return{$$typeof:gN,type:a,key:b,ref:M,props:y,_owner:xN.current}}kx.Fragment=yN;kx.jsx=yD;kx.jsxs=yD;aD.exports=kx;var ir=aD.exports,fT={},vD={exports:{}},ea={},xD={exports:{}},bD={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(a){function n(at,Ve){var Dt=at.length;at.push(Ve);e:for(;0<Dt;){var Bt=Dt-1>>>1,Gt=at[Bt];if(0<y(Gt,Ve))at[Bt]=Ve,at[Dt]=Gt,Dt=Bt;else break e}}function h(at){return at.length===0?null:at[0]}function m(at){if(at.length===0)return null;var Ve=at[0],Dt=at.pop();if(Dt!==Ve){at[0]=Dt;e:for(var Bt=0,Gt=at.length,qt=Gt>>>1;Bt<qt;){var or=2*(Bt+1)-1,et=at[or],kt=or+1,Vt=at[kt];if(0>y(et,Dt))kt<Gt&&0>y(Vt,et)?(at[Bt]=Vt,at[kt]=Dt,Bt=kt):(at[Bt]=et,at[or]=Dt,Bt=or);else if(kt<Gt&&0>y(Vt,Dt))at[Bt]=Vt,at[kt]=Dt,Bt=kt;else break e}}return Ve}function y(at,Ve){var Dt=at.sortIndex-Ve.sortIndex;return Dt!==0?Dt:at.id-Ve.id}if(typeof performance=="object"&&typeof performance.now=="function"){var b=performance;a.unstable_now=function(){return b.now()}}else{var M=Date,P=M.now();a.unstable_now=function(){return M.now()-P}}var o=[],R=[],U=1,V=null,Z=3,te=!1,se=!1,re=!1,Te=typeof setTimeout=="function"?setTimeout:null,ae=typeof clearTimeout=="function"?clearTimeout:null,q=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Q(at){for(var Ve=h(R);Ve!==null;){if(Ve.callback===null)m(R);else if(Ve.startTime<=at)m(R),Ve.sortIndex=Ve.expirationTime,n(o,Ve);else break;Ve=h(R)}}function le(at){if(re=!1,Q(at),!se)if(h(o)!==null)se=!0,rt(ye);else{var Ve=h(R);Ve!==null&&st(le,Ve.startTime-at)}}function ye(at,Ve){se=!1,re&&(re=!1,ae(Ne),Ne=-1),te=!0;var Dt=Z;try{for(Q(Ve),V=h(o);V!==null&&(!(V.expirationTime>Ve)||at&&!Ie());){var Bt=V.callback;if(typeof Bt=="function"){V.callback=null,Z=V.priorityLevel;var Gt=Bt(V.expirationTime<=Ve);Ve=a.unstable_now(),typeof Gt=="function"?V.callback=Gt:V===h(o)&&m(o),Q(Ve)}else m(o);V=h(o)}if(V!==null)var qt=!0;else{var or=h(R);or!==null&&st(le,or.startTime-Ve),qt=!1}return qt}finally{V=null,Z=Dt,te=!1}}var ze=!1,He=null,Ne=-1,xe=5,Me=-1;function Ie(){return!(a.unstable_now()-Me<xe)}function Je(){if(He!==null){var at=a.unstable_now();Me=at;var Ve=!0;try{Ve=He(!0,at)}finally{Ve?Be():(ze=!1,He=null)}}else ze=!1}var Be;if(typeof q=="function")Be=function(){q(Je)};else if(typeof MessageChannel<"u"){var Ce=new MessageChannel,Re=Ce.port2;Ce.port1.onmessage=Je,Be=function(){Re.postMessage(null)}}else Be=function(){Te(Je,0)};function rt(at){He=at,ze||(ze=!0,Be())}function st(at,Ve){Ne=Te(function(){at(a.unstable_now())},Ve)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(at){at.callback=null},a.unstable_continueExecution=function(){se||te||(se=!0,rt(ye))},a.unstable_forceFrameRate=function(at){0>at||125<at?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):xe=0<at?Math.floor(1e3/at):5},a.unstable_getCurrentPriorityLevel=function(){return Z},a.unstable_getFirstCallbackNode=function(){return h(o)},a.unstable_next=function(at){switch(Z){case 1:case 2:case 3:var Ve=3;break;default:Ve=Z}var Dt=Z;Z=Ve;try{return at()}finally{Z=Dt}},a.unstable_pauseExecution=function(){},a.unstable_requestPaint=function(){},a.unstable_runWithPriority=function(at,Ve){switch(at){case 1:case 2:case 3:case 4:case 5:break;default:at=3}var Dt=Z;Z=at;try{return Ve()}finally{Z=Dt}},a.unstable_scheduleCallback=function(at,Ve,Dt){var Bt=a.unstable_now();switch(typeof Dt=="object"&&Dt!==null?(Dt=Dt.delay,Dt=typeof Dt=="number"&&0<Dt?Bt+Dt:Bt):Dt=Bt,at){case 1:var Gt=-1;break;case 2:Gt=250;break;case 5:Gt=1073741823;break;case 4:Gt=1e4;break;default:Gt=5e3}return Gt=Dt+Gt,at={id:U++,callback:Ve,priorityLevel:at,startTime:Dt,expirationTime:Gt,sortIndex:-1},Dt>Bt?(at.sortIndex=Dt,n(R,at),h(o)===null&&at===h(R)&&(re?(ae(Ne),Ne=-1):re=!0,st(le,Dt-Bt))):(at.sortIndex=Gt,n(o,at),se||te||(se=!0,rt(ye))),at},a.unstable_shouldYield=Ie,a.unstable_wrapCallback=function(at){var Ve=Z;return function(){var Dt=Z;Z=Ve;try{return at.apply(this,arguments)}finally{Z=Dt}}}})(bD);xD.exports=bD;var wN=xD.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TN=rr,Qs=wN;function Zt(a){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+a,h=1;h<arguments.length;h++)n+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+a+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var wD=new Set,ag={};function Af(a,n){gp(a,n),gp(a+"Capture",n)}function gp(a,n){for(ag[a]=n,a=0;a<n.length;a++)wD.add(n[a])}var Pu=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),dT=Object.prototype.hasOwnProperty,SN=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,l3={},u3={};function EN(a){return dT.call(u3,a)?!0:dT.call(l3,a)?!1:SN.test(a)?u3[a]=!0:(l3[a]=!0,!1)}function MN(a,n,h,m){if(h!==null&&h.type===0)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return m?!1:h!==null?!h.acceptsBooleans:(a=a.toLowerCase().slice(0,5),a!=="data-"&&a!=="aria-");default:return!1}}function IN(a,n,h,m){if(n===null||typeof n>"u"||MN(a,n,h,m))return!0;if(m)return!1;if(h!==null)switch(h.type){case 3:return!n;case 4:return n===!1;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}function Jo(a,n,h,m,y,b,M){this.acceptsBooleans=n===2||n===3||n===4,this.attributeName=m,this.attributeNamespace=y,this.mustUseProperty=h,this.propertyName=a,this.type=n,this.sanitizeURL=b,this.removeEmptyString=M}var mo={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){mo[a]=new Jo(a,0,!1,a,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var n=a[0];mo[n]=new Jo(n,1,!1,a[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(a){mo[a]=new Jo(a,2,!1,a.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){mo[a]=new Jo(a,2,!1,a,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){mo[a]=new Jo(a,3,!1,a.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(a){mo[a]=new Jo(a,3,!0,a,null,!1,!1)});["capture","download"].forEach(function(a){mo[a]=new Jo(a,4,!1,a,null,!1,!1)});["cols","rows","size","span"].forEach(function(a){mo[a]=new Jo(a,6,!1,a,null,!1,!1)});["rowSpan","start"].forEach(function(a){mo[a]=new Jo(a,5,!1,a.toLowerCase(),null,!1,!1)});var YS=/[\-:]([a-z])/g;function KS(a){return a[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var n=a.replace(YS,KS);mo[n]=new Jo(n,1,!1,a,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var n=a.replace(YS,KS);mo[n]=new Jo(n,1,!1,a,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(a){var n=a.replace(YS,KS);mo[n]=new Jo(n,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(a){mo[a]=new Jo(a,1,!1,a.toLowerCase(),null,!1,!1)});mo.xlinkHref=new Jo("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(a){mo[a]=new Jo(a,1,!1,a.toLowerCase(),null,!0,!0)});function QS(a,n,h,m){var y=mo.hasOwnProperty(n)?mo[n]:null;(y!==null?y.type!==0:m||!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(IN(n,h,y,m)&&(h=null),m||y===null?EN(n)&&(h===null?a.removeAttribute(n):a.setAttribute(n,""+h)):y.mustUseProperty?a[y.propertyName]=h===null?y.type===3?!1:"":h:(n=y.attributeName,m=y.attributeNamespace,h===null?a.removeAttribute(n):(y=y.type,h=y===3||y===4&&h===!0?"":""+h,m?a.setAttributeNS(m,n,h):a.setAttribute(n,h))))}var zu=TN.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,q0=Symbol.for("react.element"),Gd=Symbol.for("react.portal"),Wd=Symbol.for("react.fragment"),JS=Symbol.for("react.strict_mode"),pT=Symbol.for("react.profiler"),TD=Symbol.for("react.provider"),SD=Symbol.for("react.context"),eE=Symbol.for("react.forward_ref"),mT=Symbol.for("react.suspense"),_T=Symbol.for("react.suspense_list"),tE=Symbol.for("react.memo"),Pc=Symbol.for("react.lazy"),ED=Symbol.for("react.offscreen"),c3=Symbol.iterator;function S_(a){return a===null||typeof a!="object"?null:(a=c3&&a[c3]||a["@@iterator"],typeof a=="function"?a:null)}var gi=Object.assign,cw;function F_(a){if(cw===void 0)try{throw Error()}catch(h){var n=h.stack.trim().match(/\n( *(at )?)/);cw=n&&n[1]||""}return`
`+cw+a}var hw=!1;function fw(a,n){if(!a||hw)return"";hw=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n,[])}catch(R){var m=R}Reflect.construct(a,[],n)}else{try{n.call()}catch(R){m=R}a.call(n.prototype)}else{try{throw Error()}catch(R){m=R}a()}}catch(R){if(R&&m&&typeof R.stack=="string"){for(var y=R.stack.split(`
`),b=m.stack.split(`
`),M=y.length-1,P=b.length-1;1<=M&&0<=P&&y[M]!==b[P];)P--;for(;1<=M&&0<=P;M--,P--)if(y[M]!==b[P]){if(M!==1||P!==1)do if(M--,P--,0>P||y[M]!==b[P]){var o=`
`+y[M].replace(" at new "," at ");return a.displayName&&o.includes("<anonymous>")&&(o=o.replace("<anonymous>",a.displayName)),o}while(1<=M&&0<=P);break}}}finally{hw=!1,Error.prepareStackTrace=h}return(a=a?a.displayName||a.name:"")?F_(a):""}function AN(a){switch(a.tag){case 5:return F_(a.type);case 16:return F_("Lazy");case 13:return F_("Suspense");case 19:return F_("SuspenseList");case 0:case 2:case 15:return a=fw(a.type,!1),a;case 11:return a=fw(a.type.render,!1),a;case 1:return a=fw(a.type,!0),a;default:return""}}function gT(a){if(a==null)return null;if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case Wd:return"Fragment";case Gd:return"Portal";case pT:return"Profiler";case JS:return"StrictMode";case mT:return"Suspense";case _T:return"SuspenseList"}if(typeof a=="object")switch(a.$$typeof){case SD:return(a.displayName||"Context")+".Consumer";case TD:return(a._context.displayName||"Context")+".Provider";case eE:var n=a.render;return a=a.displayName,a||(a=n.displayName||n.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case tE:return n=a.displayName||null,n!==null?n:gT(a.type)||"Memo";case Pc:n=a._payload,a=a._init;try{return gT(a(n))}catch{}}return null}function CN(a){var n=a.type;switch(a.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return a=n.render,a=a.displayName||a.name||"",n.displayName||(a!==""?"ForwardRef("+a+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return gT(n);case 8:return n===JS?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n}return null}function Qc(a){switch(typeof a){case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function MD(a){var n=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function PN(a){var n=MD(a)?"checked":"value",h=Object.getOwnPropertyDescriptor(a.constructor.prototype,n),m=""+a[n];if(!a.hasOwnProperty(n)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var y=h.get,b=h.set;return Object.defineProperty(a,n,{configurable:!0,get:function(){return y.call(this)},set:function(M){m=""+M,b.call(this,M)}}),Object.defineProperty(a,n,{enumerable:h.enumerable}),{getValue:function(){return m},setValue:function(M){m=""+M},stopTracking:function(){a._valueTracker=null,delete a[n]}}}}function H0(a){a._valueTracker||(a._valueTracker=PN(a))}function ID(a){if(!a)return!1;var n=a._valueTracker;if(!n)return!0;var h=n.getValue(),m="";return a&&(m=MD(a)?a.checked?"true":"false":a.value),a=m,a!==h?(n.setValue(a),!0):!1}function jv(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}function yT(a,n){var h=n.checked;return gi({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??a._wrapperState.initialChecked})}function h3(a,n){var h=n.defaultValue==null?"":n.defaultValue,m=n.checked!=null?n.checked:n.defaultChecked;h=Qc(n.value!=null?n.value:h),a._wrapperState={initialChecked:m,initialValue:h,controlled:n.type==="checkbox"||n.type==="radio"?n.checked!=null:n.value!=null}}function AD(a,n){n=n.checked,n!=null&&QS(a,"checked",n,!1)}function vT(a,n){AD(a,n);var h=Qc(n.value),m=n.type;if(h!=null)m==="number"?(h===0&&a.value===""||a.value!=h)&&(a.value=""+h):a.value!==""+h&&(a.value=""+h);else if(m==="submit"||m==="reset"){a.removeAttribute("value");return}n.hasOwnProperty("value")?xT(a,n.type,h):n.hasOwnProperty("defaultValue")&&xT(a,n.type,Qc(n.defaultValue)),n.checked==null&&n.defaultChecked!=null&&(a.defaultChecked=!!n.defaultChecked)}function f3(a,n,h){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var m=n.type;if(!(m!=="submit"&&m!=="reset"||n.value!==void 0&&n.value!==null))return;n=""+a._wrapperState.initialValue,h||n===a.value||(a.value=n),a.defaultValue=n}h=a.name,h!==""&&(a.name=""),a.defaultChecked=!!a._wrapperState.initialChecked,h!==""&&(a.name=h)}function xT(a,n,h){(n!=="number"||jv(a.ownerDocument)!==a)&&(h==null?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+h&&(a.defaultValue=""+h))}var B_=Array.isArray;function op(a,n,h,m){if(a=a.options,n){n={};for(var y=0;y<h.length;y++)n["$"+h[y]]=!0;for(h=0;h<a.length;h++)y=n.hasOwnProperty("$"+a[h].value),a[h].selected!==y&&(a[h].selected=y),y&&m&&(a[h].defaultSelected=!0)}else{for(h=""+Qc(h),n=null,y=0;y<a.length;y++){if(a[y].value===h){a[y].selected=!0,m&&(a[y].defaultSelected=!0);return}n!==null||a[y].disabled||(n=a[y])}n!==null&&(n.selected=!0)}}function bT(a,n){if(n.dangerouslySetInnerHTML!=null)throw Error(Zt(91));return gi({},n,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}function d3(a,n){var h=n.value;if(h==null){if(h=n.children,n=n.defaultValue,h!=null){if(n!=null)throw Error(Zt(92));if(B_(h)){if(1<h.length)throw Error(Zt(93));h=h[0]}n=h}n==null&&(n=""),h=n}a._wrapperState={initialValue:Qc(h)}}function CD(a,n){var h=Qc(n.value),m=Qc(n.defaultValue);h!=null&&(h=""+h,h!==a.value&&(a.value=h),n.defaultValue==null&&a.defaultValue!==h&&(a.defaultValue=h)),m!=null&&(a.defaultValue=""+m)}function p3(a){var n=a.textContent;n===a._wrapperState.initialValue&&n!==""&&n!==null&&(a.value=n)}function PD(a){switch(a){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function wT(a,n){return a==null||a==="http://www.w3.org/1999/xhtml"?PD(n):a==="http://www.w3.org/2000/svg"&&n==="foreignObject"?"http://www.w3.org/1999/xhtml":a}var Z0,OD=function(a){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(n,h,m,y){MSApp.execUnsafeLocalFunction(function(){return a(n,h,m,y)})}:a}(function(a,n){if(a.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in a)a.innerHTML=n;else{for(Z0=Z0||document.createElement("div"),Z0.innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=Z0.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;n.firstChild;)a.appendChild(n.firstChild)}});function lg(a,n){if(n){var h=a.firstChild;if(h&&h===a.lastChild&&h.nodeType===3){h.nodeValue=n;return}}a.textContent=n}var q_={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ON=["Webkit","ms","Moz","O"];Object.keys(q_).forEach(function(a){ON.forEach(function(n){n=n+a.charAt(0).toUpperCase()+a.substring(1),q_[n]=q_[a]})});function DD(a,n,h){return n==null||typeof n=="boolean"||n===""?"":h||typeof n!="number"||n===0||q_.hasOwnProperty(a)&&q_[a]?(""+n).trim():n+"px"}function RD(a,n){a=a.style;for(var h in n)if(n.hasOwnProperty(h)){var m=h.indexOf("--")===0,y=DD(h,n[h],m);h==="float"&&(h="cssFloat"),m?a.setProperty(h,y):a[h]=y}}var DN=gi({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function TT(a,n){if(n){if(DN[a]&&(n.children!=null||n.dangerouslySetInnerHTML!=null))throw Error(Zt(137,a));if(n.dangerouslySetInnerHTML!=null){if(n.children!=null)throw Error(Zt(60));if(typeof n.dangerouslySetInnerHTML!="object"||!("__html"in n.dangerouslySetInnerHTML))throw Error(Zt(61))}if(n.style!=null&&typeof n.style!="object")throw Error(Zt(62))}}function ST(a,n){if(a.indexOf("-")===-1)return typeof n.is=="string";switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ET=null;function rE(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var MT=null,sp=null,ap=null;function m3(a){if(a=Ug(a)){if(typeof MT!="function")throw Error(Zt(280));var n=a.stateNode;n&&(n=Nx(n),MT(a.stateNode,a.type,n))}}function kD(a){sp?ap?ap.push(a):ap=[a]:sp=a}function LD(){if(sp){var a=sp,n=ap;if(ap=sp=null,m3(a),n)for(a=0;a<n.length;a++)m3(n[a])}}function zD(a,n){return a(n)}function FD(){}var dw=!1;function BD(a,n,h){if(dw)return a(n,h);dw=!0;try{return zD(a,n,h)}finally{dw=!1,(sp!==null||ap!==null)&&(FD(),LD())}}function ug(a,n){var h=a.stateNode;if(h===null)return null;var m=Nx(h);if(m===null)return null;h=m[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(a=a.type,m=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!m;break e;default:a=!1}if(a)return null;if(h&&typeof h!="function")throw Error(Zt(231,n,typeof h));return h}var IT=!1;if(Pu)try{var E_={};Object.defineProperty(E_,"passive",{get:function(){IT=!0}}),window.addEventListener("test",E_,E_),window.removeEventListener("test",E_,E_)}catch{IT=!1}function RN(a,n,h,m,y,b,M,P,o){var R=Array.prototype.slice.call(arguments,3);try{n.apply(h,R)}catch(U){this.onError(U)}}var H_=!1,Vv=null,$v=!1,AT=null,kN={onError:function(a){H_=!0,Vv=a}};function LN(a,n,h,m,y,b,M,P,o){H_=!1,Vv=null,RN.apply(kN,arguments)}function zN(a,n,h,m,y,b,M,P,o){if(LN.apply(this,arguments),H_){if(H_){var R=Vv;H_=!1,Vv=null}else throw Error(Zt(198));$v||($v=!0,AT=R)}}function Cf(a){var n=a,h=a;if(a.alternate)for(;n.return;)n=n.return;else{a=n;do n=a,n.flags&4098&&(h=n.return),a=n.return;while(a)}return n.tag===3?h:null}function ND(a){if(a.tag===13){var n=a.memoizedState;if(n===null&&(a=a.alternate,a!==null&&(n=a.memoizedState)),n!==null)return n.dehydrated}return null}function _3(a){if(Cf(a)!==a)throw Error(Zt(188))}function FN(a){var n=a.alternate;if(!n){if(n=Cf(a),n===null)throw Error(Zt(188));return n!==a?null:a}for(var h=a,m=n;;){var y=h.return;if(y===null)break;var b=y.alternate;if(b===null){if(m=y.return,m!==null){h=m;continue}break}if(y.child===b.child){for(b=y.child;b;){if(b===h)return _3(y),a;if(b===m)return _3(y),n;b=b.sibling}throw Error(Zt(188))}if(h.return!==m.return)h=y,m=b;else{for(var M=!1,P=y.child;P;){if(P===h){M=!0,h=y,m=b;break}if(P===m){M=!0,m=y,h=b;break}P=P.sibling}if(!M){for(P=b.child;P;){if(P===h){M=!0,h=b,m=y;break}if(P===m){M=!0,m=b,h=y;break}P=P.sibling}if(!M)throw Error(Zt(189))}}if(h.alternate!==m)throw Error(Zt(190))}if(h.tag!==3)throw Error(Zt(188));return h.stateNode.current===h?a:n}function UD(a){return a=FN(a),a!==null?jD(a):null}function jD(a){if(a.tag===5||a.tag===6)return a;for(a=a.child;a!==null;){var n=jD(a);if(n!==null)return n;a=a.sibling}return null}var VD=Qs.unstable_scheduleCallback,g3=Qs.unstable_cancelCallback,BN=Qs.unstable_shouldYield,NN=Qs.unstable_requestPaint,Mi=Qs.unstable_now,UN=Qs.unstable_getCurrentPriorityLevel,nE=Qs.unstable_ImmediatePriority,$D=Qs.unstable_UserBlockingPriority,Gv=Qs.unstable_NormalPriority,jN=Qs.unstable_LowPriority,GD=Qs.unstable_IdlePriority,Lx=null,Ll=null;function VN(a){if(Ll&&typeof Ll.onCommitFiberRoot=="function")try{Ll.onCommitFiberRoot(Lx,a,void 0,(a.current.flags&128)===128)}catch{}}var al=Math.clz32?Math.clz32:WN,$N=Math.log,GN=Math.LN2;function WN(a){return a>>>=0,a===0?32:31-($N(a)/GN|0)|0}var X0=64,Y0=4194304;function N_(a){switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return a&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return a}}function Wv(a,n){var h=a.pendingLanes;if(h===0)return 0;var m=0,y=a.suspendedLanes,b=a.pingedLanes,M=h&268435455;if(M!==0){var P=M&~y;P!==0?m=N_(P):(b&=M,b!==0&&(m=N_(b)))}else M=h&~y,M!==0?m=N_(M):b!==0&&(m=N_(b));if(m===0)return 0;if(n!==0&&n!==m&&!(n&y)&&(y=m&-m,b=n&-n,y>=b||y===16&&(b&4194240)!==0))return n;if(m&4&&(m|=h&16),n=a.entangledLanes,n!==0)for(a=a.entanglements,n&=m;0<n;)h=31-al(n),y=1<<h,m|=a[h],n&=~y;return m}function qN(a,n){switch(a){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function HN(a,n){for(var h=a.suspendedLanes,m=a.pingedLanes,y=a.expirationTimes,b=a.pendingLanes;0<b;){var M=31-al(b),P=1<<M,o=y[M];o===-1?(!(P&h)||P&m)&&(y[M]=qN(P,n)):o<=n&&(a.expiredLanes|=P),b&=~P}}function CT(a){return a=a.pendingLanes&-1073741825,a!==0?a:a&1073741824?1073741824:0}function WD(){var a=X0;return X0<<=1,!(X0&4194240)&&(X0=64),a}function pw(a){for(var n=[],h=0;31>h;h++)n.push(a);return n}function Bg(a,n,h){a.pendingLanes|=n,n!==536870912&&(a.suspendedLanes=0,a.pingedLanes=0),a=a.eventTimes,n=31-al(n),a[n]=h}function ZN(a,n){var h=a.pendingLanes&~n;a.pendingLanes=n,a.suspendedLanes=0,a.pingedLanes=0,a.expiredLanes&=n,a.mutableReadLanes&=n,a.entangledLanes&=n,n=a.entanglements;var m=a.eventTimes;for(a=a.expirationTimes;0<h;){var y=31-al(h),b=1<<y;n[y]=0,m[y]=-1,a[y]=-1,h&=~b}}function iE(a,n){var h=a.entangledLanes|=n;for(a=a.entanglements;h;){var m=31-al(h),y=1<<m;y&n|a[m]&n&&(a[m]|=n),h&=~y}}var Pn=0;function qD(a){return a&=-a,1<a?4<a?a&268435455?16:536870912:4:1}var HD,oE,ZD,XD,YD,PT=!1,K0=[],Vc=null,$c=null,Gc=null,cg=new Map,hg=new Map,Rc=[],XN="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function y3(a,n){switch(a){case"focusin":case"focusout":Vc=null;break;case"dragenter":case"dragleave":$c=null;break;case"mouseover":case"mouseout":Gc=null;break;case"pointerover":case"pointerout":cg.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":hg.delete(n.pointerId)}}function M_(a,n,h,m,y,b){return a===null||a.nativeEvent!==b?(a={blockedOn:n,domEventName:h,eventSystemFlags:m,nativeEvent:b,targetContainers:[y]},n!==null&&(n=Ug(n),n!==null&&oE(n)),a):(a.eventSystemFlags|=m,n=a.targetContainers,y!==null&&n.indexOf(y)===-1&&n.push(y),a)}function YN(a,n,h,m,y){switch(n){case"focusin":return Vc=M_(Vc,a,n,h,m,y),!0;case"dragenter":return $c=M_($c,a,n,h,m,y),!0;case"mouseover":return Gc=M_(Gc,a,n,h,m,y),!0;case"pointerover":var b=y.pointerId;return cg.set(b,M_(cg.get(b)||null,a,n,h,m,y)),!0;case"gotpointercapture":return b=y.pointerId,hg.set(b,M_(hg.get(b)||null,a,n,h,m,y)),!0}return!1}function KD(a){var n=lf(a.target);if(n!==null){var h=Cf(n);if(h!==null){if(n=h.tag,n===13){if(n=ND(h),n!==null){a.blockedOn=n,YD(a.priority,function(){ZD(h)});return}}else if(n===3&&h.stateNode.current.memoizedState.isDehydrated){a.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}a.blockedOn=null}function _v(a){if(a.blockedOn!==null)return!1;for(var n=a.targetContainers;0<n.length;){var h=OT(a.domEventName,a.eventSystemFlags,n[0],a.nativeEvent);if(h===null){h=a.nativeEvent;var m=new h.constructor(h.type,h);ET=m,h.target.dispatchEvent(m),ET=null}else return n=Ug(h),n!==null&&oE(n),a.blockedOn=h,!1;n.shift()}return!0}function v3(a,n,h){_v(a)&&h.delete(n)}function KN(){PT=!1,Vc!==null&&_v(Vc)&&(Vc=null),$c!==null&&_v($c)&&($c=null),Gc!==null&&_v(Gc)&&(Gc=null),cg.forEach(v3),hg.forEach(v3)}function I_(a,n){a.blockedOn===n&&(a.blockedOn=null,PT||(PT=!0,Qs.unstable_scheduleCallback(Qs.unstable_NormalPriority,KN)))}function fg(a){function n(y){return I_(y,a)}if(0<K0.length){I_(K0[0],a);for(var h=1;h<K0.length;h++){var m=K0[h];m.blockedOn===a&&(m.blockedOn=null)}}for(Vc!==null&&I_(Vc,a),$c!==null&&I_($c,a),Gc!==null&&I_(Gc,a),cg.forEach(n),hg.forEach(n),h=0;h<Rc.length;h++)m=Rc[h],m.blockedOn===a&&(m.blockedOn=null);for(;0<Rc.length&&(h=Rc[0],h.blockedOn===null);)KD(h),h.blockedOn===null&&Rc.shift()}var lp=zu.ReactCurrentBatchConfig,qv=!0;function QN(a,n,h,m){var y=Pn,b=lp.transition;lp.transition=null;try{Pn=1,sE(a,n,h,m)}finally{Pn=y,lp.transition=b}}function JN(a,n,h,m){var y=Pn,b=lp.transition;lp.transition=null;try{Pn=4,sE(a,n,h,m)}finally{Pn=y,lp.transition=b}}function sE(a,n,h,m){if(qv){var y=OT(a,n,h,m);if(y===null)Sw(a,n,m,Hv,h),y3(a,m);else if(YN(y,a,n,h,m))m.stopPropagation();else if(y3(a,m),n&4&&-1<XN.indexOf(a)){for(;y!==null;){var b=Ug(y);if(b!==null&&HD(b),b=OT(a,n,h,m),b===null&&Sw(a,n,m,Hv,h),b===y)break;y=b}y!==null&&m.stopPropagation()}else Sw(a,n,m,null,h)}}var Hv=null;function OT(a,n,h,m){if(Hv=null,a=rE(m),a=lf(a),a!==null)if(n=Cf(a),n===null)a=null;else if(h=n.tag,h===13){if(a=ND(n),a!==null)return a;a=null}else if(h===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;a=null}else n!==a&&(a=null);return Hv=a,null}function QD(a){switch(a){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(UN()){case nE:return 1;case $D:return 4;case Gv:case jN:return 16;case GD:return 536870912;default:return 16}default:return 16}}var Lc=null,aE=null,gv=null;function JD(){if(gv)return gv;var a,n=aE,h=n.length,m,y="value"in Lc?Lc.value:Lc.textContent,b=y.length;for(a=0;a<h&&n[a]===y[a];a++);var M=h-a;for(m=1;m<=M&&n[h-m]===y[b-m];m++);return gv=y.slice(a,1<m?1-m:void 0)}function yv(a){var n=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&n===13&&(a=13)):a=n,a===10&&(a=13),32<=a||a===13?a:0}function Q0(){return!0}function x3(){return!1}function ta(a){function n(h,m,y,b,M){this._reactName=h,this._targetInst=y,this.type=m,this.nativeEvent=b,this.target=M,this.currentTarget=null;for(var P in a)a.hasOwnProperty(P)&&(h=a[P],this[P]=h?h(b):b[P]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?Q0:x3,this.isPropagationStopped=x3,this}return gi(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=Q0)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=Q0)},persist:function(){},isPersistent:Q0}),n}var Lp={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lE=ta(Lp),Ng=gi({},Lp,{view:0,detail:0}),e6=ta(Ng),mw,_w,A_,zx=gi({},Ng,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:uE,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==A_&&(A_&&a.type==="mousemove"?(mw=a.screenX-A_.screenX,_w=a.screenY-A_.screenY):_w=mw=0,A_=a),mw)},movementY:function(a){return"movementY"in a?a.movementY:_w}}),b3=ta(zx),t6=gi({},zx,{dataTransfer:0}),r6=ta(t6),n6=gi({},Ng,{relatedTarget:0}),gw=ta(n6),i6=gi({},Lp,{animationName:0,elapsedTime:0,pseudoElement:0}),o6=ta(i6),s6=gi({},Lp,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),a6=ta(s6),l6=gi({},Lp,{data:0}),w3=ta(l6),u6={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},c6={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},h6={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function f6(a){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(a):(a=h6[a])?!!n[a]:!1}function uE(){return f6}var d6=gi({},Ng,{key:function(a){if(a.key){var n=u6[a.key]||a.key;if(n!=="Unidentified")return n}return a.type==="keypress"?(a=yv(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?c6[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:uE,charCode:function(a){return a.type==="keypress"?yv(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?yv(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),p6=ta(d6),m6=gi({},zx,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),T3=ta(m6),_6=gi({},Ng,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:uE}),g6=ta(_6),y6=gi({},Lp,{propertyName:0,elapsedTime:0,pseudoElement:0}),v6=ta(y6),x6=gi({},zx,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),b6=ta(x6),w6=[9,13,27,32],cE=Pu&&"CompositionEvent"in window,Z_=null;Pu&&"documentMode"in document&&(Z_=document.documentMode);var T6=Pu&&"TextEvent"in window&&!Z_,eR=Pu&&(!cE||Z_&&8<Z_&&11>=Z_),S3=" ",E3=!1;function tR(a,n){switch(a){case"keyup":return w6.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function rR(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var qd=!1;function S6(a,n){switch(a){case"compositionend":return rR(n);case"keypress":return n.which!==32?null:(E3=!0,S3);case"textInput":return a=n.data,a===S3&&E3?null:a;default:return null}}function E6(a,n){if(qd)return a==="compositionend"||!cE&&tR(a,n)?(a=JD(),gv=aE=Lc=null,qd=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return eR&&n.locale!=="ko"?null:n.data;default:return null}}var M6={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function M3(a){var n=a&&a.nodeName&&a.nodeName.toLowerCase();return n==="input"?!!M6[a.type]:n==="textarea"}function nR(a,n,h,m){kD(m),n=Zv(n,"onChange"),0<n.length&&(h=new lE("onChange","change",null,h,m),a.push({event:h,listeners:n}))}var X_=null,dg=null;function I6(a){pR(a,0)}function Fx(a){var n=Xd(a);if(ID(n))return a}function A6(a,n){if(a==="change")return n}var iR=!1;if(Pu){var yw;if(Pu){var vw="oninput"in document;if(!vw){var I3=document.createElement("div");I3.setAttribute("oninput","return;"),vw=typeof I3.oninput=="function"}yw=vw}else yw=!1;iR=yw&&(!document.documentMode||9<document.documentMode)}function A3(){X_&&(X_.detachEvent("onpropertychange",oR),dg=X_=null)}function oR(a){if(a.propertyName==="value"&&Fx(dg)){var n=[];nR(n,dg,a,rE(a)),BD(I6,n)}}function C6(a,n,h){a==="focusin"?(A3(),X_=n,dg=h,X_.attachEvent("onpropertychange",oR)):a==="focusout"&&A3()}function P6(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Fx(dg)}function O6(a,n){if(a==="click")return Fx(n)}function D6(a,n){if(a==="input"||a==="change")return Fx(n)}function R6(a,n){return a===n&&(a!==0||1/a===1/n)||a!==a&&n!==n}var cl=typeof Object.is=="function"?Object.is:R6;function pg(a,n){if(cl(a,n))return!0;if(typeof a!="object"||a===null||typeof n!="object"||n===null)return!1;var h=Object.keys(a),m=Object.keys(n);if(h.length!==m.length)return!1;for(m=0;m<h.length;m++){var y=h[m];if(!dT.call(n,y)||!cl(a[y],n[y]))return!1}return!0}function C3(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function P3(a,n){var h=C3(a);a=0;for(var m;h;){if(h.nodeType===3){if(m=a+h.textContent.length,a<=n&&m>=n)return{node:h,offset:n-a};a=m}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=C3(h)}}function sR(a,n){return a&&n?a===n?!0:a&&a.nodeType===3?!1:n&&n.nodeType===3?sR(a,n.parentNode):"contains"in a?a.contains(n):a.compareDocumentPosition?!!(a.compareDocumentPosition(n)&16):!1:!1}function aR(){for(var a=window,n=jv();n instanceof a.HTMLIFrameElement;){try{var h=typeof n.contentWindow.location.href=="string"}catch{h=!1}if(h)a=n.contentWindow;else break;n=jv(a.document)}return n}function hE(a){var n=a&&a.nodeName&&a.nodeName.toLowerCase();return n&&(n==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||n==="textarea"||a.contentEditable==="true")}function k6(a){var n=aR(),h=a.focusedElem,m=a.selectionRange;if(n!==h&&h&&h.ownerDocument&&sR(h.ownerDocument.documentElement,h)){if(m!==null&&hE(h)){if(n=m.start,a=m.end,a===void 0&&(a=n),"selectionStart"in h)h.selectionStart=n,h.selectionEnd=Math.min(a,h.value.length);else if(a=(n=h.ownerDocument||document)&&n.defaultView||window,a.getSelection){a=a.getSelection();var y=h.textContent.length,b=Math.min(m.start,y);m=m.end===void 0?b:Math.min(m.end,y),!a.extend&&b>m&&(y=m,m=b,b=y),y=P3(h,b);var M=P3(h,m);y&&M&&(a.rangeCount!==1||a.anchorNode!==y.node||a.anchorOffset!==y.offset||a.focusNode!==M.node||a.focusOffset!==M.offset)&&(n=n.createRange(),n.setStart(y.node,y.offset),a.removeAllRanges(),b>m?(a.addRange(n),a.extend(M.node,M.offset)):(n.setEnd(M.node,M.offset),a.addRange(n)))}}for(n=[],a=h;a=a.parentNode;)a.nodeType===1&&n.push({element:a,left:a.scrollLeft,top:a.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<n.length;h++)a=n[h],a.element.scrollLeft=a.left,a.element.scrollTop=a.top}}var L6=Pu&&"documentMode"in document&&11>=document.documentMode,Hd=null,DT=null,Y_=null,RT=!1;function O3(a,n,h){var m=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;RT||Hd==null||Hd!==jv(m)||(m=Hd,"selectionStart"in m&&hE(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Y_&&pg(Y_,m)||(Y_=m,m=Zv(DT,"onSelect"),0<m.length&&(n=new lE("onSelect","select",null,n,h),a.push({event:n,listeners:m}),n.target=Hd)))}function J0(a,n){var h={};return h[a.toLowerCase()]=n.toLowerCase(),h["Webkit"+a]="webkit"+n,h["Moz"+a]="moz"+n,h}var Zd={animationend:J0("Animation","AnimationEnd"),animationiteration:J0("Animation","AnimationIteration"),animationstart:J0("Animation","AnimationStart"),transitionend:J0("Transition","TransitionEnd")},xw={},lR={};Pu&&(lR=document.createElement("div").style,"AnimationEvent"in window||(delete Zd.animationend.animation,delete Zd.animationiteration.animation,delete Zd.animationstart.animation),"TransitionEvent"in window||delete Zd.transitionend.transition);function Bx(a){if(xw[a])return xw[a];if(!Zd[a])return a;var n=Zd[a],h;for(h in n)if(n.hasOwnProperty(h)&&h in lR)return xw[a]=n[h];return a}var uR=Bx("animationend"),cR=Bx("animationiteration"),hR=Bx("animationstart"),fR=Bx("transitionend"),dR=new Map,D3="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function nh(a,n){dR.set(a,n),Af(n,[a])}for(var bw=0;bw<D3.length;bw++){var ww=D3[bw],z6=ww.toLowerCase(),F6=ww[0].toUpperCase()+ww.slice(1);nh(z6,"on"+F6)}nh(uR,"onAnimationEnd");nh(cR,"onAnimationIteration");nh(hR,"onAnimationStart");nh("dblclick","onDoubleClick");nh("focusin","onFocus");nh("focusout","onBlur");nh(fR,"onTransitionEnd");gp("onMouseEnter",["mouseout","mouseover"]);gp("onMouseLeave",["mouseout","mouseover"]);gp("onPointerEnter",["pointerout","pointerover"]);gp("onPointerLeave",["pointerout","pointerover"]);Af("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Af("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Af("onBeforeInput",["compositionend","keypress","textInput","paste"]);Af("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Af("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Af("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var U_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),B6=new Set("cancel close invalid load scroll toggle".split(" ").concat(U_));function R3(a,n,h){var m=a.type||"unknown-event";a.currentTarget=h,zN(m,n,void 0,a),a.currentTarget=null}function pR(a,n){n=(n&4)!==0;for(var h=0;h<a.length;h++){var m=a[h],y=m.event;m=m.listeners;e:{var b=void 0;if(n)for(var M=m.length-1;0<=M;M--){var P=m[M],o=P.instance,R=P.currentTarget;if(P=P.listener,o!==b&&y.isPropagationStopped())break e;R3(y,P,R),b=o}else for(M=0;M<m.length;M++){if(P=m[M],o=P.instance,R=P.currentTarget,P=P.listener,o!==b&&y.isPropagationStopped())break e;R3(y,P,R),b=o}}}if($v)throw a=AT,$v=!1,AT=null,a}function Zn(a,n){var h=n[BT];h===void 0&&(h=n[BT]=new Set);var m=a+"__bubble";h.has(m)||(mR(n,a,2,!1),h.add(m))}function Tw(a,n,h){var m=0;n&&(m|=4),mR(h,a,m,n)}var ev="_reactListening"+Math.random().toString(36).slice(2);function mg(a){if(!a[ev]){a[ev]=!0,wD.forEach(function(h){h!=="selectionchange"&&(B6.has(h)||Tw(h,!1,a),Tw(h,!0,a))});var n=a.nodeType===9?a:a.ownerDocument;n===null||n[ev]||(n[ev]=!0,Tw("selectionchange",!1,n))}}function mR(a,n,h,m){switch(QD(n)){case 1:var y=QN;break;case 4:y=JN;break;default:y=sE}h=y.bind(null,n,h,a),y=void 0,!IT||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(y=!0),m?y!==void 0?a.addEventListener(n,h,{capture:!0,passive:y}):a.addEventListener(n,h,!0):y!==void 0?a.addEventListener(n,h,{passive:y}):a.addEventListener(n,h,!1)}function Sw(a,n,h,m,y){var b=m;if(!(n&1)&&!(n&2)&&m!==null)e:for(;;){if(m===null)return;var M=m.tag;if(M===3||M===4){var P=m.stateNode.containerInfo;if(P===y||P.nodeType===8&&P.parentNode===y)break;if(M===4)for(M=m.return;M!==null;){var o=M.tag;if((o===3||o===4)&&(o=M.stateNode.containerInfo,o===y||o.nodeType===8&&o.parentNode===y))return;M=M.return}for(;P!==null;){if(M=lf(P),M===null)return;if(o=M.tag,o===5||o===6){m=b=M;continue e}P=P.parentNode}}m=m.return}BD(function(){var R=b,U=rE(h),V=[];e:{var Z=dR.get(a);if(Z!==void 0){var te=lE,se=a;switch(a){case"keypress":if(yv(h)===0)break e;case"keydown":case"keyup":te=p6;break;case"focusin":se="focus",te=gw;break;case"focusout":se="blur",te=gw;break;case"beforeblur":case"afterblur":te=gw;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":te=b3;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":te=r6;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":te=g6;break;case uR:case cR:case hR:te=o6;break;case fR:te=v6;break;case"scroll":te=e6;break;case"wheel":te=b6;break;case"copy":case"cut":case"paste":te=a6;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":te=T3}var re=(n&4)!==0,Te=!re&&a==="scroll",ae=re?Z!==null?Z+"Capture":null:Z;re=[];for(var q=R,Q;q!==null;){Q=q;var le=Q.stateNode;if(Q.tag===5&&le!==null&&(Q=le,ae!==null&&(le=ug(q,ae),le!=null&&re.push(_g(q,le,Q)))),Te)break;q=q.return}0<re.length&&(Z=new te(Z,se,null,h,U),V.push({event:Z,listeners:re}))}}if(!(n&7)){e:{if(Z=a==="mouseover"||a==="pointerover",te=a==="mouseout"||a==="pointerout",Z&&h!==ET&&(se=h.relatedTarget||h.fromElement)&&(lf(se)||se[Ou]))break e;if((te||Z)&&(Z=U.window===U?U:(Z=U.ownerDocument)?Z.defaultView||Z.parentWindow:window,te?(se=h.relatedTarget||h.toElement,te=R,se=se?lf(se):null,se!==null&&(Te=Cf(se),se!==Te||se.tag!==5&&se.tag!==6)&&(se=null)):(te=null,se=R),te!==se)){if(re=b3,le="onMouseLeave",ae="onMouseEnter",q="mouse",(a==="pointerout"||a==="pointerover")&&(re=T3,le="onPointerLeave",ae="onPointerEnter",q="pointer"),Te=te==null?Z:Xd(te),Q=se==null?Z:Xd(se),Z=new re(le,q+"leave",te,h,U),Z.target=Te,Z.relatedTarget=Q,le=null,lf(U)===R&&(re=new re(ae,q+"enter",se,h,U),re.target=Q,re.relatedTarget=Te,le=re),Te=le,te&&se)t:{for(re=te,ae=se,q=0,Q=re;Q;Q=Nd(Q))q++;for(Q=0,le=ae;le;le=Nd(le))Q++;for(;0<q-Q;)re=Nd(re),q--;for(;0<Q-q;)ae=Nd(ae),Q--;for(;q--;){if(re===ae||ae!==null&&re===ae.alternate)break t;re=Nd(re),ae=Nd(ae)}re=null}else re=null;te!==null&&k3(V,Z,te,re,!1),se!==null&&Te!==null&&k3(V,Te,se,re,!0)}}e:{if(Z=R?Xd(R):window,te=Z.nodeName&&Z.nodeName.toLowerCase(),te==="select"||te==="input"&&Z.type==="file")var ye=A6;else if(M3(Z))if(iR)ye=D6;else{ye=P6;var ze=C6}else(te=Z.nodeName)&&te.toLowerCase()==="input"&&(Z.type==="checkbox"||Z.type==="radio")&&(ye=O6);if(ye&&(ye=ye(a,R))){nR(V,ye,h,U);break e}ze&&ze(a,Z,R),a==="focusout"&&(ze=Z._wrapperState)&&ze.controlled&&Z.type==="number"&&xT(Z,"number",Z.value)}switch(ze=R?Xd(R):window,a){case"focusin":(M3(ze)||ze.contentEditable==="true")&&(Hd=ze,DT=R,Y_=null);break;case"focusout":Y_=DT=Hd=null;break;case"mousedown":RT=!0;break;case"contextmenu":case"mouseup":case"dragend":RT=!1,O3(V,h,U);break;case"selectionchange":if(L6)break;case"keydown":case"keyup":O3(V,h,U)}var He;if(cE)e:{switch(a){case"compositionstart":var Ne="onCompositionStart";break e;case"compositionend":Ne="onCompositionEnd";break e;case"compositionupdate":Ne="onCompositionUpdate";break e}Ne=void 0}else qd?tR(a,h)&&(Ne="onCompositionEnd"):a==="keydown"&&h.keyCode===229&&(Ne="onCompositionStart");Ne&&(eR&&h.locale!=="ko"&&(qd||Ne!=="onCompositionStart"?Ne==="onCompositionEnd"&&qd&&(He=JD()):(Lc=U,aE="value"in Lc?Lc.value:Lc.textContent,qd=!0)),ze=Zv(R,Ne),0<ze.length&&(Ne=new w3(Ne,a,null,h,U),V.push({event:Ne,listeners:ze}),He?Ne.data=He:(He=rR(h),He!==null&&(Ne.data=He)))),(He=T6?S6(a,h):E6(a,h))&&(R=Zv(R,"onBeforeInput"),0<R.length&&(U=new w3("onBeforeInput","beforeinput",null,h,U),V.push({event:U,listeners:R}),U.data=He))}pR(V,n)})}function _g(a,n,h){return{instance:a,listener:n,currentTarget:h}}function Zv(a,n){for(var h=n+"Capture",m=[];a!==null;){var y=a,b=y.stateNode;y.tag===5&&b!==null&&(y=b,b=ug(a,h),b!=null&&m.unshift(_g(a,b,y)),b=ug(a,n),b!=null&&m.push(_g(a,b,y))),a=a.return}return m}function Nd(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5);return a||null}function k3(a,n,h,m,y){for(var b=n._reactName,M=[];h!==null&&h!==m;){var P=h,o=P.alternate,R=P.stateNode;if(o!==null&&o===m)break;P.tag===5&&R!==null&&(P=R,y?(o=ug(h,b),o!=null&&M.unshift(_g(h,o,P))):y||(o=ug(h,b),o!=null&&M.push(_g(h,o,P)))),h=h.return}M.length!==0&&a.push({event:n,listeners:M})}var N6=/\r\n?/g,U6=/\u0000|\uFFFD/g;function L3(a){return(typeof a=="string"?a:""+a).replace(N6,`
`).replace(U6,"")}function tv(a,n,h){if(n=L3(n),L3(a)!==n&&h)throw Error(Zt(425))}function Xv(){}var kT=null,LT=null;function zT(a,n){return a==="textarea"||a==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var FT=typeof setTimeout=="function"?setTimeout:void 0,j6=typeof clearTimeout=="function"?clearTimeout:void 0,z3=typeof Promise=="function"?Promise:void 0,V6=typeof queueMicrotask=="function"?queueMicrotask:typeof z3<"u"?function(a){return z3.resolve(null).then(a).catch($6)}:FT;function $6(a){setTimeout(function(){throw a})}function Ew(a,n){var h=n,m=0;do{var y=h.nextSibling;if(a.removeChild(h),y&&y.nodeType===8)if(h=y.data,h==="/$"){if(m===0){a.removeChild(y),fg(n);return}m--}else h!=="$"&&h!=="$?"&&h!=="$!"||m++;h=y}while(h);fg(n)}function Wc(a){for(;a!=null;a=a.nextSibling){var n=a.nodeType;if(n===1||n===3)break;if(n===8){if(n=a.data,n==="$"||n==="$!"||n==="$?")break;if(n==="/$")return null}}return a}function F3(a){a=a.previousSibling;for(var n=0;a;){if(a.nodeType===8){var h=a.data;if(h==="$"||h==="$!"||h==="$?"){if(n===0)return a;n--}else h==="/$"&&n++}a=a.previousSibling}return null}var zp=Math.random().toString(36).slice(2),Dl="__reactFiber$"+zp,gg="__reactProps$"+zp,Ou="__reactContainer$"+zp,BT="__reactEvents$"+zp,G6="__reactListeners$"+zp,W6="__reactHandles$"+zp;function lf(a){var n=a[Dl];if(n)return n;for(var h=a.parentNode;h;){if(n=h[Ou]||h[Dl]){if(h=n.alternate,n.child!==null||h!==null&&h.child!==null)for(a=F3(a);a!==null;){if(h=a[Dl])return h;a=F3(a)}return n}a=h,h=a.parentNode}return null}function Ug(a){return a=a[Dl]||a[Ou],!a||a.tag!==5&&a.tag!==6&&a.tag!==13&&a.tag!==3?null:a}function Xd(a){if(a.tag===5||a.tag===6)return a.stateNode;throw Error(Zt(33))}function Nx(a){return a[gg]||null}var NT=[],Yd=-1;function ih(a){return{current:a}}function Xn(a){0>Yd||(a.current=NT[Yd],NT[Yd]=null,Yd--)}function Vn(a,n){Yd++,NT[Yd]=a.current,a.current=n}var Jc={},zo=ih(Jc),ps=ih(!1),bf=Jc;function yp(a,n){var h=a.type.contextTypes;if(!h)return Jc;var m=a.stateNode;if(m&&m.__reactInternalMemoizedUnmaskedChildContext===n)return m.__reactInternalMemoizedMaskedChildContext;var y={},b;for(b in h)y[b]=n[b];return m&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=n,a.__reactInternalMemoizedMaskedChildContext=y),y}function ms(a){return a=a.childContextTypes,a!=null}function Yv(){Xn(ps),Xn(zo)}function B3(a,n,h){if(zo.current!==Jc)throw Error(Zt(168));Vn(zo,n),Vn(ps,h)}function _R(a,n,h){var m=a.stateNode;if(n=n.childContextTypes,typeof m.getChildContext!="function")return h;m=m.getChildContext();for(var y in m)if(!(y in n))throw Error(Zt(108,CN(a)||"Unknown",y));return gi({},h,m)}function Kv(a){return a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Jc,bf=zo.current,Vn(zo,a),Vn(ps,ps.current),!0}function N3(a,n,h){var m=a.stateNode;if(!m)throw Error(Zt(169));h?(a=_R(a,n,bf),m.__reactInternalMemoizedMergedChildContext=a,Xn(ps),Xn(zo),Vn(zo,a)):Xn(ps),Vn(ps,h)}var Su=null,Ux=!1,Mw=!1;function gR(a){Su===null?Su=[a]:Su.push(a)}function q6(a){Ux=!0,gR(a)}function oh(){if(!Mw&&Su!==null){Mw=!0;var a=0,n=Pn;try{var h=Su;for(Pn=1;a<h.length;a++){var m=h[a];do m=m(!0);while(m!==null)}Su=null,Ux=!1}catch(y){throw Su!==null&&(Su=Su.slice(a+1)),VD(nE,oh),y}finally{Pn=n,Mw=!1}}return null}var Kd=[],Qd=0,Qv=null,Jv=0,ba=[],wa=0,wf=null,Mu=1,Iu="";function of(a,n){Kd[Qd++]=Jv,Kd[Qd++]=Qv,Qv=a,Jv=n}function yR(a,n,h){ba[wa++]=Mu,ba[wa++]=Iu,ba[wa++]=wf,wf=a;var m=Mu;a=Iu;var y=32-al(m)-1;m&=~(1<<y),h+=1;var b=32-al(n)+y;if(30<b){var M=y-y%5;b=(m&(1<<M)-1).toString(32),m>>=M,y-=M,Mu=1<<32-al(n)+y|h<<y|m,Iu=b+a}else Mu=1<<b|h<<y|m,Iu=a}function fE(a){a.return!==null&&(of(a,1),yR(a,1,0))}function dE(a){for(;a===Qv;)Qv=Kd[--Qd],Kd[Qd]=null,Jv=Kd[--Qd],Kd[Qd]=null;for(;a===wf;)wf=ba[--wa],ba[wa]=null,Iu=ba[--wa],ba[wa]=null,Mu=ba[--wa],ba[wa]=null}var Ys=null,Zs=null,ti=!1,il=null;function vR(a,n){var h=Ta(5,null,null,0);h.elementType="DELETED",h.stateNode=n,h.return=a,n=a.deletions,n===null?(a.deletions=[h],a.flags|=16):n.push(h)}function U3(a,n){switch(a.tag){case 5:var h=a.type;return n=n.nodeType!==1||h.toLowerCase()!==n.nodeName.toLowerCase()?null:n,n!==null?(a.stateNode=n,Ys=a,Zs=Wc(n.firstChild),!0):!1;case 6:return n=a.pendingProps===""||n.nodeType!==3?null:n,n!==null?(a.stateNode=n,Ys=a,Zs=null,!0):!1;case 13:return n=n.nodeType!==8?null:n,n!==null?(h=wf!==null?{id:Mu,overflow:Iu}:null,a.memoizedState={dehydrated:n,treeContext:h,retryLane:1073741824},h=Ta(18,null,null,0),h.stateNode=n,h.return=a,a.child=h,Ys=a,Zs=null,!0):!1;default:return!1}}function UT(a){return(a.mode&1)!==0&&(a.flags&128)===0}function jT(a){if(ti){var n=Zs;if(n){var h=n;if(!U3(a,n)){if(UT(a))throw Error(Zt(418));n=Wc(h.nextSibling);var m=Ys;n&&U3(a,n)?vR(m,h):(a.flags=a.flags&-4097|2,ti=!1,Ys=a)}}else{if(UT(a))throw Error(Zt(418));a.flags=a.flags&-4097|2,ti=!1,Ys=a}}}function j3(a){for(a=a.return;a!==null&&a.tag!==5&&a.tag!==3&&a.tag!==13;)a=a.return;Ys=a}function rv(a){if(a!==Ys)return!1;if(!ti)return j3(a),ti=!0,!1;var n;if((n=a.tag!==3)&&!(n=a.tag!==5)&&(n=a.type,n=n!=="head"&&n!=="body"&&!zT(a.type,a.memoizedProps)),n&&(n=Zs)){if(UT(a))throw xR(),Error(Zt(418));for(;n;)vR(a,n),n=Wc(n.nextSibling)}if(j3(a),a.tag===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Zt(317));e:{for(a=a.nextSibling,n=0;a;){if(a.nodeType===8){var h=a.data;if(h==="/$"){if(n===0){Zs=Wc(a.nextSibling);break e}n--}else h!=="$"&&h!=="$!"&&h!=="$?"||n++}a=a.nextSibling}Zs=null}}else Zs=Ys?Wc(a.stateNode.nextSibling):null;return!0}function xR(){for(var a=Zs;a;)a=Wc(a.nextSibling)}function vp(){Zs=Ys=null,ti=!1}function pE(a){il===null?il=[a]:il.push(a)}var H6=zu.ReactCurrentBatchConfig;function C_(a,n,h){if(a=h.ref,a!==null&&typeof a!="function"&&typeof a!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(Zt(309));var m=h.stateNode}if(!m)throw Error(Zt(147,a));var y=m,b=""+a;return n!==null&&n.ref!==null&&typeof n.ref=="function"&&n.ref._stringRef===b?n.ref:(n=function(M){var P=y.refs;M===null?delete P[b]:P[b]=M},n._stringRef=b,n)}if(typeof a!="string")throw Error(Zt(284));if(!h._owner)throw Error(Zt(290,a))}return a}function nv(a,n){throw a=Object.prototype.toString.call(n),Error(Zt(31,a==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":a))}function V3(a){var n=a._init;return n(a._payload)}function bR(a){function n(ae,q){if(a){var Q=ae.deletions;Q===null?(ae.deletions=[q],ae.flags|=16):Q.push(q)}}function h(ae,q){if(!a)return null;for(;q!==null;)n(ae,q),q=q.sibling;return null}function m(ae,q){for(ae=new Map;q!==null;)q.key!==null?ae.set(q.key,q):ae.set(q.index,q),q=q.sibling;return ae}function y(ae,q){return ae=Xc(ae,q),ae.index=0,ae.sibling=null,ae}function b(ae,q,Q){return ae.index=Q,a?(Q=ae.alternate,Q!==null?(Q=Q.index,Q<q?(ae.flags|=2,q):Q):(ae.flags|=2,q)):(ae.flags|=1048576,q)}function M(ae){return a&&ae.alternate===null&&(ae.flags|=2),ae}function P(ae,q,Q,le){return q===null||q.tag!==6?(q=Rw(Q,ae.mode,le),q.return=ae,q):(q=y(q,Q),q.return=ae,q)}function o(ae,q,Q,le){var ye=Q.type;return ye===Wd?U(ae,q,Q.props.children,le,Q.key):q!==null&&(q.elementType===ye||typeof ye=="object"&&ye!==null&&ye.$$typeof===Pc&&V3(ye)===q.type)?(le=y(q,Q.props),le.ref=C_(ae,q,Q),le.return=ae,le):(le=Ev(Q.type,Q.key,Q.props,null,ae.mode,le),le.ref=C_(ae,q,Q),le.return=ae,le)}function R(ae,q,Q,le){return q===null||q.tag!==4||q.stateNode.containerInfo!==Q.containerInfo||q.stateNode.implementation!==Q.implementation?(q=kw(Q,ae.mode,le),q.return=ae,q):(q=y(q,Q.children||[]),q.return=ae,q)}function U(ae,q,Q,le,ye){return q===null||q.tag!==7?(q=df(Q,ae.mode,le,ye),q.return=ae,q):(q=y(q,Q),q.return=ae,q)}function V(ae,q,Q){if(typeof q=="string"&&q!==""||typeof q=="number")return q=Rw(""+q,ae.mode,Q),q.return=ae,q;if(typeof q=="object"&&q!==null){switch(q.$$typeof){case q0:return Q=Ev(q.type,q.key,q.props,null,ae.mode,Q),Q.ref=C_(ae,null,q),Q.return=ae,Q;case Gd:return q=kw(q,ae.mode,Q),q.return=ae,q;case Pc:var le=q._init;return V(ae,le(q._payload),Q)}if(B_(q)||S_(q))return q=df(q,ae.mode,Q,null),q.return=ae,q;nv(ae,q)}return null}function Z(ae,q,Q,le){var ye=q!==null?q.key:null;if(typeof Q=="string"&&Q!==""||typeof Q=="number")return ye!==null?null:P(ae,q,""+Q,le);if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case q0:return Q.key===ye?o(ae,q,Q,le):null;case Gd:return Q.key===ye?R(ae,q,Q,le):null;case Pc:return ye=Q._init,Z(ae,q,ye(Q._payload),le)}if(B_(Q)||S_(Q))return ye!==null?null:U(ae,q,Q,le,null);nv(ae,Q)}return null}function te(ae,q,Q,le,ye){if(typeof le=="string"&&le!==""||typeof le=="number")return ae=ae.get(Q)||null,P(q,ae,""+le,ye);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case q0:return ae=ae.get(le.key===null?Q:le.key)||null,o(q,ae,le,ye);case Gd:return ae=ae.get(le.key===null?Q:le.key)||null,R(q,ae,le,ye);case Pc:var ze=le._init;return te(ae,q,Q,ze(le._payload),ye)}if(B_(le)||S_(le))return ae=ae.get(Q)||null,U(q,ae,le,ye,null);nv(q,le)}return null}function se(ae,q,Q,le){for(var ye=null,ze=null,He=q,Ne=q=0,xe=null;He!==null&&Ne<Q.length;Ne++){He.index>Ne?(xe=He,He=null):xe=He.sibling;var Me=Z(ae,He,Q[Ne],le);if(Me===null){He===null&&(He=xe);break}a&&He&&Me.alternate===null&&n(ae,He),q=b(Me,q,Ne),ze===null?ye=Me:ze.sibling=Me,ze=Me,He=xe}if(Ne===Q.length)return h(ae,He),ti&&of(ae,Ne),ye;if(He===null){for(;Ne<Q.length;Ne++)He=V(ae,Q[Ne],le),He!==null&&(q=b(He,q,Ne),ze===null?ye=He:ze.sibling=He,ze=He);return ti&&of(ae,Ne),ye}for(He=m(ae,He);Ne<Q.length;Ne++)xe=te(He,ae,Ne,Q[Ne],le),xe!==null&&(a&&xe.alternate!==null&&He.delete(xe.key===null?Ne:xe.key),q=b(xe,q,Ne),ze===null?ye=xe:ze.sibling=xe,ze=xe);return a&&He.forEach(function(Ie){return n(ae,Ie)}),ti&&of(ae,Ne),ye}function re(ae,q,Q,le){var ye=S_(Q);if(typeof ye!="function")throw Error(Zt(150));if(Q=ye.call(Q),Q==null)throw Error(Zt(151));for(var ze=ye=null,He=q,Ne=q=0,xe=null,Me=Q.next();He!==null&&!Me.done;Ne++,Me=Q.next()){He.index>Ne?(xe=He,He=null):xe=He.sibling;var Ie=Z(ae,He,Me.value,le);if(Ie===null){He===null&&(He=xe);break}a&&He&&Ie.alternate===null&&n(ae,He),q=b(Ie,q,Ne),ze===null?ye=Ie:ze.sibling=Ie,ze=Ie,He=xe}if(Me.done)return h(ae,He),ti&&of(ae,Ne),ye;if(He===null){for(;!Me.done;Ne++,Me=Q.next())Me=V(ae,Me.value,le),Me!==null&&(q=b(Me,q,Ne),ze===null?ye=Me:ze.sibling=Me,ze=Me);return ti&&of(ae,Ne),ye}for(He=m(ae,He);!Me.done;Ne++,Me=Q.next())Me=te(He,ae,Ne,Me.value,le),Me!==null&&(a&&Me.alternate!==null&&He.delete(Me.key===null?Ne:Me.key),q=b(Me,q,Ne),ze===null?ye=Me:ze.sibling=Me,ze=Me);return a&&He.forEach(function(Je){return n(ae,Je)}),ti&&of(ae,Ne),ye}function Te(ae,q,Q,le){if(typeof Q=="object"&&Q!==null&&Q.type===Wd&&Q.key===null&&(Q=Q.props.children),typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case q0:e:{for(var ye=Q.key,ze=q;ze!==null;){if(ze.key===ye){if(ye=Q.type,ye===Wd){if(ze.tag===7){h(ae,ze.sibling),q=y(ze,Q.props.children),q.return=ae,ae=q;break e}}else if(ze.elementType===ye||typeof ye=="object"&&ye!==null&&ye.$$typeof===Pc&&V3(ye)===ze.type){h(ae,ze.sibling),q=y(ze,Q.props),q.ref=C_(ae,ze,Q),q.return=ae,ae=q;break e}h(ae,ze);break}else n(ae,ze);ze=ze.sibling}Q.type===Wd?(q=df(Q.props.children,ae.mode,le,Q.key),q.return=ae,ae=q):(le=Ev(Q.type,Q.key,Q.props,null,ae.mode,le),le.ref=C_(ae,q,Q),le.return=ae,ae=le)}return M(ae);case Gd:e:{for(ze=Q.key;q!==null;){if(q.key===ze)if(q.tag===4&&q.stateNode.containerInfo===Q.containerInfo&&q.stateNode.implementation===Q.implementation){h(ae,q.sibling),q=y(q,Q.children||[]),q.return=ae,ae=q;break e}else{h(ae,q);break}else n(ae,q);q=q.sibling}q=kw(Q,ae.mode,le),q.return=ae,ae=q}return M(ae);case Pc:return ze=Q._init,Te(ae,q,ze(Q._payload),le)}if(B_(Q))return se(ae,q,Q,le);if(S_(Q))return re(ae,q,Q,le);nv(ae,Q)}return typeof Q=="string"&&Q!==""||typeof Q=="number"?(Q=""+Q,q!==null&&q.tag===6?(h(ae,q.sibling),q=y(q,Q),q.return=ae,ae=q):(h(ae,q),q=Rw(Q,ae.mode,le),q.return=ae,ae=q),M(ae)):h(ae,q)}return Te}var xp=bR(!0),wR=bR(!1),ex=ih(null),tx=null,Jd=null,mE=null;function _E(){mE=Jd=tx=null}function gE(a){var n=ex.current;Xn(ex),a._currentValue=n}function VT(a,n,h){for(;a!==null;){var m=a.alternate;if((a.childLanes&n)!==n?(a.childLanes|=n,m!==null&&(m.childLanes|=n)):m!==null&&(m.childLanes&n)!==n&&(m.childLanes|=n),a===h)break;a=a.return}}function up(a,n){tx=a,mE=Jd=null,a=a.dependencies,a!==null&&a.firstContext!==null&&(a.lanes&n&&(ds=!0),a.firstContext=null)}function Ia(a){var n=a._currentValue;if(mE!==a)if(a={context:a,memoizedValue:n,next:null},Jd===null){if(tx===null)throw Error(Zt(308));Jd=a,tx.dependencies={lanes:0,firstContext:a}}else Jd=Jd.next=a;return n}var uf=null;function yE(a){uf===null?uf=[a]:uf.push(a)}function TR(a,n,h,m){var y=n.interleaved;return y===null?(h.next=h,yE(n)):(h.next=y.next,y.next=h),n.interleaved=h,Du(a,m)}function Du(a,n){a.lanes|=n;var h=a.alternate;for(h!==null&&(h.lanes|=n),h=a,a=a.return;a!==null;)a.childLanes|=n,h=a.alternate,h!==null&&(h.childLanes|=n),h=a,a=a.return;return h.tag===3?h.stateNode:null}var Oc=!1;function vE(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function SR(a,n){a=a.updateQueue,n.updateQueue===a&&(n.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,effects:a.effects})}function Au(a,n){return{eventTime:a,lane:n,tag:0,payload:null,callback:null,next:null}}function qc(a,n,h){var m=a.updateQueue;if(m===null)return null;if(m=m.shared,vn&2){var y=m.pending;return y===null?n.next=n:(n.next=y.next,y.next=n),m.pending=n,Du(a,h)}return y=m.interleaved,y===null?(n.next=n,yE(m)):(n.next=y.next,y.next=n),m.interleaved=n,Du(a,h)}function vv(a,n,h){if(n=n.updateQueue,n!==null&&(n=n.shared,(h&4194240)!==0)){var m=n.lanes;m&=a.pendingLanes,h|=m,n.lanes=h,iE(a,h)}}function $3(a,n){var h=a.updateQueue,m=a.alternate;if(m!==null&&(m=m.updateQueue,h===m)){var y=null,b=null;if(h=h.firstBaseUpdate,h!==null){do{var M={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};b===null?y=b=M:b=b.next=M,h=h.next}while(h!==null);b===null?y=b=n:b=b.next=n}else y=b=n;h={baseState:m.baseState,firstBaseUpdate:y,lastBaseUpdate:b,shared:m.shared,effects:m.effects},a.updateQueue=h;return}a=h.lastBaseUpdate,a===null?h.firstBaseUpdate=n:a.next=n,h.lastBaseUpdate=n}function rx(a,n,h,m){var y=a.updateQueue;Oc=!1;var b=y.firstBaseUpdate,M=y.lastBaseUpdate,P=y.shared.pending;if(P!==null){y.shared.pending=null;var o=P,R=o.next;o.next=null,M===null?b=R:M.next=R,M=o;var U=a.alternate;U!==null&&(U=U.updateQueue,P=U.lastBaseUpdate,P!==M&&(P===null?U.firstBaseUpdate=R:P.next=R,U.lastBaseUpdate=o))}if(b!==null){var V=y.baseState;M=0,U=R=o=null,P=b;do{var Z=P.lane,te=P.eventTime;if((m&Z)===Z){U!==null&&(U=U.next={eventTime:te,lane:0,tag:P.tag,payload:P.payload,callback:P.callback,next:null});e:{var se=a,re=P;switch(Z=n,te=h,re.tag){case 1:if(se=re.payload,typeof se=="function"){V=se.call(te,V,Z);break e}V=se;break e;case 3:se.flags=se.flags&-65537|128;case 0:if(se=re.payload,Z=typeof se=="function"?se.call(te,V,Z):se,Z==null)break e;V=gi({},V,Z);break e;case 2:Oc=!0}}P.callback!==null&&P.lane!==0&&(a.flags|=64,Z=y.effects,Z===null?y.effects=[P]:Z.push(P))}else te={eventTime:te,lane:Z,tag:P.tag,payload:P.payload,callback:P.callback,next:null},U===null?(R=U=te,o=V):U=U.next=te,M|=Z;if(P=P.next,P===null){if(P=y.shared.pending,P===null)break;Z=P,P=Z.next,Z.next=null,y.lastBaseUpdate=Z,y.shared.pending=null}}while(!0);if(U===null&&(o=V),y.baseState=o,y.firstBaseUpdate=R,y.lastBaseUpdate=U,n=y.shared.interleaved,n!==null){y=n;do M|=y.lane,y=y.next;while(y!==n)}else b===null&&(y.shared.lanes=0);Sf|=M,a.lanes=M,a.memoizedState=V}}function G3(a,n,h){if(a=n.effects,n.effects=null,a!==null)for(n=0;n<a.length;n++){var m=a[n],y=m.callback;if(y!==null){if(m.callback=null,m=h,typeof y!="function")throw Error(Zt(191,y));y.call(m)}}}var jg={},zl=ih(jg),yg=ih(jg),vg=ih(jg);function cf(a){if(a===jg)throw Error(Zt(174));return a}function xE(a,n){switch(Vn(vg,n),Vn(yg,a),Vn(zl,jg),a=n.nodeType,a){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:wT(null,"");break;default:a=a===8?n.parentNode:n,n=a.namespaceURI||null,a=a.tagName,n=wT(n,a)}Xn(zl),Vn(zl,n)}function bp(){Xn(zl),Xn(yg),Xn(vg)}function ER(a){cf(vg.current);var n=cf(zl.current),h=wT(n,a.type);n!==h&&(Vn(yg,a),Vn(zl,h))}function bE(a){yg.current===a&&(Xn(zl),Xn(yg))}var di=ih(0);function nx(a){for(var n=a;n!==null;){if(n.tag===13){var h=n.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if(n.flags&128)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===a)break;for(;n.sibling===null;){if(n.return===null||n.return===a)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var Iw=[];function wE(){for(var a=0;a<Iw.length;a++)Iw[a]._workInProgressVersionPrimary=null;Iw.length=0}var xv=zu.ReactCurrentDispatcher,Aw=zu.ReactCurrentBatchConfig,Tf=0,_i=null,Vi=null,no=null,ix=!1,K_=!1,xg=0,Z6=0;function Po(){throw Error(Zt(321))}function TE(a,n){if(n===null)return!1;for(var h=0;h<n.length&&h<a.length;h++)if(!cl(a[h],n[h]))return!1;return!0}function SE(a,n,h,m,y,b){if(Tf=b,_i=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,xv.current=a===null||a.memoizedState===null?Q6:J6,a=h(m,y),K_){b=0;do{if(K_=!1,xg=0,25<=b)throw Error(Zt(301));b+=1,no=Vi=null,n.updateQueue=null,xv.current=eU,a=h(m,y)}while(K_)}if(xv.current=ox,n=Vi!==null&&Vi.next!==null,Tf=0,no=Vi=_i=null,ix=!1,n)throw Error(Zt(300));return a}function EE(){var a=xg!==0;return xg=0,a}function Cl(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return no===null?_i.memoizedState=no=a:no=no.next=a,no}function Aa(){if(Vi===null){var a=_i.alternate;a=a!==null?a.memoizedState:null}else a=Vi.next;var n=no===null?_i.memoizedState:no.next;if(n!==null)no=n,Vi=a;else{if(a===null)throw Error(Zt(310));Vi=a,a={memoizedState:Vi.memoizedState,baseState:Vi.baseState,baseQueue:Vi.baseQueue,queue:Vi.queue,next:null},no===null?_i.memoizedState=no=a:no=no.next=a}return no}function bg(a,n){return typeof n=="function"?n(a):n}function Cw(a){var n=Aa(),h=n.queue;if(h===null)throw Error(Zt(311));h.lastRenderedReducer=a;var m=Vi,y=m.baseQueue,b=h.pending;if(b!==null){if(y!==null){var M=y.next;y.next=b.next,b.next=M}m.baseQueue=y=b,h.pending=null}if(y!==null){b=y.next,m=m.baseState;var P=M=null,o=null,R=b;do{var U=R.lane;if((Tf&U)===U)o!==null&&(o=o.next={lane:0,action:R.action,hasEagerState:R.hasEagerState,eagerState:R.eagerState,next:null}),m=R.hasEagerState?R.eagerState:a(m,R.action);else{var V={lane:U,action:R.action,hasEagerState:R.hasEagerState,eagerState:R.eagerState,next:null};o===null?(P=o=V,M=m):o=o.next=V,_i.lanes|=U,Sf|=U}R=R.next}while(R!==null&&R!==b);o===null?M=m:o.next=P,cl(m,n.memoizedState)||(ds=!0),n.memoizedState=m,n.baseState=M,n.baseQueue=o,h.lastRenderedState=m}if(a=h.interleaved,a!==null){y=a;do b=y.lane,_i.lanes|=b,Sf|=b,y=y.next;while(y!==a)}else y===null&&(h.lanes=0);return[n.memoizedState,h.dispatch]}function Pw(a){var n=Aa(),h=n.queue;if(h===null)throw Error(Zt(311));h.lastRenderedReducer=a;var m=h.dispatch,y=h.pending,b=n.memoizedState;if(y!==null){h.pending=null;var M=y=y.next;do b=a(b,M.action),M=M.next;while(M!==y);cl(b,n.memoizedState)||(ds=!0),n.memoizedState=b,n.baseQueue===null&&(n.baseState=b),h.lastRenderedState=b}return[b,m]}function MR(){}function IR(a,n){var h=_i,m=Aa(),y=n(),b=!cl(m.memoizedState,y);if(b&&(m.memoizedState=y,ds=!0),m=m.queue,ME(PR.bind(null,h,m,a),[a]),m.getSnapshot!==n||b||no!==null&&no.memoizedState.tag&1){if(h.flags|=2048,wg(9,CR.bind(null,h,m,y,n),void 0,null),oo===null)throw Error(Zt(349));Tf&30||AR(h,n,y)}return y}function AR(a,n,h){a.flags|=16384,a={getSnapshot:n,value:h},n=_i.updateQueue,n===null?(n={lastEffect:null,stores:null},_i.updateQueue=n,n.stores=[a]):(h=n.stores,h===null?n.stores=[a]:h.push(a))}function CR(a,n,h,m){n.value=h,n.getSnapshot=m,OR(n)&&DR(a)}function PR(a,n,h){return h(function(){OR(n)&&DR(a)})}function OR(a){var n=a.getSnapshot;a=a.value;try{var h=n();return!cl(a,h)}catch{return!0}}function DR(a){var n=Du(a,1);n!==null&&ll(n,a,1,-1)}function W3(a){var n=Cl();return typeof a=="function"&&(a=a()),n.memoizedState=n.baseState=a,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bg,lastRenderedState:a},n.queue=a,a=a.dispatch=K6.bind(null,_i,a),[n.memoizedState,a]}function wg(a,n,h,m){return a={tag:a,create:n,destroy:h,deps:m,next:null},n=_i.updateQueue,n===null?(n={lastEffect:null,stores:null},_i.updateQueue=n,n.lastEffect=a.next=a):(h=n.lastEffect,h===null?n.lastEffect=a.next=a:(m=h.next,h.next=a,a.next=m,n.lastEffect=a)),a}function RR(){return Aa().memoizedState}function bv(a,n,h,m){var y=Cl();_i.flags|=a,y.memoizedState=wg(1|n,h,void 0,m===void 0?null:m)}function jx(a,n,h,m){var y=Aa();m=m===void 0?null:m;var b=void 0;if(Vi!==null){var M=Vi.memoizedState;if(b=M.destroy,m!==null&&TE(m,M.deps)){y.memoizedState=wg(n,h,b,m);return}}_i.flags|=a,y.memoizedState=wg(1|n,h,b,m)}function q3(a,n){return bv(8390656,8,a,n)}function ME(a,n){return jx(2048,8,a,n)}function kR(a,n){return jx(4,2,a,n)}function LR(a,n){return jx(4,4,a,n)}function zR(a,n){if(typeof n=="function")return a=a(),n(a),function(){n(null)};if(n!=null)return a=a(),n.current=a,function(){n.current=null}}function FR(a,n,h){return h=h!=null?h.concat([a]):null,jx(4,4,zR.bind(null,n,a),h)}function IE(){}function BR(a,n){var h=Aa();n=n===void 0?null:n;var m=h.memoizedState;return m!==null&&n!==null&&TE(n,m[1])?m[0]:(h.memoizedState=[a,n],a)}function NR(a,n){var h=Aa();n=n===void 0?null:n;var m=h.memoizedState;return m!==null&&n!==null&&TE(n,m[1])?m[0]:(a=a(),h.memoizedState=[a,n],a)}function UR(a,n,h){return Tf&21?(cl(h,n)||(h=WD(),_i.lanes|=h,Sf|=h,a.baseState=!0),n):(a.baseState&&(a.baseState=!1,ds=!0),a.memoizedState=h)}function X6(a,n){var h=Pn;Pn=h!==0&&4>h?h:4,a(!0);var m=Aw.transition;Aw.transition={};try{a(!1),n()}finally{Pn=h,Aw.transition=m}}function jR(){return Aa().memoizedState}function Y6(a,n,h){var m=Zc(a);if(h={lane:m,action:h,hasEagerState:!1,eagerState:null,next:null},VR(a))$R(n,h);else if(h=TR(a,n,h,m),h!==null){var y=Ko();ll(h,a,m,y),GR(h,n,m)}}function K6(a,n,h){var m=Zc(a),y={lane:m,action:h,hasEagerState:!1,eagerState:null,next:null};if(VR(a))$R(n,y);else{var b=a.alternate;if(a.lanes===0&&(b===null||b.lanes===0)&&(b=n.lastRenderedReducer,b!==null))try{var M=n.lastRenderedState,P=b(M,h);if(y.hasEagerState=!0,y.eagerState=P,cl(P,M)){var o=n.interleaved;o===null?(y.next=y,yE(n)):(y.next=o.next,o.next=y),n.interleaved=y;return}}catch{}finally{}h=TR(a,n,y,m),h!==null&&(y=Ko(),ll(h,a,m,y),GR(h,n,m))}}function VR(a){var n=a.alternate;return a===_i||n!==null&&n===_i}function $R(a,n){K_=ix=!0;var h=a.pending;h===null?n.next=n:(n.next=h.next,h.next=n),a.pending=n}function GR(a,n,h){if(h&4194240){var m=n.lanes;m&=a.pendingLanes,h|=m,n.lanes=h,iE(a,h)}}var ox={readContext:Ia,useCallback:Po,useContext:Po,useEffect:Po,useImperativeHandle:Po,useInsertionEffect:Po,useLayoutEffect:Po,useMemo:Po,useReducer:Po,useRef:Po,useState:Po,useDebugValue:Po,useDeferredValue:Po,useTransition:Po,useMutableSource:Po,useSyncExternalStore:Po,useId:Po,unstable_isNewReconciler:!1},Q6={readContext:Ia,useCallback:function(a,n){return Cl().memoizedState=[a,n===void 0?null:n],a},useContext:Ia,useEffect:q3,useImperativeHandle:function(a,n,h){return h=h!=null?h.concat([a]):null,bv(4194308,4,zR.bind(null,n,a),h)},useLayoutEffect:function(a,n){return bv(4194308,4,a,n)},useInsertionEffect:function(a,n){return bv(4,2,a,n)},useMemo:function(a,n){var h=Cl();return n=n===void 0?null:n,a=a(),h.memoizedState=[a,n],a},useReducer:function(a,n,h){var m=Cl();return n=h!==void 0?h(n):n,m.memoizedState=m.baseState=n,a={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:n},m.queue=a,a=a.dispatch=Y6.bind(null,_i,a),[m.memoizedState,a]},useRef:function(a){var n=Cl();return a={current:a},n.memoizedState=a},useState:W3,useDebugValue:IE,useDeferredValue:function(a){return Cl().memoizedState=a},useTransition:function(){var a=W3(!1),n=a[0];return a=X6.bind(null,a[1]),Cl().memoizedState=a,[n,a]},useMutableSource:function(){},useSyncExternalStore:function(a,n,h){var m=_i,y=Cl();if(ti){if(h===void 0)throw Error(Zt(407));h=h()}else{if(h=n(),oo===null)throw Error(Zt(349));Tf&30||AR(m,n,h)}y.memoizedState=h;var b={value:h,getSnapshot:n};return y.queue=b,q3(PR.bind(null,m,b,a),[a]),m.flags|=2048,wg(9,CR.bind(null,m,b,h,n),void 0,null),h},useId:function(){var a=Cl(),n=oo.identifierPrefix;if(ti){var h=Iu,m=Mu;h=(m&~(1<<32-al(m)-1)).toString(32)+h,n=":"+n+"R"+h,h=xg++,0<h&&(n+="H"+h.toString(32)),n+=":"}else h=Z6++,n=":"+n+"r"+h.toString(32)+":";return a.memoizedState=n},unstable_isNewReconciler:!1},J6={readContext:Ia,useCallback:BR,useContext:Ia,useEffect:ME,useImperativeHandle:FR,useInsertionEffect:kR,useLayoutEffect:LR,useMemo:NR,useReducer:Cw,useRef:RR,useState:function(){return Cw(bg)},useDebugValue:IE,useDeferredValue:function(a){var n=Aa();return UR(n,Vi.memoizedState,a)},useTransition:function(){var a=Cw(bg)[0],n=Aa().memoizedState;return[a,n]},useMutableSource:MR,useSyncExternalStore:IR,useId:jR,unstable_isNewReconciler:!1},eU={readContext:Ia,useCallback:BR,useContext:Ia,useEffect:ME,useImperativeHandle:FR,useInsertionEffect:kR,useLayoutEffect:LR,useMemo:NR,useReducer:Pw,useRef:RR,useState:function(){return Pw(bg)},useDebugValue:IE,useDeferredValue:function(a){var n=Aa();return Vi===null?n.memoizedState=a:UR(n,Vi.memoizedState,a)},useTransition:function(){var a=Pw(bg)[0],n=Aa().memoizedState;return[a,n]},useMutableSource:MR,useSyncExternalStore:IR,useId:jR,unstable_isNewReconciler:!1};function rl(a,n){if(a&&a.defaultProps){n=gi({},n),a=a.defaultProps;for(var h in a)n[h]===void 0&&(n[h]=a[h]);return n}return n}function $T(a,n,h,m){n=a.memoizedState,h=h(m,n),h=h==null?n:gi({},n,h),a.memoizedState=h,a.lanes===0&&(a.updateQueue.baseState=h)}var Vx={isMounted:function(a){return(a=a._reactInternals)?Cf(a)===a:!1},enqueueSetState:function(a,n,h){a=a._reactInternals;var m=Ko(),y=Zc(a),b=Au(m,y);b.payload=n,h!=null&&(b.callback=h),n=qc(a,b,y),n!==null&&(ll(n,a,y,m),vv(n,a,y))},enqueueReplaceState:function(a,n,h){a=a._reactInternals;var m=Ko(),y=Zc(a),b=Au(m,y);b.tag=1,b.payload=n,h!=null&&(b.callback=h),n=qc(a,b,y),n!==null&&(ll(n,a,y,m),vv(n,a,y))},enqueueForceUpdate:function(a,n){a=a._reactInternals;var h=Ko(),m=Zc(a),y=Au(h,m);y.tag=2,n!=null&&(y.callback=n),n=qc(a,y,m),n!==null&&(ll(n,a,m,h),vv(n,a,m))}};function H3(a,n,h,m,y,b,M){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(m,b,M):n.prototype&&n.prototype.isPureReactComponent?!pg(h,m)||!pg(y,b):!0}function WR(a,n,h){var m=!1,y=Jc,b=n.contextType;return typeof b=="object"&&b!==null?b=Ia(b):(y=ms(n)?bf:zo.current,m=n.contextTypes,b=(m=m!=null)?yp(a,y):Jc),n=new n(h,b),a.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=Vx,a.stateNode=n,n._reactInternals=a,m&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=y,a.__reactInternalMemoizedMaskedChildContext=b),n}function Z3(a,n,h,m){a=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(h,m),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(h,m),n.state!==a&&Vx.enqueueReplaceState(n,n.state,null)}function GT(a,n,h,m){var y=a.stateNode;y.props=h,y.state=a.memoizedState,y.refs={},vE(a);var b=n.contextType;typeof b=="object"&&b!==null?y.context=Ia(b):(b=ms(n)?bf:zo.current,y.context=yp(a,b)),y.state=a.memoizedState,b=n.getDerivedStateFromProps,typeof b=="function"&&($T(a,n,b,h),y.state=a.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(n=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),n!==y.state&&Vx.enqueueReplaceState(y,y.state,null),rx(a,h,y,m),y.state=a.memoizedState),typeof y.componentDidMount=="function"&&(a.flags|=4194308)}function wp(a,n){try{var h="",m=n;do h+=AN(m),m=m.return;while(m);var y=h}catch(b){y=`
Error generating stack: `+b.message+`
`+b.stack}return{value:a,source:n,stack:y,digest:null}}function Ow(a,n,h){return{value:a,source:null,stack:h??null,digest:n??null}}function WT(a,n){try{console.error(n.value)}catch(h){setTimeout(function(){throw h})}}var tU=typeof WeakMap=="function"?WeakMap:Map;function qR(a,n,h){h=Au(-1,h),h.tag=3,h.payload={element:null};var m=n.value;return h.callback=function(){ax||(ax=!0,tS=m),WT(a,n)},h}function HR(a,n,h){h=Au(-1,h),h.tag=3;var m=a.type.getDerivedStateFromError;if(typeof m=="function"){var y=n.value;h.payload=function(){return m(y)},h.callback=function(){WT(a,n)}}var b=a.stateNode;return b!==null&&typeof b.componentDidCatch=="function"&&(h.callback=function(){WT(a,n),typeof m!="function"&&(Hc===null?Hc=new Set([this]):Hc.add(this));var M=n.stack;this.componentDidCatch(n.value,{componentStack:M!==null?M:""})}),h}function X3(a,n,h){var m=a.pingCache;if(m===null){m=a.pingCache=new tU;var y=new Set;m.set(n,y)}else y=m.get(n),y===void 0&&(y=new Set,m.set(n,y));y.has(h)||(y.add(h),a=mU.bind(null,a,n,h),n.then(a,a))}function Y3(a){do{var n;if((n=a.tag===13)&&(n=a.memoizedState,n=n!==null?n.dehydrated!==null:!0),n)return a;a=a.return}while(a!==null);return null}function K3(a,n,h,m,y){return a.mode&1?(a.flags|=65536,a.lanes=y,a):(a===n?a.flags|=65536:(a.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(n=Au(-1,1),n.tag=2,qc(h,n,1))),h.lanes|=1),a)}var rU=zu.ReactCurrentOwner,ds=!1;function Zo(a,n,h,m){n.child=a===null?wR(n,null,h,m):xp(n,a.child,h,m)}function Q3(a,n,h,m,y){h=h.render;var b=n.ref;return up(n,y),m=SE(a,n,h,m,b,y),h=EE(),a!==null&&!ds?(n.updateQueue=a.updateQueue,n.flags&=-2053,a.lanes&=~y,Ru(a,n,y)):(ti&&h&&fE(n),n.flags|=1,Zo(a,n,m,y),n.child)}function J3(a,n,h,m,y){if(a===null){var b=h.type;return typeof b=="function"&&!LE(b)&&b.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(n.tag=15,n.type=b,ZR(a,n,b,m,y)):(a=Ev(h.type,null,m,n,n.mode,y),a.ref=n.ref,a.return=n,n.child=a)}if(b=a.child,!(a.lanes&y)){var M=b.memoizedProps;if(h=h.compare,h=h!==null?h:pg,h(M,m)&&a.ref===n.ref)return Ru(a,n,y)}return n.flags|=1,a=Xc(b,m),a.ref=n.ref,a.return=n,n.child=a}function ZR(a,n,h,m,y){if(a!==null){var b=a.memoizedProps;if(pg(b,m)&&a.ref===n.ref)if(ds=!1,n.pendingProps=m=b,(a.lanes&y)!==0)a.flags&131072&&(ds=!0);else return n.lanes=a.lanes,Ru(a,n,y)}return qT(a,n,h,m,y)}function XR(a,n,h){var m=n.pendingProps,y=m.children,b=a!==null?a.memoizedState:null;if(m.mode==="hidden")if(!(n.mode&1))n.memoizedState={baseLanes:0,cachePool:null,transitions:null},Vn(tp,Ws),Ws|=h;else{if(!(h&1073741824))return a=b!==null?b.baseLanes|h:h,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:a,cachePool:null,transitions:null},n.updateQueue=null,Vn(tp,Ws),Ws|=a,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},m=b!==null?b.baseLanes:h,Vn(tp,Ws),Ws|=m}else b!==null?(m=b.baseLanes|h,n.memoizedState=null):m=h,Vn(tp,Ws),Ws|=m;return Zo(a,n,y,h),n.child}function YR(a,n){var h=n.ref;(a===null&&h!==null||a!==null&&a.ref!==h)&&(n.flags|=512,n.flags|=2097152)}function qT(a,n,h,m,y){var b=ms(h)?bf:zo.current;return b=yp(n,b),up(n,y),h=SE(a,n,h,m,b,y),m=EE(),a!==null&&!ds?(n.updateQueue=a.updateQueue,n.flags&=-2053,a.lanes&=~y,Ru(a,n,y)):(ti&&m&&fE(n),n.flags|=1,Zo(a,n,h,y),n.child)}function eP(a,n,h,m,y){if(ms(h)){var b=!0;Kv(n)}else b=!1;if(up(n,y),n.stateNode===null)wv(a,n),WR(n,h,m),GT(n,h,m,y),m=!0;else if(a===null){var M=n.stateNode,P=n.memoizedProps;M.props=P;var o=M.context,R=h.contextType;typeof R=="object"&&R!==null?R=Ia(R):(R=ms(h)?bf:zo.current,R=yp(n,R));var U=h.getDerivedStateFromProps,V=typeof U=="function"||typeof M.getSnapshotBeforeUpdate=="function";V||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(P!==m||o!==R)&&Z3(n,M,m,R),Oc=!1;var Z=n.memoizedState;M.state=Z,rx(n,m,M,y),o=n.memoizedState,P!==m||Z!==o||ps.current||Oc?(typeof U=="function"&&($T(n,h,U,m),o=n.memoizedState),(P=Oc||H3(n,h,P,m,Z,o,R))?(V||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount()),typeof M.componentDidMount=="function"&&(n.flags|=4194308)):(typeof M.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=m,n.memoizedState=o),M.props=m,M.state=o,M.context=R,m=P):(typeof M.componentDidMount=="function"&&(n.flags|=4194308),m=!1)}else{M=n.stateNode,SR(a,n),P=n.memoizedProps,R=n.type===n.elementType?P:rl(n.type,P),M.props=R,V=n.pendingProps,Z=M.context,o=h.contextType,typeof o=="object"&&o!==null?o=Ia(o):(o=ms(h)?bf:zo.current,o=yp(n,o));var te=h.getDerivedStateFromProps;(U=typeof te=="function"||typeof M.getSnapshotBeforeUpdate=="function")||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(P!==V||Z!==o)&&Z3(n,M,m,o),Oc=!1,Z=n.memoizedState,M.state=Z,rx(n,m,M,y);var se=n.memoizedState;P!==V||Z!==se||ps.current||Oc?(typeof te=="function"&&($T(n,h,te,m),se=n.memoizedState),(R=Oc||H3(n,h,R,m,Z,se,o)||!1)?(U||typeof M.UNSAFE_componentWillUpdate!="function"&&typeof M.componentWillUpdate!="function"||(typeof M.componentWillUpdate=="function"&&M.componentWillUpdate(m,se,o),typeof M.UNSAFE_componentWillUpdate=="function"&&M.UNSAFE_componentWillUpdate(m,se,o)),typeof M.componentDidUpdate=="function"&&(n.flags|=4),typeof M.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof M.componentDidUpdate!="function"||P===a.memoizedProps&&Z===a.memoizedState||(n.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||P===a.memoizedProps&&Z===a.memoizedState||(n.flags|=1024),n.memoizedProps=m,n.memoizedState=se),M.props=m,M.state=se,M.context=o,m=R):(typeof M.componentDidUpdate!="function"||P===a.memoizedProps&&Z===a.memoizedState||(n.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||P===a.memoizedProps&&Z===a.memoizedState||(n.flags|=1024),m=!1)}return HT(a,n,h,m,b,y)}function HT(a,n,h,m,y,b){YR(a,n);var M=(n.flags&128)!==0;if(!m&&!M)return y&&N3(n,h,!1),Ru(a,n,b);m=n.stateNode,rU.current=n;var P=M&&typeof h.getDerivedStateFromError!="function"?null:m.render();return n.flags|=1,a!==null&&M?(n.child=xp(n,a.child,null,b),n.child=xp(n,null,P,b)):Zo(a,n,P,b),n.memoizedState=m.state,y&&N3(n,h,!0),n.child}function KR(a){var n=a.stateNode;n.pendingContext?B3(a,n.pendingContext,n.pendingContext!==n.context):n.context&&B3(a,n.context,!1),xE(a,n.containerInfo)}function tP(a,n,h,m,y){return vp(),pE(y),n.flags|=256,Zo(a,n,h,m),n.child}var ZT={dehydrated:null,treeContext:null,retryLane:0};function XT(a){return{baseLanes:a,cachePool:null,transitions:null}}function QR(a,n,h){var m=n.pendingProps,y=di.current,b=!1,M=(n.flags&128)!==0,P;if((P=M)||(P=a!==null&&a.memoizedState===null?!1:(y&2)!==0),P?(b=!0,n.flags&=-129):(a===null||a.memoizedState!==null)&&(y|=1),Vn(di,y&1),a===null)return jT(n),a=n.memoizedState,a!==null&&(a=a.dehydrated,a!==null)?(n.mode&1?a.data==="$!"?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(M=m.children,a=m.fallback,b?(m=n.mode,b=n.child,M={mode:"hidden",children:M},!(m&1)&&b!==null?(b.childLanes=0,b.pendingProps=M):b=Wx(M,m,0,null),a=df(a,m,h,null),b.return=n,a.return=n,b.sibling=a,n.child=b,n.child.memoizedState=XT(h),n.memoizedState=ZT,a):AE(n,M));if(y=a.memoizedState,y!==null&&(P=y.dehydrated,P!==null))return nU(a,n,M,m,P,y,h);if(b){b=m.fallback,M=n.mode,y=a.child,P=y.sibling;var o={mode:"hidden",children:m.children};return!(M&1)&&n.child!==y?(m=n.child,m.childLanes=0,m.pendingProps=o,n.deletions=null):(m=Xc(y,o),m.subtreeFlags=y.subtreeFlags&14680064),P!==null?b=Xc(P,b):(b=df(b,M,h,null),b.flags|=2),b.return=n,m.return=n,m.sibling=b,n.child=m,m=b,b=n.child,M=a.child.memoizedState,M=M===null?XT(h):{baseLanes:M.baseLanes|h,cachePool:null,transitions:M.transitions},b.memoizedState=M,b.childLanes=a.childLanes&~h,n.memoizedState=ZT,m}return b=a.child,a=b.sibling,m=Xc(b,{mode:"visible",children:m.children}),!(n.mode&1)&&(m.lanes=h),m.return=n,m.sibling=null,a!==null&&(h=n.deletions,h===null?(n.deletions=[a],n.flags|=16):h.push(a)),n.child=m,n.memoizedState=null,m}function AE(a,n){return n=Wx({mode:"visible",children:n},a.mode,0,null),n.return=a,a.child=n}function iv(a,n,h,m){return m!==null&&pE(m),xp(n,a.child,null,h),a=AE(n,n.pendingProps.children),a.flags|=2,n.memoizedState=null,a}function nU(a,n,h,m,y,b,M){if(h)return n.flags&256?(n.flags&=-257,m=Ow(Error(Zt(422))),iv(a,n,M,m)):n.memoizedState!==null?(n.child=a.child,n.flags|=128,null):(b=m.fallback,y=n.mode,m=Wx({mode:"visible",children:m.children},y,0,null),b=df(b,y,M,null),b.flags|=2,m.return=n,b.return=n,m.sibling=b,n.child=m,n.mode&1&&xp(n,a.child,null,M),n.child.memoizedState=XT(M),n.memoizedState=ZT,b);if(!(n.mode&1))return iv(a,n,M,null);if(y.data==="$!"){if(m=y.nextSibling&&y.nextSibling.dataset,m)var P=m.dgst;return m=P,b=Error(Zt(419)),m=Ow(b,m,void 0),iv(a,n,M,m)}if(P=(M&a.childLanes)!==0,ds||P){if(m=oo,m!==null){switch(M&-M){case 4:y=2;break;case 16:y=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:y=32;break;case 536870912:y=268435456;break;default:y=0}y=y&(m.suspendedLanes|M)?0:y,y!==0&&y!==b.retryLane&&(b.retryLane=y,Du(a,y),ll(m,a,y,-1))}return kE(),m=Ow(Error(Zt(421))),iv(a,n,M,m)}return y.data==="$?"?(n.flags|=128,n.child=a.child,n=_U.bind(null,a),y._reactRetry=n,null):(a=b.treeContext,Zs=Wc(y.nextSibling),Ys=n,ti=!0,il=null,a!==null&&(ba[wa++]=Mu,ba[wa++]=Iu,ba[wa++]=wf,Mu=a.id,Iu=a.overflow,wf=n),n=AE(n,m.children),n.flags|=4096,n)}function rP(a,n,h){a.lanes|=n;var m=a.alternate;m!==null&&(m.lanes|=n),VT(a.return,n,h)}function Dw(a,n,h,m,y){var b=a.memoizedState;b===null?a.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:m,tail:h,tailMode:y}:(b.isBackwards=n,b.rendering=null,b.renderingStartTime=0,b.last=m,b.tail=h,b.tailMode=y)}function JR(a,n,h){var m=n.pendingProps,y=m.revealOrder,b=m.tail;if(Zo(a,n,m.children,h),m=di.current,m&2)m=m&1|2,n.flags|=128;else{if(a!==null&&a.flags&128)e:for(a=n.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&rP(a,h,n);else if(a.tag===19)rP(a,h,n);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===n)break e;for(;a.sibling===null;){if(a.return===null||a.return===n)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}m&=1}if(Vn(di,m),!(n.mode&1))n.memoizedState=null;else switch(y){case"forwards":for(h=n.child,y=null;h!==null;)a=h.alternate,a!==null&&nx(a)===null&&(y=h),h=h.sibling;h=y,h===null?(y=n.child,n.child=null):(y=h.sibling,h.sibling=null),Dw(n,!1,y,h,b);break;case"backwards":for(h=null,y=n.child,n.child=null;y!==null;){if(a=y.alternate,a!==null&&nx(a)===null){n.child=y;break}a=y.sibling,y.sibling=h,h=y,y=a}Dw(n,!0,h,null,b);break;case"together":Dw(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function wv(a,n){!(n.mode&1)&&a!==null&&(a.alternate=null,n.alternate=null,n.flags|=2)}function Ru(a,n,h){if(a!==null&&(n.dependencies=a.dependencies),Sf|=n.lanes,!(h&n.childLanes))return null;if(a!==null&&n.child!==a.child)throw Error(Zt(153));if(n.child!==null){for(a=n.child,h=Xc(a,a.pendingProps),n.child=h,h.return=n;a.sibling!==null;)a=a.sibling,h=h.sibling=Xc(a,a.pendingProps),h.return=n;h.sibling=null}return n.child}function iU(a,n,h){switch(n.tag){case 3:KR(n),vp();break;case 5:ER(n);break;case 1:ms(n.type)&&Kv(n);break;case 4:xE(n,n.stateNode.containerInfo);break;case 10:var m=n.type._context,y=n.memoizedProps.value;Vn(ex,m._currentValue),m._currentValue=y;break;case 13:if(m=n.memoizedState,m!==null)return m.dehydrated!==null?(Vn(di,di.current&1),n.flags|=128,null):h&n.child.childLanes?QR(a,n,h):(Vn(di,di.current&1),a=Ru(a,n,h),a!==null?a.sibling:null);Vn(di,di.current&1);break;case 19:if(m=(h&n.childLanes)!==0,a.flags&128){if(m)return JR(a,n,h);n.flags|=128}if(y=n.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),Vn(di,di.current),m)break;return null;case 22:case 23:return n.lanes=0,XR(a,n,h)}return Ru(a,n,h)}var ek,YT,tk,rk;ek=function(a,n){for(var h=n.child;h!==null;){if(h.tag===5||h.tag===6)a.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break;for(;h.sibling===null;){if(h.return===null||h.return===n)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};YT=function(){};tk=function(a,n,h,m){var y=a.memoizedProps;if(y!==m){a=n.stateNode,cf(zl.current);var b=null;switch(h){case"input":y=yT(a,y),m=yT(a,m),b=[];break;case"select":y=gi({},y,{value:void 0}),m=gi({},m,{value:void 0}),b=[];break;case"textarea":y=bT(a,y),m=bT(a,m),b=[];break;default:typeof y.onClick!="function"&&typeof m.onClick=="function"&&(a.onclick=Xv)}TT(h,m);var M;h=null;for(R in y)if(!m.hasOwnProperty(R)&&y.hasOwnProperty(R)&&y[R]!=null)if(R==="style"){var P=y[R];for(M in P)P.hasOwnProperty(M)&&(h||(h={}),h[M]="")}else R!=="dangerouslySetInnerHTML"&&R!=="children"&&R!=="suppressContentEditableWarning"&&R!=="suppressHydrationWarning"&&R!=="autoFocus"&&(ag.hasOwnProperty(R)?b||(b=[]):(b=b||[]).push(R,null));for(R in m){var o=m[R];if(P=y!=null?y[R]:void 0,m.hasOwnProperty(R)&&o!==P&&(o!=null||P!=null))if(R==="style")if(P){for(M in P)!P.hasOwnProperty(M)||o&&o.hasOwnProperty(M)||(h||(h={}),h[M]="");for(M in o)o.hasOwnProperty(M)&&P[M]!==o[M]&&(h||(h={}),h[M]=o[M])}else h||(b||(b=[]),b.push(R,h)),h=o;else R==="dangerouslySetInnerHTML"?(o=o?o.__html:void 0,P=P?P.__html:void 0,o!=null&&P!==o&&(b=b||[]).push(R,o)):R==="children"?typeof o!="string"&&typeof o!="number"||(b=b||[]).push(R,""+o):R!=="suppressContentEditableWarning"&&R!=="suppressHydrationWarning"&&(ag.hasOwnProperty(R)?(o!=null&&R==="onScroll"&&Zn("scroll",a),b||P===o||(b=[])):(b=b||[]).push(R,o))}h&&(b=b||[]).push("style",h);var R=b;(n.updateQueue=R)&&(n.flags|=4)}};rk=function(a,n,h,m){h!==m&&(n.flags|=4)};function P_(a,n){if(!ti)switch(a.tailMode){case"hidden":n=a.tail;for(var h=null;n!==null;)n.alternate!==null&&(h=n),n=n.sibling;h===null?a.tail=null:h.sibling=null;break;case"collapsed":h=a.tail;for(var m=null;h!==null;)h.alternate!==null&&(m=h),h=h.sibling;m===null?n||a.tail===null?a.tail=null:a.tail.sibling=null:m.sibling=null}}function Oo(a){var n=a.alternate!==null&&a.alternate.child===a.child,h=0,m=0;if(n)for(var y=a.child;y!==null;)h|=y.lanes|y.childLanes,m|=y.subtreeFlags&14680064,m|=y.flags&14680064,y.return=a,y=y.sibling;else for(y=a.child;y!==null;)h|=y.lanes|y.childLanes,m|=y.subtreeFlags,m|=y.flags,y.return=a,y=y.sibling;return a.subtreeFlags|=m,a.childLanes=h,n}function oU(a,n,h){var m=n.pendingProps;switch(dE(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Oo(n),null;case 1:return ms(n.type)&&Yv(),Oo(n),null;case 3:return m=n.stateNode,bp(),Xn(ps),Xn(zo),wE(),m.pendingContext&&(m.context=m.pendingContext,m.pendingContext=null),(a===null||a.child===null)&&(rv(n)?n.flags|=4:a===null||a.memoizedState.isDehydrated&&!(n.flags&256)||(n.flags|=1024,il!==null&&(iS(il),il=null))),YT(a,n),Oo(n),null;case 5:bE(n);var y=cf(vg.current);if(h=n.type,a!==null&&n.stateNode!=null)tk(a,n,h,m,y),a.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!m){if(n.stateNode===null)throw Error(Zt(166));return Oo(n),null}if(a=cf(zl.current),rv(n)){m=n.stateNode,h=n.type;var b=n.memoizedProps;switch(m[Dl]=n,m[gg]=b,a=(n.mode&1)!==0,h){case"dialog":Zn("cancel",m),Zn("close",m);break;case"iframe":case"object":case"embed":Zn("load",m);break;case"video":case"audio":for(y=0;y<U_.length;y++)Zn(U_[y],m);break;case"source":Zn("error",m);break;case"img":case"image":case"link":Zn("error",m),Zn("load",m);break;case"details":Zn("toggle",m);break;case"input":h3(m,b),Zn("invalid",m);break;case"select":m._wrapperState={wasMultiple:!!b.multiple},Zn("invalid",m);break;case"textarea":d3(m,b),Zn("invalid",m)}TT(h,b),y=null;for(var M in b)if(b.hasOwnProperty(M)){var P=b[M];M==="children"?typeof P=="string"?m.textContent!==P&&(b.suppressHydrationWarning!==!0&&tv(m.textContent,P,a),y=["children",P]):typeof P=="number"&&m.textContent!==""+P&&(b.suppressHydrationWarning!==!0&&tv(m.textContent,P,a),y=["children",""+P]):ag.hasOwnProperty(M)&&P!=null&&M==="onScroll"&&Zn("scroll",m)}switch(h){case"input":H0(m),f3(m,b,!0);break;case"textarea":H0(m),p3(m);break;case"select":case"option":break;default:typeof b.onClick=="function"&&(m.onclick=Xv)}m=y,n.updateQueue=m,m!==null&&(n.flags|=4)}else{M=y.nodeType===9?y:y.ownerDocument,a==="http://www.w3.org/1999/xhtml"&&(a=PD(h)),a==="http://www.w3.org/1999/xhtml"?h==="script"?(a=M.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild)):typeof m.is=="string"?a=M.createElement(h,{is:m.is}):(a=M.createElement(h),h==="select"&&(M=a,m.multiple?M.multiple=!0:m.size&&(M.size=m.size))):a=M.createElementNS(a,h),a[Dl]=n,a[gg]=m,ek(a,n,!1,!1),n.stateNode=a;e:{switch(M=ST(h,m),h){case"dialog":Zn("cancel",a),Zn("close",a),y=m;break;case"iframe":case"object":case"embed":Zn("load",a),y=m;break;case"video":case"audio":for(y=0;y<U_.length;y++)Zn(U_[y],a);y=m;break;case"source":Zn("error",a),y=m;break;case"img":case"image":case"link":Zn("error",a),Zn("load",a),y=m;break;case"details":Zn("toggle",a),y=m;break;case"input":h3(a,m),y=yT(a,m),Zn("invalid",a);break;case"option":y=m;break;case"select":a._wrapperState={wasMultiple:!!m.multiple},y=gi({},m,{value:void 0}),Zn("invalid",a);break;case"textarea":d3(a,m),y=bT(a,m),Zn("invalid",a);break;default:y=m}TT(h,y),P=y;for(b in P)if(P.hasOwnProperty(b)){var o=P[b];b==="style"?RD(a,o):b==="dangerouslySetInnerHTML"?(o=o?o.__html:void 0,o!=null&&OD(a,o)):b==="children"?typeof o=="string"?(h!=="textarea"||o!=="")&&lg(a,o):typeof o=="number"&&lg(a,""+o):b!=="suppressContentEditableWarning"&&b!=="suppressHydrationWarning"&&b!=="autoFocus"&&(ag.hasOwnProperty(b)?o!=null&&b==="onScroll"&&Zn("scroll",a):o!=null&&QS(a,b,o,M))}switch(h){case"input":H0(a),f3(a,m,!1);break;case"textarea":H0(a),p3(a);break;case"option":m.value!=null&&a.setAttribute("value",""+Qc(m.value));break;case"select":a.multiple=!!m.multiple,b=m.value,b!=null?op(a,!!m.multiple,b,!1):m.defaultValue!=null&&op(a,!!m.multiple,m.defaultValue,!0);break;default:typeof y.onClick=="function"&&(a.onclick=Xv)}switch(h){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}}m&&(n.flags|=4)}n.ref!==null&&(n.flags|=512,n.flags|=2097152)}return Oo(n),null;case 6:if(a&&n.stateNode!=null)rk(a,n,a.memoizedProps,m);else{if(typeof m!="string"&&n.stateNode===null)throw Error(Zt(166));if(h=cf(vg.current),cf(zl.current),rv(n)){if(m=n.stateNode,h=n.memoizedProps,m[Dl]=n,(b=m.nodeValue!==h)&&(a=Ys,a!==null))switch(a.tag){case 3:tv(m.nodeValue,h,(a.mode&1)!==0);break;case 5:a.memoizedProps.suppressHydrationWarning!==!0&&tv(m.nodeValue,h,(a.mode&1)!==0)}b&&(n.flags|=4)}else m=(h.nodeType===9?h:h.ownerDocument).createTextNode(m),m[Dl]=n,n.stateNode=m}return Oo(n),null;case 13:if(Xn(di),m=n.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(ti&&Zs!==null&&n.mode&1&&!(n.flags&128))xR(),vp(),n.flags|=98560,b=!1;else if(b=rv(n),m!==null&&m.dehydrated!==null){if(a===null){if(!b)throw Error(Zt(318));if(b=n.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(Zt(317));b[Dl]=n}else vp(),!(n.flags&128)&&(n.memoizedState=null),n.flags|=4;Oo(n),b=!1}else il!==null&&(iS(il),il=null),b=!0;if(!b)return n.flags&65536?n:null}return n.flags&128?(n.lanes=h,n):(m=m!==null,m!==(a!==null&&a.memoizedState!==null)&&m&&(n.child.flags|=8192,n.mode&1&&(a===null||di.current&1?$i===0&&($i=3):kE())),n.updateQueue!==null&&(n.flags|=4),Oo(n),null);case 4:return bp(),YT(a,n),a===null&&mg(n.stateNode.containerInfo),Oo(n),null;case 10:return gE(n.type._context),Oo(n),null;case 17:return ms(n.type)&&Yv(),Oo(n),null;case 19:if(Xn(di),b=n.memoizedState,b===null)return Oo(n),null;if(m=(n.flags&128)!==0,M=b.rendering,M===null)if(m)P_(b,!1);else{if($i!==0||a!==null&&a.flags&128)for(a=n.child;a!==null;){if(M=nx(a),M!==null){for(n.flags|=128,P_(b,!1),m=M.updateQueue,m!==null&&(n.updateQueue=m,n.flags|=4),n.subtreeFlags=0,m=h,h=n.child;h!==null;)b=h,a=m,b.flags&=14680066,M=b.alternate,M===null?(b.childLanes=0,b.lanes=a,b.child=null,b.subtreeFlags=0,b.memoizedProps=null,b.memoizedState=null,b.updateQueue=null,b.dependencies=null,b.stateNode=null):(b.childLanes=M.childLanes,b.lanes=M.lanes,b.child=M.child,b.subtreeFlags=0,b.deletions=null,b.memoizedProps=M.memoizedProps,b.memoizedState=M.memoizedState,b.updateQueue=M.updateQueue,b.type=M.type,a=M.dependencies,b.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),h=h.sibling;return Vn(di,di.current&1|2),n.child}a=a.sibling}b.tail!==null&&Mi()>Tp&&(n.flags|=128,m=!0,P_(b,!1),n.lanes=4194304)}else{if(!m)if(a=nx(M),a!==null){if(n.flags|=128,m=!0,h=a.updateQueue,h!==null&&(n.updateQueue=h,n.flags|=4),P_(b,!0),b.tail===null&&b.tailMode==="hidden"&&!M.alternate&&!ti)return Oo(n),null}else 2*Mi()-b.renderingStartTime>Tp&&h!==1073741824&&(n.flags|=128,m=!0,P_(b,!1),n.lanes=4194304);b.isBackwards?(M.sibling=n.child,n.child=M):(h=b.last,h!==null?h.sibling=M:n.child=M,b.last=M)}return b.tail!==null?(n=b.tail,b.rendering=n,b.tail=n.sibling,b.renderingStartTime=Mi(),n.sibling=null,h=di.current,Vn(di,m?h&1|2:h&1),n):(Oo(n),null);case 22:case 23:return RE(),m=n.memoizedState!==null,a!==null&&a.memoizedState!==null!==m&&(n.flags|=8192),m&&n.mode&1?Ws&1073741824&&(Oo(n),n.subtreeFlags&6&&(n.flags|=8192)):Oo(n),null;case 24:return null;case 25:return null}throw Error(Zt(156,n.tag))}function sU(a,n){switch(dE(n),n.tag){case 1:return ms(n.type)&&Yv(),a=n.flags,a&65536?(n.flags=a&-65537|128,n):null;case 3:return bp(),Xn(ps),Xn(zo),wE(),a=n.flags,a&65536&&!(a&128)?(n.flags=a&-65537|128,n):null;case 5:return bE(n),null;case 13:if(Xn(di),a=n.memoizedState,a!==null&&a.dehydrated!==null){if(n.alternate===null)throw Error(Zt(340));vp()}return a=n.flags,a&65536?(n.flags=a&-65537|128,n):null;case 19:return Xn(di),null;case 4:return bp(),null;case 10:return gE(n.type._context),null;case 22:case 23:return RE(),null;case 24:return null;default:return null}}var ov=!1,Do=!1,aU=typeof WeakSet=="function"?WeakSet:Set,_r=null;function ep(a,n){var h=a.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(m){vi(a,n,m)}else h.current=null}function KT(a,n,h){try{h()}catch(m){vi(a,n,m)}}var nP=!1;function lU(a,n){if(kT=qv,a=aR(),hE(a)){if("selectionStart"in a)var h={start:a.selectionStart,end:a.selectionEnd};else e:{h=(h=a.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&m.rangeCount!==0){h=m.anchorNode;var y=m.anchorOffset,b=m.focusNode;m=m.focusOffset;try{h.nodeType,b.nodeType}catch{h=null;break e}var M=0,P=-1,o=-1,R=0,U=0,V=a,Z=null;t:for(;;){for(var te;V!==h||y!==0&&V.nodeType!==3||(P=M+y),V!==b||m!==0&&V.nodeType!==3||(o=M+m),V.nodeType===3&&(M+=V.nodeValue.length),(te=V.firstChild)!==null;)Z=V,V=te;for(;;){if(V===a)break t;if(Z===h&&++R===y&&(P=M),Z===b&&++U===m&&(o=M),(te=V.nextSibling)!==null)break;V=Z,Z=V.parentNode}V=te}h=P===-1||o===-1?null:{start:P,end:o}}else h=null}h=h||{start:0,end:0}}else h=null;for(LT={focusedElem:a,selectionRange:h},qv=!1,_r=n;_r!==null;)if(n=_r,a=n.child,(n.subtreeFlags&1028)!==0&&a!==null)a.return=n,_r=a;else for(;_r!==null;){n=_r;try{var se=n.alternate;if(n.flags&1024)switch(n.tag){case 0:case 11:case 15:break;case 1:if(se!==null){var re=se.memoizedProps,Te=se.memoizedState,ae=n.stateNode,q=ae.getSnapshotBeforeUpdate(n.elementType===n.type?re:rl(n.type,re),Te);ae.__reactInternalSnapshotBeforeUpdate=q}break;case 3:var Q=n.stateNode.containerInfo;Q.nodeType===1?Q.textContent="":Q.nodeType===9&&Q.documentElement&&Q.removeChild(Q.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Zt(163))}}catch(le){vi(n,n.return,le)}if(a=n.sibling,a!==null){a.return=n.return,_r=a;break}_r=n.return}return se=nP,nP=!1,se}function Q_(a,n,h){var m=n.updateQueue;if(m=m!==null?m.lastEffect:null,m!==null){var y=m=m.next;do{if((y.tag&a)===a){var b=y.destroy;y.destroy=void 0,b!==void 0&&KT(n,h,b)}y=y.next}while(y!==m)}}function $x(a,n){if(n=n.updateQueue,n=n!==null?n.lastEffect:null,n!==null){var h=n=n.next;do{if((h.tag&a)===a){var m=h.create;h.destroy=m()}h=h.next}while(h!==n)}}function QT(a){var n=a.ref;if(n!==null){var h=a.stateNode;switch(a.tag){case 5:a=h;break;default:a=h}typeof n=="function"?n(a):n.current=a}}function nk(a){var n=a.alternate;n!==null&&(a.alternate=null,nk(n)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(n=a.stateNode,n!==null&&(delete n[Dl],delete n[gg],delete n[BT],delete n[G6],delete n[W6])),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}function ik(a){return a.tag===5||a.tag===3||a.tag===4}function iP(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||ik(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function JT(a,n,h){var m=a.tag;if(m===5||m===6)a=a.stateNode,n?h.nodeType===8?h.parentNode.insertBefore(a,n):h.insertBefore(a,n):(h.nodeType===8?(n=h.parentNode,n.insertBefore(a,h)):(n=h,n.appendChild(a)),h=h._reactRootContainer,h!=null||n.onclick!==null||(n.onclick=Xv));else if(m!==4&&(a=a.child,a!==null))for(JT(a,n,h),a=a.sibling;a!==null;)JT(a,n,h),a=a.sibling}function eS(a,n,h){var m=a.tag;if(m===5||m===6)a=a.stateNode,n?h.insertBefore(a,n):h.appendChild(a);else if(m!==4&&(a=a.child,a!==null))for(eS(a,n,h),a=a.sibling;a!==null;)eS(a,n,h),a=a.sibling}var fo=null,nl=!1;function Cc(a,n,h){for(h=h.child;h!==null;)ok(a,n,h),h=h.sibling}function ok(a,n,h){if(Ll&&typeof Ll.onCommitFiberUnmount=="function")try{Ll.onCommitFiberUnmount(Lx,h)}catch{}switch(h.tag){case 5:Do||ep(h,n);case 6:var m=fo,y=nl;fo=null,Cc(a,n,h),fo=m,nl=y,fo!==null&&(nl?(a=fo,h=h.stateNode,a.nodeType===8?a.parentNode.removeChild(h):a.removeChild(h)):fo.removeChild(h.stateNode));break;case 18:fo!==null&&(nl?(a=fo,h=h.stateNode,a.nodeType===8?Ew(a.parentNode,h):a.nodeType===1&&Ew(a,h),fg(a)):Ew(fo,h.stateNode));break;case 4:m=fo,y=nl,fo=h.stateNode.containerInfo,nl=!0,Cc(a,n,h),fo=m,nl=y;break;case 0:case 11:case 14:case 15:if(!Do&&(m=h.updateQueue,m!==null&&(m=m.lastEffect,m!==null))){y=m=m.next;do{var b=y,M=b.destroy;b=b.tag,M!==void 0&&(b&2||b&4)&&KT(h,n,M),y=y.next}while(y!==m)}Cc(a,n,h);break;case 1:if(!Do&&(ep(h,n),m=h.stateNode,typeof m.componentWillUnmount=="function"))try{m.props=h.memoizedProps,m.state=h.memoizedState,m.componentWillUnmount()}catch(P){vi(h,n,P)}Cc(a,n,h);break;case 21:Cc(a,n,h);break;case 22:h.mode&1?(Do=(m=Do)||h.memoizedState!==null,Cc(a,n,h),Do=m):Cc(a,n,h);break;default:Cc(a,n,h)}}function oP(a){var n=a.updateQueue;if(n!==null){a.updateQueue=null;var h=a.stateNode;h===null&&(h=a.stateNode=new aU),n.forEach(function(m){var y=gU.bind(null,a,m);h.has(m)||(h.add(m),m.then(y,y))})}}function el(a,n){var h=n.deletions;if(h!==null)for(var m=0;m<h.length;m++){var y=h[m];try{var b=a,M=n,P=M;e:for(;P!==null;){switch(P.tag){case 5:fo=P.stateNode,nl=!1;break e;case 3:fo=P.stateNode.containerInfo,nl=!0;break e;case 4:fo=P.stateNode.containerInfo,nl=!0;break e}P=P.return}if(fo===null)throw Error(Zt(160));ok(b,M,y),fo=null,nl=!1;var o=y.alternate;o!==null&&(o.return=null),y.return=null}catch(R){vi(y,n,R)}}if(n.subtreeFlags&12854)for(n=n.child;n!==null;)sk(n,a),n=n.sibling}function sk(a,n){var h=a.alternate,m=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:if(el(n,a),Al(a),m&4){try{Q_(3,a,a.return),$x(3,a)}catch(re){vi(a,a.return,re)}try{Q_(5,a,a.return)}catch(re){vi(a,a.return,re)}}break;case 1:el(n,a),Al(a),m&512&&h!==null&&ep(h,h.return);break;case 5:if(el(n,a),Al(a),m&512&&h!==null&&ep(h,h.return),a.flags&32){var y=a.stateNode;try{lg(y,"")}catch(re){vi(a,a.return,re)}}if(m&4&&(y=a.stateNode,y!=null)){var b=a.memoizedProps,M=h!==null?h.memoizedProps:b,P=a.type,o=a.updateQueue;if(a.updateQueue=null,o!==null)try{P==="input"&&b.type==="radio"&&b.name!=null&&AD(y,b),ST(P,M);var R=ST(P,b);for(M=0;M<o.length;M+=2){var U=o[M],V=o[M+1];U==="style"?RD(y,V):U==="dangerouslySetInnerHTML"?OD(y,V):U==="children"?lg(y,V):QS(y,U,V,R)}switch(P){case"input":vT(y,b);break;case"textarea":CD(y,b);break;case"select":var Z=y._wrapperState.wasMultiple;y._wrapperState.wasMultiple=!!b.multiple;var te=b.value;te!=null?op(y,!!b.multiple,te,!1):Z!==!!b.multiple&&(b.defaultValue!=null?op(y,!!b.multiple,b.defaultValue,!0):op(y,!!b.multiple,b.multiple?[]:"",!1))}y[gg]=b}catch(re){vi(a,a.return,re)}}break;case 6:if(el(n,a),Al(a),m&4){if(a.stateNode===null)throw Error(Zt(162));y=a.stateNode,b=a.memoizedProps;try{y.nodeValue=b}catch(re){vi(a,a.return,re)}}break;case 3:if(el(n,a),Al(a),m&4&&h!==null&&h.memoizedState.isDehydrated)try{fg(n.containerInfo)}catch(re){vi(a,a.return,re)}break;case 4:el(n,a),Al(a);break;case 13:el(n,a),Al(a),y=a.child,y.flags&8192&&(b=y.memoizedState!==null,y.stateNode.isHidden=b,!b||y.alternate!==null&&y.alternate.memoizedState!==null||(OE=Mi())),m&4&&oP(a);break;case 22:if(U=h!==null&&h.memoizedState!==null,a.mode&1?(Do=(R=Do)||U,el(n,a),Do=R):el(n,a),Al(a),m&8192){if(R=a.memoizedState!==null,(a.stateNode.isHidden=R)&&!U&&a.mode&1)for(_r=a,U=a.child;U!==null;){for(V=_r=U;_r!==null;){switch(Z=_r,te=Z.child,Z.tag){case 0:case 11:case 14:case 15:Q_(4,Z,Z.return);break;case 1:ep(Z,Z.return);var se=Z.stateNode;if(typeof se.componentWillUnmount=="function"){m=Z,h=Z.return;try{n=m,se.props=n.memoizedProps,se.state=n.memoizedState,se.componentWillUnmount()}catch(re){vi(m,h,re)}}break;case 5:ep(Z,Z.return);break;case 22:if(Z.memoizedState!==null){aP(V);continue}}te!==null?(te.return=Z,_r=te):aP(V)}U=U.sibling}e:for(U=null,V=a;;){if(V.tag===5){if(U===null){U=V;try{y=V.stateNode,R?(b=y.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none"):(P=V.stateNode,o=V.memoizedProps.style,M=o!=null&&o.hasOwnProperty("display")?o.display:null,P.style.display=DD("display",M))}catch(re){vi(a,a.return,re)}}}else if(V.tag===6){if(U===null)try{V.stateNode.nodeValue=R?"":V.memoizedProps}catch(re){vi(a,a.return,re)}}else if((V.tag!==22&&V.tag!==23||V.memoizedState===null||V===a)&&V.child!==null){V.child.return=V,V=V.child;continue}if(V===a)break e;for(;V.sibling===null;){if(V.return===null||V.return===a)break e;U===V&&(U=null),V=V.return}U===V&&(U=null),V.sibling.return=V.return,V=V.sibling}}break;case 19:el(n,a),Al(a),m&4&&oP(a);break;case 21:break;default:el(n,a),Al(a)}}function Al(a){var n=a.flags;if(n&2){try{e:{for(var h=a.return;h!==null;){if(ik(h)){var m=h;break e}h=h.return}throw Error(Zt(160))}switch(m.tag){case 5:var y=m.stateNode;m.flags&32&&(lg(y,""),m.flags&=-33);var b=iP(a);eS(a,b,y);break;case 3:case 4:var M=m.stateNode.containerInfo,P=iP(a);JT(a,P,M);break;default:throw Error(Zt(161))}}catch(o){vi(a,a.return,o)}a.flags&=-3}n&4096&&(a.flags&=-4097)}function uU(a,n,h){_r=a,ak(a)}function ak(a,n,h){for(var m=(a.mode&1)!==0;_r!==null;){var y=_r,b=y.child;if(y.tag===22&&m){var M=y.memoizedState!==null||ov;if(!M){var P=y.alternate,o=P!==null&&P.memoizedState!==null||Do;P=ov;var R=Do;if(ov=M,(Do=o)&&!R)for(_r=y;_r!==null;)M=_r,o=M.child,M.tag===22&&M.memoizedState!==null?lP(y):o!==null?(o.return=M,_r=o):lP(y);for(;b!==null;)_r=b,ak(b),b=b.sibling;_r=y,ov=P,Do=R}sP(a)}else y.subtreeFlags&8772&&b!==null?(b.return=y,_r=b):sP(a)}}function sP(a){for(;_r!==null;){var n=_r;if(n.flags&8772){var h=n.alternate;try{if(n.flags&8772)switch(n.tag){case 0:case 11:case 15:Do||$x(5,n);break;case 1:var m=n.stateNode;if(n.flags&4&&!Do)if(h===null)m.componentDidMount();else{var y=n.elementType===n.type?h.memoizedProps:rl(n.type,h.memoizedProps);m.componentDidUpdate(y,h.memoizedState,m.__reactInternalSnapshotBeforeUpdate)}var b=n.updateQueue;b!==null&&G3(n,b,m);break;case 3:var M=n.updateQueue;if(M!==null){if(h=null,n.child!==null)switch(n.child.tag){case 5:h=n.child.stateNode;break;case 1:h=n.child.stateNode}G3(n,M,h)}break;case 5:var P=n.stateNode;if(h===null&&n.flags&4){h=P;var o=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":o.autoFocus&&h.focus();break;case"img":o.src&&(h.src=o.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(n.memoizedState===null){var R=n.alternate;if(R!==null){var U=R.memoizedState;if(U!==null){var V=U.dehydrated;V!==null&&fg(V)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Zt(163))}Do||n.flags&512&&QT(n)}catch(Z){vi(n,n.return,Z)}}if(n===a){_r=null;break}if(h=n.sibling,h!==null){h.return=n.return,_r=h;break}_r=n.return}}function aP(a){for(;_r!==null;){var n=_r;if(n===a){_r=null;break}var h=n.sibling;if(h!==null){h.return=n.return,_r=h;break}_r=n.return}}function lP(a){for(;_r!==null;){var n=_r;try{switch(n.tag){case 0:case 11:case 15:var h=n.return;try{$x(4,n)}catch(o){vi(n,h,o)}break;case 1:var m=n.stateNode;if(typeof m.componentDidMount=="function"){var y=n.return;try{m.componentDidMount()}catch(o){vi(n,y,o)}}var b=n.return;try{QT(n)}catch(o){vi(n,b,o)}break;case 5:var M=n.return;try{QT(n)}catch(o){vi(n,M,o)}}}catch(o){vi(n,n.return,o)}if(n===a){_r=null;break}var P=n.sibling;if(P!==null){P.return=n.return,_r=P;break}_r=n.return}}var cU=Math.ceil,sx=zu.ReactCurrentDispatcher,CE=zu.ReactCurrentOwner,Ma=zu.ReactCurrentBatchConfig,vn=0,oo=null,zi=null,po=0,Ws=0,tp=ih(0),$i=0,Tg=null,Sf=0,Gx=0,PE=0,J_=null,fs=null,OE=0,Tp=1/0,wu=null,ax=!1,tS=null,Hc=null,sv=!1,zc=null,lx=0,eg=0,rS=null,Tv=-1,Sv=0;function Ko(){return vn&6?Mi():Tv!==-1?Tv:Tv=Mi()}function Zc(a){return a.mode&1?vn&2&&po!==0?po&-po:H6.transition!==null?(Sv===0&&(Sv=WD()),Sv):(a=Pn,a!==0||(a=window.event,a=a===void 0?16:QD(a.type)),a):1}function ll(a,n,h,m){if(50<eg)throw eg=0,rS=null,Error(Zt(185));Bg(a,h,m),(!(vn&2)||a!==oo)&&(a===oo&&(!(vn&2)&&(Gx|=h),$i===4&&kc(a,po)),_s(a,m),h===1&&vn===0&&!(n.mode&1)&&(Tp=Mi()+500,Ux&&oh()))}function _s(a,n){var h=a.callbackNode;HN(a,n);var m=Wv(a,a===oo?po:0);if(m===0)h!==null&&g3(h),a.callbackNode=null,a.callbackPriority=0;else if(n=m&-m,a.callbackPriority!==n){if(h!=null&&g3(h),n===1)a.tag===0?q6(uP.bind(null,a)):gR(uP.bind(null,a)),V6(function(){!(vn&6)&&oh()}),h=null;else{switch(qD(m)){case 1:h=nE;break;case 4:h=$D;break;case 16:h=Gv;break;case 536870912:h=GD;break;default:h=Gv}h=mk(h,lk.bind(null,a))}a.callbackPriority=n,a.callbackNode=h}}function lk(a,n){if(Tv=-1,Sv=0,vn&6)throw Error(Zt(327));var h=a.callbackNode;if(cp()&&a.callbackNode!==h)return null;var m=Wv(a,a===oo?po:0);if(m===0)return null;if(m&30||m&a.expiredLanes||n)n=ux(a,m);else{n=m;var y=vn;vn|=2;var b=ck();(oo!==a||po!==n)&&(wu=null,Tp=Mi()+500,ff(a,n));do try{dU();break}catch(P){uk(a,P)}while(!0);_E(),sx.current=b,vn=y,zi!==null?n=0:(oo=null,po=0,n=$i)}if(n!==0){if(n===2&&(y=CT(a),y!==0&&(m=y,n=nS(a,y))),n===1)throw h=Tg,ff(a,0),kc(a,m),_s(a,Mi()),h;if(n===6)kc(a,m);else{if(y=a.current.alternate,!(m&30)&&!hU(y)&&(n=ux(a,m),n===2&&(b=CT(a),b!==0&&(m=b,n=nS(a,b))),n===1))throw h=Tg,ff(a,0),kc(a,m),_s(a,Mi()),h;switch(a.finishedWork=y,a.finishedLanes=m,n){case 0:case 1:throw Error(Zt(345));case 2:sf(a,fs,wu);break;case 3:if(kc(a,m),(m&130023424)===m&&(n=OE+500-Mi(),10<n)){if(Wv(a,0)!==0)break;if(y=a.suspendedLanes,(y&m)!==m){Ko(),a.pingedLanes|=a.suspendedLanes&y;break}a.timeoutHandle=FT(sf.bind(null,a,fs,wu),n);break}sf(a,fs,wu);break;case 4:if(kc(a,m),(m&4194240)===m)break;for(n=a.eventTimes,y=-1;0<m;){var M=31-al(m);b=1<<M,M=n[M],M>y&&(y=M),m&=~b}if(m=y,m=Mi()-m,m=(120>m?120:480>m?480:1080>m?1080:1920>m?1920:3e3>m?3e3:4320>m?4320:1960*cU(m/1960))-m,10<m){a.timeoutHandle=FT(sf.bind(null,a,fs,wu),m);break}sf(a,fs,wu);break;case 5:sf(a,fs,wu);break;default:throw Error(Zt(329))}}}return _s(a,Mi()),a.callbackNode===h?lk.bind(null,a):null}function nS(a,n){var h=J_;return a.current.memoizedState.isDehydrated&&(ff(a,n).flags|=256),a=ux(a,n),a!==2&&(n=fs,fs=h,n!==null&&iS(n)),a}function iS(a){fs===null?fs=a:fs.push.apply(fs,a)}function hU(a){for(var n=a;;){if(n.flags&16384){var h=n.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var m=0;m<h.length;m++){var y=h[m],b=y.getSnapshot;y=y.value;try{if(!cl(b(),y))return!1}catch{return!1}}}if(h=n.child,n.subtreeFlags&16384&&h!==null)h.return=n,n=h;else{if(n===a)break;for(;n.sibling===null;){if(n.return===null||n.return===a)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function kc(a,n){for(n&=~PE,n&=~Gx,a.suspendedLanes|=n,a.pingedLanes&=~n,a=a.expirationTimes;0<n;){var h=31-al(n),m=1<<h;a[h]=-1,n&=~m}}function uP(a){if(vn&6)throw Error(Zt(327));cp();var n=Wv(a,0);if(!(n&1))return _s(a,Mi()),null;var h=ux(a,n);if(a.tag!==0&&h===2){var m=CT(a);m!==0&&(n=m,h=nS(a,m))}if(h===1)throw h=Tg,ff(a,0),kc(a,n),_s(a,Mi()),h;if(h===6)throw Error(Zt(345));return a.finishedWork=a.current.alternate,a.finishedLanes=n,sf(a,fs,wu),_s(a,Mi()),null}function DE(a,n){var h=vn;vn|=1;try{return a(n)}finally{vn=h,vn===0&&(Tp=Mi()+500,Ux&&oh())}}function Ef(a){zc!==null&&zc.tag===0&&!(vn&6)&&cp();var n=vn;vn|=1;var h=Ma.transition,m=Pn;try{if(Ma.transition=null,Pn=1,a)return a()}finally{Pn=m,Ma.transition=h,vn=n,!(vn&6)&&oh()}}function RE(){Ws=tp.current,Xn(tp)}function ff(a,n){a.finishedWork=null,a.finishedLanes=0;var h=a.timeoutHandle;if(h!==-1&&(a.timeoutHandle=-1,j6(h)),zi!==null)for(h=zi.return;h!==null;){var m=h;switch(dE(m),m.tag){case 1:m=m.type.childContextTypes,m!=null&&Yv();break;case 3:bp(),Xn(ps),Xn(zo),wE();break;case 5:bE(m);break;case 4:bp();break;case 13:Xn(di);break;case 19:Xn(di);break;case 10:gE(m.type._context);break;case 22:case 23:RE()}h=h.return}if(oo=a,zi=a=Xc(a.current,null),po=Ws=n,$i=0,Tg=null,PE=Gx=Sf=0,fs=J_=null,uf!==null){for(n=0;n<uf.length;n++)if(h=uf[n],m=h.interleaved,m!==null){h.interleaved=null;var y=m.next,b=h.pending;if(b!==null){var M=b.next;b.next=y,m.next=M}h.pending=m}uf=null}return a}function uk(a,n){do{var h=zi;try{if(_E(),xv.current=ox,ix){for(var m=_i.memoizedState;m!==null;){var y=m.queue;y!==null&&(y.pending=null),m=m.next}ix=!1}if(Tf=0,no=Vi=_i=null,K_=!1,xg=0,CE.current=null,h===null||h.return===null){$i=1,Tg=n,zi=null;break}e:{var b=a,M=h.return,P=h,o=n;if(n=po,P.flags|=32768,o!==null&&typeof o=="object"&&typeof o.then=="function"){var R=o,U=P,V=U.tag;if(!(U.mode&1)&&(V===0||V===11||V===15)){var Z=U.alternate;Z?(U.updateQueue=Z.updateQueue,U.memoizedState=Z.memoizedState,U.lanes=Z.lanes):(U.updateQueue=null,U.memoizedState=null)}var te=Y3(M);if(te!==null){te.flags&=-257,K3(te,M,P,b,n),te.mode&1&&X3(b,R,n),n=te,o=R;var se=n.updateQueue;if(se===null){var re=new Set;re.add(o),n.updateQueue=re}else se.add(o);break e}else{if(!(n&1)){X3(b,R,n),kE();break e}o=Error(Zt(426))}}else if(ti&&P.mode&1){var Te=Y3(M);if(Te!==null){!(Te.flags&65536)&&(Te.flags|=256),K3(Te,M,P,b,n),pE(wp(o,P));break e}}b=o=wp(o,P),$i!==4&&($i=2),J_===null?J_=[b]:J_.push(b),b=M;do{switch(b.tag){case 3:b.flags|=65536,n&=-n,b.lanes|=n;var ae=qR(b,o,n);$3(b,ae);break e;case 1:P=o;var q=b.type,Q=b.stateNode;if(!(b.flags&128)&&(typeof q.getDerivedStateFromError=="function"||Q!==null&&typeof Q.componentDidCatch=="function"&&(Hc===null||!Hc.has(Q)))){b.flags|=65536,n&=-n,b.lanes|=n;var le=HR(b,P,n);$3(b,le);break e}}b=b.return}while(b!==null)}fk(h)}catch(ye){n=ye,zi===h&&h!==null&&(zi=h=h.return);continue}break}while(!0)}function ck(){var a=sx.current;return sx.current=ox,a===null?ox:a}function kE(){($i===0||$i===3||$i===2)&&($i=4),oo===null||!(Sf&268435455)&&!(Gx&268435455)||kc(oo,po)}function ux(a,n){var h=vn;vn|=2;var m=ck();(oo!==a||po!==n)&&(wu=null,ff(a,n));do try{fU();break}catch(y){uk(a,y)}while(!0);if(_E(),vn=h,sx.current=m,zi!==null)throw Error(Zt(261));return oo=null,po=0,$i}function fU(){for(;zi!==null;)hk(zi)}function dU(){for(;zi!==null&&!BN();)hk(zi)}function hk(a){var n=pk(a.alternate,a,Ws);a.memoizedProps=a.pendingProps,n===null?fk(a):zi=n,CE.current=null}function fk(a){var n=a;do{var h=n.alternate;if(a=n.return,n.flags&32768){if(h=sU(h,n),h!==null){h.flags&=32767,zi=h;return}if(a!==null)a.flags|=32768,a.subtreeFlags=0,a.deletions=null;else{$i=6,zi=null;return}}else if(h=oU(h,n,Ws),h!==null){zi=h;return}if(n=n.sibling,n!==null){zi=n;return}zi=n=a}while(n!==null);$i===0&&($i=5)}function sf(a,n,h){var m=Pn,y=Ma.transition;try{Ma.transition=null,Pn=1,pU(a,n,h,m)}finally{Ma.transition=y,Pn=m}return null}function pU(a,n,h,m){do cp();while(zc!==null);if(vn&6)throw Error(Zt(327));h=a.finishedWork;var y=a.finishedLanes;if(h===null)return null;if(a.finishedWork=null,a.finishedLanes=0,h===a.current)throw Error(Zt(177));a.callbackNode=null,a.callbackPriority=0;var b=h.lanes|h.childLanes;if(ZN(a,b),a===oo&&(zi=oo=null,po=0),!(h.subtreeFlags&2064)&&!(h.flags&2064)||sv||(sv=!0,mk(Gv,function(){return cp(),null})),b=(h.flags&15990)!==0,h.subtreeFlags&15990||b){b=Ma.transition,Ma.transition=null;var M=Pn;Pn=1;var P=vn;vn|=4,CE.current=null,lU(a,h),sk(h,a),k6(LT),qv=!!kT,LT=kT=null,a.current=h,uU(h),NN(),vn=P,Pn=M,Ma.transition=b}else a.current=h;if(sv&&(sv=!1,zc=a,lx=y),b=a.pendingLanes,b===0&&(Hc=null),VN(h.stateNode),_s(a,Mi()),n!==null)for(m=a.onRecoverableError,h=0;h<n.length;h++)y=n[h],m(y.value,{componentStack:y.stack,digest:y.digest});if(ax)throw ax=!1,a=tS,tS=null,a;return lx&1&&a.tag!==0&&cp(),b=a.pendingLanes,b&1?a===rS?eg++:(eg=0,rS=a):eg=0,oh(),null}function cp(){if(zc!==null){var a=qD(lx),n=Ma.transition,h=Pn;try{if(Ma.transition=null,Pn=16>a?16:a,zc===null)var m=!1;else{if(a=zc,zc=null,lx=0,vn&6)throw Error(Zt(331));var y=vn;for(vn|=4,_r=a.current;_r!==null;){var b=_r,M=b.child;if(_r.flags&16){var P=b.deletions;if(P!==null){for(var o=0;o<P.length;o++){var R=P[o];for(_r=R;_r!==null;){var U=_r;switch(U.tag){case 0:case 11:case 15:Q_(8,U,b)}var V=U.child;if(V!==null)V.return=U,_r=V;else for(;_r!==null;){U=_r;var Z=U.sibling,te=U.return;if(nk(U),U===R){_r=null;break}if(Z!==null){Z.return=te,_r=Z;break}_r=te}}}var se=b.alternate;if(se!==null){var re=se.child;if(re!==null){se.child=null;do{var Te=re.sibling;re.sibling=null,re=Te}while(re!==null)}}_r=b}}if(b.subtreeFlags&2064&&M!==null)M.return=b,_r=M;else e:for(;_r!==null;){if(b=_r,b.flags&2048)switch(b.tag){case 0:case 11:case 15:Q_(9,b,b.return)}var ae=b.sibling;if(ae!==null){ae.return=b.return,_r=ae;break e}_r=b.return}}var q=a.current;for(_r=q;_r!==null;){M=_r;var Q=M.child;if(M.subtreeFlags&2064&&Q!==null)Q.return=M,_r=Q;else e:for(M=q;_r!==null;){if(P=_r,P.flags&2048)try{switch(P.tag){case 0:case 11:case 15:$x(9,P)}}catch(ye){vi(P,P.return,ye)}if(P===M){_r=null;break e}var le=P.sibling;if(le!==null){le.return=P.return,_r=le;break e}_r=P.return}}if(vn=y,oh(),Ll&&typeof Ll.onPostCommitFiberRoot=="function")try{Ll.onPostCommitFiberRoot(Lx,a)}catch{}m=!0}return m}finally{Pn=h,Ma.transition=n}}return!1}function cP(a,n,h){n=wp(h,n),n=qR(a,n,1),a=qc(a,n,1),n=Ko(),a!==null&&(Bg(a,1,n),_s(a,n))}function vi(a,n,h){if(a.tag===3)cP(a,a,h);else for(;n!==null;){if(n.tag===3){cP(n,a,h);break}else if(n.tag===1){var m=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Hc===null||!Hc.has(m))){a=wp(h,a),a=HR(n,a,1),n=qc(n,a,1),a=Ko(),n!==null&&(Bg(n,1,a),_s(n,a));break}}n=n.return}}function mU(a,n,h){var m=a.pingCache;m!==null&&m.delete(n),n=Ko(),a.pingedLanes|=a.suspendedLanes&h,oo===a&&(po&h)===h&&($i===4||$i===3&&(po&130023424)===po&&500>Mi()-OE?ff(a,0):PE|=h),_s(a,n)}function dk(a,n){n===0&&(a.mode&1?(n=Y0,Y0<<=1,!(Y0&130023424)&&(Y0=4194304)):n=1);var h=Ko();a=Du(a,n),a!==null&&(Bg(a,n,h),_s(a,h))}function _U(a){var n=a.memoizedState,h=0;n!==null&&(h=n.retryLane),dk(a,h)}function gU(a,n){var h=0;switch(a.tag){case 13:var m=a.stateNode,y=a.memoizedState;y!==null&&(h=y.retryLane);break;case 19:m=a.stateNode;break;default:throw Error(Zt(314))}m!==null&&m.delete(n),dk(a,h)}var pk;pk=function(a,n,h){if(a!==null)if(a.memoizedProps!==n.pendingProps||ps.current)ds=!0;else{if(!(a.lanes&h)&&!(n.flags&128))return ds=!1,iU(a,n,h);ds=!!(a.flags&131072)}else ds=!1,ti&&n.flags&1048576&&yR(n,Jv,n.index);switch(n.lanes=0,n.tag){case 2:var m=n.type;wv(a,n),a=n.pendingProps;var y=yp(n,zo.current);up(n,h),y=SE(null,n,m,a,y,h);var b=EE();return n.flags|=1,typeof y=="object"&&y!==null&&typeof y.render=="function"&&y.$$typeof===void 0?(n.tag=1,n.memoizedState=null,n.updateQueue=null,ms(m)?(b=!0,Kv(n)):b=!1,n.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,vE(n),y.updater=Vx,n.stateNode=y,y._reactInternals=n,GT(n,m,a,h),n=HT(null,n,m,!0,b,h)):(n.tag=0,ti&&b&&fE(n),Zo(null,n,y,h),n=n.child),n;case 16:m=n.elementType;e:{switch(wv(a,n),a=n.pendingProps,y=m._init,m=y(m._payload),n.type=m,y=n.tag=vU(m),a=rl(m,a),y){case 0:n=qT(null,n,m,a,h);break e;case 1:n=eP(null,n,m,a,h);break e;case 11:n=Q3(null,n,m,a,h);break e;case 14:n=J3(null,n,m,rl(m.type,a),h);break e}throw Error(Zt(306,m,""))}return n;case 0:return m=n.type,y=n.pendingProps,y=n.elementType===m?y:rl(m,y),qT(a,n,m,y,h);case 1:return m=n.type,y=n.pendingProps,y=n.elementType===m?y:rl(m,y),eP(a,n,m,y,h);case 3:e:{if(KR(n),a===null)throw Error(Zt(387));m=n.pendingProps,b=n.memoizedState,y=b.element,SR(a,n),rx(n,m,null,h);var M=n.memoizedState;if(m=M.element,b.isDehydrated)if(b={element:m,isDehydrated:!1,cache:M.cache,pendingSuspenseBoundaries:M.pendingSuspenseBoundaries,transitions:M.transitions},n.updateQueue.baseState=b,n.memoizedState=b,n.flags&256){y=wp(Error(Zt(423)),n),n=tP(a,n,m,h,y);break e}else if(m!==y){y=wp(Error(Zt(424)),n),n=tP(a,n,m,h,y);break e}else for(Zs=Wc(n.stateNode.containerInfo.firstChild),Ys=n,ti=!0,il=null,h=wR(n,null,m,h),n.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(vp(),m===y){n=Ru(a,n,h);break e}Zo(a,n,m,h)}n=n.child}return n;case 5:return ER(n),a===null&&jT(n),m=n.type,y=n.pendingProps,b=a!==null?a.memoizedProps:null,M=y.children,zT(m,y)?M=null:b!==null&&zT(m,b)&&(n.flags|=32),YR(a,n),Zo(a,n,M,h),n.child;case 6:return a===null&&jT(n),null;case 13:return QR(a,n,h);case 4:return xE(n,n.stateNode.containerInfo),m=n.pendingProps,a===null?n.child=xp(n,null,m,h):Zo(a,n,m,h),n.child;case 11:return m=n.type,y=n.pendingProps,y=n.elementType===m?y:rl(m,y),Q3(a,n,m,y,h);case 7:return Zo(a,n,n.pendingProps,h),n.child;case 8:return Zo(a,n,n.pendingProps.children,h),n.child;case 12:return Zo(a,n,n.pendingProps.children,h),n.child;case 10:e:{if(m=n.type._context,y=n.pendingProps,b=n.memoizedProps,M=y.value,Vn(ex,m._currentValue),m._currentValue=M,b!==null)if(cl(b.value,M)){if(b.children===y.children&&!ps.current){n=Ru(a,n,h);break e}}else for(b=n.child,b!==null&&(b.return=n);b!==null;){var P=b.dependencies;if(P!==null){M=b.child;for(var o=P.firstContext;o!==null;){if(o.context===m){if(b.tag===1){o=Au(-1,h&-h),o.tag=2;var R=b.updateQueue;if(R!==null){R=R.shared;var U=R.pending;U===null?o.next=o:(o.next=U.next,U.next=o),R.pending=o}}b.lanes|=h,o=b.alternate,o!==null&&(o.lanes|=h),VT(b.return,h,n),P.lanes|=h;break}o=o.next}}else if(b.tag===10)M=b.type===n.type?null:b.child;else if(b.tag===18){if(M=b.return,M===null)throw Error(Zt(341));M.lanes|=h,P=M.alternate,P!==null&&(P.lanes|=h),VT(M,h,n),M=b.sibling}else M=b.child;if(M!==null)M.return=b;else for(M=b;M!==null;){if(M===n){M=null;break}if(b=M.sibling,b!==null){b.return=M.return,M=b;break}M=M.return}b=M}Zo(a,n,y.children,h),n=n.child}return n;case 9:return y=n.type,m=n.pendingProps.children,up(n,h),y=Ia(y),m=m(y),n.flags|=1,Zo(a,n,m,h),n.child;case 14:return m=n.type,y=rl(m,n.pendingProps),y=rl(m.type,y),J3(a,n,m,y,h);case 15:return ZR(a,n,n.type,n.pendingProps,h);case 17:return m=n.type,y=n.pendingProps,y=n.elementType===m?y:rl(m,y),wv(a,n),n.tag=1,ms(m)?(a=!0,Kv(n)):a=!1,up(n,h),WR(n,m,y),GT(n,m,y,h),HT(null,n,m,!0,a,h);case 19:return JR(a,n,h);case 22:return XR(a,n,h)}throw Error(Zt(156,n.tag))};function mk(a,n){return VD(a,n)}function yU(a,n,h,m){this.tag=a,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ta(a,n,h,m){return new yU(a,n,h,m)}function LE(a){return a=a.prototype,!(!a||!a.isReactComponent)}function vU(a){if(typeof a=="function")return LE(a)?1:0;if(a!=null){if(a=a.$$typeof,a===eE)return 11;if(a===tE)return 14}return 2}function Xc(a,n){var h=a.alternate;return h===null?(h=Ta(a.tag,n,a.key,a.mode),h.elementType=a.elementType,h.type=a.type,h.stateNode=a.stateNode,h.alternate=a,a.alternate=h):(h.pendingProps=n,h.type=a.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=a.flags&14680064,h.childLanes=a.childLanes,h.lanes=a.lanes,h.child=a.child,h.memoizedProps=a.memoizedProps,h.memoizedState=a.memoizedState,h.updateQueue=a.updateQueue,n=a.dependencies,h.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},h.sibling=a.sibling,h.index=a.index,h.ref=a.ref,h}function Ev(a,n,h,m,y,b){var M=2;if(m=a,typeof a=="function")LE(a)&&(M=1);else if(typeof a=="string")M=5;else e:switch(a){case Wd:return df(h.children,y,b,n);case JS:M=8,y|=8;break;case pT:return a=Ta(12,h,n,y|2),a.elementType=pT,a.lanes=b,a;case mT:return a=Ta(13,h,n,y),a.elementType=mT,a.lanes=b,a;case _T:return a=Ta(19,h,n,y),a.elementType=_T,a.lanes=b,a;case ED:return Wx(h,y,b,n);default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case TD:M=10;break e;case SD:M=9;break e;case eE:M=11;break e;case tE:M=14;break e;case Pc:M=16,m=null;break e}throw Error(Zt(130,a==null?a:typeof a,""))}return n=Ta(M,h,n,y),n.elementType=a,n.type=m,n.lanes=b,n}function df(a,n,h,m){return a=Ta(7,a,m,n),a.lanes=h,a}function Wx(a,n,h,m){return a=Ta(22,a,m,n),a.elementType=ED,a.lanes=h,a.stateNode={isHidden:!1},a}function Rw(a,n,h){return a=Ta(6,a,null,n),a.lanes=h,a}function kw(a,n,h){return n=Ta(4,a.children!==null?a.children:[],a.key,n),n.lanes=h,n.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},n}function xU(a,n,h,m,y){this.tag=n,this.containerInfo=a,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=pw(0),this.expirationTimes=pw(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=pw(0),this.identifierPrefix=m,this.onRecoverableError=y,this.mutableSourceEagerHydrationData=null}function zE(a,n,h,m,y,b,M,P,o){return a=new xU(a,n,h,P,o),n===1?(n=1,b===!0&&(n|=8)):n=0,b=Ta(3,null,null,n),a.current=b,b.stateNode=a,b.memoizedState={element:m,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},vE(b),a}function bU(a,n,h){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Gd,key:m==null?null:""+m,children:a,containerInfo:n,implementation:h}}function _k(a){if(!a)return Jc;a=a._reactInternals;e:{if(Cf(a)!==a||a.tag!==1)throw Error(Zt(170));var n=a;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(ms(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(n!==null);throw Error(Zt(171))}if(a.tag===1){var h=a.type;if(ms(h))return _R(a,h,n)}return n}function gk(a,n,h,m,y,b,M,P,o){return a=zE(h,m,!0,a,y,b,M,P,o),a.context=_k(null),h=a.current,m=Ko(),y=Zc(h),b=Au(m,y),b.callback=n??null,qc(h,b,y),a.current.lanes=y,Bg(a,y,m),_s(a,m),a}function qx(a,n,h,m){var y=n.current,b=Ko(),M=Zc(y);return h=_k(h),n.context===null?n.context=h:n.pendingContext=h,n=Au(b,M),n.payload={element:a},m=m===void 0?null:m,m!==null&&(n.callback=m),a=qc(y,n,M),a!==null&&(ll(a,y,M,b),vv(a,y,M)),M}function cx(a){if(a=a.current,!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function hP(a,n){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var h=a.retryLane;a.retryLane=h!==0&&h<n?h:n}}function FE(a,n){hP(a,n),(a=a.alternate)&&hP(a,n)}function wU(){return null}var yk=typeof reportError=="function"?reportError:function(a){console.error(a)};function BE(a){this._internalRoot=a}Hx.prototype.render=BE.prototype.render=function(a){var n=this._internalRoot;if(n===null)throw Error(Zt(409));qx(a,n,null,null)};Hx.prototype.unmount=BE.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var n=a.containerInfo;Ef(function(){qx(null,a,null,null)}),n[Ou]=null}};function Hx(a){this._internalRoot=a}Hx.prototype.unstable_scheduleHydration=function(a){if(a){var n=XD();a={blockedOn:null,target:a,priority:n};for(var h=0;h<Rc.length&&n!==0&&n<Rc[h].priority;h++);Rc.splice(h,0,a),h===0&&KD(a)}};function NE(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function Zx(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11&&(a.nodeType!==8||a.nodeValue!==" react-mount-point-unstable "))}function fP(){}function TU(a,n,h,m,y){if(y){if(typeof m=="function"){var b=m;m=function(){var R=cx(M);b.call(R)}}var M=gk(n,m,a,0,null,!1,!1,"",fP);return a._reactRootContainer=M,a[Ou]=M.current,mg(a.nodeType===8?a.parentNode:a),Ef(),M}for(;y=a.lastChild;)a.removeChild(y);if(typeof m=="function"){var P=m;m=function(){var R=cx(o);P.call(R)}}var o=zE(a,0,!1,null,null,!1,!1,"",fP);return a._reactRootContainer=o,a[Ou]=o.current,mg(a.nodeType===8?a.parentNode:a),Ef(function(){qx(n,o,h,m)}),o}function Xx(a,n,h,m,y){var b=h._reactRootContainer;if(b){var M=b;if(typeof y=="function"){var P=y;y=function(){var o=cx(M);P.call(o)}}qx(n,M,a,y)}else M=TU(h,n,a,y,m);return cx(M)}HD=function(a){switch(a.tag){case 3:var n=a.stateNode;if(n.current.memoizedState.isDehydrated){var h=N_(n.pendingLanes);h!==0&&(iE(n,h|1),_s(n,Mi()),!(vn&6)&&(Tp=Mi()+500,oh()))}break;case 13:Ef(function(){var m=Du(a,1);if(m!==null){var y=Ko();ll(m,a,1,y)}}),FE(a,1)}};oE=function(a){if(a.tag===13){var n=Du(a,134217728);if(n!==null){var h=Ko();ll(n,a,134217728,h)}FE(a,134217728)}};ZD=function(a){if(a.tag===13){var n=Zc(a),h=Du(a,n);if(h!==null){var m=Ko();ll(h,a,n,m)}FE(a,n)}};XD=function(){return Pn};YD=function(a,n){var h=Pn;try{return Pn=a,n()}finally{Pn=h}};MT=function(a,n,h){switch(n){case"input":if(vT(a,h),n=h.name,h.type==="radio"&&n!=null){for(h=a;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<h.length;n++){var m=h[n];if(m!==a&&m.form===a.form){var y=Nx(m);if(!y)throw Error(Zt(90));ID(m),vT(m,y)}}}break;case"textarea":CD(a,h);break;case"select":n=h.value,n!=null&&op(a,!!h.multiple,n,!1)}};zD=DE;FD=Ef;var SU={usingClientEntryPoint:!1,Events:[Ug,Xd,Nx,kD,LD,DE]},O_={findFiberByHostInstance:lf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},EU={bundleType:O_.bundleType,version:O_.version,rendererPackageName:O_.rendererPackageName,rendererConfig:O_.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:zu.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){return a=UD(a),a===null?null:a.stateNode},findFiberByHostInstance:O_.findFiberByHostInstance||wU,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var av=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!av.isDisabled&&av.supportsFiber)try{Lx=av.inject(EU),Ll=av}catch{}}ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=SU;ea.createPortal=function(a,n){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!NE(n))throw Error(Zt(200));return bU(a,n,null,h)};ea.createRoot=function(a,n){if(!NE(a))throw Error(Zt(299));var h=!1,m="",y=yk;return n!=null&&(n.unstable_strictMode===!0&&(h=!0),n.identifierPrefix!==void 0&&(m=n.identifierPrefix),n.onRecoverableError!==void 0&&(y=n.onRecoverableError)),n=zE(a,1,!1,null,null,h,!1,m,y),a[Ou]=n.current,mg(a.nodeType===8?a.parentNode:a),new BE(n)};ea.findDOMNode=function(a){if(a==null)return null;if(a.nodeType===1)return a;var n=a._reactInternals;if(n===void 0)throw typeof a.render=="function"?Error(Zt(188)):(a=Object.keys(a).join(","),Error(Zt(268,a)));return a=UD(n),a=a===null?null:a.stateNode,a};ea.flushSync=function(a){return Ef(a)};ea.hydrate=function(a,n,h){if(!Zx(n))throw Error(Zt(200));return Xx(null,a,n,!0,h)};ea.hydrateRoot=function(a,n,h){if(!NE(a))throw Error(Zt(405));var m=h!=null&&h.hydratedSources||null,y=!1,b="",M=yk;if(h!=null&&(h.unstable_strictMode===!0&&(y=!0),h.identifierPrefix!==void 0&&(b=h.identifierPrefix),h.onRecoverableError!==void 0&&(M=h.onRecoverableError)),n=gk(n,null,a,1,h??null,y,!1,b,M),a[Ou]=n.current,mg(a),m)for(a=0;a<m.length;a++)h=m[a],y=h._getVersion,y=y(h._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[h,y]:n.mutableSourceEagerHydrationData.push(h,y);return new Hx(n)};ea.render=function(a,n,h){if(!Zx(n))throw Error(Zt(200));return Xx(null,a,n,!1,h)};ea.unmountComponentAtNode=function(a){if(!Zx(a))throw Error(Zt(40));return a._reactRootContainer?(Ef(function(){Xx(null,null,a,!1,function(){a._reactRootContainer=null,a[Ou]=null})}),!0):!1};ea.unstable_batchedUpdates=DE;ea.unstable_renderSubtreeIntoContainer=function(a,n,h,m){if(!Zx(h))throw Error(Zt(200));if(a==null||a._reactInternals===void 0)throw Error(Zt(38));return Xx(a,n,h,!1,m)};ea.version="18.3.1-next-f1338f8080-20240426";function vk(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(vk)}catch(a){console.error(a)}}vk(),vD.exports=ea;var MU=vD.exports,dP=MU;fT.createRoot=dP.createRoot,fT.hydrateRoot=dP.hydrateRoot;const IU=[{title:"Routing Map",url:"/directions",cName:"nav-links"},{title:"Choropleth Map",url:"/choropleth",cName:"nav-links"}];/**
 * @remix-run/router v1.19.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Sg(){return Sg=Object.assign?Object.assign.bind():function(a){for(var n=1;n<arguments.length;n++){var h=arguments[n];for(var m in h)Object.prototype.hasOwnProperty.call(h,m)&&(a[m]=h[m])}return a},Sg.apply(this,arguments)}var Fc;(function(a){a.Pop="POP",a.Push="PUSH",a.Replace="REPLACE"})(Fc||(Fc={}));const pP="popstate";function AU(a){a===void 0&&(a={});function n(m,y){let{pathname:b,search:M,hash:P}=m.location;return oS("",{pathname:b,search:M,hash:P},y.state&&y.state.usr||null,y.state&&y.state.key||"default")}function h(m,y){return typeof y=="string"?y:bk(y)}return PU(n,h,null,a)}function Gi(a,n){if(a===!1||a===null||typeof a>"u")throw new Error(n)}function xk(a,n){if(!a){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function CU(){return Math.random().toString(36).substr(2,8)}function mP(a,n){return{usr:a.state,key:a.key,idx:n}}function oS(a,n,h,m){return h===void 0&&(h=null),Sg({pathname:typeof a=="string"?a:a.pathname,search:"",hash:""},typeof n=="string"?Fp(n):n,{state:h,key:n&&n.key||m||CU()})}function bk(a){let{pathname:n="/",search:h="",hash:m=""}=a;return h&&h!=="?"&&(n+=h.charAt(0)==="?"?h:"?"+h),m&&m!=="#"&&(n+=m.charAt(0)==="#"?m:"#"+m),n}function Fp(a){let n={};if(a){let h=a.indexOf("#");h>=0&&(n.hash=a.substr(h),a=a.substr(0,h));let m=a.indexOf("?");m>=0&&(n.search=a.substr(m),a=a.substr(0,m)),a&&(n.pathname=a)}return n}function PU(a,n,h,m){m===void 0&&(m={});let{window:y=document.defaultView,v5Compat:b=!1}=m,M=y.history,P=Fc.Pop,o=null,R=U();R==null&&(R=0,M.replaceState(Sg({},M.state,{idx:R}),""));function U(){return(M.state||{idx:null}).idx}function V(){P=Fc.Pop;let Te=U(),ae=Te==null?null:Te-R;R=Te,o&&o({action:P,location:re.location,delta:ae})}function Z(Te,ae){P=Fc.Push;let q=oS(re.location,Te,ae);R=U()+1;let Q=mP(q,R),le=re.createHref(q);try{M.pushState(Q,"",le)}catch(ye){if(ye instanceof DOMException&&ye.name==="DataCloneError")throw ye;y.location.assign(le)}b&&o&&o({action:P,location:re.location,delta:1})}function te(Te,ae){P=Fc.Replace;let q=oS(re.location,Te,ae);R=U();let Q=mP(q,R),le=re.createHref(q);M.replaceState(Q,"",le),b&&o&&o({action:P,location:re.location,delta:0})}function se(Te){let ae=y.location.origin!=="null"?y.location.origin:y.location.href,q=typeof Te=="string"?Te:bk(Te);return q=q.replace(/ $/,"%20"),Gi(ae,"No window.location.(origin|href) available to create URL for href: "+q),new URL(q,ae)}let re={get action(){return P},get location(){return a(y,M)},listen(Te){if(o)throw new Error("A history only accepts one active listener");return y.addEventListener(pP,V),o=Te,()=>{y.removeEventListener(pP,V),o=null}},createHref(Te){return n(y,Te)},createURL:se,encodeLocation(Te){let ae=se(Te);return{pathname:ae.pathname,search:ae.search,hash:ae.hash}},push:Z,replace:te,go(Te){return M.go(Te)}};return re}var _P;(function(a){a.data="data",a.deferred="deferred",a.redirect="redirect",a.error="error"})(_P||(_P={}));function OU(a,n,h){return h===void 0&&(h="/"),DU(a,n,h,!1)}function DU(a,n,h,m){let y=typeof n=="string"?Fp(n):n,b=Sk(y.pathname||"/",h);if(b==null)return null;let M=wk(a);RU(M);let P=null;for(let o=0;P==null&&o<M.length;++o){let R=GU(b);P=VU(M[o],R,m)}return P}function wk(a,n,h,m){n===void 0&&(n=[]),h===void 0&&(h=[]),m===void 0&&(m="");let y=(b,M,P)=>{let o={relativePath:P===void 0?b.path||"":P,caseSensitive:b.caseSensitive===!0,childrenIndex:M,route:b};o.relativePath.startsWith("/")&&(Gi(o.relativePath.startsWith(m),'Absolute route path "'+o.relativePath+'" nested under path '+('"'+m+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),o.relativePath=o.relativePath.slice(m.length));let R=pf([m,o.relativePath]),U=h.concat(o);b.children&&b.children.length>0&&(Gi(b.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+R+'".')),wk(b.children,n,U,R)),!(b.path==null&&!b.index)&&n.push({path:R,score:UU(R,b.index),routesMeta:U})};return a.forEach((b,M)=>{var P;if(b.path===""||!((P=b.path)!=null&&P.includes("?")))y(b,M);else for(let o of Tk(b.path))y(b,M,o)}),n}function Tk(a){let n=a.split("/");if(n.length===0)return[];let[h,...m]=n,y=h.endsWith("?"),b=h.replace(/\?$/,"");if(m.length===0)return y?[b,""]:[b];let M=Tk(m.join("/")),P=[];return P.push(...M.map(o=>o===""?b:[b,o].join("/"))),y&&P.push(...M),P.map(o=>a.startsWith("/")&&o===""?"/":o)}function RU(a){a.sort((n,h)=>n.score!==h.score?h.score-n.score:jU(n.routesMeta.map(m=>m.childrenIndex),h.routesMeta.map(m=>m.childrenIndex)))}const kU=/^:[\w-]+$/,LU=3,zU=2,FU=1,BU=10,NU=-2,gP=a=>a==="*";function UU(a,n){let h=a.split("/"),m=h.length;return h.some(gP)&&(m+=NU),n&&(m+=zU),h.filter(y=>!gP(y)).reduce((y,b)=>y+(kU.test(b)?LU:b===""?FU:BU),m)}function jU(a,n){return a.length===n.length&&a.slice(0,-1).every((m,y)=>m===n[y])?a[a.length-1]-n[n.length-1]:0}function VU(a,n,h){let{routesMeta:m}=a,y={},b="/",M=[];for(let P=0;P<m.length;++P){let o=m[P],R=P===m.length-1,U=b==="/"?n:n.slice(b.length)||"/",V=yP({path:o.relativePath,caseSensitive:o.caseSensitive,end:R},U),Z=o.route;if(!V&&R&&h&&!m[m.length-1].route.index&&(V=yP({path:o.relativePath,caseSensitive:o.caseSensitive,end:!1},U)),!V)return null;Object.assign(y,V.params),M.push({params:y,pathname:pf([b,V.pathname]),pathnameBase:YU(pf([b,V.pathnameBase])),route:Z}),V.pathnameBase!=="/"&&(b=pf([b,V.pathnameBase]))}return M}function yP(a,n){typeof a=="string"&&(a={path:a,caseSensitive:!1,end:!0});let[h,m]=$U(a.path,a.caseSensitive,a.end),y=n.match(h);if(!y)return null;let b=y[0],M=b.replace(/(.)\/+$/,"$1"),P=y.slice(1);return{params:m.reduce((R,U,V)=>{let{paramName:Z,isOptional:te}=U;if(Z==="*"){let re=P[V]||"";M=b.slice(0,b.length-re.length).replace(/(.)\/+$/,"$1")}const se=P[V];return te&&!se?R[Z]=void 0:R[Z]=(se||"").replace(/%2F/g,"/"),R},{}),pathname:b,pathnameBase:M,pattern:a}}function $U(a,n,h){n===void 0&&(n=!1),h===void 0&&(h=!0),xk(a==="*"||!a.endsWith("*")||a.endsWith("/*"),'Route path "'+a+'" will be treated as if it were '+('"'+a.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+a.replace(/\*$/,"/*")+'".'));let m=[],y="^"+a.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(M,P,o)=>(m.push({paramName:P,isOptional:o!=null}),o?"/?([^\\/]+)?":"/([^\\/]+)"));return a.endsWith("*")?(m.push({paramName:"*"}),y+=a==="*"||a==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):h?y+="\\/*$":a!==""&&a!=="/"&&(y+="(?:(?=\\/|$))"),[new RegExp(y,n?void 0:"i"),m]}function GU(a){try{return a.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return xk(!1,'The URL path "'+a+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+n+").")),a}}function Sk(a,n){if(n==="/")return a;if(!a.toLowerCase().startsWith(n.toLowerCase()))return null;let h=n.endsWith("/")?n.length-1:n.length,m=a.charAt(h);return m&&m!=="/"?null:a.slice(h)||"/"}function WU(a,n){n===void 0&&(n="/");let{pathname:h,search:m="",hash:y=""}=typeof a=="string"?Fp(a):a;return{pathname:h?h.startsWith("/")?h:qU(h,n):n,search:KU(m),hash:QU(y)}}function qU(a,n){let h=n.replace(/\/+$/,"").split("/");return a.split("/").forEach(y=>{y===".."?h.length>1&&h.pop():y!=="."&&h.push(y)}),h.length>1?h.join("/"):"/"}function Lw(a,n,h,m){return"Cannot include a '"+a+"' character in a manually specified "+("`to."+n+"` field ["+JSON.stringify(m)+"].  Please separate it out to the ")+("`to."+h+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function HU(a){return a.filter((n,h)=>h===0||n.route.path&&n.route.path.length>0)}function ZU(a,n){let h=HU(a);return n?h.map((m,y)=>y===h.length-1?m.pathname:m.pathnameBase):h.map(m=>m.pathnameBase)}function XU(a,n,h,m){m===void 0&&(m=!1);let y;typeof a=="string"?y=Fp(a):(y=Sg({},a),Gi(!y.pathname||!y.pathname.includes("?"),Lw("?","pathname","search",y)),Gi(!y.pathname||!y.pathname.includes("#"),Lw("#","pathname","hash",y)),Gi(!y.search||!y.search.includes("#"),Lw("#","search","hash",y)));let b=a===""||y.pathname==="",M=b?"/":y.pathname,P;if(M==null)P=h;else{let V=n.length-1;if(!m&&M.startsWith("..")){let Z=M.split("/");for(;Z[0]==="..";)Z.shift(),V-=1;y.pathname=Z.join("/")}P=V>=0?n[V]:"/"}let o=WU(y,P),R=M&&M!=="/"&&M.endsWith("/"),U=(b||M===".")&&h.endsWith("/");return!o.pathname.endsWith("/")&&(R||U)&&(o.pathname+="/"),o}const pf=a=>a.join("/").replace(/\/\/+/g,"/"),YU=a=>a.replace(/\/+$/,"").replace(/^\/*/,"/"),KU=a=>!a||a==="?"?"":a.startsWith("?")?a:"?"+a,QU=a=>!a||a==="#"?"":a.startsWith("#")?a:"#"+a;function JU(a){return a!=null&&typeof a.status=="number"&&typeof a.statusText=="string"&&typeof a.internal=="boolean"&&"data"in a}const Ek=["post","put","patch","delete"];new Set(Ek);const ej=["get",...Ek];new Set(ej);/**
 * React Router v6.26.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Eg(){return Eg=Object.assign?Object.assign.bind():function(a){for(var n=1;n<arguments.length;n++){var h=arguments[n];for(var m in h)Object.prototype.hasOwnProperty.call(h,m)&&(a[m]=h[m])}return a},Eg.apply(this,arguments)}const UE=rr.createContext(null),tj=rr.createContext(null),Yx=rr.createContext(null),Kx=rr.createContext(null),Bp=rr.createContext({outlet:null,matches:[],isDataRoute:!1}),Mk=rr.createContext(null);function Qx(){return rr.useContext(Kx)!=null}function Ik(){return Qx()||Gi(!1),rr.useContext(Kx).location}function Ak(a){rr.useContext(Yx).static||rr.useLayoutEffect(a)}function rj(){let{isDataRoute:a}=rr.useContext(Bp);return a?mj():nj()}function nj(){Qx()||Gi(!1);let a=rr.useContext(UE),{basename:n,future:h,navigator:m}=rr.useContext(Yx),{matches:y}=rr.useContext(Bp),{pathname:b}=Ik(),M=JSON.stringify(ZU(y,h.v7_relativeSplatPath)),P=rr.useRef(!1);return Ak(()=>{P.current=!0}),rr.useCallback(function(R,U){if(U===void 0&&(U={}),!P.current)return;if(typeof R=="number"){m.go(R);return}let V=XU(R,JSON.parse(M),b,U.relative==="path");a==null&&n!=="/"&&(V.pathname=V.pathname==="/"?n:pf([n,V.pathname])),(U.replace?m.replace:m.push)(V,U.state,U)},[n,m,M,b,a])}function ij(a,n){return oj(a,n)}function oj(a,n,h,m){Qx()||Gi(!1);let{navigator:y}=rr.useContext(Yx),{matches:b}=rr.useContext(Bp),M=b[b.length-1],P=M?M.params:{};M&&M.pathname;let o=M?M.pathnameBase:"/";M&&M.route;let R=Ik(),U;if(n){var V;let Te=typeof n=="string"?Fp(n):n;o==="/"||(V=Te.pathname)!=null&&V.startsWith(o)||Gi(!1),U=Te}else U=R;let Z=U.pathname||"/",te=Z;if(o!=="/"){let Te=o.replace(/^\//,"").split("/");te="/"+Z.replace(/^\//,"").split("/").slice(Te.length).join("/")}let se=OU(a,{pathname:te}),re=cj(se&&se.map(Te=>Object.assign({},Te,{params:Object.assign({},P,Te.params),pathname:pf([o,y.encodeLocation?y.encodeLocation(Te.pathname).pathname:Te.pathname]),pathnameBase:Te.pathnameBase==="/"?o:pf([o,y.encodeLocation?y.encodeLocation(Te.pathnameBase).pathname:Te.pathnameBase])})),b,h,m);return n&&re?rr.createElement(Kx.Provider,{value:{location:Eg({pathname:"/",search:"",hash:"",state:null,key:"default"},U),navigationType:Fc.Pop}},re):re}function sj(){let a=pj(),n=JU(a)?a.status+" "+a.statusText:a instanceof Error?a.message:JSON.stringify(a),h=a instanceof Error?a.stack:null,y={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return rr.createElement(rr.Fragment,null,rr.createElement("h2",null,"Unexpected Application Error!"),rr.createElement("h3",{style:{fontStyle:"italic"}},n),h?rr.createElement("pre",{style:y},h):null,null)}const aj=rr.createElement(sj,null);class lj extends rr.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,h){return h.location!==n.location||h.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:h.error,location:h.location,revalidation:n.revalidation||h.revalidation}}componentDidCatch(n,h){console.error("React Router caught the following error during render",n,h)}render(){return this.state.error!==void 0?rr.createElement(Bp.Provider,{value:this.props.routeContext},rr.createElement(Mk.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function uj(a){let{routeContext:n,match:h,children:m}=a,y=rr.useContext(UE);return y&&y.static&&y.staticContext&&(h.route.errorElement||h.route.ErrorBoundary)&&(y.staticContext._deepestRenderedBoundaryId=h.route.id),rr.createElement(Bp.Provider,{value:n},m)}function cj(a,n,h,m){var y;if(n===void 0&&(n=[]),h===void 0&&(h=null),m===void 0&&(m=null),a==null){var b;if(!h)return null;if(h.errors)a=h.matches;else if((b=m)!=null&&b.v7_partialHydration&&n.length===0&&!h.initialized&&h.matches.length>0)a=h.matches;else return null}let M=a,P=(y=h)==null?void 0:y.errors;if(P!=null){let U=M.findIndex(V=>V.route.id&&(P==null?void 0:P[V.route.id])!==void 0);U>=0||Gi(!1),M=M.slice(0,Math.min(M.length,U+1))}let o=!1,R=-1;if(h&&m&&m.v7_partialHydration)for(let U=0;U<M.length;U++){let V=M[U];if((V.route.HydrateFallback||V.route.hydrateFallbackElement)&&(R=U),V.route.id){let{loaderData:Z,errors:te}=h,se=V.route.loader&&Z[V.route.id]===void 0&&(!te||te[V.route.id]===void 0);if(V.route.lazy||se){o=!0,R>=0?M=M.slice(0,R+1):M=[M[0]];break}}}return M.reduceRight((U,V,Z)=>{let te,se=!1,re=null,Te=null;h&&(te=P&&V.route.id?P[V.route.id]:void 0,re=V.route.errorElement||aj,o&&(R<0&&Z===0?(se=!0,Te=null):R===Z&&(se=!0,Te=V.route.hydrateFallbackElement||null)));let ae=n.concat(M.slice(0,Z+1)),q=()=>{let Q;return te?Q=re:se?Q=Te:V.route.Component?Q=rr.createElement(V.route.Component,null):V.route.element?Q=V.route.element:Q=U,rr.createElement(uj,{match:V,routeContext:{outlet:U,matches:ae,isDataRoute:h!=null},children:Q})};return h&&(V.route.ErrorBoundary||V.route.errorElement||Z===0)?rr.createElement(lj,{location:h.location,revalidation:h.revalidation,component:re,error:te,children:q(),routeContext:{outlet:null,matches:ae,isDataRoute:!0}}):q()},null)}var Ck=function(a){return a.UseBlocker="useBlocker",a.UseRevalidator="useRevalidator",a.UseNavigateStable="useNavigate",a}(Ck||{}),hx=function(a){return a.UseBlocker="useBlocker",a.UseLoaderData="useLoaderData",a.UseActionData="useActionData",a.UseRouteError="useRouteError",a.UseNavigation="useNavigation",a.UseRouteLoaderData="useRouteLoaderData",a.UseMatches="useMatches",a.UseRevalidator="useRevalidator",a.UseNavigateStable="useNavigate",a.UseRouteId="useRouteId",a}(hx||{});function hj(a){let n=rr.useContext(UE);return n||Gi(!1),n}function fj(a){let n=rr.useContext(tj);return n||Gi(!1),n}function dj(a){let n=rr.useContext(Bp);return n||Gi(!1),n}function Pk(a){let n=dj(),h=n.matches[n.matches.length-1];return h.route.id||Gi(!1),h.route.id}function pj(){var a;let n=rr.useContext(Mk),h=fj(hx.UseRouteError),m=Pk(hx.UseRouteError);return n!==void 0?n:(a=h.errors)==null?void 0:a[m]}function mj(){let{router:a}=hj(Ck.UseNavigateStable),n=Pk(hx.UseNavigateStable),h=rr.useRef(!1);return Ak(()=>{h.current=!0}),rr.useCallback(function(y,b){b===void 0&&(b={}),h.current&&(typeof y=="number"?a.navigate(y):a.navigate(y,Eg({fromRouteId:n},b)))},[a,n])}function Mv(a){Gi(!1)}function _j(a){let{basename:n="/",children:h=null,location:m,navigationType:y=Fc.Pop,navigator:b,static:M=!1,future:P}=a;Qx()&&Gi(!1);let o=n.replace(/^\/*/,"/"),R=rr.useMemo(()=>({basename:o,navigator:b,static:M,future:Eg({v7_relativeSplatPath:!1},P)}),[o,P,b,M]);typeof m=="string"&&(m=Fp(m));let{pathname:U="/",search:V="",hash:Z="",state:te=null,key:se="default"}=m,re=rr.useMemo(()=>{let Te=Sk(U,o);return Te==null?null:{location:{pathname:Te,search:V,hash:Z,state:te,key:se},navigationType:y}},[o,U,V,Z,te,se,y]);return re==null?null:rr.createElement(Yx.Provider,{value:R},rr.createElement(Kx.Provider,{children:h,value:re}))}function gj(a){let{children:n,location:h}=a;return ij(sS(n),h)}new Promise(()=>{});function sS(a,n){n===void 0&&(n=[]);let h=[];return rr.Children.forEach(a,(m,y)=>{if(!rr.isValidElement(m))return;let b=[...n,y];if(m.type===rr.Fragment){h.push.apply(h,sS(m.props.children,b));return}m.type!==Mv&&Gi(!1),!m.props.index||!m.props.children||Gi(!1);let M={id:m.props.id||b.join("-"),caseSensitive:m.props.caseSensitive,element:m.props.element,Component:m.props.Component,index:m.props.index,path:m.props.path,loader:m.props.loader,action:m.props.action,errorElement:m.props.errorElement,ErrorBoundary:m.props.ErrorBoundary,hasErrorBoundary:m.props.ErrorBoundary!=null||m.props.errorElement!=null,shouldRevalidate:m.props.shouldRevalidate,handle:m.props.handle,lazy:m.props.lazy};m.props.children&&(M.children=sS(m.props.children,b)),h.push(M)}),h}/**
 * React Router DOM v6.26.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const yj="6";try{window.__reactRouterVersion=yj}catch{}const vj="startTransition",vP=mN[vj];function xj(a){let{basename:n,children:h,future:m,window:y}=a,b=rr.useRef();b.current==null&&(b.current=AU({window:y,v5Compat:!0}));let M=b.current,[P,o]=rr.useState({action:M.action,location:M.location}),{v7_startTransition:R}=m||{},U=rr.useCallback(V=>{R&&vP?vP(()=>o(V)):o(V)},[o,R]);return rr.useLayoutEffect(()=>M.listen(U),[M,U]),rr.createElement(_j,{basename:n,children:h,location:P.location,navigationType:P.action,navigator:M,future:m})}var xP;(function(a){a.UseScrollRestoration="useScrollRestoration",a.UseSubmit="useSubmit",a.UseSubmitFetcher="useSubmitFetcher",a.UseFetcher="useFetcher",a.useViewTransitionState="useViewTransitionState"})(xP||(xP={}));var bP;(function(a){a.UseFetcher="useFetcher",a.UseFetchers="useFetchers",a.UseScrollRestoration="useScrollRestoration"})(bP||(bP={}));class jE extends rr.Component{render(){return ir.jsxs("nav",{className:"NavbarItems",children:[ir.jsx("h1",{className:"safeCycleIcon",children:"SafeCycle"}),ir.jsx("ul",{className:"nav-menu",children:IU.map((n,h)=>ir.jsx("li",{children:ir.jsxs("a",{href:n.url,className:n.cName,children:[ir.jsx("i",{className:n.icon}),n.title]})},h))})]})}}var Ok={exports:{}};(function(a,n){var h={};(function(m,y){a.exports=y()})(Xo,function(){var m,y,b;function M(o,R){if(!m)m=R;else if(!y)y=R;else{var U="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+m+")(sharedChunk); ("+y+")(sharedChunk); self.onerror = null;",V={};m(V),b=R(V),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(b.workerUrl=window.URL.createObjectURL(new Blob([U],{type:"text/javascript"})))}}M(["exports"],function(o){var R="3.5.2";let U;const V={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(U==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{U=h.API_URL_REGEX!=null?new RegExp(h.API_URL_REGEX):t}catch{U=t}}return U},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!V.API_URL)return null;try{const t=new URL(V.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Z(t){return V.API_URL_REGEX.test(t)}function te(t){return t.indexOf("mapbox:")===0}function se(t){return V.API_CDN_URL_REGEX.test(t)}function re(t){return V.API_SPRITE_REGEX.test(t)}function Te(t){return V.API_STYLE_REGEX.test(t)&&!re(t)}const ae={create:"create",load:"load",fullLoad:"fullLoad"},q={mark(t){performance.mark(t)},measure(t,e,r){performance.measure(t,e,r)}};function Q(t){const e=t.name.split("?")[0];return se(e)&&e.includes("mapbox-gl.js")?"javascript":se(e)&&e.includes("mapbox-gl.css")?"css":function(r){return V.API_FONTS_REGEX.test(r)}(e)?"fontRange":re(e)?"sprite":Te(e)?"style":function(r){return V.API_TILEJSON_REGEX.test(r)}(e)?"tilejson":"other"}function le(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ye={},ze={};Object.defineProperty(ze,"__esModule",{value:!0}),ze.setMatrixArrayType=function(t){ze.ARRAY_TYPE=Ne=t},ze.toRadian=function(t){return t*Me},ze.equals=function(t,e){return Math.abs(t-e)<=He*Math.max(1,Math.abs(t),Math.abs(e))},ze.RANDOM=ze.ARRAY_TYPE=ze.EPSILON=void 0;var He=1e-6;ze.EPSILON=He;var Ne=typeof Float32Array<"u"?Float32Array:Array;ze.ARRAY_TYPE=Ne;var xe=Math.random;ze.RANDOM=xe;var Me=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Ie={};function Je(t){return Je=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Je(t)}Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.create=function(){var t=new Be.ARRAY_TYPE(4);return Be.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Ie.clone=function(t){var e=new Be.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Ie.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Ie.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Ie.fromValues=function(t,e,r,s){var u=new Be.ARRAY_TYPE(4);return u[0]=t,u[1]=e,u[2]=r,u[3]=s,u},Ie.set=function(t,e,r,s,u){return t[0]=e,t[1]=r,t[2]=s,t[3]=u,t},Ie.transpose=function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Ie.invert=function(t,e){var r=e[0],s=e[1],u=e[2],f=e[3],d=r*f-u*s;return d?(t[0]=f*(d=1/d),t[1]=-s*d,t[2]=-u*d,t[3]=r*d,t):null},Ie.adjoint=function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},Ie.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Ie.multiply=Re,Ie.rotate=function(t,e,r){var s=e[0],u=e[1],f=e[2],d=e[3],g=Math.sin(r),v=Math.cos(r);return t[0]=s*v+f*g,t[1]=u*v+d*g,t[2]=s*-g+f*v,t[3]=u*-g+d*v,t},Ie.scale=function(t,e,r){var s=e[1],u=e[2],f=e[3],d=r[0],g=r[1];return t[0]=e[0]*d,t[1]=s*d,t[2]=u*g,t[3]=f*g,t},Ie.fromRotation=function(t,e){var r=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=r,t[2]=-r,t[3]=s,t},Ie.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Ie.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Ie.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Ie.LDU=function(t,e,r,s){return t[2]=s[2]/s[0],r[0]=s[0],r[1]=s[1],r[3]=s[3]-t[2]*r[1],[t,e,r]},Ie.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},Ie.subtract=rt,Ie.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Ie.equals=function(t,e){var r=t[0],s=t[1],u=t[2],f=t[3],d=e[0],g=e[1],v=e[2],T=e[3];return Math.abs(r-d)<=Be.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(s-g)<=Be.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(u-v)<=Be.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(f-T)<=Be.EPSILON*Math.max(1,Math.abs(f),Math.abs(T))},Ie.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},Ie.multiplyScalarAndAdd=function(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t[3]=e[3]+r[3]*s,t},Ie.sub=Ie.mul=void 0;var Be=function(t,e){if(t&&t.__esModule)return t;if(t===null||Je(t)!=="object"&&typeof t!="function")return{default:t};var r=Ce(void 0);if(r&&r.has(t))return r.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var d=u?Object.getOwnPropertyDescriptor(t,f):null;d&&(d.get||d.set)?Object.defineProperty(s,f,d):s[f]=t[f]}return s.default=t,r&&r.set(t,s),s}(ze);function Ce(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Ce=function(s){return s?r:e})(t)}function Re(t,e,r){var s=e[0],u=e[1],f=e[2],d=e[3],g=r[0],v=r[1],T=r[2],E=r[3];return t[0]=s*g+f*v,t[1]=u*g+d*v,t[2]=s*T+f*E,t[3]=u*T+d*E,t}function rt(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}Ie.mul=Re,Ie.sub=rt;var st={};function at(t){return at=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},at(t)}Object.defineProperty(st,"__esModule",{value:!0}),st.create=function(){var t=new Ve.ARRAY_TYPE(6);return Ve.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},st.clone=function(t){var e=new Ve.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},st.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},st.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},st.fromValues=function(t,e,r,s,u,f){var d=new Ve.ARRAY_TYPE(6);return d[0]=t,d[1]=e,d[2]=r,d[3]=s,d[4]=u,d[5]=f,d},st.set=function(t,e,r,s,u,f,d){return t[0]=e,t[1]=r,t[2]=s,t[3]=u,t[4]=f,t[5]=d,t},st.invert=function(t,e){var r=e[0],s=e[1],u=e[2],f=e[3],d=e[4],g=e[5],v=r*f-s*u;return v?(t[0]=f*(v=1/v),t[1]=-s*v,t[2]=-u*v,t[3]=r*v,t[4]=(u*g-f*d)*v,t[5]=(s*d-r*g)*v,t):null},st.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},st.multiply=Bt,st.rotate=function(t,e,r){var s=e[0],u=e[1],f=e[2],d=e[3],g=e[4],v=e[5],T=Math.sin(r),E=Math.cos(r);return t[0]=s*E+f*T,t[1]=u*E+d*T,t[2]=s*-T+f*E,t[3]=u*-T+d*E,t[4]=g,t[5]=v,t},st.scale=function(t,e,r){var s=e[1],u=e[2],f=e[3],d=e[4],g=e[5],v=r[0],T=r[1];return t[0]=e[0]*v,t[1]=s*v,t[2]=u*T,t[3]=f*T,t[4]=d,t[5]=g,t},st.translate=function(t,e,r){var s=e[0],u=e[1],f=e[2],d=e[3],g=e[4],v=e[5],T=r[0],E=r[1];return t[0]=s,t[1]=u,t[2]=f,t[3]=d,t[4]=s*T+f*E+g,t[5]=u*T+d*E+v,t},st.fromRotation=function(t,e){var r=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=r,t[2]=-r,t[3]=s,t[4]=0,t[5]=0,t},st.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},st.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},st.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},st.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},st.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t},st.subtract=Gt,st.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t},st.multiplyScalarAndAdd=function(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t[3]=e[3]+r[3]*s,t[4]=e[4]+r[4]*s,t[5]=e[5]+r[5]*s,t},st.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},st.equals=function(t,e){var r=t[0],s=t[1],u=t[2],f=t[3],d=t[4],g=t[5],v=e[0],T=e[1],E=e[2],A=e[3],C=e[4],k=e[5];return Math.abs(r-v)<=Ve.EPSILON*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(s-T)<=Ve.EPSILON*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(u-E)<=Ve.EPSILON*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(f-A)<=Ve.EPSILON*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(d-C)<=Ve.EPSILON*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(g-k)<=Ve.EPSILON*Math.max(1,Math.abs(g),Math.abs(k))},st.sub=st.mul=void 0;var Ve=function(t,e){if(t&&t.__esModule)return t;if(t===null||at(t)!=="object"&&typeof t!="function")return{default:t};var r=Dt(void 0);if(r&&r.has(t))return r.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var d=u?Object.getOwnPropertyDescriptor(t,f):null;d&&(d.get||d.set)?Object.defineProperty(s,f,d):s[f]=t[f]}return s.default=t,r&&r.set(t,s),s}(ze);function Dt(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Dt=function(s){return s?r:e})(t)}function Bt(t,e,r){var s=e[0],u=e[1],f=e[2],d=e[3],g=e[4],v=e[5],T=r[0],E=r[1],A=r[2],C=r[3],k=r[4],L=r[5];return t[0]=s*T+f*E,t[1]=u*T+d*E,t[2]=s*A+f*C,t[3]=u*A+d*C,t[4]=s*k+f*L+g,t[5]=u*k+d*L+v,t}function Gt(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}st.mul=Bt,st.sub=Gt;var qt={};function or(t){return or=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},or(t)}Object.defineProperty(qt,"__esModule",{value:!0}),qt.create=function(){var t=new et.ARRAY_TYPE(9);return et.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},qt.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},qt.clone=function(t){var e=new et.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},qt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},qt.fromValues=function(t,e,r,s,u,f,d,g,v){var T=new et.ARRAY_TYPE(9);return T[0]=t,T[1]=e,T[2]=r,T[3]=s,T[4]=u,T[5]=f,T[6]=d,T[7]=g,T[8]=v,T},qt.set=function(t,e,r,s,u,f,d,g,v,T){return t[0]=e,t[1]=r,t[2]=s,t[3]=u,t[4]=f,t[5]=d,t[6]=g,t[7]=v,t[8]=T,t},qt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},qt.transpose=function(t,e){if(t===e){var r=e[1],s=e[2],u=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=s,t[7]=u}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},qt.invert=function(t,e){var r=e[0],s=e[1],u=e[2],f=e[3],d=e[4],g=e[5],v=e[6],T=e[7],E=e[8],A=E*d-g*T,C=-E*f+g*v,k=T*f-d*v,L=r*A+s*C+u*k;return L?(t[0]=A*(L=1/L),t[1]=(-E*s+u*T)*L,t[2]=(g*s-u*d)*L,t[3]=C*L,t[4]=(E*r-u*v)*L,t[5]=(-g*r+u*f)*L,t[6]=k*L,t[7]=(-T*r+s*v)*L,t[8]=(d*r-s*f)*L,t):null},qt.adjoint=function(t,e){var r=e[0],s=e[1],u=e[2],f=e[3],d=e[4],g=e[5],v=e[6],T=e[7],E=e[8];return t[0]=d*E-g*T,t[1]=u*T-s*E,t[2]=s*g-u*d,t[3]=g*v-f*E,t[4]=r*E-u*v,t[5]=u*f-r*g,t[6]=f*T-d*v,t[7]=s*v-r*T,t[8]=r*d-s*f,t},qt.determinant=function(t){var e=t[3],r=t[4],s=t[5],u=t[6],f=t[7],d=t[8];return t[0]*(d*r-s*f)+t[1]*(-d*e+s*u)+t[2]*(f*e-r*u)},qt.multiply=Vt,qt.translate=function(t,e,r){var s=e[0],u=e[1],f=e[2],d=e[3],g=e[4],v=e[5],T=e[6],E=e[7],A=e[8],C=r[0],k=r[1];return t[0]=s,t[1]=u,t[2]=f,t[3]=d,t[4]=g,t[5]=v,t[6]=C*s+k*d+T,t[7]=C*u+k*g+E,t[8]=C*f+k*v+A,t},qt.rotate=function(t,e,r){var s=e[0],u=e[1],f=e[2],d=e[3],g=e[4],v=e[5],T=e[6],E=e[7],A=e[8],C=Math.sin(r),k=Math.cos(r);return t[0]=k*s+C*d,t[1]=k*u+C*g,t[2]=k*f+C*v,t[3]=k*d-C*s,t[4]=k*g-C*u,t[5]=k*v-C*f,t[6]=T,t[7]=E,t[8]=A,t},qt.scale=function(t,e,r){var s=r[0],u=r[1];return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=u*e[3],t[4]=u*e[4],t[5]=u*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},qt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},qt.fromRotation=function(t,e){var r=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=r,t[2]=0,t[3]=-r,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},qt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},qt.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},qt.fromQuat=function(t,e){var r=e[0],s=e[1],u=e[2],f=e[3],d=r+r,g=s+s,v=u+u,T=r*d,E=s*d,A=s*g,C=u*d,k=u*g,L=u*v,F=f*d,N=f*g,G=f*v;return t[0]=1-A-L,t[3]=E-G,t[6]=C+N,t[1]=E+G,t[4]=1-T-L,t[7]=k-F,t[2]=C-N,t[5]=k+F,t[8]=1-T-A,t},qt.normalFromMat4=function(t,e){var r=e[0],s=e[1],u=e[2],f=e[3],d=e[4],g=e[5],v=e[6],T=e[7],E=e[8],A=e[9],C=e[10],k=e[11],L=e[12],F=e[13],N=e[14],G=e[15],ne=r*g-s*d,ie=r*v-u*d,oe=r*T-f*d,me=s*v-u*g,pe=s*T-f*g,Ee=u*T-f*v,De=E*F-A*L,je=E*N-C*L,Qe=E*G-k*L,Ze=A*N-C*F,ut=A*G-k*F,vt=C*G-k*N,ot=ne*vt-ie*ut+oe*Ze+me*Qe-pe*je+Ee*De;return ot?(t[0]=(g*vt-v*ut+T*Ze)*(ot=1/ot),t[1]=(v*Qe-d*vt-T*je)*ot,t[2]=(d*ut-g*Qe+T*De)*ot,t[3]=(u*ut-s*vt-f*Ze)*ot,t[4]=(r*vt-u*Qe+f*je)*ot,t[5]=(s*Qe-r*ut-f*De)*ot,t[6]=(F*Ee-N*pe+G*me)*ot,t[7]=(N*oe-L*Ee-G*ie)*ot,t[8]=(L*pe-F*oe+G*ne)*ot,t):null},qt.projection=function(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},qt.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},qt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},qt.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},qt.subtract=dr,qt.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},qt.multiplyScalarAndAdd=function(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t[3]=e[3]+r[3]*s,t[4]=e[4]+r[4]*s,t[5]=e[5]+r[5]*s,t[6]=e[6]+r[6]*s,t[7]=e[7]+r[7]*s,t[8]=e[8]+r[8]*s,t},qt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},qt.equals=function(t,e){var r=t[0],s=t[1],u=t[2],f=t[3],d=t[4],g=t[5],v=t[6],T=t[7],E=t[8],A=e[0],C=e[1],k=e[2],L=e[3],F=e[4],N=e[5],G=e[6],ne=e[7],ie=e[8];return Math.abs(r-A)<=et.EPSILON*Math.max(1,Math.abs(r),Math.abs(A))&&Math.abs(s-C)<=et.EPSILON*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(u-k)<=et.EPSILON*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(f-L)<=et.EPSILON*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(d-F)<=et.EPSILON*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(g-N)<=et.EPSILON*Math.max(1,Math.abs(g),Math.abs(N))&&Math.abs(v-G)<=et.EPSILON*Math.max(1,Math.abs(v),Math.abs(G))&&Math.abs(T-ne)<=et.EPSILON*Math.max(1,Math.abs(T),Math.abs(ne))&&Math.abs(E-ie)<=et.EPSILON*Math.max(1,Math.abs(E),Math.abs(ie))},qt.sub=qt.mul=void 0;var et=function(t,e){if(t&&t.__esModule)return t;if(t===null||or(t)!=="object"&&typeof t!="function")return{default:t};var r=kt(void 0);if(r&&r.has(t))return r.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var d=u?Object.getOwnPropertyDescriptor(t,f):null;d&&(d.get||d.set)?Object.defineProperty(s,f,d):s[f]=t[f]}return s.default=t,r&&r.set(t,s),s}(ze);function kt(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(kt=function(s){return s?r:e})(t)}function Vt(t,e,r){var s=e[0],u=e[1],f=e[2],d=e[3],g=e[4],v=e[5],T=e[6],E=e[7],A=e[8],C=r[0],k=r[1],L=r[2],F=r[3],N=r[4],G=r[5],ne=r[6],ie=r[7],oe=r[8];return t[0]=C*s+k*d+L*T,t[1]=C*u+k*g+L*E,t[2]=C*f+k*v+L*A,t[3]=F*s+N*d+G*T,t[4]=F*u+N*g+G*E,t[5]=F*f+N*v+G*A,t[6]=ne*s+ie*d+oe*T,t[7]=ne*u+ie*g+oe*E,t[8]=ne*f+ie*v+oe*A,t}function dr(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}qt.mul=Vt,qt.sub=dr;var ht={};function vr(t){return vr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vr(t)}Object.defineProperty(ht,"__esModule",{value:!0}),ht.create=function(){var t=new ar.ARRAY_TYPE(16);return ar.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},ht.clone=function(t){var e=new ar.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},ht.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},ht.fromValues=function(t,e,r,s,u,f,d,g,v,T,E,A,C,k,L,F){var N=new ar.ARRAY_TYPE(16);return N[0]=t,N[1]=e,N[2]=r,N[3]=s,N[4]=u,N[5]=f,N[6]=d,N[7]=g,N[8]=v,N[9]=T,N[10]=E,N[11]=A,N[12]=C,N[13]=k,N[14]=L,N[15]=F,N},ht.set=function(t,e,r,s,u,f,d,g,v,T,E,A,C,k,L,F,N){return t[0]=e,t[1]=r,t[2]=s,t[3]=u,t[4]=f,t[5]=d,t[6]=g,t[7]=v,t[8]=T,t[9]=E,t[10]=A,t[11]=C,t[12]=k,t[13]=L,t[14]=F,t[15]=N,t},ht.identity=Lr,ht.transpose=function(t,e){if(t===e){var r=e[1],s=e[2],u=e[3],f=e[6],d=e[7],g=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=s,t[9]=f,t[11]=e[14],t[12]=u,t[13]=d,t[14]=g}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},ht.invert=function(t,e){var r=e[0],s=e[1],u=e[2],f=e[3],d=e[4],g=e[5],v=e[6],T=e[7],E=e[8],A=e[9],C=e[10],k=e[11],L=e[12],F=e[13],N=e[14],G=e[15],ne=r*g-s*d,ie=r*v-u*d,oe=r*T-f*d,me=s*v-u*g,pe=s*T-f*g,Ee=u*T-f*v,De=E*F-A*L,je=E*N-C*L,Qe=E*G-k*L,Ze=A*N-C*F,ut=A*G-k*F,vt=C*G-k*N,ot=ne*vt-ie*ut+oe*Ze+me*Qe-pe*je+Ee*De;return ot?(t[0]=(g*vt-v*ut+T*Ze)*(ot=1/ot),t[1]=(u*ut-s*vt-f*Ze)*ot,t[2]=(F*Ee-N*pe+G*me)*ot,t[3]=(C*pe-A*Ee-k*me)*ot,t[4]=(v*Qe-d*vt-T*je)*ot,t[5]=(r*vt-u*Qe+f*je)*ot,t[6]=(N*oe-L*Ee-G*ie)*ot,t[7]=(E*Ee-C*oe+k*ie)*ot,t[8]=(d*ut-g*Qe+T*De)*ot,t[9]=(s*Qe-r*ut-f*De)*ot,t[10]=(L*pe-F*oe+G*ne)*ot,t[11]=(A*oe-E*pe-k*ne)*ot,t[12]=(g*je-d*Ze-v*De)*ot,t[13]=(r*Ze-s*je+u*De)*ot,t[14]=(F*ie-L*me-N*ne)*ot,t[15]=(E*me-A*ie+C*ne)*ot,t):null},ht.adjoint=function(t,e){var r=e[0],s=e[1],u=e[2],f=e[3],d=e[4],g=e[5],v=e[6],T=e[7],E=e[8],A=e[9],C=e[10],k=e[11],L=e[12],F=e[13],N=e[14],G=e[15];return t[0]=g*(C*G-k*N)-A*(v*G-T*N)+F*(v*k-T*C),t[1]=-(s*(C*G-k*N)-A*(u*G-f*N)+F*(u*k-f*C)),t[2]=s*(v*G-T*N)-g*(u*G-f*N)+F*(u*T-f*v),t[3]=-(s*(v*k-T*C)-g*(u*k-f*C)+A*(u*T-f*v)),t[4]=-(d*(C*G-k*N)-E*(v*G-T*N)+L*(v*k-T*C)),t[5]=r*(C*G-k*N)-E*(u*G-f*N)+L*(u*k-f*C),t[6]=-(r*(v*G-T*N)-d*(u*G-f*N)+L*(u*T-f*v)),t[7]=r*(v*k-T*C)-d*(u*k-f*C)+E*(u*T-f*v),t[8]=d*(A*G-k*F)-E*(g*G-T*F)+L*(g*k-T*A),t[9]=-(r*(A*G-k*F)-E*(s*G-f*F)+L*(s*k-f*A)),t[10]=r*(g*G-T*F)-d*(s*G-f*F)+L*(s*T-f*g),t[11]=-(r*(g*k-T*A)-d*(s*k-f*A)+E*(s*T-f*g)),t[12]=-(d*(A*N-C*F)-E*(g*N-v*F)+L*(g*C-v*A)),t[13]=r*(A*N-C*F)-E*(s*N-u*F)+L*(s*C-u*A),t[14]=-(r*(g*N-v*F)-d*(s*N-u*F)+L*(s*v-u*g)),t[15]=r*(g*C-v*A)-d*(s*C-u*A)+E*(s*v-u*g),t},ht.determinant=function(t){var e=t[0],r=t[1],s=t[2],u=t[3],f=t[4],d=t[5],g=t[6],v=t[7],T=t[8],E=t[9],A=t[10],C=t[11],k=t[12],L=t[13],F=t[14],N=t[15];return(e*d-r*f)*(A*N-C*F)-(e*g-s*f)*(E*N-C*L)+(e*v-u*f)*(E*F-A*L)+(r*g-s*d)*(T*N-C*k)-(r*v-u*d)*(T*F-A*k)+(s*v-u*g)*(T*L-E*k)},ht.multiply=xn,ht.translate=function(t,e,r){var s,u,f,d,g,v,T,E,A,C,k,L,F=r[0],N=r[1],G=r[2];return e===t?(t[12]=e[0]*F+e[4]*N+e[8]*G+e[12],t[13]=e[1]*F+e[5]*N+e[9]*G+e[13],t[14]=e[2]*F+e[6]*N+e[10]*G+e[14],t[15]=e[3]*F+e[7]*N+e[11]*G+e[15]):(u=e[1],f=e[2],d=e[3],g=e[4],v=e[5],T=e[6],E=e[7],A=e[8],C=e[9],k=e[10],L=e[11],t[0]=s=e[0],t[1]=u,t[2]=f,t[3]=d,t[4]=g,t[5]=v,t[6]=T,t[7]=E,t[8]=A,t[9]=C,t[10]=k,t[11]=L,t[12]=s*F+g*N+A*G+e[12],t[13]=u*F+v*N+C*G+e[13],t[14]=f*F+T*N+k*G+e[14],t[15]=d*F+E*N+L*G+e[15]),t},ht.scale=function(t,e,r){var s=r[0],u=r[1],f=r[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*u,t[5]=e[5]*u,t[6]=e[6]*u,t[7]=e[7]*u,t[8]=e[8]*f,t[9]=e[9]*f,t[10]=e[10]*f,t[11]=e[11]*f,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},ht.rotate=function(t,e,r,s){var u,f,d,g,v,T,E,A,C,k,L,F,N,G,ne,ie,oe,me,pe,Ee,De,je,Qe,Ze,ut=s[0],vt=s[1],ot=s[2],mt=Math.hypot(ut,vt,ot);return mt<ar.EPSILON?null:(ut*=mt=1/mt,vt*=mt,ot*=mt,u=Math.sin(r),f=Math.cos(r),v=e[1],T=e[2],E=e[3],C=e[5],k=e[6],L=e[7],N=e[9],G=e[10],ne=e[11],ie=ut*ut*(d=1-f)+f,pe=ut*vt*d-ot*u,Ee=vt*vt*d+f,De=ot*vt*d+ut*u,je=ut*ot*d+vt*u,Qe=vt*ot*d-ut*u,Ze=ot*ot*d+f,t[0]=(g=e[0])*ie+(A=e[4])*(oe=vt*ut*d+ot*u)+(F=e[8])*(me=ot*ut*d-vt*u),t[1]=v*ie+C*oe+N*me,t[2]=T*ie+k*oe+G*me,t[3]=E*ie+L*oe+ne*me,t[4]=g*pe+A*Ee+F*De,t[5]=v*pe+C*Ee+N*De,t[6]=T*pe+k*Ee+G*De,t[7]=E*pe+L*Ee+ne*De,t[8]=g*je+A*Qe+F*Ze,t[9]=v*je+C*Qe+N*Ze,t[10]=T*je+k*Qe+G*Ze,t[11]=E*je+L*Qe+ne*Ze,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},ht.rotateX=function(t,e,r){var s=Math.sin(r),u=Math.cos(r),f=e[4],d=e[5],g=e[6],v=e[7],T=e[8],E=e[9],A=e[10],C=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=f*u+T*s,t[5]=d*u+E*s,t[6]=g*u+A*s,t[7]=v*u+C*s,t[8]=T*u-f*s,t[9]=E*u-d*s,t[10]=A*u-g*s,t[11]=C*u-v*s,t},ht.rotateY=function(t,e,r){var s=Math.sin(r),u=Math.cos(r),f=e[0],d=e[1],g=e[2],v=e[3],T=e[8],E=e[9],A=e[10],C=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*u-T*s,t[1]=d*u-E*s,t[2]=g*u-A*s,t[3]=v*u-C*s,t[8]=f*s+T*u,t[9]=d*s+E*u,t[10]=g*s+A*u,t[11]=v*s+C*u,t},ht.rotateZ=function(t,e,r){var s=Math.sin(r),u=Math.cos(r),f=e[0],d=e[1],g=e[2],v=e[3],T=e[4],E=e[5],A=e[6],C=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*u+T*s,t[1]=d*u+E*s,t[2]=g*u+A*s,t[3]=v*u+C*s,t[4]=T*u-f*s,t[5]=E*u-d*s,t[6]=A*u-g*s,t[7]=C*u-v*s,t},ht.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},ht.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},ht.fromRotation=function(t,e,r){var s,u,f,d=r[0],g=r[1],v=r[2],T=Math.hypot(d,g,v);return T<ar.EPSILON?null:(d*=T=1/T,g*=T,v*=T,s=Math.sin(e),u=Math.cos(e),t[0]=d*d*(f=1-u)+u,t[1]=g*d*f+v*s,t[2]=v*d*f-g*s,t[3]=0,t[4]=d*g*f-v*s,t[5]=g*g*f+u,t[6]=v*g*f+d*s,t[7]=0,t[8]=d*v*f+g*s,t[9]=g*v*f-d*s,t[10]=v*v*f+u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},ht.fromXRotation=function(t,e){var r=Math.sin(e),s=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},ht.fromYRotation=function(t,e){var r=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},ht.fromZRotation=function(t,e){var r=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},ht.fromRotationTranslation=$n,ht.fromQuat2=function(t,e){var r=new ar.ARRAY_TYPE(3),s=-e[0],u=-e[1],f=-e[2],d=e[3],g=e[4],v=e[5],T=e[6],E=e[7],A=s*s+u*u+f*f+d*d;return A>0?(r[0]=2*(g*d+E*s+v*f-T*u)/A,r[1]=2*(v*d+E*u+T*s-g*f)/A,r[2]=2*(T*d+E*f+g*u-v*s)/A):(r[0]=2*(g*d+E*s+v*f-T*u),r[1]=2*(v*d+E*u+T*s-g*f),r[2]=2*(T*d+E*f+g*u-v*s)),$n(t,e,r),t},ht.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},ht.getScaling=Ur,ht.getRotation=function(t,e){var r=new ar.ARRAY_TYPE(3);Ur(r,e);var s=1/r[0],u=1/r[1],f=1/r[2],d=e[0]*s,g=e[1]*u,v=e[2]*f,T=e[4]*s,E=e[5]*u,A=e[6]*f,C=e[8]*s,k=e[9]*u,L=e[10]*f,F=d+E+L,N=0;return F>0?(N=2*Math.sqrt(F+1),t[3]=.25*N,t[0]=(A-k)/N,t[1]=(C-v)/N,t[2]=(g-T)/N):d>E&&d>L?(N=2*Math.sqrt(1+d-E-L),t[3]=(A-k)/N,t[0]=.25*N,t[1]=(g+T)/N,t[2]=(C+v)/N):E>L?(N=2*Math.sqrt(1+E-d-L),t[3]=(C-v)/N,t[0]=(g+T)/N,t[1]=.25*N,t[2]=(A+k)/N):(N=2*Math.sqrt(1+L-d-E),t[3]=(g-T)/N,t[0]=(C+v)/N,t[1]=(A+k)/N,t[2]=.25*N),t},ht.fromRotationTranslationScale=function(t,e,r,s){var u=e[0],f=e[1],d=e[2],g=e[3],v=u+u,T=f+f,E=d+d,A=u*v,C=u*T,k=u*E,L=f*T,F=f*E,N=d*E,G=g*v,ne=g*T,ie=g*E,oe=s[0],me=s[1],pe=s[2];return t[0]=(1-(L+N))*oe,t[1]=(C+ie)*oe,t[2]=(k-ne)*oe,t[3]=0,t[4]=(C-ie)*me,t[5]=(1-(A+N))*me,t[6]=(F+G)*me,t[7]=0,t[8]=(k+ne)*pe,t[9]=(F-G)*pe,t[10]=(1-(A+L))*pe,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},ht.fromRotationTranslationScaleOrigin=function(t,e,r,s,u){var f=e[0],d=e[1],g=e[2],v=e[3],T=f+f,E=d+d,A=g+g,C=f*T,k=f*E,L=f*A,F=d*E,N=d*A,G=g*A,ne=v*T,ie=v*E,oe=v*A,me=s[0],pe=s[1],Ee=s[2],De=u[0],je=u[1],Qe=u[2],Ze=(1-(F+G))*me,ut=(k+oe)*me,vt=(L-ie)*me,ot=(k-oe)*pe,mt=(1-(C+G))*pe,tt=(N+ne)*pe,_t=(L+ie)*Ee,bt=(N-ne)*Ee,gt=(1-(C+F))*Ee;return t[0]=Ze,t[1]=ut,t[2]=vt,t[3]=0,t[4]=ot,t[5]=mt,t[6]=tt,t[7]=0,t[8]=_t,t[9]=bt,t[10]=gt,t[11]=0,t[12]=r[0]+De-(Ze*De+ot*je+_t*Qe),t[13]=r[1]+je-(ut*De+mt*je+bt*Qe),t[14]=r[2]+Qe-(vt*De+tt*je+gt*Qe),t[15]=1,t},ht.fromQuat=function(t,e){var r=e[0],s=e[1],u=e[2],f=e[3],d=r+r,g=s+s,v=u+u,T=r*d,E=s*d,A=s*g,C=u*d,k=u*g,L=u*v,F=f*d,N=f*g,G=f*v;return t[0]=1-A-L,t[1]=E+G,t[2]=C-N,t[3]=0,t[4]=E-G,t[5]=1-T-L,t[6]=k+F,t[7]=0,t[8]=C+N,t[9]=k-F,t[10]=1-T-A,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},ht.frustum=function(t,e,r,s,u,f,d){var g=1/(r-e),v=1/(u-s),T=1/(f-d);return t[0]=2*f*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*f*v,t[6]=0,t[7]=0,t[8]=(r+e)*g,t[9]=(u+s)*v,t[10]=(d+f)*T,t[11]=-1,t[12]=0,t[13]=0,t[14]=d*f*2*T,t[15]=0,t},ht.perspectiveNO=ni,ht.perspectiveZO=function(t,e,r,s,u){var f,d=1/Math.tan(e/2);return t[0]=d/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=d,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=u*(f=1/(s-u)),t[14]=u*s*f):(t[10]=-1,t[14]=-s),t},ht.perspectiveFromFieldOfView=function(t,e,r,s){var u=Math.tan(e.upDegrees*Math.PI/180),f=Math.tan(e.downDegrees*Math.PI/180),d=Math.tan(e.leftDegrees*Math.PI/180),g=Math.tan(e.rightDegrees*Math.PI/180),v=2/(d+g),T=2/(u+f);return t[0]=v,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=T,t[6]=0,t[7]=0,t[8]=-(d-g)*v*.5,t[9]=(u-f)*T*.5,t[10]=s/(r-s),t[11]=-1,t[12]=0,t[13]=0,t[14]=s*r/(r-s),t[15]=0,t},ht.orthoNO=ii,ht.orthoZO=function(t,e,r,s,u,f,d){var g=1/(e-r),v=1/(s-u),T=1/(f-d);return t[0]=-2*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*v,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=T,t[11]=0,t[12]=(e+r)*g,t[13]=(u+s)*v,t[14]=f*T,t[15]=1,t},ht.lookAt=function(t,e,r,s){var u,f,d,g,v,T,E,A,C,k,L=e[0],F=e[1],N=e[2],G=s[0],ne=s[1],ie=s[2],oe=r[0],me=r[1],pe=r[2];return Math.abs(L-oe)<ar.EPSILON&&Math.abs(F-me)<ar.EPSILON&&Math.abs(N-pe)<ar.EPSILON?Lr(t):(E=L-oe,A=F-me,C=N-pe,u=ne*(C*=k=1/Math.hypot(E,A,C))-ie*(A*=k),f=ie*(E*=k)-G*C,d=G*A-ne*E,(k=Math.hypot(u,f,d))?(u*=k=1/k,f*=k,d*=k):(u=0,f=0,d=0),g=A*d-C*f,v=C*u-E*d,T=E*f-A*u,(k=Math.hypot(g,v,T))?(g*=k=1/k,v*=k,T*=k):(g=0,v=0,T=0),t[0]=u,t[1]=g,t[2]=E,t[3]=0,t[4]=f,t[5]=v,t[6]=A,t[7]=0,t[8]=d,t[9]=T,t[10]=C,t[11]=0,t[12]=-(u*L+f*F+d*N),t[13]=-(g*L+v*F+T*N),t[14]=-(E*L+A*F+C*N),t[15]=1,t)},ht.targetTo=function(t,e,r,s){var u=e[0],f=e[1],d=e[2],g=s[0],v=s[1],T=s[2],E=u-r[0],A=f-r[1],C=d-r[2],k=E*E+A*A+C*C;k>0&&(E*=k=1/Math.sqrt(k),A*=k,C*=k);var L=v*C-T*A,F=T*E-g*C,N=g*A-v*E;return(k=L*L+F*F+N*N)>0&&(L*=k=1/Math.sqrt(k),F*=k,N*=k),t[0]=L,t[1]=F,t[2]=N,t[3]=0,t[4]=A*N-C*F,t[5]=C*L-E*N,t[6]=E*F-A*L,t[7]=0,t[8]=E,t[9]=A,t[10]=C,t[11]=0,t[12]=u,t[13]=f,t[14]=d,t[15]=1,t},ht.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},ht.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},ht.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},ht.subtract=kn,ht.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},ht.multiplyScalarAndAdd=function(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t[3]=e[3]+r[3]*s,t[4]=e[4]+r[4]*s,t[5]=e[5]+r[5]*s,t[6]=e[6]+r[6]*s,t[7]=e[7]+r[7]*s,t[8]=e[8]+r[8]*s,t[9]=e[9]+r[9]*s,t[10]=e[10]+r[10]*s,t[11]=e[11]+r[11]*s,t[12]=e[12]+r[12]*s,t[13]=e[13]+r[13]*s,t[14]=e[14]+r[14]*s,t[15]=e[15]+r[15]*s,t},ht.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},ht.equals=function(t,e){var r=t[0],s=t[1],u=t[2],f=t[3],d=t[4],g=t[5],v=t[6],T=t[7],E=t[8],A=t[9],C=t[10],k=t[11],L=t[12],F=t[13],N=t[14],G=t[15],ne=e[0],ie=e[1],oe=e[2],me=e[3],pe=e[4],Ee=e[5],De=e[6],je=e[7],Qe=e[8],Ze=e[9],ut=e[10],vt=e[11],ot=e[12],mt=e[13],tt=e[14],_t=e[15];return Math.abs(r-ne)<=ar.EPSILON*Math.max(1,Math.abs(r),Math.abs(ne))&&Math.abs(s-ie)<=ar.EPSILON*Math.max(1,Math.abs(s),Math.abs(ie))&&Math.abs(u-oe)<=ar.EPSILON*Math.max(1,Math.abs(u),Math.abs(oe))&&Math.abs(f-me)<=ar.EPSILON*Math.max(1,Math.abs(f),Math.abs(me))&&Math.abs(d-pe)<=ar.EPSILON*Math.max(1,Math.abs(d),Math.abs(pe))&&Math.abs(g-Ee)<=ar.EPSILON*Math.max(1,Math.abs(g),Math.abs(Ee))&&Math.abs(v-De)<=ar.EPSILON*Math.max(1,Math.abs(v),Math.abs(De))&&Math.abs(T-je)<=ar.EPSILON*Math.max(1,Math.abs(T),Math.abs(je))&&Math.abs(E-Qe)<=ar.EPSILON*Math.max(1,Math.abs(E),Math.abs(Qe))&&Math.abs(A-Ze)<=ar.EPSILON*Math.max(1,Math.abs(A),Math.abs(Ze))&&Math.abs(C-ut)<=ar.EPSILON*Math.max(1,Math.abs(C),Math.abs(ut))&&Math.abs(k-vt)<=ar.EPSILON*Math.max(1,Math.abs(k),Math.abs(vt))&&Math.abs(L-ot)<=ar.EPSILON*Math.max(1,Math.abs(L),Math.abs(ot))&&Math.abs(F-mt)<=ar.EPSILON*Math.max(1,Math.abs(F),Math.abs(mt))&&Math.abs(N-tt)<=ar.EPSILON*Math.max(1,Math.abs(N),Math.abs(tt))&&Math.abs(G-_t)<=ar.EPSILON*Math.max(1,Math.abs(G),Math.abs(_t))},ht.sub=ht.mul=ht.ortho=ht.perspective=void 0;var ar=function(t,e){if(t&&t.__esModule)return t;if(t===null||vr(t)!=="object"&&typeof t!="function")return{default:t};var r=$r(void 0);if(r&&r.has(t))return r.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var d=u?Object.getOwnPropertyDescriptor(t,f):null;d&&(d.get||d.set)?Object.defineProperty(s,f,d):s[f]=t[f]}return s.default=t,r&&r.set(t,s),s}(ze);function $r(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return($r=function(s){return s?r:e})(t)}function Lr(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xn(t,e,r){var s=e[0],u=e[1],f=e[2],d=e[3],g=e[4],v=e[5],T=e[6],E=e[7],A=e[8],C=e[9],k=e[10],L=e[11],F=e[12],N=e[13],G=e[14],ne=e[15],ie=r[0],oe=r[1],me=r[2],pe=r[3];return t[0]=ie*s+oe*g+me*A+pe*F,t[1]=ie*u+oe*v+me*C+pe*N,t[2]=ie*f+oe*T+me*k+pe*G,t[3]=ie*d+oe*E+me*L+pe*ne,t[4]=(ie=r[4])*s+(oe=r[5])*g+(me=r[6])*A+(pe=r[7])*F,t[5]=ie*u+oe*v+me*C+pe*N,t[6]=ie*f+oe*T+me*k+pe*G,t[7]=ie*d+oe*E+me*L+pe*ne,t[8]=(ie=r[8])*s+(oe=r[9])*g+(me=r[10])*A+(pe=r[11])*F,t[9]=ie*u+oe*v+me*C+pe*N,t[10]=ie*f+oe*T+me*k+pe*G,t[11]=ie*d+oe*E+me*L+pe*ne,t[12]=(ie=r[12])*s+(oe=r[13])*g+(me=r[14])*A+(pe=r[15])*F,t[13]=ie*u+oe*v+me*C+pe*N,t[14]=ie*f+oe*T+me*k+pe*G,t[15]=ie*d+oe*E+me*L+pe*ne,t}function $n(t,e,r){var s=e[0],u=e[1],f=e[2],d=e[3],g=s+s,v=u+u,T=f+f,E=s*g,A=s*v,C=s*T,k=u*v,L=u*T,F=f*T,N=d*g,G=d*v,ne=d*T;return t[0]=1-(k+F),t[1]=A+ne,t[2]=C-G,t[3]=0,t[4]=A-ne,t[5]=1-(E+F),t[6]=L+N,t[7]=0,t[8]=C+G,t[9]=L-N,t[10]=1-(E+k),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Ur(t,e){var r=e[4],s=e[5],u=e[6],f=e[8],d=e[9],g=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(r,s,u),t[2]=Math.hypot(f,d,g),t}function ni(t,e,r,s,u){var f,d=1/Math.tan(e/2);return t[0]=d/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=d,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=(u+s)*(f=1/(s-u)),t[14]=2*u*s*f):(t[10]=-1,t[14]=-2*s),t}function ii(t,e,r,s,u,f,d){var g=1/(e-r),v=1/(s-u),T=1/(f-d);return t[0]=-2*g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*v,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*T,t[11]=0,t[12]=(e+r)*g,t[13]=(u+s)*v,t[14]=(d+f)*T,t[15]=1,t}function kn(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}ht.perspective=ni,ht.ortho=ii,ht.mul=xn,ht.sub=kn;var Wt={},er={};function go(t){return go=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},go(t)}Object.defineProperty(er,"__esModule",{value:!0}),er.create=ws,er.clone=function(t){var e=new bi.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},er.length=Ts,er.fromValues=function(t,e,r){var s=new bi.ARRAY_TYPE(3);return s[0]=t,s[1]=e,s[2]=r,s},er.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},er.set=function(t,e,r,s){return t[0]=e,t[1]=r,t[2]=s,t},er.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},er.subtract=na,er.multiply=No,er.divide=Ss,er.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},er.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},er.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},er.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},er.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},er.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},er.scaleAndAdd=function(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t},er.distance=Es,er.squaredDistance=es,er.squaredLength=ts,er.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},er.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},er.normalize=function(t,e){var r=e[0],s=e[1],u=e[2],f=r*r+s*s+u*u;return f>0&&(f=1/Math.sqrt(f)),t[0]=e[0]*f,t[1]=e[1]*f,t[2]=e[2]*f,t},er.dot=Ms,er.cross=function(t,e,r){var s=e[0],u=e[1],f=e[2],d=r[0],g=r[1],v=r[2];return t[0]=u*v-f*g,t[1]=f*d-s*v,t[2]=s*g-u*d,t},er.lerp=function(t,e,r,s){var u=e[0],f=e[1],d=e[2];return t[0]=u+s*(r[0]-u),t[1]=f+s*(r[1]-f),t[2]=d+s*(r[2]-d),t},er.hermite=function(t,e,r,s,u,f){var d=f*f,g=d*(2*f-3)+1,v=d*(f-2)+f,T=d*(f-1),E=d*(3-2*f);return t[0]=e[0]*g+r[0]*v+s[0]*T+u[0]*E,t[1]=e[1]*g+r[1]*v+s[1]*T+u[1]*E,t[2]=e[2]*g+r[2]*v+s[2]*T+u[2]*E,t},er.bezier=function(t,e,r,s,u,f){var d=1-f,g=d*d,v=f*f,T=g*d,E=3*f*g,A=3*v*d,C=v*f;return t[0]=e[0]*T+r[0]*E+s[0]*A+u[0]*C,t[1]=e[1]*T+r[1]*E+s[1]*A+u[1]*C,t[2]=e[2]*T+r[2]*E+s[2]*A+u[2]*C,t},er.random=function(t,e){e=e||1;var r=2*bi.RANDOM()*Math.PI,s=2*bi.RANDOM()-1,u=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(r)*u,t[1]=Math.sin(r)*u,t[2]=s*e,t},er.transformMat4=function(t,e,r){var s=e[0],u=e[1],f=e[2],d=r[3]*s+r[7]*u+r[11]*f+r[15];return t[0]=(r[0]*s+r[4]*u+r[8]*f+r[12])/(d=d||1),t[1]=(r[1]*s+r[5]*u+r[9]*f+r[13])/d,t[2]=(r[2]*s+r[6]*u+r[10]*f+r[14])/d,t},er.transformMat3=function(t,e,r){var s=e[0],u=e[1],f=e[2];return t[0]=s*r[0]+u*r[3]+f*r[6],t[1]=s*r[1]+u*r[4]+f*r[7],t[2]=s*r[2]+u*r[5]+f*r[8],t},er.transformQuat=function(t,e,r){var s=r[0],u=r[1],f=r[2],d=e[0],g=e[1],v=e[2],T=u*v-f*g,E=f*d-s*v,A=s*g-u*d,C=u*A-f*E,k=f*T-s*A,L=s*E-u*T,F=2*r[3];return E*=F,A*=F,k*=2,L*=2,t[0]=d+(T*=F)+(C*=2),t[1]=g+E+k,t[2]=v+A+L,t},er.rotateX=function(t,e,r,s){var u=[],f=[];return u[0]=e[0]-r[0],u[1]=e[1]-r[1],u[2]=e[2]-r[2],f[0]=u[0],f[1]=u[1]*Math.cos(s)-u[2]*Math.sin(s),f[2]=u[1]*Math.sin(s)+u[2]*Math.cos(s),t[0]=f[0]+r[0],t[1]=f[1]+r[1],t[2]=f[2]+r[2],t},er.rotateY=function(t,e,r,s){var u=[],f=[];return u[0]=e[0]-r[0],u[1]=e[1]-r[1],u[2]=e[2]-r[2],f[0]=u[2]*Math.sin(s)+u[0]*Math.cos(s),f[1]=u[1],f[2]=u[2]*Math.cos(s)-u[0]*Math.sin(s),t[0]=f[0]+r[0],t[1]=f[1]+r[1],t[2]=f[2]+r[2],t},er.rotateZ=function(t,e,r,s){var u=[],f=[];return u[0]=e[0]-r[0],u[1]=e[1]-r[1],u[2]=e[2]-r[2],f[0]=u[0]*Math.cos(s)-u[1]*Math.sin(s),f[1]=u[0]*Math.sin(s)+u[1]*Math.cos(s),f[2]=u[2],t[0]=f[0]+r[0],t[1]=f[1]+r[1],t[2]=f[2]+r[2],t},er.angle=function(t,e){var r=t[0],s=t[1],u=t[2],f=e[0],d=e[1],g=e[2],v=Math.sqrt(r*r+s*s+u*u)*Math.sqrt(f*f+d*d+g*g),T=v&&Ms(t,e)/v;return Math.acos(Math.min(Math.max(T,-1),1))},er.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},er.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},er.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},er.equals=function(t,e){var r=t[0],s=t[1],u=t[2],f=e[0],d=e[1],g=e[2];return Math.abs(r-f)<=bi.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-d)<=bi.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(u-g)<=bi.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))},er.forEach=er.sqrLen=er.len=er.sqrDist=er.dist=er.div=er.mul=er.sub=void 0;var bi=function(t,e){if(t&&t.__esModule)return t;if(t===null||go(t)!=="object"&&typeof t!="function")return{default:t};var r=Bo(void 0);if(r&&r.has(t))return r.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var d=u?Object.getOwnPropertyDescriptor(t,f):null;d&&(d.get||d.set)?Object.defineProperty(s,f,d):s[f]=t[f]}return s.default=t,r&&r.set(t,s),s}(ze);function Bo(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Bo=function(s){return s?r:e})(t)}function ws(){var t=new bi.ARRAY_TYPE(3);return bi.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ts(t){return Math.hypot(t[0],t[1],t[2])}function na(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function No(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Ss(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function Es(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function es(t,e){var r=e[0]-t[0],s=e[1]-t[1],u=e[2]-t[2];return r*r+s*s+u*u}function ts(t){var e=t[0],r=t[1],s=t[2];return e*e+r*r+s*s}function Ms(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}er.sub=na,er.mul=No,er.div=Ss,er.dist=Es,er.sqrDist=es,er.len=Ts,er.sqrLen=ts;var Dn,Da=(Dn=ws(),function(t,e,r,s,u,f){var d,g;for(e||(e=3),r||(r=0),g=s?Math.min(s*e+r,t.length):t.length,d=r;d<g;d+=e)Dn[0]=t[d],Dn[1]=t[d+1],Dn[2]=t[d+2],u(Dn,Dn,f),t[d]=Dn[0],t[d+1]=Dn[1],t[d+2]=Dn[2];return t});er.forEach=Da;var sr={};function Is(t){return Is=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Is(t)}Object.defineProperty(sr,"__esModule",{value:!0}),sr.create=Uo,sr.clone=function(t){var e=new ln.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},sr.fromValues=function(t,e,r,s){var u=new ln.ARRAY_TYPE(4);return u[0]=t,u[1]=e,u[2]=r,u[3]=s,u},sr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},sr.set=function(t,e,r,s,u){return t[0]=e,t[1]=r,t[2]=s,t[3]=u,t},sr.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},sr.subtract=Wi,sr.multiply=yo,sr.divide=ao,sr.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},sr.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},sr.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},sr.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},sr.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},sr.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},sr.scaleAndAdd=function(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t[3]=e[3]+r[3]*s,t},sr.distance=vo,sr.squaredDistance=lo,sr.length=ia,sr.squaredLength=rs,sr.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},sr.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},sr.normalize=function(t,e){var r=e[0],s=e[1],u=e[2],f=e[3],d=r*r+s*s+u*u+f*f;return d>0&&(d=1/Math.sqrt(d)),t[0]=r*d,t[1]=s*d,t[2]=u*d,t[3]=f*d,t},sr.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},sr.cross=function(t,e,r,s){var u=r[0]*s[1]-r[1]*s[0],f=r[0]*s[2]-r[2]*s[0],d=r[0]*s[3]-r[3]*s[0],g=r[1]*s[2]-r[2]*s[1],v=r[1]*s[3]-r[3]*s[1],T=r[2]*s[3]-r[3]*s[2],E=e[0],A=e[1],C=e[2],k=e[3];return t[0]=A*T-C*v+k*g,t[1]=-E*T+C*d-k*f,t[2]=E*v-A*d+k*u,t[3]=-E*g+A*f-C*u,t},sr.lerp=function(t,e,r,s){var u=e[0],f=e[1],d=e[2],g=e[3];return t[0]=u+s*(r[0]-u),t[1]=f+s*(r[1]-f),t[2]=d+s*(r[2]-d),t[3]=g+s*(r[3]-g),t},sr.random=function(t,e){var r,s,u,f,d,g;e=e||1;do d=(r=2*ln.RANDOM()-1)*r+(s=2*ln.RANDOM()-1)*s;while(d>=1);do g=(u=2*ln.RANDOM()-1)*u+(f=2*ln.RANDOM()-1)*f;while(g>=1);var v=Math.sqrt((1-d)/g);return t[0]=e*r,t[1]=e*s,t[2]=e*u*v,t[3]=e*f*v,t},sr.transformMat4=function(t,e,r){var s=e[0],u=e[1],f=e[2],d=e[3];return t[0]=r[0]*s+r[4]*u+r[8]*f+r[12]*d,t[1]=r[1]*s+r[5]*u+r[9]*f+r[13]*d,t[2]=r[2]*s+r[6]*u+r[10]*f+r[14]*d,t[3]=r[3]*s+r[7]*u+r[11]*f+r[15]*d,t},sr.transformQuat=function(t,e,r){var s=e[0],u=e[1],f=e[2],d=r[0],g=r[1],v=r[2],T=r[3],E=T*s+g*f-v*u,A=T*u+v*s-d*f,C=T*f+d*u-g*s,k=-d*s-g*u-v*f;return t[0]=E*T+k*-d+A*-v-C*-g,t[1]=A*T+k*-g+C*-d-E*-v,t[2]=C*T+k*-v+E*-g-A*-d,t[3]=e[3],t},sr.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},sr.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},sr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},sr.equals=function(t,e){var r=t[0],s=t[1],u=t[2],f=t[3],d=e[0],g=e[1],v=e[2],T=e[3];return Math.abs(r-d)<=ln.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(s-g)<=ln.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(u-v)<=ln.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(f-T)<=ln.EPSILON*Math.max(1,Math.abs(f),Math.abs(T))},sr.forEach=sr.sqrLen=sr.len=sr.sqrDist=sr.dist=sr.div=sr.mul=sr.sub=void 0;var ln=function(t,e){if(t&&t.__esModule)return t;if(t===null||Is(t)!=="object"&&typeof t!="function")return{default:t};var r=Gn(void 0);if(r&&r.has(t))return r.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var d=u?Object.getOwnPropertyDescriptor(t,f):null;d&&(d.get||d.set)?Object.defineProperty(s,f,d):s[f]=t[f]}return s.default=t,r&&r.set(t,s),s}(ze);function Gn(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Gn=function(s){return s?r:e})(t)}function Uo(){var t=new ln.ARRAY_TYPE(4);return ln.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Wi(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function yo(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function ao(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function vo(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function lo(t,e){var r=e[0]-t[0],s=e[1]-t[1],u=e[2]-t[2],f=e[3]-t[3];return r*r+s*s+u*u+f*f}function ia(t){return Math.hypot(t[0],t[1],t[2],t[3])}function rs(t){var e=t[0],r=t[1],s=t[2],u=t[3];return e*e+r*r+s*s+u*u}sr.sub=Wi,sr.mul=yo,sr.div=ao,sr.dist=vo,sr.sqrDist=lo,sr.len=ia,sr.sqrLen=rs;var Ii=function(){var t=Uo();return function(e,r,s,u,f,d){var g,v;for(r||(r=4),s||(s=0),v=u?Math.min(u*r+s,e.length):e.length,g=s;g<v;g+=r)t[0]=e[g],t[1]=e[g+1],t[2]=e[g+2],t[3]=e[g+3],f(t,t,d),e[g]=t[0],e[g+1]=t[1],e[g+2]=t[2],e[g+3]=t[3];return e}}();function uo(t){return uo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},uo(t)}sr.forEach=Ii,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.create=As,Wt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Wt.setAxisAngle=ka,Wt.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),s=Math.sin(r/2);return s>Ai.EPSILON?(t[0]=e[0]/s,t[1]=e[1]/s,t[2]=e[2]/s):(t[0]=1,t[1]=0,t[2]=0),r},Wt.getAngle=function(t,e){var r=we(t,e);return Math.acos(2*r*r-1)},Wt.multiply=is,Wt.rotateX=function(t,e,r){r*=.5;var s=e[0],u=e[1],f=e[2],d=e[3],g=Math.sin(r),v=Math.cos(r);return t[0]=s*v+d*g,t[1]=u*v+f*g,t[2]=f*v-u*g,t[3]=d*v-s*g,t},Wt.rotateY=function(t,e,r){r*=.5;var s=e[0],u=e[1],f=e[2],d=e[3],g=Math.sin(r),v=Math.cos(r);return t[0]=s*v-f*g,t[1]=u*v+d*g,t[2]=f*v+s*g,t[3]=d*v-u*g,t},Wt.rotateZ=function(t,e,r){r*=.5;var s=e[0],u=e[1],f=e[2],d=e[3],g=Math.sin(r),v=Math.cos(r);return t[0]=s*v+u*g,t[1]=u*v-s*g,t[2]=f*v+d*g,t[3]=d*v-f*g,t},Wt.calculateW=function(t,e){var r=e[0],s=e[1],u=e[2];return t[0]=r,t[1]=s,t[2]=u,t[3]=Math.sqrt(Math.abs(1-r*r-s*s-u*u)),t},Wt.exp=Ae,Wt.ln=W,Wt.pow=function(t,e,r){return W(t,e),ve(t,t,r),Ae(t,t),t},Wt.slerp=J,Wt.random=function(t){var e=Ai.RANDOM(),r=Ai.RANDOM(),s=Ai.RANDOM(),u=Math.sqrt(1-e),f=Math.sqrt(e);return t[0]=u*Math.sin(2*Math.PI*r),t[1]=u*Math.cos(2*Math.PI*r),t[2]=f*Math.sin(2*Math.PI*s),t[3]=f*Math.cos(2*Math.PI*s),t},Wt.invert=function(t,e){var r=e[0],s=e[1],u=e[2],f=e[3],d=r*r+s*s+u*u+f*f,g=d?1/d:0;return t[0]=-r*g,t[1]=-s*g,t[2]=-u*g,t[3]=f*g,t},Wt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Wt.fromMat3=de,Wt.fromEuler=function(t,e,r,s){var u=.5*Math.PI/180;e*=u,r*=u,s*=u;var f=Math.sin(e),d=Math.cos(e),g=Math.sin(r),v=Math.cos(r),T=Math.sin(s),E=Math.cos(s);return t[0]=f*v*E-d*g*T,t[1]=d*g*E+f*v*T,t[2]=d*v*T-f*g*E,t[3]=d*v*E+f*g*T,t},Wt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Wt.setAxes=Wt.sqlerp=Wt.rotationTo=Wt.equals=Wt.exactEquals=Wt.normalize=Wt.sqrLen=Wt.squaredLength=Wt.len=Wt.length=Wt.lerp=Wt.dot=Wt.scale=Wt.mul=Wt.add=Wt.set=Wt.copy=Wt.fromValues=Wt.clone=void 0;var Ai=ns(ze),xo=ns(qt),oi=ns(er),Yn=ns(sr);function Ra(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Ra=function(s){return s?r:e})(t)}function ns(t,e){if(t&&t.__esModule)return t;if(t===null||uo(t)!=="object"&&typeof t!="function")return{default:t};var r=Ra(e);if(r&&r.has(t))return r.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var d=u?Object.getOwnPropertyDescriptor(t,f):null;d&&(d.get||d.set)?Object.defineProperty(s,f,d):s[f]=t[f]}return s.default=t,r&&r.set(t,s),s}function As(){var t=new Ai.ARRAY_TYPE(4);return Ai.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function ka(t,e,r){r*=.5;var s=Math.sin(r);return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(r),t}function is(t,e,r){var s=e[0],u=e[1],f=e[2],d=e[3],g=r[0],v=r[1],T=r[2],E=r[3];return t[0]=s*E+d*g+u*T-f*v,t[1]=u*E+d*v+f*g-s*T,t[2]=f*E+d*T+s*v-u*g,t[3]=d*E-s*g-u*v-f*T,t}function Ae(t,e){var r=e[0],s=e[1],u=e[2],f=e[3],d=Math.sqrt(r*r+s*s+u*u),g=Math.exp(f),v=d>0?g*Math.sin(d)/d:0;return t[0]=r*v,t[1]=s*v,t[2]=u*v,t[3]=g*Math.cos(d),t}function W(t,e){var r=e[0],s=e[1],u=e[2],f=e[3],d=Math.sqrt(r*r+s*s+u*u),g=d>0?Math.atan2(d,f)/d:0;return t[0]=r*g,t[1]=s*g,t[2]=u*g,t[3]=.5*Math.log(r*r+s*s+u*u+f*f),t}function J(t,e,r,s){var u,f,d,g,v,T=e[0],E=e[1],A=e[2],C=e[3],k=r[0],L=r[1],F=r[2],N=r[3];return(f=T*k+E*L+A*F+C*N)<0&&(f=-f,k=-k,L=-L,F=-F,N=-N),1-f>Ai.EPSILON?(u=Math.acos(f),d=Math.sin(u),g=Math.sin((1-s)*u)/d,v=Math.sin(s*u)/d):(g=1-s,v=s),t[0]=g*T+v*k,t[1]=g*E+v*L,t[2]=g*A+v*F,t[3]=g*C+v*N,t}function de(t,e){var r,s=e[0]+e[4]+e[8];if(s>0)r=Math.sqrt(s+1),t[3]=.5*r,t[0]=(e[5]-e[7])*(r=.5/r),t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var u=0;e[4]>e[0]&&(u=1),e[8]>e[3*u+u]&&(u=2);var f=(u+1)%3,d=(u+2)%3;r=Math.sqrt(e[3*u+u]-e[3*f+f]-e[3*d+d]+1),t[u]=.5*r,t[3]=(e[3*f+d]-e[3*d+f])*(r=.5/r),t[f]=(e[3*f+u]+e[3*u+f])*r,t[d]=(e[3*d+u]+e[3*u+d])*r}return t}Wt.clone=Yn.clone,Wt.fromValues=Yn.fromValues,Wt.copy=Yn.copy,Wt.set=Yn.set,Wt.add=Yn.add,Wt.mul=is;var ve=Yn.scale;Wt.scale=ve;var we=Yn.dot;Wt.dot=we,Wt.lerp=Yn.lerp;var Ue=Yn.length;Wt.length=Ue,Wt.len=Ue;var qe=Yn.squaredLength;Wt.squaredLength=qe,Wt.sqrLen=qe;var Le=Yn.normalize;Wt.normalize=Le,Wt.exactEquals=Yn.exactEquals,Wt.equals=Yn.equals;var Ke,St,yt,Ht=(Ke=oi.create(),St=oi.fromValues(1,0,0),yt=oi.fromValues(0,1,0),function(t,e,r){var s=oi.dot(e,r);return s<-.999999?(oi.cross(Ke,St,e),oi.len(Ke)<1e-6&&oi.cross(Ke,yt,e),oi.normalize(Ke,Ke),ka(t,Ke,Math.PI),t):s>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(oi.cross(Ke,e,r),t[0]=Ke[0],t[1]=Ke[1],t[2]=Ke[2],t[3]=1+s,Le(t,t))});Wt.rotationTo=Ht;var Qt,br,Sr=(Qt=As(),br=As(),function(t,e,r,s,u,f){return J(Qt,e,u,f),J(br,r,s,f),J(t,Qt,br,2*f*(1-f)),t});Wt.sqlerp=Sr;var gr,Ir=(gr=xo.create(),function(t,e,r,s){return gr[0]=r[0],gr[3]=r[1],gr[6]=r[2],gr[1]=s[0],gr[4]=s[1],gr[7]=s[2],gr[2]=-e[0],gr[5]=-e[1],gr[8]=-e[2],Le(t,de(t,gr))});Wt.setAxes=Ir;var $t={};function rn(t){return rn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rn(t)}Object.defineProperty($t,"__esModule",{value:!0}),$t.create=function(){var t=new Zr.ARRAY_TYPE(8);return Zr.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},$t.clone=function(t){var e=new Zr.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},$t.fromValues=function(t,e,r,s,u,f,d,g){var v=new Zr.ARRAY_TYPE(8);return v[0]=t,v[1]=e,v[2]=r,v[3]=s,v[4]=u,v[5]=f,v[6]=d,v[7]=g,v},$t.fromRotationTranslationValues=function(t,e,r,s,u,f,d){var g=new Zr.ARRAY_TYPE(8);g[0]=t,g[1]=e,g[2]=r,g[3]=s;var v=.5*u,T=.5*f,E=.5*d;return g[4]=v*s+T*r-E*e,g[5]=T*s+E*t-v*r,g[6]=E*s+v*e-T*t,g[7]=-v*t-T*e-E*r,g},$t.fromRotationTranslation=si,$t.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},$t.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},$t.fromMat4=function(t,e){var r=Dr.create();on.getRotation(r,e);var s=new Zr.ARRAY_TYPE(3);return on.getTranslation(s,e),si(t,r,s),t},$t.copy=Kn,$t.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},$t.set=function(t,e,r,s,u,f,d,g,v){return t[0]=e,t[1]=r,t[2]=s,t[3]=u,t[4]=f,t[5]=d,t[6]=g,t[7]=v,t},$t.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},$t.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},$t.getTranslation=function(t,e){var r=e[4],s=e[5],u=e[6],f=e[7],d=-e[0],g=-e[1],v=-e[2],T=e[3];return t[0]=2*(r*T+f*d+s*v-u*g),t[1]=2*(s*T+f*g+u*d-r*v),t[2]=2*(u*T+f*v+r*g-s*d),t},$t.translate=function(t,e,r){var s=e[0],u=e[1],f=e[2],d=e[3],g=.5*r[0],v=.5*r[1],T=.5*r[2],E=e[4],A=e[5],C=e[6],k=e[7];return t[0]=s,t[1]=u,t[2]=f,t[3]=d,t[4]=d*g+u*T-f*v+E,t[5]=d*v+f*g-s*T+A,t[6]=d*T+s*v-u*g+C,t[7]=-s*g-u*v-f*T+k,t},$t.rotateX=function(t,e,r){var s=-e[0],u=-e[1],f=-e[2],d=e[3],g=e[4],v=e[5],T=e[6],E=e[7],A=g*d+E*s+v*f-T*u,C=v*d+E*u+T*s-g*f,k=T*d+E*f+g*u-v*s,L=E*d-g*s-v*u-T*f;return Dr.rotateX(t,e,r),t[4]=A*(d=t[3])+L*(s=t[0])+C*(f=t[2])-k*(u=t[1]),t[5]=C*d+L*u+k*s-A*f,t[6]=k*d+L*f+A*u-C*s,t[7]=L*d-A*s-C*u-k*f,t},$t.rotateY=function(t,e,r){var s=-e[0],u=-e[1],f=-e[2],d=e[3],g=e[4],v=e[5],T=e[6],E=e[7],A=g*d+E*s+v*f-T*u,C=v*d+E*u+T*s-g*f,k=T*d+E*f+g*u-v*s,L=E*d-g*s-v*u-T*f;return Dr.rotateY(t,e,r),t[4]=A*(d=t[3])+L*(s=t[0])+C*(f=t[2])-k*(u=t[1]),t[5]=C*d+L*u+k*s-A*f,t[6]=k*d+L*f+A*u-C*s,t[7]=L*d-A*s-C*u-k*f,t},$t.rotateZ=function(t,e,r){var s=-e[0],u=-e[1],f=-e[2],d=e[3],g=e[4],v=e[5],T=e[6],E=e[7],A=g*d+E*s+v*f-T*u,C=v*d+E*u+T*s-g*f,k=T*d+E*f+g*u-v*s,L=E*d-g*s-v*u-T*f;return Dr.rotateZ(t,e,r),t[4]=A*(d=t[3])+L*(s=t[0])+C*(f=t[2])-k*(u=t[1]),t[5]=C*d+L*u+k*s-A*f,t[6]=k*d+L*f+A*u-C*s,t[7]=L*d-A*s-C*u-k*f,t},$t.rotateByQuatAppend=function(t,e,r){var s=r[0],u=r[1],f=r[2],d=r[3],g=e[0],v=e[1],T=e[2],E=e[3];return t[0]=g*d+E*s+v*f-T*u,t[1]=v*d+E*u+T*s-g*f,t[2]=T*d+E*f+g*u-v*s,t[3]=E*d-g*s-v*u-T*f,t[4]=(g=e[4])*d+(E=e[7])*s+(v=e[5])*f-(T=e[6])*u,t[5]=v*d+E*u+T*s-g*f,t[6]=T*d+E*f+g*u-v*s,t[7]=E*d-g*s-v*u-T*f,t},$t.rotateByQuatPrepend=function(t,e,r){var s=e[0],u=e[1],f=e[2],d=e[3],g=r[0],v=r[1],T=r[2],E=r[3];return t[0]=s*E+d*g+u*T-f*v,t[1]=u*E+d*v+f*g-s*T,t[2]=f*E+d*T+s*v-u*g,t[3]=d*E-s*g-u*v-f*T,t[4]=s*(E=r[7])+d*(g=r[4])+u*(T=r[6])-f*(v=r[5]),t[5]=u*E+d*v+f*g-s*T,t[6]=f*E+d*T+s*v-u*g,t[7]=d*E-s*g-u*v-f*T,t},$t.rotateAroundAxis=function(t,e,r,s){if(Math.abs(s)<Zr.EPSILON)return Kn(t,e);var u=Math.hypot(r[0],r[1],r[2]);s*=.5;var f=Math.sin(s),d=f*r[0]/u,g=f*r[1]/u,v=f*r[2]/u,T=Math.cos(s),E=e[0],A=e[1],C=e[2],k=e[3];t[0]=E*T+k*d+A*v-C*g,t[1]=A*T+k*g+C*d-E*v,t[2]=C*T+k*v+E*g-A*d,t[3]=k*T-E*d-A*g-C*v;var L=e[4],F=e[5],N=e[6],G=e[7];return t[4]=L*T+G*d+F*v-N*g,t[5]=F*T+G*g+N*d-L*v,t[6]=N*T+G*v+L*g-F*d,t[7]=G*T-L*d-F*g-N*v,t},$t.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t},$t.multiply=jo,$t.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t},$t.lerp=function(t,e,r,s){var u=1-s;return jl(e,r)<0&&(s=-s),t[0]=e[0]*u+r[0]*s,t[1]=e[1]*u+r[1]*s,t[2]=e[2]*u+r[2]*s,t[3]=e[3]*u+r[3]*s,t[4]=e[4]*u+r[4]*s,t[5]=e[5]*u+r[5]*s,t[6]=e[6]*u+r[6]*s,t[7]=e[7]*u+r[7]*s,t},$t.invert=function(t,e){var r=sa(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t},$t.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},$t.normalize=function(t,e){var r=sa(e);if(r>0){r=Math.sqrt(r);var s=e[0]/r,u=e[1]/r,f=e[2]/r,d=e[3]/r,g=e[4],v=e[5],T=e[6],E=e[7],A=s*g+u*v+f*T+d*E;t[0]=s,t[1]=u,t[2]=f,t[3]=d,t[4]=(g-s*A)/r,t[5]=(v-u*A)/r,t[6]=(T-f*A)/r,t[7]=(E-d*A)/r}return t},$t.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},$t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},$t.equals=function(t,e){var r=t[0],s=t[1],u=t[2],f=t[3],d=t[4],g=t[5],v=t[6],T=t[7],E=e[0],A=e[1],C=e[2],k=e[3],L=e[4],F=e[5],N=e[6],G=e[7];return Math.abs(r-E)<=Zr.EPSILON*Math.max(1,Math.abs(r),Math.abs(E))&&Math.abs(s-A)<=Zr.EPSILON*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(u-C)<=Zr.EPSILON*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(f-k)<=Zr.EPSILON*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(d-L)<=Zr.EPSILON*Math.max(1,Math.abs(d),Math.abs(L))&&Math.abs(g-F)<=Zr.EPSILON*Math.max(1,Math.abs(g),Math.abs(F))&&Math.abs(v-N)<=Zr.EPSILON*Math.max(1,Math.abs(v),Math.abs(N))&&Math.abs(T-G)<=Zr.EPSILON*Math.max(1,Math.abs(T),Math.abs(G))},$t.sqrLen=$t.squaredLength=$t.len=$t.length=$t.dot=$t.mul=$t.setReal=$t.getReal=void 0;var Zr=Mn(ze),Dr=Mn(Wt),on=Mn(ht);function hn(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(hn=function(s){return s?r:e})(t)}function Mn(t,e){if(t&&t.__esModule)return t;if(t===null||rn(t)!=="object"&&typeof t!="function")return{default:t};var r=hn(e);if(r&&r.has(t))return r.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var d=u?Object.getOwnPropertyDescriptor(t,f):null;d&&(d.get||d.set)?Object.defineProperty(s,f,d):s[f]=t[f]}return s.default=t,r&&r.set(t,s),s}function si(t,e,r){var s=.5*r[0],u=.5*r[1],f=.5*r[2],d=e[0],g=e[1],v=e[2],T=e[3];return t[0]=d,t[1]=g,t[2]=v,t[3]=T,t[4]=s*T+u*v-f*g,t[5]=u*T+f*d-s*v,t[6]=f*T+s*g-u*d,t[7]=-s*d-u*g-f*v,t}function Kn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function jo(t,e,r){var s=e[0],u=e[1],f=e[2],d=e[3],g=r[4],v=r[5],T=r[6],E=r[7],A=e[4],C=e[5],k=e[6],L=e[7],F=r[0],N=r[1],G=r[2],ne=r[3];return t[0]=s*ne+d*F+u*G-f*N,t[1]=u*ne+d*N+f*F-s*G,t[2]=f*ne+d*G+s*N-u*F,t[3]=d*ne-s*F-u*N-f*G,t[4]=s*E+d*g+u*T-f*v+A*ne+L*F+C*G-k*N,t[5]=u*E+d*v+f*g-s*T+C*ne+L*N+k*F-A*G,t[6]=f*E+d*T+s*v-u*g+k*ne+L*G+A*N-C*F,t[7]=d*E-s*g-u*v-f*T+L*ne-A*F-C*N-k*G,t}$t.getReal=Dr.copy,$t.setReal=Dr.copy,$t.mul=jo;var jl=Dr.dot;$t.dot=jl;var oa=Dr.length;$t.length=oa,$t.len=oa;var sa=Dr.squaredLength;$t.squaredLength=sa,$t.sqrLen=sa;var mr={};function Cs(t){return Cs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cs(t)}Object.defineProperty(mr,"__esModule",{value:!0}),mr.create=$l,mr.clone=function(t){var e=new Ci.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},mr.fromValues=function(t,e){var r=new Ci.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r},mr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},mr.set=function(t,e,r){return t[0]=e,t[1]=r,t},mr.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},mr.subtract=Gl,mr.multiply=Wl,mr.divide=La,mr.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},mr.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},mr.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},mr.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},mr.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},mr.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},mr.scaleAndAdd=function(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t},mr.distance=ql,mr.squaredDistance=Hl,mr.length=hl,mr.squaredLength=aa,mr.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},mr.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},mr.normalize=function(t,e){var r=e[0],s=e[1],u=r*r+s*s;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t},mr.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},mr.cross=function(t,e,r){var s=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=s,t},mr.lerp=function(t,e,r,s){var u=e[0],f=e[1];return t[0]=u+s*(r[0]-u),t[1]=f+s*(r[1]-f),t},mr.random=function(t,e){e=e||1;var r=2*Ci.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},mr.transformMat2=function(t,e,r){var s=e[0],u=e[1];return t[0]=r[0]*s+r[2]*u,t[1]=r[1]*s+r[3]*u,t},mr.transformMat2d=function(t,e,r){var s=e[0],u=e[1];return t[0]=r[0]*s+r[2]*u+r[4],t[1]=r[1]*s+r[3]*u+r[5],t},mr.transformMat3=function(t,e,r){var s=e[0],u=e[1];return t[0]=r[0]*s+r[3]*u+r[6],t[1]=r[1]*s+r[4]*u+r[7],t},mr.transformMat4=function(t,e,r){var s=e[0],u=e[1];return t[0]=r[0]*s+r[4]*u+r[12],t[1]=r[1]*s+r[5]*u+r[13],t},mr.rotate=function(t,e,r,s){var u=e[0]-r[0],f=e[1]-r[1],d=Math.sin(s),g=Math.cos(s);return t[0]=u*g-f*d+r[0],t[1]=u*d+f*g+r[1],t},mr.angle=function(t,e){var r=t[0],s=t[1],u=e[0],f=e[1],d=Math.sqrt(r*r+s*s)*Math.sqrt(u*u+f*f);return Math.acos(Math.min(Math.max(d&&(r*u+s*f)/d,-1),1))},mr.zero=function(t){return t[0]=0,t[1]=0,t},mr.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},mr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},mr.equals=function(t,e){var r=t[0],s=t[1],u=e[0],f=e[1];return Math.abs(r-u)<=Ci.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(s-f)<=Ci.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))},mr.forEach=mr.sqrLen=mr.sqrDist=mr.dist=mr.div=mr.mul=mr.sub=mr.len=void 0;var Ci=function(t,e){if(t&&t.__esModule)return t;if(t===null||Cs(t)!=="object"&&typeof t!="function")return{default:t};var r=Vl(void 0);if(r&&r.has(t))return r.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var d=u?Object.getOwnPropertyDescriptor(t,f):null;d&&(d.get||d.set)?Object.defineProperty(s,f,d):s[f]=t[f]}return s.default=t,r&&r.set(t,s),s}(ze);function Vl(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(Vl=function(s){return s?r:e})(t)}function $l(){var t=new Ci.ARRAY_TYPE(2);return Ci.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function Gl(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Wl(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function La(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function ql(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function Hl(t,e){var r=e[0]-t[0],s=e[1]-t[1];return r*r+s*s}function hl(t){return Math.hypot(t[0],t[1])}function aa(t){var e=t[0],r=t[1];return e*e+r*r}mr.len=hl,mr.sub=Gl,mr.mul=Wl,mr.div=La,mr.dist=ql,mr.sqrDist=Hl,mr.sqrLen=aa;var Ps=function(){var t=$l();return function(e,r,s,u,f,d){var g,v;for(r||(r=2),s||(s=0),v=u?Math.min(u*r+s,e.length):e.length,g=s;g<v;g+=r)t[0]=e[g],t[1]=e[g+1],f(t,t,d),e[g]=t[0],e[g+1]=t[1];return e}}();function Os(t){return Os=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Os(t)}mr.forEach=Ps,Object.defineProperty(ye,"__esModule",{value:!0}),o.aA=ye.vec4=o._=ye.vec3=ye.vec2=ye.quat2=o.av=ye.quat=o.ad=ye.mat4=o.bC=ye.mat3=ye.mat2d=o.aC=ye.mat2=ye.glMatrix=void 0;var fl=co(ze);ye.glMatrix=fl;var Ge=co(Ie);o.aC=ye.mat2=Ge;var Et=co(st);ye.mat2d=Et;var Nt=co(qt);o.bC=ye.mat3=Nt;var Br=co(ht);o.ad=ye.mat4=Br;var Kr=co(Wt);o.av=ye.quat=Kr;var cr=co($t);ye.quat2=cr;var Qn=co(mr);ye.vec2=Qn;var Ln=co(er);o._=ye.vec3=Ln;var bo=co(sr);function ai(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(ai=function(s){return s?r:e})(t)}function co(t,e){if(t&&t.__esModule)return t;if(t===null||Os(t)!=="object"&&typeof t!="function")return{default:t};var r=ai(e);if(r&&r.has(t))return r.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in t)if(f!=="default"&&Object.prototype.hasOwnProperty.call(t,f)){var d=u?Object.getOwnPropertyDescriptor(t,f):null;d&&(d.get||d.set)?Object.defineProperty(s,f,d):s[f]=t[f]}return s.default=t,r&&r.set(t,s),s}o.aA=ye.vec4=bo;var Jn=za;function za(t,e,r,s){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=r,this.p2y=s}za.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var r=t,s=0;s<8;s++){var u=this.sampleCurveX(r)-t;if(Math.abs(u)<e)return r;var f=this.sampleCurveDerivativeX(r);if(Math.abs(f)<1e-6)break;r-=u/f}var d=0,g=1;for(r=t,s=0;s<20&&(u=this.sampleCurveX(r),!(Math.abs(u-t)<e));s++)t>u?d=r:g=r,r=.5*(g-d)+d;return r},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var la=le(Jn),Ds=wo;function wo(t,e){this.x=t,this.y=e}wo.prototype={clone:function(){return new wo(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(t,e){var r=Math.cos(t),s=Math.sin(t),u=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},wo.convert=function(t){return t instanceof wo?t:Array.isArray(t)?new wo(t[0],t[1]):t};var Mt=le(Ds);const Fa=Math.PI/180,Rs=180/Math.PI;function Ar(t){return t*Fa}function li(t){return t*Rs}const Oe=[[0,0],[1,0],[1,1],[0,1]];function nt(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}function Rt(t,e,r,s){const u=new la(t,e,r,s);return function(f){return u.solve(f)}}const hr=Rt(.25,.1,.25,1);function Kt(t,e,r){return Math.min(r,Math.max(e,t))}function zr(t,e,r){return(r=Kt((r-t)/(e-t),0,1))*r*(3-2*r)}function bn(t,e,r){const s=r-e,u=((t-e)%s+s)%s+e;return u===e?r:u}function fn(t,e,r){if(!t.length)return r(null,[]);let s=t.length;const u=new Array(t.length);let f=null;t.forEach((d,g)=>{e(d,(v,T)=>{v&&(f=v),u[g]=T,--s==0&&r(f,u)})})}function ui(t){const e=[];for(const r in t)e.push(t[r]);return e}function Qr(t,...e){for(const r of e)for(const s in r)t[s]=r[s];return t}let qi=1;function Hi(){return qi++}function ci(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Zi(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Xi(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Vo(t,e){t.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function Fi(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Yi(t,e,r){const s={};for(const u in t)s[u]=e.call(this,t[u],u,t);return s}function Fu(t,e,r){const s={};for(const u in t)e.call(this,t[u],u,t)&&(s[u]=t[u]);return s}function ho(t){return Array.isArray(t)?t.map(ho):typeof t=="object"&&t?Yi(t,ho):t}const dl={};function zn(t){dl[t]||(typeof console<"u"&&console.warn(t),dl[t]=!0)}function Wn(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function Zl(t){let e=0;for(let r,s,u=0,f=t.length,d=f-1;u<f;d=u++)r=t[u],s=t[d],e+=(s.x-r.x)*(r.y+s.y);return e}function Ki([t,e,r]){const s=Ar(e+90),u=Ar(r);return{x:t*Math.cos(s)*Math.sin(u),y:t*Math.sin(s)*Math.sin(u),z:t*Math.cos(u),azimuthal:e,polar:r}}function ch(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function jp(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,u,f)=>{const d=u||f;return e[s]=!d||d.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Vp,Xl,kf,Bu,Yl,Nu,pl=null;function $p(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function hh(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Hg(t,e,r,s){for(;e<r;){const u=e+r>>1;t[u]<s?e=u+1:r=u}return e}function Lf(t,e,r,s){for(;e<r;){const u=e+r>>1;t[u]<=s?e=u+1:r=u}return e}function zf(t){return t>0?1/(1.001-t):1+t}function Uu(t){return t>0?1-1/(1.001-t):-t}function Ff(){return Vp==null&&(Vp=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Vp}const Pi={now:()=>Bu!==void 0?Bu:performance.now(),setNow(t){Bu=t},restoreNow(){Bu=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:r,height:s}=t;Yl||(Yl=document.createElement("canvas"));const u=Yl.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(r>Yl.width||s>Yl.height)&&(Yl.width=r,Yl.height=s),u.clearRect(-e,-e,r+2*e,s+2*e),u.drawImage(t,0,0,r,s),u.getImageData(-e,-e,r+2*e,s+2*e)},resolveURL:t=>(Xl||(Xl=document.createElement("a")),Xl.href=t,Xl.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(kf==null&&(kf=window.matchMedia("(prefers-reduced-motion: reduce)")),kf.matches)},hasCanvasFingerprintNoise(){if(Nu!==void 0)return Nu;if(!Ff())return Nu=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let r=0;for(let u=0;u<t.width;++u)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(u,0,1,1);const s=e.getImageData(0,0,t.width,t.height);r=0;for(let u=0;u<s.data.length;++u)if(u%4!=3&&r++!==s.data[u])return Nu=!0,!0;return Nu=!1,!1}};function Zg(t,e){const r=t.indexOf("?");if(r<0)return`${t}?${new URLSearchParams(e).toString()}`;const s=new URLSearchParams(t.slice(r));for(const u in e)s.set(u,e[u]);return`${t.slice(0,r)}?${s.toString()}`}function Gp(t,e={persistentParams:[]}){const r=t.indexOf("?");if(r<0)return t;const s=new URLSearchParams,u=new URLSearchParams(t.slice(r));for(const d of e.persistentParams){const g=u.get(d);g&&s.set(d,g)}const f=s.toString();return`${t.slice(0,r)}${f.length>0?`?${f}`:""}`}const Wp="mapbox-tiles";let qp=500,Xg=50,Ba,Bf;function Hp(){try{return caches}catch{}}function fh(){const t=Hp();t&&!Ba&&(Ba=t.open(Wp))}let Zp=1/0;const dh={supported:!1,testSupport:function(t){!Nf&&ju&&(Xp?Kg(t):ph=t)}};let ph,ju,Nf=!1,Xp=!1;const Yg=typeof self<"u"?self:{};function Kg(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ju),t.isContextLost())return;dh.supported=!0}catch{}t.deleteTexture(e),Nf=!0}Yg.document&&(ju=Yg.document.createElement("img"),ju.onload=function(){ph&&Kg(ph),ph=null,Xp=!0},ju.onerror=function(){Nf=!0,ph=null},ju.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Uf={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Uf);class jf extends Error{constructor(e,r,s){r===401&&Z(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Yp=ch()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,mh=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(Yp())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(s,u){const f=new AbortController,d=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Yp(),referrerPolicy:s.referrerPolicy,signal:f.signal});let g=!1,v=!1;const T=(E=d.url).indexOf("sku=")>0&&Z(E);var E;s.type==="json"&&d.headers.set("Accept","application/json");const A=(k,L,F)=>{if(v)return;if(k&&k.message!=="SecurityError"&&zn(k.toString()),L&&F)return C(L);const N=Date.now();fetch(d).then(G=>{if(G.ok){const ne=T?G.clone():null;return C(G,ne,N)}return u(new jf(G.statusText,G.status,s.url))}).catch(G=>{G.name!=="AbortError"&&u(new Error(`${G.message} ${s.url}`))})},C=(k,L,F)=>{(s.type==="arrayBuffer"?k.arrayBuffer():s.type==="json"?k.json():k.text()).then(N=>{v||(L&&F&&function(G,ne,ie){if(fh(),!Ba)return;const oe=jp(ne.headers.get("Cache-Control")||"");if(oe["no-store"])return;const me={status:ne.status,statusText:ne.statusText,headers:new Headers};ne.headers.forEach((De,je)=>me.headers.set(je,De)),oe["max-age"]&&me.headers.set("Expires",new Date(ie+1e3*oe["max-age"]).toUTCString());const pe=me.headers.get("Expires");if(!pe||new Date(pe).getTime()-ie<42e4)return;let Ee=Gp(G.url,{persistentParams:["language","worldview"]});if(ne.status===206){const De=G.headers.get("Range");if(!De)return;me.status=200,Ee=Zg(Ee,{range:De})}(function(De,je){if(Bf===void 0)try{new Response(new ReadableStream),Bf=!0}catch{Bf=!1}Bf?je(De.body):De.blob().then(je)})(ne,De=>{const je=new Response((Qe=ne.status)!==200&&Qe!==404&&[101,103,204,205,304].includes(Qe)?null:De,me);var Qe;fh(),Ba&&Ba.then(Ze=>Ze.put(Ee,je)).catch(Ze=>zn(Ze.message))})}(d,L,F),g=!0,u(null,N,k.headers.get("Cache-Control"),k.headers.get("Expires")))}).catch(N=>{v||u(new Error(N.message))})};return T?function(k,L){if(fh(),!Ba)return L(null);Ba.then(F=>{let N=Gp(k.url,{persistentParams:["language","worldview"]});const G=k.headers.get("Range");G&&(N=Zg(N,{range:G})),F.match(N).then(ne=>{const ie=function(oe){if(!oe)return!1;const me=new Date(oe.headers.get("Expires")||0),pe=jp(oe.headers.get("Cache-Control")||"");return me>Date.now()&&!pe["no-cache"]}(ne);F.delete(N),ie&&F.put(N,ne.clone()),L(null,ne,ie)}).catch(L)}).catch(L)}(d,A):A(null,null),{cancel:()=>{v=!0,g||f.abort()}}}(t,e);if(ch()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(s,u){const f=new XMLHttpRequest;f.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const d in s.headers)f.setRequestHeader(d,s.headers[d]);return s.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=s.credentials==="include",f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let d=f.response;if(s.type==="json")try{d=JSON.parse(f.response)}catch(g){return u(g)}u(null,d,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new jf(f.statusText,f.status,s.url))},f.send(s.body),{cancel:()=>f.abort()}}(t,e)},ml=function(t,e){return mh(Qr(t,{type:"arrayBuffer"}),e)};function Qg(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const Kp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Vf,ua;Vf=[],ua=0;const Qp=function(t,e){if(dh.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),ua>=V.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Vf.push(f),f}ua++;let r=!1;const s=()=>{if(!r)for(r=!0,ua--;Vf.length&&ua<V.MAX_PARALLEL_IMAGE_REQUESTS;){const f=Vf.shift(),{requestParameters:d,callback:g,cancelled:v}=f;v||(f.cancel=Qp(d,g).cancel)}},u=ml(t,(f,d,g,v)=>{s(),f?e(f):d&&(self.createImageBitmap?function(T,E){const A=new Blob([new Uint8Array(T)],{type:"image/png"});createImageBitmap(A).then(C=>{E(null,C)}).catch(C=>{E(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(T,E)=>e(T,E,g,v)):function(T,E){const A=new Image;A.onload=()=>{E(null,A),URL.revokeObjectURL(A.src),A.onload=null,requestAnimationFrame(()=>{A.src=Kp})},A.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const C=new Blob([new Uint8Array(T)],{type:"image/png"});A.src=T.byteLength?URL.createObjectURL(C):Kp}(d,(T,E)=>e(T,E,g,v)))});return{cancel:()=>{u.cancel(),s()}}},Jp="01",em="NO_ACCESS_TOKEN",Jg=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ks(t){const e=t.match(Jg);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Kl(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const ey="mapbox.eventData";function ty(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class _h{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=ty(V.ACCESS_TOKEN);let s="";return s=r&&r.u?btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(u,f)=>String.fromCharCode(+("0x"+f)))):V.ACCESS_TOKEN||"",e?`${ey}.${e}:${s}`:`${ey}:${s}`}fetchEventData(){const e=$p("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const u=localStorage.getItem(r);u&&(this.eventData=JSON.parse(u));const f=localStorage.getItem(s);f&&(this.anonId=f)}catch{zn("Unable to read from LocalStorage")}}saveEventData(){const e=$p("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid"),u=this.anonId;if(e&&u)try{localStorage.setItem(s,u),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData))}catch{zn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,s,u){if(!V.EVENTS_URL)return;const f=ks(V.EVENTS_URL);f.params.push(`access_token=${u||V.ACCESS_TOKEN||""}`);const d={event:this.type,created:new Date(e).toISOString()},g=r?Qr(d,r):d,v={url:Kl(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([g])};this.pendingRequest=function(T,E){return mh(Qr(T,{method:"POST"}),E)}(v,T=>{this.pendingRequest=null,s(T),this.saveEventData(),this.processRequests(u)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const $f=new class extends _h{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){V.EVENTS_URL&&V.ACCESS_TOKEN&&Array.isArray(t)&&t.some(r=>te(r)||Z(r))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=ty(V.ACCESS_TOKEN),r=e?e.u:V.ACCESS_TOKEN;let s=r!==this.eventData.tokenU;Xi(this.anonId)||(this.anonId=ci(),s=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),d=new Date(u),g=(u-this.eventData.lastSuccess)/864e5;s=s||g>=1||g<-1||f.getDate()!==d.getDate()}else s=!0;s?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:Jp,"enabled.telemetry":!1,userId:this.anonId},f=>{f||(this.eventData.lastSuccess=u,this.eventData.tokenU=r)},t):this.processRequests()}},tm=$f.postTurnstileEvent.bind($f),Gf=new class extends _h{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,r,s){this.skuToken=e,this.errorCb=s,V.EVENTS_URL&&(r||V.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(em)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Xi(this.anonId)||(this.anonId=ci()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:Jp,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},u1=Gf.postMapLoadEvent.bind(Gf),ry=new class extends _h{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=ci(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){const e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){const{map:r,style:s,importedStyles:u}=e;if(!V.EVENTS_URL||!t&&!V.ACCESS_TOKEN)return;const f=this.getMapInstanceId(r),d={mapInstanceId:f,eventId:this.getEventId(f),style:s};u.length&&(d.importedStyles=u),this.queueRequest({timestamp:Date.now(),payload:d},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,payload:r}=this.queue.shift();this.postEvent(e,r,()=>{},t)}},rm=ry.postStyleLoadEvent.bind(ry),ny=new class extends _h{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){V.EVENTS_URL&&(t||V.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:r}=this.queue.shift(),s=function(u){const f=performance.getEntriesByType("resource"),d=performance.getEntriesByType("mark"),g=function(k){const L={};if(k){for(const F in k)if(F!=="other")for(const N of k[F]){const G=`${F}ResolveRangeMin`,ne=`${F}ResolveRangeMax`,ie=`${F}RequestCount`,oe=`${F}RequestCachedCount`;L[G]=Math.min(L[G]||1/0,N.startTime),L[ne]=Math.max(L[ne]||-1/0,N.responseEnd);const me=pe=>{L[pe]===void 0&&(L[pe]=0),++L[pe]};N.transferSize!==void 0&&N.transferSize===0&&me(oe),me(ie)}}return L}(function(k,L){const F={};if(k)for(const N of k){const G=L(N);F[G]===void 0&&(F[G]=[]),F[G].push(N)}return F}(f,Q)),v=window.devicePixelRatio,T=navigator.connection||navigator.mozConnection||navigator.webkitConnection,E=T?T.effectiveType:void 0,A={counters:[],metadata:[],attributes:[]},C=(k,L,F)=>{F!=null&&k.push({name:L,value:F.toString()})};for(const k in g)C(A.counters,k,g[k]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(C(A.counters,"interactionRangeMin",u.interactionRange[0]),C(A.counters,"interactionRangeMax",u.interactionRange[1])),d)for(const k of Object.keys(ae)){const L=ae[k],F=d.find(N=>N.name===L);F&&C(A.counters,L,F.startTime)}return C(A.counters,"visibilityHidden",u.visibilityHidden),C(A.attributes,"style",function(k){if(k)for(const L of k){const F=L.name.split("?")[0];if(Te(F)){const N=F.split("/").slice(-2);if(N.length===2)return`mapbox://styles/${N[0]}/${N[1]}`}}}(f)),C(A.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),C(A.attributes,"fogEnabled",u.fogEnabled?"true":"false"),C(A.attributes,"projection",u.projection),C(A.attributes,"zoom",u.zoom),C(A.metadata,"devicePixelRatio",v),C(A.metadata,"connectionEffectiveType",E),C(A.metadata,"navigatorUserAgent",navigator.userAgent),C(A.metadata,"screenWidth",window.screen.width),C(A.metadata,"screenHeight",window.screen.height),C(A.metadata,"windowWidth",window.innerWidth),C(A.metadata,"windowHeight",window.innerHeight),C(A.metadata,"mapWidth",u.width/v),C(A.metadata,"mapHeight",u.height/v),C(A.metadata,"webglRenderer",u.renderer),C(A.metadata,"webglVendor",u.vendor),C(A.metadata,"sdkVersion",R),C(A.metadata,"sdkIdentifier","mapbox-gl-js"),A}(r);for(const u of s.metadata);for(const u of s.counters);for(const u of s.attributes);this.postEvent(e,s,()=>{},t)}},Wf=ny.postPerformanceEvent.bind(ny),Vu=new class extends _h{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,r,s){if(!V.API_URL||!V.SESSION_PATH)return;const u=ks(V.API_URL+V.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${s||V.ACCESS_TOKEN||""}`);const f={url:Kl(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(d,g){return mh(Qr(d,{method:"GET"}),g)}(f,d=>{this.pendingRequest=null,r(d),this.saveEventData(),this.processRequests(s)})}getSessionAPI(t,e,r,s){this.skuToken=e,this.errorCb=s,V.SESSION_PATH&&V.API_URL&&(r||V.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(em)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},iy=Vu.getSessionAPI.bind(Vu),Ql=new Set;var gh={exports:{}},c1={exports:function(t,e){var r,s,u,f,d,g,v,T;for(s=t.length-(r=3&t.length),u=e,d=3432918353,g=461845907,T=0;T<s;)v=255&t.charCodeAt(T)|(255&t.charCodeAt(++T))<<8|(255&t.charCodeAt(++T))<<16|(255&t.charCodeAt(++T))<<24,++T,u=27492+(65535&(f=5*(65535&(u=(u^=v=(65535&(v=(v=(65535&v)*d+(((v>>>16)*d&65535)<<16)&4294967295)<<15|v>>>17))*g+(((v>>>16)*g&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(v=0,r){case 3:v^=(255&t.charCodeAt(T+2))<<16;case 2:v^=(255&t.charCodeAt(T+1))<<8;case 1:u^=v=(65535&(v=(v=(65535&(v^=255&t.charCodeAt(T)))*d+(((v>>>16)*d&65535)<<16)&4294967295)<<15|v>>>17))*g+(((v>>>16)*g&65535)<<16)&4294967295}return u^=t.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}},h1={exports:function(t,e){for(var r,s=t.length,u=e^s,f=0;s>=4;)r=1540483477*(65535&(r=255&t.charCodeAt(f)|(255&t.charCodeAt(++f))<<8|(255&t.charCodeAt(++f))<<16|(255&t.charCodeAt(++f))<<24))+((1540483477*(r>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),s-=4,++f;switch(s){case 3:u^=(255&t.charCodeAt(f+2))<<16;case 2:u^=(255&t.charCodeAt(f+1))<<8;case 1:u=1540483477*(65535&(u^=255&t.charCodeAt(f)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}},qf=c1.exports,nm=h1.exports;gh.exports=qf,gh.exports.murmur3=qf,gh.exports.murmur2=nm;var yh=le(gh.exports);class $o{constructor(e,...r){Qr(this,r[0]||{}),this.type=e}}class Na extends $o{constructor(e,r={}){super("error",Qr({error:e},r))}}function oy(t,e,r){r[t]&&r[t].indexOf(e)!==-1||(r[t]=r[t]||[],r[t].push(e))}function im(t,e,r){if(r&&r[t]){const s=r[t].indexOf(e);s!==-1&&r[t].splice(s,1)}}class Jl{on(e,r){return this._listeners=this._listeners||{},oy(e,r,this._listeners),this}off(e,r){return im(e,r,this._listeners),im(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},oy(e,r,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,r){const s=typeof e=="string"?new $o(e,r):e,u=s.type;if(this.listens(u)){s.target=this;const f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const v of f)v.call(this,s);const d=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const v of d)im(u,v,this._oneTimeListeners),v.call(this,s);const g=this._eventedParent;g&&(Qr(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(s))}else s instanceof Na&&console.error(s.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}o.F=void 0;var sy={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Hf(t){return(t=Math.round(t))<0?0:t>255?255:t}function Zf(t){return Hf(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function $u(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function om(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{o.F={}.parseCSSColor=function(t){var e,r=t.replace(/ /g,"").toLowerCase();if(r in sy)return sy[r].slice();if(r[0]==="#")return r.length===4?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:r.length===7&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=r.indexOf("("),u=r.indexOf(")");if(s!==-1&&u+1===r.length){var f=r.substr(0,s),d=r.substr(s+1,u-(s+1)).split(","),g=1;switch(f){case"rgba":if(d.length!==4)return null;g=$u(d.pop());case"rgb":return d.length!==3?null:[Zf(d[0]),Zf(d[1]),Zf(d[2]),g];case"hsla":if(d.length!==4)return null;g=$u(d.pop());case"hsl":if(d.length!==3)return null;var v=(parseFloat(d[0])%360+360)%360/360,T=$u(d[1]),E=$u(d[2]),A=E<=.5?E*(T+1):E+T-E*T,C=2*E-A;return[Hf(255*om(C,A,v+1/3)),Hf(255*om(C,A,v)),Hf(255*om(C,A,v-1/3)),g];default:return null}}return null}}catch{}class Gr{constructor(e,r,s,u=1){this.r=e,this.g=r,this.b=s,this.a=u}static parse(e){if(!e)return;if(e instanceof Gr)return e;if(typeof e!="string")return;const r=o.F(e);return r?new Gr(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,s,u]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(s)},${u})`}toRenderColor(e){const{r,g:s,b:u,a:f}=this;return new f1(e,r,s,u,f)}}class f1{constructor(e,r,s,u,f){if(e){const d=e.image.height,g=d*d;r=f===0?0:r/f*(d-1),s=f===0?0:s/f*(d-1),u=f===0?0:u/f*(d-1);const v=Math.floor(r),T=Math.floor(s),E=Math.floor(u),A=Math.ceil(r),C=Math.ceil(s),k=Math.ceil(u),L=r-v,F=s-T,N=u-E,G=e.image.data,ne=4*(v+T*g+E*d),ie=4*(v+T*g+k*d),oe=4*(v+C*g+E*d),me=4*(v+C*g+k*d),pe=4*(A+T*g+E*d),Ee=4*(A+T*g+k*d),De=4*(A+C*g+E*d),je=4*(A+C*g+k*d);if(ne<0||je>=G.length)throw new Error("out of range");this.r=nr(nr(nr(G[ne],G[ie],N),nr(G[oe],G[me],N),F),nr(nr(G[pe],G[Ee],N),nr(G[De],G[je],N),F),L)/255*f,this.g=nr(nr(nr(G[ne+1],G[ie+1],N),nr(G[oe+1],G[me+1],N),F),nr(nr(G[pe+1],G[Ee+1],N),nr(G[De+1],G[je+1],N),F),L)/255*f,this.b=nr(nr(nr(G[ne+2],G[ie+2],N),nr(G[oe+2],G[me+2],N),F),nr(nr(G[pe+2],G[Ee+2],N),nr(G[De+2],G[je+2],N),F),L)/255*f,this.a=f}else this.r=r,this.g=s,this.b=u,this.a=f}toArray(){const{r:e,g:r,b:s,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*r/u,255*s/u,u]}toArray01(){const{r:e,g:r,b:s,a:u}=this;return u===0?[0,0,0,0]:[e/u,r/u,s/u,u]}toArray01Scaled(e){const{r,g:s,b:u,a:f}=this;return f===0?[0,0,0]:[r/f*e,s/f*e,u/f*e]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:s,a:u}=this;return[e,r,s,u]}toArray01Linear(){const{r:e,g:r,b:s,a:u}=this;return u===0?[0,0,0,0]:[Math.pow(e/u,2.2),Math.pow(r/u,2.2),Math.pow(s/u,2.2),u]}}function nr(t,e,r){return t*(1-r)+e*r}function ay(t,e,r){return t.map((s,u)=>nr(s,e[u],r))}Gr.black=new Gr(0,0,0,1),Gr.white=new Gr(1,1,1,1),Gr.transparent=new Gr(0,0,0,0),Gr.red=new Gr(1,0,0,1),Gr.blue=new Gr(0,0,1,1);var Xf=Object.freeze({__proto__:null,array:ay,color:function(t,e,r){return new Gr(nr(t.r,e.r,r),nr(t.g,e.g,r),nr(t.b,e.b,r),nr(t.a,e.a,r))},number:nr});function sm(t,...e){for(const r of e)for(const s in r)t[s]=r[s];return t}class ca extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class am{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,u]of r)this.bindings[s]=u}concat(e){return new am(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Ls={kind:"null"},Ut={kind:"number"},Wr={kind:"string"},jr={kind:"boolean"},os={kind:"color"},Gu={kind:"object"},Cr={kind:"value"},vh={kind:"collator"},ha={kind:"formatted"},xh={kind:"resolvedImage"};function To(t,e){return{kind:"array",itemType:t,N:e}}function Nn(t){if(t.kind==="array"){const e=Nn(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const d1=[Ls,Ut,Wr,jr,os,ha,Gu,To(Cr),xh];function bh(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!bh(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const r of d1)if(!bh(r,e))return null}}return`Expected ${Nn(t)} but found ${Nn(e)} instead.`}function Yf(t,e){return e.some(r=>r.kind===t.kind)}function eu(t,e){return e.some(r=>r==="null"?t===null:r==="array"?Array.isArray(t):r==="object"?t&&!Array.isArray(t)&&typeof t=="object":r===typeof t)}class Wu{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class wh{constructor(e,r,s,u,f){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=s,this.fontStack=u,this.textColor=f}}class Oi{constructor(e){this.sections=e}static fromString(e){return new Oi([new wh(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Oi?e:Oi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.namePrimary]);continue}e.push(r.text);const s={};r.fontStack&&(s["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(s["font-scale"]=r.scale),r.textColor&&(s["text-color"]=["rgba"].concat(r.textColor.toRenderColor(null).toArray())),e.push(s)}return e}}class Go{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,r){return e?new Go({namePrimary:e,nameSecondary:r,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function zs(t,e,r,s){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[t,e,r,s]:[t,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function qu(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Gr||t instanceof Wu||t instanceof Oi||t instanceof Go)return!0;if(Array.isArray(t)){for(const e of t)if(!qu(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!qu(t[e]))return!1;return!0}return!1}function qn(t){if(t===null)return Ls;if(typeof t=="string")return Wr;if(typeof t=="boolean")return jr;if(typeof t=="number")return Ut;if(t instanceof Gr)return os;if(t instanceof Wu)return vh;if(t instanceof Oi)return ha;if(t instanceof Go)return xh;if(Array.isArray(t)){const e=t.length;let r;for(const s of t){const u=qn(s);if(r){if(r===u)continue;r=Cr;break}r=u}return To(r||Cr,e)}return Gu}function Fs(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Gr||t instanceof Oi||t instanceof Go?t.toString():JSON.stringify(t)}class Ua{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!qu(e[1]))return r.error("invalid value");const s=e[1];let u=qn(s);const f=r.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new Ua(u,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Gr?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Oi?this.value.serialize():this.value}}class yi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const lm={string:Wr,number:Ut,boolean:jr,object:Gu};class Bs{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,u=1;const f=e[0];if(f==="array"){let g,v;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in lm)||T==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);g=lm[T],u++}else g=Cr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);v=e[2],u++}s=To(g,v)}else s=lm[f];const d=[];for(;u<e.length;u++){const g=r.parse(e[u],u,Cr);if(!g)return null;d.push(g)}return new Bs(s,d)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!bh(this.type,qn(s)))return s;if(r===this.args.length-1)throw new yi(`Expected value to be of type ${Nn(this.type)}, but found ${Nn(qn(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){r.push(s.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&r.push(u)}}return r.concat(this.args.map(s=>s.serialize()))}}class Th{constructor(e){this.type=ha,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const u=[];let f=!1;for(let d=1;d<=e.length-1;++d){const g=e[d];if(f&&typeof g=="object"&&!Array.isArray(g)){f=!1;let v=null;if(g["font-scale"]&&(v=r.parse(g["font-scale"],1,Ut),!v))return null;let T=null;if(g["text-font"]&&(T=r.parse(g["text-font"],1,To(Wr)),!T))return null;let E=null;if(g["text-color"]&&(E=r.parse(g["text-color"],1,os),!E))return null;const A=u[u.length-1];A.scale=v,A.font=T,A.textColor=E}else{const v=r.parse(e[d],1,Cr);if(!v)return null;const T=v.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:v,scale:null,font:null,textColor:null})}}return new Th(u)}evaluate(e){return new Oi(this.sections.map(r=>{const s=r.content.evaluate(e);return qn(s)===xh?new wh("",s,null,null,null):new wh(Fs(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const s={};r.scale&&(s["font-scale"]=r.scale.serialize()),r.font&&(s["text-font"]=r.font.serialize()),r.textColor&&(s["text-color"]=r.textColor.serialize()),e.push(s)}return e}}class Sh{constructor(e,r){this.type=xh,this.inputPrimary=e,this.inputSecondary=r}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");const s=r.parse(e[1],1,Wr);if(!s)return r.error("No image name provided.");if(e.length===2)return new Sh(s);const u=r.parse(e[2],1,Wr);return u?new Sh(s,u):r.error("Secondary image variant is not a string.")}evaluate(e){const r=Go.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(r.namePrimary)>-1,r.nameSecondary&&r.available&&e.availableImages&&(r.available=e.availableImages.indexOf(r.nameSecondary)>-1)),r}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function tu(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}const um={"to-boolean":jr,"to-color":os,"to-number":Ut,"to-string":Wr};class fa{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0],u=[];let f=Ls;if(s==="to-array"){if(!Array.isArray(e[1]))return null;const d=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);f=To(r.expectedType.itemType,d)}else{if(!(d>0&&qu(e[1][0])))return null;f=To(qn(e[1][0]),d)}for(let g=0;g<d;g++){const v=e[1][g];let T;if(tu(v)==="array")T=r.parse(v,void 0,f.itemType);else{const E=tu(v);if(E!==f.itemType.kind)return r.error(`Expected ${f.itemType.kind} but found ${E}.`);T=r.registry.literal.parse(["literal",v===void 0?null:v],r)}if(!T)return null;u.push(T)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return r.error("Expected one argument.");f=um[s];for(let d=1;d<e.length;d++){const g=r.parse(e[d],d,Cr);if(!g)return null;u.push(g)}}return new fa(f,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,s;for(const u of this.args){if(r=u.evaluate(e),s=null,r instanceof Gr)return r;if(typeof r=="string"){const f=e.parseColor(r);if(f)return f}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:zs(r[0],r[1],r[2],r[3]),!s))return new Gr(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new yi(s||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const s of this.args){if(r=s.evaluate(e),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new yi(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Oi.fromString(Fs(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Go.fromString(Fs(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(r=>r.evaluate(e)):Fs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Th([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Sh(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const p1=["Unknown","Point","LineString","Polygon"];class Kf{constructor(e,r){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=r}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?p1[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:s,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*r-e[0])+this.featureDistanceData.bearing[1]*(u*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=Gr.parse(e)),r}getConfig(e){return this.options?this.options.get(e):null}}class Qi{constructor(e,r,s,u,f){this.name=e,this.type=r,this._evaluate=s,this.args=u,this._overloadIndex=f}evaluate(e){if(!this._evaluate){const r=Qi.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const s=e[0],u=Qi.definitions[s];if(!u)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,d=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,g=[];let v=null,T=-1;for(const[E,A]of d){if(Array.isArray(E)&&E.length!==e.length-1)continue;g.push(E),T++,v=new id(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);const C=[];let k=!1;for(let L=1;L<e.length;L++){const F=e[L],N=Array.isArray(E)?E[L-1]:E.type,G=v.parse(F,1+C.length,N);if(!G){k=!0;break}C.push(G)}if(!k)if(Array.isArray(E)&&E.length!==C.length)v.error(`Expected ${E.length} arguments, but found ${C.length} instead.`);else{for(let L=0;L<C.length;L++){const F=Array.isArray(E)?E[L]:E.type,N=C[L];v.concat(L+1).checkSubtype(F,N.type)}if(v.errors.length===0)return new Qi(s,f,A,C,T)}}if(g.length===1)r.errors.push(...v.errors);else{const E=(g.length?g:d.map(([C])=>C)).map(Eh).join(" | "),A=[];for(let C=1;C<e.length;C++){const k=r.parse(e[C],1+A.length);if(!k)return null;A.push(Nn(k.type))}r.error(`Expected arguments of type ${E}, but found (${A.join(", ")}) instead.`)}return null}static register(e,r){Qi.definitions=r;for(const s in r)e[s]=Qi}}function Eh(t){return Array.isArray(t)?`(${t.map(Nn).join(", ")})`:`(${Nn(t.type)}...)`}class Mh{constructor(e,r,s){this.type=vh,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const u=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,jr);if(!u)return null;const f=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,jr);if(!f)return null;let d=null;return s.locale&&(d=r.parse(s.locale,1,Wr),!d)?null:new Mh(u,f,d)}evaluate(e){return new Wu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function ly(t,e,r=0,s=t.length-1,u=m1){for(;s>r;){if(s-r>600){const v=s-r+1,T=e-r+1,E=Math.log(v),A=.5*Math.exp(2*E/3),C=.5*Math.sqrt(E*A*(v-A)/v)*(T-v/2<0?-1:1);ly(t,e,Math.max(r,Math.floor(e-T*A/v+C)),Math.min(s,Math.floor(e+(v-T)*A/v+C)),u)}const f=t[e];let d=r,g=s;for(Ih(t,r,e),u(t[s],f)>0&&Ih(t,r,s);d<g;){for(Ih(t,d,g),d++,g--;u(t[d],f)<0;)d++;for(;u(t[g],f)>0;)g--}u(t[r],f)===0?Ih(t,r,g):(g++,Ih(t,g,s)),g<=e&&(r=g+1),e<=g&&(s=g-1)}}function Ih(t,e,r){const s=t[e];t[e]=t[r],t[r]=s}function m1(t,e){return t<e?-1:t>e?1:0}function uy(t){let e=0;for(let r,s,u=0,f=t.length,d=f-1;u<f;d=u++)r=t[u],s=t[d],e+=(s.x-r.x)*(r.y+s.y);return e}function Ah(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ch(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function cy(t,e,r){const s=t[0]-e[0],u=t[1]-e[1],f=t[0]-r[0],d=t[1]-r[1];return s*d-f*u==0&&s*f<=0&&u*d<=0}function Fr(t,e,r=!1){let s=!1;for(let g=0,v=e.length;g<v;g++){const T=e[g];for(let E=0,A=T.length,C=A-1;E<A;C=E++){const k=T[C],L=T[E];if(cy(t,k,L))return r;(f=k)[1]>(u=t)[1]!=(d=L)[1]>u[1]&&u[0]<(d[0]-f[0])*(u[1]-f[1])/(d[1]-f[1])+f[0]&&(s=!s)}}var u,f,d;return s}function cm(t,e,r,s){const u=s[0]-r[0],f=s[1]-r[1],d=(t[0]-r[0])*f-u*(t[1]-r[1]),g=(e[0]-r[0])*f-u*(e[1]-r[1]);return d>0&&g<0||d<0&&g>0}function Ph(t,e,r,s){return(u=[s[0]-r[0],s[1]-r[1]])[0]*(f=[e[0]-t[0],e[1]-t[1]])[1]-u[1]*f[0]!=0&&!(!cm(t,e,r,s)||!cm(r,s,t,e));var u,f}const _l=8192;function _1(t,e){const r=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*_l),Math.round(s*u*_l)]}function Qf(t,e){for(let r=0;r<e.length;r++)if(Fr(t,e[r]))return!0;return!1}function Jf(t,e,r){for(const s of r)for(let u=0,f=s.length,d=f-1;u<f;d=u++)if(Ph(t,e,s[d],s[u]))return!0;return!1}function Oh(t,e){for(let r=0;r<t.length;++r)if(!Fr(t[r],e))return!1;for(let r=0;r<t.length-1;++r)if(Jf(t[r],t[r+1],e))return!1;return!0}function g1(t,e){for(let r=0;r<e.length;r++)if(Oh(t,e[r]))return!0;return!1}function ed(t,e,r){const s=[];for(let u=0;u<t.length;u++){const f=[];for(let d=0;d<t[u].length;d++){const g=_1(t[u][d],r);Ah(e,g),f.push(g)}s.push(f)}return s}function Ns(t,e,r){const s=[];for(let u=0;u<t.length;u++){const f=ed(t[u],e,r);s.push(f)}return s}function hy(t,e,r,s){if(t[0]<r[0]||t[0]>r[2]){const u=.5*s;let f=t[0]-r[0]>u?-s:r[0]-t[0]>u?s:0;f===0&&(f=t[0]-r[2]>u?-s:r[2]-t[0]>u?s:0),t[0]+=f}Ah(e,t)}function hm(t,e,r,s){const u=Math.pow(2,s.z)*_l,f=[s.x*_l,s.y*_l],d=[];if(!t)return d;for(const g of t)for(const v of g){const T=[v.x+f[0],v.y+f[1]];hy(T,e,r,u),d.push(T)}return d}function Hu(t,e,r,s){const u=Math.pow(2,s.z)*_l,f=[s.x*_l,s.y*_l],d=[];if(!t)return d;for(const v of t){const T=[];for(const E of v){const A=[E.x+f[0],E.y+f[1]];Ah(e,A),T.push(A)}d.push(T)}if(e[2]-e[0]<=u/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const v of d)for(const T of v)hy(T,e,r,u)}var g;return d}class ja{constructor(e,r){this.type=jr,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(qu(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let u=0;u<s.features.length;++u){const f=s.features[u].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new ja(s,s.features[u].geometry)}else if(s.type==="Feature"){const u=s.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new ja(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new ja(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,s){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(!d)return!1;if(s.type==="Polygon"){const g=ed(s.coordinates,f,d),v=hm(r.geometry(),u,f,d);if(!Ch(u,f))return!1;for(const T of v)if(!Fr(T,g))return!1}if(s.type==="MultiPolygon"){const g=Ns(s.coordinates,f,d),v=hm(r.geometry(),u,f,d);if(!Ch(u,f))return!1;for(const T of v)if(!Qf(T,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,s){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(!d)return!1;if(s.type==="Polygon"){const g=ed(s.coordinates,f,d),v=Hu(r.geometry(),u,f,d);if(!Ch(u,f))return!1;for(const T of v)if(!Oh(T,g))return!1}if(s.type==="MultiPolygon"){const g=Ns(s.coordinates,f,d),v=Hu(r.geometry(),u,f,d);if(!Ch(u,f))return!1;for(const T of v)if(!g1(T,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const td={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},fy=1/298.257223563,dy=fy*(2-fy),Zu=Math.PI/180;class ru{static fromTile(e,r,s){const u=Math.PI*(1-2*(e+.5)/Math.pow(2,r)),f=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/Zu;return new ru(f,s)}static get units(){return td}constructor(e,r){if(e===void 0)throw new Error("No latitude given.");if(r&&!td[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(td).join(", ")}`);const s=6378.137*Zu*(r?td[r]:1),u=Math.cos(e*Zu),f=1/(1-dy*(1-u*u)),d=Math.sqrt(f);this.kx=s*d*u,this.ky=s*d*f*(1-dy)}distance(e,r){const s=ss(e[0]-r[0])*this.kx,u=(e[1]-r[1])*this.ky;return Math.sqrt(s*s+u*u)}bearing(e,r){const s=ss(r[0]-e[0])*this.kx;return Math.atan2(s,(r[1]-e[1])*this.ky)/Zu}destination(e,r,s){const u=s*Zu;return this.offset(e,Math.sin(u)*r,Math.cos(u)*r)}offset(e,r,s){return[e[0]+r/this.kx,e[1]+s/this.ky]}lineDistance(e){let r=0;for(let s=0;s<e.length-1;s++)r+=this.distance(e[s],e[s+1]);return r}area(e){let r=0;for(let s=0;s<e.length;s++){const u=e[s];for(let f=0,d=u.length,g=d-1;f<d;g=f++)r+=ss(u[f][0]-u[g][0])*(u[f][1]+u[g][1])*(s?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(e,r){let s=0;if(r<=0)return e[0];for(let u=0;u<e.length-1;u++){const f=e[u],d=e[u+1],g=this.distance(f,d);if(s+=g,s>r)return Xu(f,d,(r-(s-g))/g)}return e[e.length-1]}pointToSegmentDistance(e,r,s){let[u,f]=r,d=ss(s[0]-u)*this.kx,g=(s[1]-f)*this.ky;if(d!==0||g!==0){const v=(ss(e[0]-u)*this.kx*d+(e[1]-f)*this.ky*g)/(d*d+g*g);v>1?(u=s[0],f=s[1]):v>0&&(u+=d/this.kx*v,f+=g/this.ky*v)}return d=ss(e[0]-u)*this.kx,g=(e[1]-f)*this.ky,Math.sqrt(d*d+g*g)}pointOnLine(e,r){let s=1/0,u=e[0][0],f=e[0][1],d=0,g=0;for(let v=0;v<e.length-1;v++){let T=e[v][0],E=e[v][1],A=ss(e[v+1][0]-T)*this.kx,C=(e[v+1][1]-E)*this.ky,k=0;A===0&&C===0||(k=(ss(r[0]-T)*this.kx*A+(r[1]-E)*this.ky*C)/(A*A+C*C),k>1?(T=e[v+1][0],E=e[v+1][1]):k>0&&(T+=A/this.kx*k,E+=C/this.ky*k)),A=ss(r[0]-T)*this.kx,C=(r[1]-E)*this.ky;const L=A*A+C*C;L<s&&(s=L,u=T,f=E,d=v,g=k)}return{point:[u,f],index:d,t:Math.max(0,Math.min(1,g))}}lineSlice(e,r,s){let u=this.pointOnLine(s,e),f=this.pointOnLine(s,r);if(u.index>f.index||u.index===f.index&&u.t>f.t){const T=u;u=f,f=T}const d=[u.point],g=u.index+1,v=f.index;!py(s[g],d[0])&&g<=v&&d.push(s[g]);for(let T=g+1;T<=v;T++)d.push(s[T]);return py(s[v],f.point)||d.push(f.point),d}lineSliceAlong(e,r,s){let u=0;const f=[];for(let d=0;d<s.length-1;d++){const g=s[d],v=s[d+1],T=this.distance(g,v);if(u+=T,u>e&&f.length===0&&f.push(Xu(g,v,(e-(u-T))/T)),u>=r)return f.push(Xu(g,v,(r-(u-T))/T)),f;u>e&&f.push(v)}return f}bufferPoint(e,r){const s=r/this.ky,u=r/this.kx;return[e[0]-u,e[1]-s,e[0]+u,e[1]+s]}bufferBBox(e,r){const s=r/this.ky,u=r/this.kx;return[e[0]-u,e[1]-s,e[2]+u,e[3]+s]}insideBBox(e,r){return ss(e[0]-r[0])>=0&&ss(e[0]-r[2])<=0&&e[1]>=r[1]&&e[1]<=r[3]}}function py(t,e){return t[0]===e[0]&&t[1]===e[1]}function Xu(t,e,r){const s=ss(e[0]-t[0]);return[t[0]+s*r,t[1]+(e[1]-t[1])*r]}function ss(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}class fm{constructor(e=[],r=(s,u)=>s<u?-1:s>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,u=r[e];for(;e>0;){const f=e-1>>1,d=r[f];if(s(u,d)>=0)break;r[e]=d,e=f}r[e]=u}_down(e){const{data:r,compare:s}=this,u=this.length>>1,f=r[e];for(;e<u;){let d=1+(e<<1);const g=d+1;if(g<this.length&&s(r[g],r[d])<0&&(d=g),s(r[d],f)>=0)break;r[e]=r[d],e=d}r[e]=f}}var At=8192;function my(t,e){return e.dist-t.dist}const dm=100,pm=50;function _y(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function Dh(t){return t[1]-t[0]+1}function So(t,e){const r=t[1]>=t[0]&&t[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function mm(t,e){if(t[0]>t[1])return[null,null];const r=Dh(t);if(e){if(r===2)return[t,null];const s=Math.floor(r/2);return[[t[0],t[0]+s],[t[0]+s,t[1]]]}{if(r===1)return[t,null];const s=Math.floor(r/2)-1;return[[t[0],t[0]+s],[t[0]+s+1,t[1]]]}}function nu(t,e){const r=[1/0,1/0,-1/0,-1/0];if(!So(e,t.length))return r;for(let s=e[0];s<=e[1];++s)Ah(r,t[s]);return r}function Yu(t){const e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<t.length;++r)for(let s=0;s<t[r].length;++s)Ah(e,t[r][s]);return e}function Ku(t,e,r){if(_y(t)||_y(e))return NaN;let s=0,u=0;return t[2]<e[0]&&(s=e[0]-t[2]),t[0]>e[2]&&(s=t[0]-e[2]),t[1]>e[3]&&(u=t[1]-e[3]),t[3]<e[1]&&(u=e[1]-t[3]),r.distance([0,0],[s,u])}function y1(t){return 360*t-180}function v1(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function _m(t,e){const r=Math.pow(2,e.z),s=(t.y/At+e.y)/r;return[y1((t.x/At+e.x)/r),v1(s)]}function x1(t,e){const r=[];for(let s=0;s<t.length;++s)r.push(_m(t[s],e));return r}function gl(t,e,r){const s=r.pointOnLine(e,t).point;return r.distance(t,s)}function gy(t,e,r,s,u){const f=r.slice(s[0],s[1]+1);let d=1/0;for(let g=e[0];g<=e[1];++g)if((d=Math.min(d,gl(t[g],f,u)))===0)return 0;return d}function gm(t,e,r,s,u){const f=Math.min(u.pointToSegmentDistance(t,r,s),u.pointToSegmentDistance(e,r,s)),d=Math.min(u.pointToSegmentDistance(r,t,e),u.pointToSegmentDistance(s,t,e));return Math.min(f,d)}function yy(t,e,r,s,u){if(!So(e,t.length)||!So(s,r.length))return NaN;let f=1/0;for(let d=e[0];d<e[1];++d)for(let g=s[0];g<s[1];++g){if(Ph(t[d],t[d+1],r[g],r[g+1]))return 0;f=Math.min(f,gm(t[d],t[d+1],r[g],r[g+1],u))}return f}function vy(t,e,r,s,u){if(!So(e,t.length)||!So(s,r.length))return NaN;let f=1/0;for(let d=e[0];d<=e[1];++d)for(let g=s[0];g<=s[1];++g)if((f=Math.min(f,u.distance(t[d],r[g])))===0)return f;return f}function Us(t,e,r){if(Fr(t,e,!0))return 0;let s=1/0;for(const u of e){const f=u.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[f-1]&&(s=Math.min(s,r.pointToSegmentDistance(t,u[f-1],u[0])))===0||(s=Math.min(s,gl(t,u,r)))===0)return s}return s}function xy(t,e,r,s){if(!So(e,t.length))return NaN;for(let f=e[0];f<=e[1];++f)if(Fr(t[f],r,!0))return 0;let u=1/0;for(let f=e[0];f<e[1];++f)for(const d of r)for(let g=0,v=d.length,T=v-1;g<v;T=g++){if(Ph(t[f],t[f+1],d[T],d[g]))return 0;u=Math.min(u,gm(t[f],t[f+1],d[T],d[g],s))}return u}function by(t,e){for(const r of t)for(let s=0;s<=r.length-1;++s)if(Fr(r[s],e,!0))return!0;return!1}function wy(t,e,r,s=1/0){const u=Yu(t),f=Yu(e);if(s!==1/0&&Ku(u,f,r)>=s)return s;if(Ch(u,f)){if(by(t,e))return 0}else if(by(e,t))return 0;let d=s;for(const g of t)for(let v=0,T=g.length,E=T-1;v<T;E=v++)for(const A of e)for(let C=0,k=A.length,L=k-1;C<k;L=C++){if(Ph(g[E],g[v],A[L],A[C]))return 0;d=Math.min(d,gm(g[E],g[v],A[L],A[C],r))}return d}function iu(t,e,r,s,u,f,d){if(f===null||d===null)return;const g=Ku(nu(s,f),nu(u,d),r);g<e&&t.push({dist:g,range1:f,range2:d})}function b1(t,e,r,s,u=1/0){let f=Math.min(s.distance(t[0],r[0][0]),u);if(f===0)return f;const d=new fm([{dist:0,range1:[0,t.length-1],range2:[0,0]}],my),g=e?pm:dm,v=Yu(r);for(;d.length;){const T=d.pop();if(T.dist>=f)continue;const E=T.range1;if(Dh(E)<=g){if(!So(E,t.length))return NaN;if(e){const A=xy(t,E,r,s);if((f=Math.min(f,A))===0)return f}else for(let A=E[0];A<=E[1];++A){const C=Us(t[A],r,s);if((f=Math.min(f,C))===0)return f}}else{const A=mm(E,e);if(A[0]!==null){const C=Ku(nu(t,A[0]),v,s);C<f&&d.push({dist:C,range1:A[0],range2:[0,0]})}if(A[1]!==null){const C=Ku(nu(t,A[1]),v,s);C<f&&d.push({dist:C,range1:A[1],range2:[0,0]})}}}return f}function Ty(t,e,r,s,u,f=1/0){let d=Math.min(f,u.distance(t[0],r[0]));if(d===0)return d;const g=new fm([{dist:0,range1:[0,t.length-1],range2:[0,r.length-1]}],my),v=e?pm:dm,T=s?pm:dm;for(;g.length;){const E=g.pop();if(E.dist>=d)continue;const A=E.range1,C=E.range2;if(Dh(A)<=v&&Dh(C)<=T){if(!So(A,t.length)||!So(C,r.length))return NaN;if(e&&s?d=Math.min(d,yy(t,A,r,C,u)):e||s?e&&!s?d=Math.min(d,gy(r,C,t,A,u)):!e&&s&&(d=Math.min(d,gy(t,A,r,C,u))):d=Math.min(d,vy(t,A,r,C,u)),d===0)return d}else{const k=mm(A,e),L=mm(C,s);iu(g,d,u,t,r,k[0],L[0]),iu(g,d,u,t,r,k[0],L[1]),iu(g,d,u,t,r,k[1],L[0]),iu(g,d,u,t,r,k[1],L[1])}}return d}function ym(t,e,r,s,u=1/0){let f=u;const d=nu(t,[0,t.length-1]);for(const g of r)if(!(f!==1/0&&Ku(d,nu(g,[0,g.length-1]),s)>=f)&&(f=Math.min(f,Ty(t,e,g,!0,s,f)),f===0))return f;return f}function rd(t,e,r,s,u=1/0){let f=u;const d=nu(t,[0,t.length-1]);for(const g of r){if(f!==1/0&&Ku(d,Yu(g),s)>=f)continue;const v=b1(t,e,g,s,f);if(isNaN(v))return v;if((f=Math.min(f,v))===0)return f}return f}function vm(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class da{constructor(e,r){this.type=Ut,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(qu(e[1])){const s=e[1];if(s.type==="FeatureCollection"){for(let u=0;u<s.features.length;++u)if(vm(s.features[u].geometry.type))return new da(s,s.features[u].geometry)}else if(s.type==="Feature"){if(vm(s.geometry.type))return new da(s,s.geometry)}else if(vm(s.type))return new da(s,s)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const r=e.geometry(),s=e.canonicalID();if(r!=null&&s!=null){if(e.geometryType()==="Point")return function(u,f,d){const g=[];for(const T of u)for(const E of T)g.push(_m(E,f));const v=new ru(g[0][1],"meters");return d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString"?Ty(g,!1,d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",v):d.type==="MultiLineString"?ym(g,!1,d.coordinates,v):d.type==="Polygon"||d.type==="MultiPolygon"?rd(g,!1,d.type==="Polygon"?[d.coordinates]:d.coordinates,v):null}(r,s,this.geometries);if(e.geometryType()==="LineString")return function(u,f,d){const g=[];for(const T of u){const E=[];for(const A of T)E.push(_m(A,f));g.push(E)}const v=new ru(g[0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return ym(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",g,v);if(d.type==="MultiLineString"){let T=1/0;for(let E=0;E<d.coordinates.length;E++){const A=ym(d.coordinates[E],!0,g,v,T);if(isNaN(A))return A;if((T=Math.min(T,A))===0)return T}return T}if(d.type==="Polygon"||d.type==="MultiPolygon"){let T=1/0;for(let E=0;E<g.length;E++){const A=rd(g[E],!0,d.type==="Polygon"?[d.coordinates]:d.coordinates,v,T);if(isNaN(A))return A;if((T=Math.min(T,A))===0)return T}return T}return null}(r,s,this.geometries);if(e.geometryType()==="Polygon")return function(u,f,d){const g=[];for(const T of function(E,A){const C=E.length;if(C<=1)return[E];const k=[];let L,F;for(let N=0;N<C;N++){const G=uy(E[N]);G!==0&&(E[N].area=Math.abs(G),F===void 0&&(F=G<0),F===G<0?(L&&k.push(L),L=[E[N]]):L.push(E[N]))}return L&&k.push(L),k}(u)){const E=[];for(let A=0;A<T.length;++A)E.push(x1(T[A],f));g.push(E)}const v=new ru(g[0][0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return rd(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",g,v);if(d.type==="MultiLineString"){let T=1/0;for(let E=0;E<d.coordinates.length;E++){const A=rd(d.coordinates[E],!0,g,v,T);if(isNaN(A))return A;if((T=Math.min(T,A))===0)return T}return T}return d.type==="Polygon"||d.type==="MultiPolygon"?function(T,E,A){let C=1/0;for(const k of T)for(const L of E){const F=wy(k,L,A,C);if(isNaN(F))return F;if((C=Math.min(C,F))===0)return C}return C}(d.type==="Polygon"?[d.coordinates]:d.coordinates,g,v):null}(r,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Qu(t,e){switch(t){case"string":return Fs(e);case"number":return+e;case"boolean":return!!e;case"color":return Gr.parse(e);case"formatted":return Oi.fromString(Fs(e));case"resolvedImage":return Go.fromString(Fs(e))}return e}function Eo(t,e,r,s){return s!==void 0&&(t=s*Math.round(t/s)),e!==void 0&&t<e&&(t=e),r!==void 0&&t>r&&(t=r),t}class Va{constructor(e,r,s){this.type=e,this.key=r,this.scope=s}static parse(e,r){let s=r.expectedType;if(s==null&&(s=Cr),e.length<2||e.length>3)return r.error("Invalid number of arguments for 'config' expression.");const u=r.parse(e[1],1);if(!(u instanceof Ua))return r.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const f=r.parse(e[2],2);return f instanceof Ua?new Va(s,Fs(u.value),Fs(f.value)):r.error("Scope of 'config' expression must be a string literal.")}return new Va(s,Fs(u.value))}evaluate(e){const r=[this.key,this.scope,e.scope].filter(Boolean).join(""),s=e.getConfig(r);if(!s)return null;const{type:u,value:f,values:d,minValue:g,maxValue:v,stepValue:T}=s,E=s.default.evaluate(e);let A=E;if(f){const C=e.scope;e.scope=(C||"").split("").slice(1).join(""),A=f.evaluate(e),e.scope=C}return u&&(A=Qu(u,A)),A===void 0||g===void 0&&v===void 0&&T===void 0||(typeof A=="number"?A=Eo(A,g,v,T):Array.isArray(A)&&(A=A.map(C=>typeof C=="number"?Eo(C,g,v,T):C))),f!==void 0&&A!==void 0&&d&&!d.includes(A)&&(A=E,u&&(A=Qu(u,A))),(u&&u!==this.type||A!==void 0&&qn(A)!==this.type)&&(A=Qu(this.type.kind,A)),A}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Rh(t){if(t instanceof Qi&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof ja||t instanceof da)return!1;let e=!0;return t.eachChild(r=>{e&&!Rh(r)&&(e=!1)}),e}function nd(t){if(t instanceof Qi&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(r=>{e&&!nd(r)&&(e=!1)}),e}function xm(t){if(t instanceof Va)return!1;let e=!0;return t.eachChild(r=>{e&&!xm(r)&&(e=!1)}),e}function kh(t,e){if(t instanceof Qi&&e.indexOf(t.name)>=0)return!1;let r=!0;return t.eachChild(s=>{r&&!kh(s,e)&&(r=!1)}),r}class Ju{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new Ju(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class bm{constructor(e,r=[],s,u=new am,f=[],d,g){this.registry=e,this.path=r,this.key=r.map(v=>`[${v}]`).join(""),this.scope=u,this.errors=f,this.expectedType=s,this._scope=d,this.options=g}parse(e,r,s,u,f={}){return r||s?this.concat(r,s,u)._parse(e,f):this._parse(e,f)}_parse(e,r){function s(u,f,d){return d==="assert"?new Bs(f,[u]):d==="coerce"?new fa(f,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let f=u.parse(e,this);if(!f)return null;if(this.expectedType){const d=this.expectedType,g=f.type;if(d.kind!=="string"&&d.kind!=="number"&&d.kind!=="boolean"&&d.kind!=="object"&&d.kind!=="array"||g.kind!=="value")if(d.kind!=="color"&&d.kind!=="formatted"&&d.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(d,g))return null}else f=s(f,d,r.typeAnnotation||"coerce");else f=s(f,d,r.typeAnnotation||"assert")}if(!(f instanceof Ua)&&f.type.kind!=="resolvedImage"&&wm(f)){const d=new Kf(this._scope,this.options);try{f=new Ua(f.type,f.evaluate(d))}catch(g){return this.error(g.message),null}}return f}return fa.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const u=typeof e=="number"?this.path.concat(e):this.path,f=s?this.scope.concat(s):this.scope;return new bm(this.registry,u,r||null,f,this.errors,this._scope,this.options)}error(e,...r){const s=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new ca(s,e))}checkSubtype(e,r){const s=bh(e,r);return s&&this.error(s),s}}var id=bm;function wm(t){if(t instanceof Ju)return wm(t.boundExpression);if(t instanceof Qi&&t.name==="error"||t instanceof Mh||t instanceof ja||t instanceof da||t instanceof Va)return!1;const e=t instanceof fa||t instanceof Bs;let r=!0;return t.eachChild(s=>{r=e?r&&wm(s):r&&s instanceof Ua}),!!r&&Rh(t)&&kh(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function od(t,e){const r=t.length-1;let s,u,f=0,d=r,g=0;for(;f<=d;)if(g=Math.floor((f+d)/2),s=t[g],u=t[g+1],s<=e){if(g===r||e<u)return g;f=g+1}else{if(!(s>e))throw new yi("Input is not a number.");d=g-1}return 0}class ou{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[u,f]of s)this.labels.push(u),this.outputs.push(f)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,Ut);if(!s)return null;const u=[];let f=null;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);for(let d=1;d<e.length;d+=2){const g=d===1?-1/0:e[d],v=e[d+1],T=d,E=d+1;if(typeof g!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(u.length&&u[u.length-1][0]>=g)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const A=r.parse(v,E,f);if(!A)return null;f=f||A.type,u.push([g,A])}return new ou(f,s,u)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return s[0].evaluate(e);const f=r.length;return u>=r[f-1]?s[f-1].evaluate(e):s[od(r,u)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}const Sy=.95047,Tm=1.08883,Sm=4/29,ec=6/29,sd=3*ec*ec,ad=ec*ec*ec,Ey=Math.PI/180,w1=180/Math.PI;function ld(t){return t>ad?Math.pow(t,1/3):t/sd+Sm}function Em(t){return t>ec?t*t*t:sd*(t-Sm)}function Lh(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Mm(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function My(t){const e=Mm(t.r),r=Mm(t.g),s=Mm(t.b),u=ld((.4124564*e+.3575761*r+.1804375*s)/Sy),f=ld((.2126729*e+.7151522*r+.072175*s)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-ld((.0193339*e+.119192*r+.9503041*s)/Tm)),alpha:t.a}}function Iy(t){let e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*Em(e),r=Sy*Em(r),s=Tm*Em(s),new Gr(Lh(3.2404542*r-1.5371385*e-.4985314*s),Lh(-.969266*r+1.8760108*e+.041556*s),Lh(.0556434*r-.2040259*e+1.0572252*s),t.alpha)}function T1(t,e,r){const s=e-t;return t+r*(s>180||s<-180?s-360*Math.round(s/360):s)}const tc={forward:My,reverse:Iy,interpolate:function(t,e,r){return{l:nr(t.l,e.l,r),a:nr(t.a,e.a,r),b:nr(t.b,e.b,r),alpha:nr(t.alpha,e.alpha,r)}}},zh={forward:function(t){const{l:e,a:r,b:s}=My(t),u=Math.atan2(s,r)*w1;return{h:u<0?u+360:u,c:Math.sqrt(r*r+s*s),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Ey,r=t.c;return Iy({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:T1(t.h,e.h,r),c:nr(t.c,e.c,r),l:nr(t.l,e.l,r),alpha:nr(t.alpha,e.alpha,r)}}};var Ay=Object.freeze({__proto__:null,hcl:zh,lab:tc});class Wo{constructor(e,r,s,u,f){this.type=e,this.operator=r,this.interpolation=s,this.input=u,this.labels=[],this.outputs=[];for(const[d,g]of f)this.labels.push(d),this.outputs.push(g)}static interpolationFactor(e,r,s,u){let f=0;if(e.name==="exponential")f=Im(r,e.base,s,u);else if(e.name==="linear")f=Im(r,1,s,u);else if(e.name==="cubic-bezier"){const d=e.controlPoints;f=new la(d[0],d[1],d[2],d[3]).solve(Im(r,1,s,u))}return f}static parse(e,r){let[s,u,f,...d]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const T=u[1];if(typeof T!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:T}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const T=u.slice(1);if(T.length!==4||T.some(E=>typeof E!="number"||E<0||E>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(f=r.parse(f,2,Ut),!f)return null;const g=[];let v=null;s==="interpolate-hcl"||s==="interpolate-lab"?v=os:r.expectedType&&r.expectedType.kind!=="value"&&(v=r.expectedType);for(let T=0;T<d.length;T+=2){const E=d[T],A=d[T+1],C=T+3,k=T+4;if(typeof E!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(g.length&&g[g.length-1][0]>=E)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',C);const L=r.parse(A,k,v);if(!L)return null;v=v||L.type,g.push([E,L])}return v.kind==="number"||v.kind==="color"||v.kind==="array"&&v.itemType.kind==="number"&&typeof v.N=="number"?new Wo(v,s,u,f,g):r.error(`Type ${Nn(v)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return s[0].evaluate(e);const f=r.length;if(u>=r[f-1])return s[f-1].evaluate(e);const d=od(r,u),g=Wo.interpolationFactor(this.interpolation,u,r[d],r[d+1]),v=s[d].evaluate(e),T=s[d+1].evaluate(e);return this.operator==="interpolate"?Xf[this.type.kind.toLowerCase()](v,T,g):this.operator==="interpolate-hcl"?zh.reverse(zh.interpolate(zh.forward(v),zh.forward(T),g)):tc.reverse(tc.interpolate(tc.forward(v),tc.forward(T),g))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)r.push(this.labels[s],this.outputs[s].serialize());return r}}function Im(t,e,r,s){const u=s-r,f=t-r;return u===0?0:e===1?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}class ud{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const u=r.expectedType;u&&u.kind!=="value"&&(s=u);const f=[];for(const g of e.slice(1)){const v=r.parse(g,1+f.length,s,void 0,{typeAnnotation:"omit"});if(!v)return null;s=s||v.type,f.push(v)}const d=u&&f.some(g=>bh(u,g.type));return new ud(d?Cr:s,f)}evaluate(e){let r,s=null,u=0;for(const f of this.args){if(u++,s=f.evaluate(e),s&&s instanceof Go&&!s.available&&(r||(r=s),s=null,u===this.args.length))return r;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class cd{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let f=1;f<e.length-1;f+=2){const d=e[f];if(typeof d!="string")return r.error(`Expected string, but found ${typeof d} instead.`,f);if(/[^a-zA-Z0-9_]/.test(d))return r.error("Variable names must contain only alphanumeric characters or '_'.",f);const g=r.parse(e[f+1],f+1);if(!g)return null;s.push([d,g])}const u=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return u?new cd(s,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,s]of this.bindings)e.push(r,s.serialize());return e.push(this.result.serialize()),e}}class Am{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Ut),u=r.parse(e[2],2,To(r.expectedType||Cr));return s&&u?new Am(u.type.itemType,s,u):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new yi(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new yi(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new yi(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Cm{constructor(e,r){this.type=jr,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Cr),u=r.parse(e[2],2,Cr);return s&&u?Yf(s.type,[jr,Wr,Ut,Ls,Cr])?new Cm(s,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nn(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!eu(r,["boolean","string","number","null"]))throw new yi(`Expected first argument to be of type boolean, string, number or null, but found ${Nn(qn(r))} instead.`);if(!eu(s,["string","array"]))throw new yi(`Expected second argument to be of type array or string, but found ${Nn(qn(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class su{constructor(e,r,s){this.type=Ut,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Cr),u=r.parse(e[2],2,Cr);if(!s||!u)return null;if(!Yf(s.type,[jr,Wr,Ut,Ls,Cr]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Nn(s.type)} instead`);if(e.length===4){const f=r.parse(e[3],3,Ut);return f?new su(s,u,f):null}return new su(s,u)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!eu(r,["boolean","string","number","null"]))throw new yi(`Expected first argument to be of type boolean, string, number or null, but found ${Nn(qn(r))} instead.`);if(!eu(s,["string","array"]))throw new yi(`Expected second argument to be of type array or string, but found ${Nn(qn(s))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return s.indexOf(r,u)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Pm{constructor(e,r,s,u,f,d){this.inputType=e,this.type=r,this.input=s,this.cases=u,this.outputs=f,this.otherwise=d}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const f={},d=[];for(let T=2;T<e.length-1;T+=2){let E=e[T];const A=e[T+1];Array.isArray(E)||(E=[E]);const C=r.concat(T);if(E.length===0)return C.error("Expected at least one branch label.");for(const L of E){if(typeof L!="number"&&typeof L!="string")return C.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return C.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return C.error("Numeric branch labels must be integer values.");if(s){if(C.checkSubtype(s,qn(L)))return null}else s=qn(L);if(f[String(L)]!==void 0)return C.error("Branch labels must be unique.");f[String(L)]=d.length}const k=r.parse(A,T,u);if(!k)return null;u=u||k.type,d.push(k)}const g=r.parse(e[1],1,Cr);if(!g)return null;const v=r.parse(e[e.length-1],e.length-1,u);return v?g.type.kind!=="value"&&r.concat(1).checkSubtype(s,g.type)?null:new Pm(s,u,g,f,d,v):null}evaluate(e){const r=this.input.evaluate(e);return(qn(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),s=[],u={};for(const d of r){const g=u[this.cases[d]];g===void 0?(u[this.cases[d]]=s.length,s.push([this.cases[d],[d]])):s[g][1].push(d)}const f=d=>this.inputType.kind==="number"?Number(d):d;for(const[d,g]of s)e.push(g.length===1?f(g[0]):g.map(f)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}class Om{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const u=[];for(let d=1;d<e.length-1;d+=2){const g=r.parse(e[d],d,jr);if(!g)return null;const v=r.parse(e[d+1],d+1,s);if(!v)return null;u.push([g,v]),s=s||v.type}const f=r.parse(e[e.length-1],e.length-1,s);return f?new Om(s,u,f):null}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class au{constructor(e,r,s,u){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Cr),u=r.parse(e[2],2,Ut);if(!s||!u)return null;if(!Yf(s.type,[To(Cr),Wr,Cr]))return r.error(`Expected first argument to be of type array or string, but found ${Nn(s.type)} instead`);if(e.length===4){const f=r.parse(e[3],3,Ut);return f?new au(s.type,s,u,f):null}return new au(s.type,s,u)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!eu(r,["string","array"]))throw new yi(`Expected first argument to be of type array or string, but found ${Nn(qn(r))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return r.slice(s,u)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Cy(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Dm(t,e,r,s){return s.compare(e,r)===0}function rc(t,e,r){const s=t!=="=="&&t!=="!=";return class Dk{constructor(f,d,g){this.type=jr,this.lhs=f,this.rhs=d,this.collator=g,this.hasUntypedArgument=f.type.kind==="value"||d.type.kind==="value"}static parse(f,d){if(f.length!==3&&f.length!==4)return d.error("Expected two or three arguments.");const g=f[0];let v=d.parse(f[1],1,Cr);if(!v)return null;if(!Cy(g,v.type))return d.concat(1).error(`"${g}" comparisons are not supported for type '${Nn(v.type)}'.`);let T=d.parse(f[2],2,Cr);if(!T)return null;if(!Cy(g,T.type))return d.concat(2).error(`"${g}" comparisons are not supported for type '${Nn(T.type)}'.`);if(v.type.kind!==T.type.kind&&v.type.kind!=="value"&&T.type.kind!=="value")return d.error(`Cannot compare types '${Nn(v.type)}' and '${Nn(T.type)}'.`);s&&(v.type.kind==="value"&&T.type.kind!=="value"?v=new Bs(T.type,[v]):v.type.kind!=="value"&&T.type.kind==="value"&&(T=new Bs(v.type,[T])));let E=null;if(f.length===4){if(v.type.kind!=="string"&&T.type.kind!=="string"&&v.type.kind!=="value"&&T.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(E=d.parse(f[3],3,vh),!E)return null}return new Dk(v,T,E)}evaluate(f){const d=this.lhs.evaluate(f),g=this.rhs.evaluate(f);if(s&&this.hasUntypedArgument){const v=qn(d),T=qn(g);if(v.kind!==T.kind||v.kind!=="string"&&v.kind!=="number")throw new yi(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${v.kind}, ${T.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const v=qn(d),T=qn(g);if(v.kind!=="string"||T.kind!=="string")return e(f,d,g)}return this.collator?r(f,d,g,this.collator.evaluate(f)):e(f,d,g)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[t];return this.eachChild(d=>{f.push(d.serialize())}),f}}}const Py=rc("==",function(t,e,r){return e===r},Dm),Oy=rc("!=",function(t,e,r){return e!==r},function(t,e,r,s){return!Dm(0,e,r,s)}),Dy=rc("<",function(t,e,r){return e<r},function(t,e,r,s){return s.compare(e,r)<0}),Ry=rc(">",function(t,e,r){return e>r},function(t,e,r,s){return s.compare(e,r)>0}),Rm=rc("<=",function(t,e,r){return e<=r},function(t,e,r,s){return s.compare(e,r)<=0}),km=rc(">=",function(t,e,r){return e>=r},function(t,e,r,s){return s.compare(e,r)>=0});class Lm{constructor(e,r,s,u,f,d){this.type=Wr,this.number=e,this.locale=r,this.currency=s,this.unit=u,this.minFractionDigits=f,this.maxFractionDigits=d}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Ut);if(!s)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=r.parse(u.locale,1,Wr),!f))return null;let d=null;if(u.currency&&(d=r.parse(u.currency,1,Wr),!d))return null;let g=null;if(u.unit&&(g=r.parse(u.unit,1,Wr),!g))return null;let v=null;if(u["min-fraction-digits"]&&(v=r.parse(u["min-fraction-digits"],1,Ut),!v))return null;let T=null;return u["max-fraction-digits"]&&(T=r.parse(u["max-fraction-digits"],1,Ut),!T)?null:new Lm(s,f,d,g,v,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class zm{constructor(e){this.type=Ut,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Nn(s.type)} instead.`):new zm(s):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new yi(`Expected value to be of type string or array, but found ${Nn(qn(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}function Fm(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const nc={"==":Py,"!=":Oy,">":Ry,"<":Dy,">=":km,"<=":Rm,array:Bs,at:Am,boolean:Bs,case:Om,coalesce:ud,collator:Mh,format:Th,image:Sh,in:Cm,"index-of":su,interpolate:Wo,"interpolate-hcl":Wo,"interpolate-lab":Wo,length:zm,let:cd,literal:Ua,match:Pm,number:Bs,"number-format":Lm,object:Bs,slice:au,step:ou,string:Bs,"to-boolean":fa,"to-color":fa,"to-number":fa,"to-string":fa,var:Ju,within:ja,distance:da,config:Va};function ky(t,[e,r,s,u]){e=e.evaluate(t),r=r.evaluate(t),s=s.evaluate(t);const f=u?u.evaluate(t):1,d=zs(e,r,s,f);if(d)throw new yi(d);return new Gr(e/255*f,r/255*f,s/255*f,f)}function Ly(t,[e,r,s,u]){e=e.evaluate(t),r=r.evaluate(t),s=s.evaluate(t);const f=u?u.evaluate(t):1,d=function(T,E,A,C){return typeof T=="number"&&T>=0&&T<=360?typeof E=="number"&&E>=0&&E<=100&&typeof A=="number"&&A>=0&&A<=100?C===void 0||typeof C=="number"&&C>=0&&C<=1?null:`Invalid hsla value [${[T,E,A,C].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof C=="number"?[T,E,A,C]:[T,E,A]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof C=="number"?[T,E,A,C]:[T,E,A]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,s,f);if(d)throw new yi(d);const g=`hsla(${e}, ${r}%, ${s}%, ${f})`,v=Gr.parse(g);if(!v)throw new yi(`Failed to parse HSLA color: ${g}`);return v}function zy(t,e){return t in e}function Bm(t,e){const r=e[t];return r===void 0?null:r}function lu(t){return{type:t}}function Fy(t){return{result:"success",value:t}}function uu(t){return{result:"error",value:t}}function By(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function Nm(t){return t["property-type"]==="data-driven"}function p(t){return By(t.expression,"measure-light")}function i(t){return By(t.expression,"zoom")}function c(t){return!!t.expression&&t.expression.interpolated}function _(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function x(t){return t}function w(t,e){const r=e.type==="color",s=t.stops&&typeof t.stops[0][0]=="object",u=s||!(s||t.property!==void 0),f=t.type||(c(e)?"exponential":"interval");if(r&&((t=sm({},t)).stops&&(t.stops=t.stops.map(T=>[T[0],Gr.parse(T[1])])),t.default=Gr.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Ay[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let d,g,v;if(f==="exponential")d=D;else if(f==="interval")d=O;else if(f==="categorical"){d=I,g=Object.create(null);for(const T of t.stops)g[T[0]]=T[1];v=typeof t.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);d=z}if(s){const T={},E=[];for(let k=0;k<t.stops.length;k++){const L=t.stops[k],F=L[0].zoom;T[F]===void 0&&(T[F]={zoom:F,type:t.type,property:t.property,default:t.default,stops:[]},E.push(F)),T[F].stops.push([L[0].value,L[1]])}const A=[];for(const k of E)A.push([T[k].zoom,w(T[k],e)]);const C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:Wo.interpolationFactor.bind(void 0,C),zoomStops:A.map(k=>k[0]),evaluate:({zoom:k},L)=>D({stops:A,base:t.base},e,k).evaluate(k,L)}}if(u){const T=f==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:Wo.interpolationFactor.bind(void 0,T),zoomStops:t.stops.map(E=>E[0]),evaluate:({zoom:E})=>d(t,e,E,g,v)}}return{kind:"source",evaluate(T,E){const A=E&&E.properties?E.properties[t.property]:void 0;return A===void 0?S(t.default,e.default):d(t,e,A,g,v)}}}function S(t,e,r){return t!==void 0?t:e!==void 0?e:r!==void 0?r:void 0}function I(t,e,r,s,u){return S(typeof r===u?s[r]:void 0,t.default,e.default)}function O(t,e,r){if(tu(r)!=="number")return S(t.default,e.default);const s=t.stops.length;if(s===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[s-1][0])return t.stops[s-1][1];const u=od(t.stops.map(f=>f[0]),r);return t.stops[u][1]}function D(t,e,r){const s=t.base!==void 0?t.base:1;if(tu(r)!=="number")return S(t.default,e.default);const u=t.stops.length;if(u===1||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[u-1][0])return t.stops[u-1][1];const f=od(t.stops.map(E=>E[0]),r),d=function(E,A,C,k){const L=k-C,F=E-C;return L===0?0:A===1?F/L:(Math.pow(A,F)-1)/(Math.pow(A,L)-1)}(r,s,t.stops[f][0],t.stops[f+1][0]),g=t.stops[f][1],v=t.stops[f+1][1];let T=Xf[e.type]||x;if(t.colorSpace&&t.colorSpace!=="rgb"){const E=Ay[t.colorSpace];T=(A,C)=>E.reverse(E.interpolate(E.forward(A),E.forward(C),d))}return typeof g.evaluate=="function"?{evaluate(...E){const A=g.evaluate.apply(void 0,E),C=v.evaluate.apply(void 0,E);if(A!==void 0&&C!==void 0)return T(A,C,d)}}:T(g,v,d)}function z(t,e,r){return e.type==="color"?r=Gr.parse(r):e.type==="formatted"?r=Oi.fromString(r.toString()):e.type==="resolvedImage"?r=Go.fromString(r.toString()):tu(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),S(r,t.default,e.default)}Qi.register(nc,{error:[{kind:"error"},[Wr],(t,[e])=>{throw new yi(e.evaluate(t))}],typeof:[Wr,[Cr],(t,[e])=>Nn(qn(e.evaluate(t)))],"to-rgba":[To(Ut,4),[os],(t,[e])=>e.evaluate(t).toRenderColor(null).toArray()],rgb:[os,[Ut,Ut,Ut],ky],rgba:[os,[Ut,Ut,Ut,Ut],ky],hsl:[os,[Ut,Ut,Ut],Ly],hsla:[os,[Ut,Ut,Ut,Ut],Ly],has:{type:jr,overloads:[[[Wr],(t,[e])=>zy(e.evaluate(t),t.properties())],[[Wr,Gu],(t,[e,r])=>zy(e.evaluate(t),r.evaluate(t))]]},get:{type:Cr,overloads:[[[Wr],(t,[e])=>Bm(e.evaluate(t),t.properties())],[[Wr,Gu],(t,[e,r])=>Bm(e.evaluate(t),r.evaluate(t))]]},"feature-state":[Cr,[Wr],(t,[e])=>Bm(e.evaluate(t),t.featureState||{})],properties:[Gu,[],t=>t.properties()],"geometry-type":[Wr,[],t=>t.geometryType()],id:[Cr,[],t=>t.id()],zoom:[Ut,[],t=>t.globals.zoom],pitch:[Ut,[],t=>t.globals.pitch||0],"distance-from-center":[Ut,[],t=>t.distanceFromCenter()],"measure-light":[Ut,[Wr],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[Ut,[],t=>t.globals.heatmapDensity||0],"line-progress":[Ut,[],t=>t.globals.lineProgress||0],"raster-value":[Ut,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[Ut,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[Ut,[],t=>t.globals.skyRadialProgress||0],accumulated:[Cr,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Ut,lu(Ut),(t,e)=>{let r=0;for(const s of e)r+=s.evaluate(t);return r}],"*":[Ut,lu(Ut),(t,e)=>{let r=1;for(const s of e)r*=s.evaluate(t);return r}],"-":{type:Ut,overloads:[[[Ut,Ut],(t,[e,r])=>e.evaluate(t)-r.evaluate(t)],[[Ut],(t,[e])=>-e.evaluate(t)]]},"/":[Ut,[Ut,Ut],(t,[e,r])=>e.evaluate(t)/r.evaluate(t)],"%":[Ut,[Ut,Ut],(t,[e,r])=>e.evaluate(t)%r.evaluate(t)],ln2:[Ut,[],()=>Math.LN2],pi:[Ut,[],()=>Math.PI],e:[Ut,[],()=>Math.E],"^":[Ut,[Ut,Ut],(t,[e,r])=>Math.pow(e.evaluate(t),r.evaluate(t))],sqrt:[Ut,[Ut],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Ut,[Ut],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Ut,[Ut],(t,[e])=>Math.log(e.evaluate(t))],log2:[Ut,[Ut],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Ut,[Ut],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Ut,[Ut],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Ut,[Ut],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Ut,[Ut],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Ut,[Ut],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Ut,[Ut],(t,[e])=>Math.atan(e.evaluate(t))],min:[Ut,lu(Ut),(t,e)=>Math.min(...e.map(r=>r.evaluate(t)))],max:[Ut,lu(Ut),(t,e)=>Math.max(...e.map(r=>r.evaluate(t)))],abs:[Ut,[Ut],(t,[e])=>Math.abs(e.evaluate(t))],round:[Ut,[Ut],(t,[e])=>{const r=e.evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ut,[Ut],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Ut,[Ut],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[jr,[Wr,Cr],(t,[e,r])=>t.properties()[e.value]===r.value],"filter-id-==":[jr,[Cr],(t,[e])=>t.id()===e.value],"filter-type-==":[jr,[Wr],(t,[e])=>t.geometryType()===e.value],"filter-<":[jr,[Wr,Cr],(t,[e,r])=>{const s=t.properties()[e.value],u=r.value;return typeof s==typeof u&&s<u}],"filter-id-<":[jr,[Cr],(t,[e])=>{const r=t.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[jr,[Wr,Cr],(t,[e,r])=>{const s=t.properties()[e.value],u=r.value;return typeof s==typeof u&&s>u}],"filter-id->":[jr,[Cr],(t,[e])=>{const r=t.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[jr,[Wr,Cr],(t,[e,r])=>{const s=t.properties()[e.value],u=r.value;return typeof s==typeof u&&s<=u}],"filter-id-<=":[jr,[Cr],(t,[e])=>{const r=t.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[jr,[Wr,Cr],(t,[e,r])=>{const s=t.properties()[e.value],u=r.value;return typeof s==typeof u&&s>=u}],"filter-id->=":[jr,[Cr],(t,[e])=>{const r=t.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[jr,[Cr],(t,[e])=>e.value in t.properties()],"filter-has-id":[jr,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[jr,[To(Wr)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[jr,[To(Cr)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[jr,[Wr,To(Cr)],(t,[e,r])=>r.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[jr,[Wr,To(Cr)],(t,[e,r])=>function(s,u,f,d){for(;f<=d;){const g=f+d>>1;if(u[g]===s)return!0;u[g]>s?d=g-1:f=g+1}return!1}(t.properties()[e.value],r.value,0,r.value.length-1)],all:{type:jr,overloads:[[[jr,jr],(t,[e,r])=>e.evaluate(t)&&r.evaluate(t)],[lu(jr),(t,e)=>{for(const r of e)if(!r.evaluate(t))return!1;return!0}]]},any:{type:jr,overloads:[[[jr,jr],(t,[e,r])=>e.evaluate(t)||r.evaluate(t)],[lu(jr),(t,e)=>{for(const r of e)if(r.evaluate(t))return!0;return!1}]]},"!":[jr,[jr],(t,[e])=>!e.evaluate(t)],"is-supported-script":[jr,[Wr],(t,[e])=>{const r=t.globals&&t.globals.isSupportedScript;return!r||r(e.evaluate(t))}],upcase:[Wr,[Wr],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Wr,[Wr],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Wr,lu(Cr),(t,e)=>e.map(r=>Fs(r.evaluate(t))).join("")],"resolved-locale":[Wr,[vh],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[Ut,[Ut,Ut,Cr],(t,e)=>{const[r,s,u]=e.map(d=>d.evaluate(t));if(r>s||r===s)return r;let f;if(typeof u=="string")f=function(d){let g=0;if(d.length===0)return g;for(let v=0;v<d.length;v++)g=(g<<5)-g+d.charCodeAt(v),g|=0;return g}(u);else{if(typeof u!="number")throw new yi(`Invalid seed input: ${u}`);f=u}return r+Fm(f)()*(s-r)}]});class B{constructor(e,r,s,u){this.expression=e,this._warningHistory={},this._evaluator=new Kf(s,u),this._defaultValue=r?function(f){return f.type==="color"&&(_(f.default)||Array.isArray(f.default))?new Gr(0,0,0,0):f.type==="color"?Gr.parse(f.default)||null:f.default===void 0?null:f.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,s,u,f,d,g,v){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=v||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,u,f,d,g,v){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=v||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new yi(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function j(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in nc}function $(t,e,r,s){const u=new id(nc,[],e?function(d){const g={color:os,string:Wr,number:Ut,enum:Wr,boolean:jr,formatted:ha,resolvedImage:xh};return d.type==="array"?To(g[d.value]||Cr,d.length):g[d.type]}(e):void 0,void 0,void 0,r,s),f=u.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Fy(new B(f,e,r,s)):uu(u.errors)}class H{constructor(e,r,s){this.kind=e,this._styleExpression=r,this.isLightConstant=s,this.isStateDependent=e!=="constant"&&!nd(r.expression),this.isConfigDependent=!xm(r.expression)}evaluateWithoutErrorHandling(e,r,s,u,f,d){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,u,f,d)}evaluate(e,r,s,u,f,d){return this._styleExpression.evaluate(e,r,s,u,f,d)}}class X{constructor(e,r,s,u,f){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!nd(r.expression),this.isLightConstant=f,this.isConfigDependent=!xm(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,r,s,u,f,d){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,u,f,d)}evaluate(e,r,s,u,f,d){return this._styleExpression.evaluate(e,r,s,u,f,d)}interpolationFactor(e,r,s){return this.interpolationType?Wo.interpolationFactor(this.interpolationType,e,r,s):0}}function Y(t,e,r,s){if((t=$(t,e,r,s)).result==="error")return t;const u=t.value.expression,f=Rh(u);if(!f&&!Nm(e))return uu([new ca("","data expressions not supported")]);const d=kh(u,["zoom","pitch","distance-from-center"]);if(!d&&!i(e))return uu([new ca("","zoom expressions not supported")]);const g=kh(u,["measure-light"]);if(!g&&!p(e))return uu([new ca("","measure-light expression not supported")]);const v=e.expression&&e.expression.relaxZoomRestriction,T=ue(u);return T||d||v?T instanceof ca?uu([T]):T instanceof Wo&&!c(e)?uu([new ca("",'"interpolate" expressions cannot be used with this property')]):Fy(T?new X(f?"camera":"composite",t.value,T.labels,T instanceof Wo?T.interpolation:void 0,g):new H(f?"constant":"source",t.value,g)):uu([new ca("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class K{constructor(e,r){this._parameters=e,this._specification=r,sm(this,w(this._parameters,this._specification))}static deserialize(e){return new K(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ue(t){let e=null;if(t instanceof cd)e=ue(t.result);else if(t instanceof ud){for(const r of t.args)if(e=ue(r),e)break}else(t instanceof ou||t instanceof Wo)&&t.input instanceof Qi&&t.input.name==="zoom"&&(e=t);return e instanceof ca||t.eachChild(r=>{const s=ue(r);s instanceof ca?e=s:e&&s&&e!==s&&(e=new ca("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var ce=ge,he=3;function ge(t,e,r){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var u=new Int32Array(this.arrayBuffer);t=u[0],this.d=(e=u[1])+2*(r=u[2]);for(var f=0;f<this.d*this.d;f++){var d=u[he+f],g=u[he+f+1];s.push(d===g?null:u.subarray(d,g))}var v=u[he+s.length+1];this.keys=u.subarray(u[he+s.length],v),this.bboxes=u.subarray(v),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var T=0;T<this.d*this.d;T++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var E=r/e*t;this.min=-E,this.max=t+E}ge.prototype.insert=function(t,e,r,s,u){this._forEachCell(e,r,s,u,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(u)},ge.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ge.prototype._insertCell=function(t,e,r,s,u,f){this.cells[u].push(f)},ge.prototype.query=function(t,e,r,s,u){var f=this.min,d=this.max;if(t<=f&&e<=f&&d<=r&&d<=s&&!u)return Array.prototype.slice.call(this.keys);var g=[];return this._forEachCell(t,e,r,s,this._queryCell,g,{},u),g},ge.prototype._queryCell=function(t,e,r,s,u,f,d,g){var v=this.cells[u];if(v!==null)for(var T=this.keys,E=this.bboxes,A=0;A<v.length;A++){var C=v[A];if(d[C]===void 0){var k=4*C;(g?g(E[k+0],E[k+1],E[k+2],E[k+3]):t<=E[k+2]&&e<=E[k+3]&&r>=E[k+0]&&s>=E[k+1])?(d[C]=!0,f.push(T[C])):d[C]=!1}}},ge.prototype._forEachCell=function(t,e,r,s,u,f,d,g){for(var v=this._convertToCellCoord(t),T=this._convertToCellCoord(e),E=this._convertToCellCoord(r),A=this._convertToCellCoord(s),C=v;C<=E;C++)for(var k=T;k<=A;k++){var L=this.d*k+C;if((!g||g(this._convertFromCellCoord(C),this._convertFromCellCoord(k),this._convertFromCellCoord(C+1),this._convertFromCellCoord(k+1)))&&u.call(this,t,e,r,s,L,f,d,g))return}},ge.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ge.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ge.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=he+this.cells.length+1+1,r=0,s=0;s<this.cells.length;s++)r+=this.cells[s].length;var u=new Int32Array(e+r+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var f=e,d=0;d<t.length;d++){var g=t[d];u[he+d]=f,u.set(g,f),f+=g.length}return u[he+t.length]=f,u.set(this.keys,f),u[he+t.length+1]=f+=this.keys.length,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer};var _e=le(ce);const Se={};function ee(t,e,r={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writable:!1}),Se[e]={klass:t,omit:r.omit||[]}}ee(Object,"Object"),_e.serialize=function(t,e){const r=t.toArrayBuffer();return e&&e.add(r),{buffer:r}},_e.deserialize=function(t){return new _e(t.buffer)},Object.defineProperty(_e,"name",{value:"Grid"}),ee(_e,"Grid"),ee(Gr,"Color"),ee(Error,"Error"),ee(Oi,"Formatted"),ee(wh,"FormattedSection"),ee(jf,"AJAXError"),ee(Go,"ResolvedImage"),ee(K,"StylePropertyFunction"),ee(B,"StyleExpression",{omit:["_evaluator"]}),ee(X,"ZoomDependentExpression"),ee(H,"ZoomConstantExpression"),ee(Qi,"CompoundExpression",{omit:["_evaluate"]});for(const t in nc)Se[nc[t]._classRegistryKey]||ee(nc[t],`Expression${t}`);function fe(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Pe(t){return self.ImageBitmap&&t instanceof ImageBitmap}function We(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(fe(t)||Pe(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const r=t;return e&&e.add(r.buffer),r}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const r=[];for(const s of t)r.push(We(s,e));return r}if(t instanceof Map){const r={$name:"Map"};for(const[s,u]of t.entries())r[s]=We(u);return r}if(typeof t=="object"){const r=t.constructor,s=r._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const u=r.serialize?r.serialize(t,e):{};if(!r.serialize){for(const f in t)t.hasOwnProperty(f)&&(Se[s].omit.indexOf(f)>=0||(u[f]=We(t[f],e)));t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof t)}function ke(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||fe(t)||Pe(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(ke);if(typeof t=="object"){const e=t.$name||"Object";if(e==="Map"){const u=new Map;for(const f of Object.keys(t))f!=="$name"&&u.set(f,ke(t[f]));return u}const{klass:r}=Se[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(t);const s=Object.create(r.prototype);for(const u of Object.keys(t))u!=="$name"&&(s[u]=ke(t[u]));return s}throw new Error("can't deserialize object of type "+typeof t)}const be={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Xe(t){for(const e of t)if(ft(e.charCodeAt(0)))return!0;return!1}function dt(t){for(const e of t)if(!pt(e.charCodeAt(0)))return!1;return!0}function pt(t){return!(be.Arabic(t)||be["Arabic Supplement"](t)||be["Arabic Extended-A"](t)||be["Arabic Presentation Forms-A"](t)||be["Arabic Presentation Forms-B"](t))}function ft(t){return!(t!==746&&t!==747&&(t<4352||!(be["Bopomofo Extended"](t)||be.Bopomofo(t)||be["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||be["CJK Compatibility Ideographs"](t)||be["CJK Compatibility"](t)||be["CJK Radicals Supplement"](t)||be["CJK Strokes"](t)||!(!be["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||be["CJK Unified Ideographs Extension A"](t)||be["CJK Unified Ideographs"](t)||be["Enclosed CJK Letters and Months"](t)||be["Hangul Compatibility Jamo"](t)||be["Hangul Jamo Extended-A"](t)||be["Hangul Jamo Extended-B"](t)||be["Hangul Jamo"](t)||be["Hangul Syllables"](t)||be.Hiragana(t)||be["Ideographic Description Characters"](t)||be.Kanbun(t)||be["Kangxi Radicals"](t)||be["Katakana Phonetic Extensions"](t)||be.Katakana(t)&&t!==12540||!(!be["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!be["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||be["Unified Canadian Aboriginal Syllabics"](t)||be["Unified Canadian Aboriginal Syllabics Extended"](t)||be["Vertical Forms"](t)||be["Yijing Hexagram Symbols"](t)||be["Yi Syllables"](t)||be["Yi Radicals"](t))))}function Fe(t){return!(ft(t)||function(e){return!!(be["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||be["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||be["Letterlike Symbols"](e)||be["Number Forms"](e)||be["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||be["Control Pictures"](e)&&e!==9251||be["Optical Character Recognition"](e)||be["Enclosed Alphanumerics"](e)||be["Geometric Shapes"](e)||be["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||be["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||be["CJK Symbols and Punctuation"](e)||be.Katakana(e)||be["Private Use Area"](e)||be["CJK Compatibility Forms"](e)||be["Small Form Variants"](e)||be["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function Ye(t){return t>=1424&&t<=2303||be["Arabic Presentation Forms-A"](t)||be["Arabic Presentation Forms-B"](t)}function lt(t,e){return!(!e&&Ye(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||be.Khmer(t))}function Ct(t){for(const e of t)if(Ye(e.charCodeAt(0)))return!0;return!1}const Pt="deferred",Lt="loading",Ot="loaded";let It=null,it="unavailable",jt=null;const Er=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(it="error"),It&&It(t)};function lr(){yr.fire(new $o("pluginStateChange",{pluginStatus:it,pluginURL:jt}))}const yr=new Jl,Rr=function(){return it},yn=function(){if(it!==Pt||!jt)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");it=Lt,lr(),jt&&ml({url:jt},t=>{t?Er(t):(it=Ot,lr())})},Pr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>it===Ot||Pr.applyArabicShaping!=null,isLoading:()=>it===Lt,setState(t){it=t.pluginStatus,jt=t.pluginURL},isParsed:()=>Pr.applyArabicShaping!=null&&Pr.processBidirectionalText!=null&&Pr.processStyledBidirectionalText!=null,getPluginURL:()=>jt};class pr{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(r,s){for(const u of r)if(!lt(u.charCodeAt(0),s))return!1;return!0}(e,Pr.isLoaded())}}class sn{constructor(e,r,s,u){this.property=e,this.value=r,this.expression=function(f,d,g,v){if(_(f))return new K(f,d);if(j(f)||Array.isArray(f)&&f.length>0){const T=Y(f,d,g,v);if(T.result==="error")throw new Error(T.value.map(E=>`${E.key}: ${E.message}`).join(", "));return T.value}{let T=f;return typeof f=="string"&&d.type==="color"&&(T=Gr.parse(f)),{kind:"constant",isConfigDependent:!1,evaluate:()=>T}}}(r===void 0?e.specification.default:r,e.specification,s,u)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class Jr{constructor(e,r,s){this.property=e,this.value=new sn(e,void 0,r,s)}transitioned(e,r){return new xr(this.property,this.value,r,Qr({},e.transition,this.transition),e.now)}untransitioned(){return new xr(this.property,this.value,null,{},0)}}class kr{constructor(e,r,s){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=s,this.isConfigDependent=!1}getValue(e){return ho(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Jr(this._values[e].property,this._scope,this._options)),this._values[e].value=new sn(this._values[e].property,r===null?void 0:ho(r),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,r){r&&(this._options=r);const s=this._properties.properties;if(e)for(const u in e){const f=e[u];if(Fi(u,"-transition")){const d=u.slice(0,-11);s[d]&&this.setTransition(d,f)}else s.hasOwnProperty(u)&&this.setValue(u,f)}}getTransition(e){return ho(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Jr(this._values[e].property)),this._values[e].transition=ho(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s);const u=this.getTransition(r);u!==void 0&&(e[`${r}-transition`]=u)}return e}transitioned(e,r){const s=new dn(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].transitioned(e,r._values[u]);return s}untransitioned(){const e=new dn(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class xr{constructor(e,r,s,u,f){const d=u.delay||0,g=u.duration||0;f=f||0,this.property=e,this.value=r,this.begin=f+d,this.end=this.begin+g,e.specification.transition&&(u.delay||u.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const u=e.now||0,f=this.value.possiblyEvaluate(e,r,s),d=this.prior;if(d){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return d.possiblyEvaluate(e,r,s);{const g=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,r,s),f,nt(g))}}return f}}class dn{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const u=new pn(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,r,s);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Rn{constructor(e,r,s){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=s,this.isConfigDependent=!1}getValue(e){return ho(this._values[e].value)}setValue(e,r){this._values[e]=new sn(this._values[e].property,r===null?void 0:ho(r),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const u=new pn(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,r,s);return u}}class en{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,s,u){return this.property.evaluate(this.value,this.parameters,e,r,s,u)}}class pn{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ct{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,s){const u=Xf[this.specification.type];return u?u(e,r,s):e}}class Ft{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,u){return new en(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},s,u)}:e.expression,r)}interpolate(e,r,s){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new en(this,{kind:"constant",value:void 0},e.parameters);const u=Xf[this.specification.type];return u?new en(this,{kind:"constant",value:u(e.value.value,r.value.value,s)},e.parameters):e}evaluate(e,r,s,u,f,d){return e.kind==="constant"?e.value:e.evaluate(r,s,u,f,d)}}class wi{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,u){return!!e.expression.evaluate(r,null,{},s,u)}interpolate(){return!1}}class Xr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new pr(0,{});for(const s in e){const u=e[s];u.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new sn(u,void 0),d=this.defaultTransitionablePropertyValues[s]=new Jr(u);this.defaultTransitioningPropertyValues[s]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate(r)}}}ee(Ft,"DataDrivenProperty"),ee(ct,"DataConstantProperty"),ee(wi,"ColorRampProperty");var $e=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ji(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Bi(t){if(Array.isArray(t))return t.map(Bi);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const r in t)e[r]=Bi(t[r]);return e}return Ji(t)}function Ti(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Ti(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Ni(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ti(t)||(t=pa(t));const r=t;let s=!0;try{s=function(T){if(!qo(T))return T;let E=Bi(T);return $a(E),E=js(E),E}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}const u=$e[`filter_${e}`],f=$(s,u);let d=null;if(f.result==="error")throw new Error(f.value.map(T=>`${T.key}: ${T.message}`).join(", "));d=(T,E,A)=>f.value.evaluate(T,E,{},A);let g=null,v=null;if(s!==r){const T=$(r,u);if(T.result==="error")throw new Error(T.value.map(E=>`${E.key}: ${E.message}`).join(", "));g=(E,A,C,k,L)=>T.value.evaluate(E,A,{},C,void 0,void 0,k,L),v=!Rh(T.value.expression)}return{filter:d,dynamicFilter:g||void 0,needGeometry:xl(s),needFeature:!!v}}function js(t){if(!Array.isArray(t))return t;const e=function(r){if(yl.has(r[0])){for(let s=1;s<r.length;s++)if(qo(r[s]))return!0}return r}(t);return e===!0?e:e.map(r=>js(r))}function $a(t){let e=!1;const r=[];if(t[0]==="case"){for(let s=1;s<t.length-1;s+=2)e=e||qo(t[s]),r.push(t[s+1]);r.push(t[t.length-1])}else if(t[0]==="match"){e=e||qo(t[1]);for(let s=2;s<t.length-1;s+=2)r.push(t[s+1]);r.push(t[t.length-1])}else if(t[0]==="step"){e=e||qo(t[1]);for(let s=1;s<t.length-1;s+=2)r.push(t[s+1])}e&&(t.length=0,t.push("any",...r));for(let s=1;s<t.length;s++)$a(t[s])}function qo(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<t.length;r++)if(qo(t[r]))return!0;return!1}const yl=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function vl(t,e){return t<e?-1:t>e?1:0}function xl(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(xl(t[e]))return!0;return!1}function pa(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?cu(t[1],t[2],"=="):e==="!="?oc(cu(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?cu(t[1],t[2],e):e==="any"?(r=t.slice(1),["any"].concat(r.map(pa))):e==="all"?["all"].concat(t.slice(1).map(pa)):e==="none"?["all"].concat(t.slice(1).map(pa).map(oc)):e==="in"?ic(t[1],t.slice(2)):e==="!in"?oc(ic(t[1],t.slice(2))):e==="has"?Fh(t[1]):e!=="!has"||oc(Fh(t[1]));var r}function cu(t,e,r){switch(t){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,t,e]}}function ic(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",t,["literal",e.sort(vl)]]:["filter-in-small",t,["literal",e]]}}function Fh(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function oc(t){return["!",t]}const sc="";function hd(t,e){return e?`${t}${sc}${e}`:t}const fd="-transition",hu=new Set(["fill","line","background","hillshade","raster"]);class Ui extends Jl{constructor(e,r,s,u,f){if(super(),this.id=e.id,this.fqid=hd(this.id,s),this.type=e.type,this.scope=s,this.lut=u,this.options=f,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),r.layout&&(this._unevaluatedLayout=new Rn(r.layout,this.scope,f),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),r.paint)){this._transitionablePaint=new kr(r.paint,this.scope,f);for(const d in e.paint)this.setPaintProperty(d,e.paint[d]);for(const d in e.layout)this.setLayoutProperty(d,e.layout[d]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pn(r.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return hu.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r){if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);const s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,r),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Fi(e,fd)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r){const s=this._transitionablePaint,u=s._properties.properties;if(Fi(e,fd)){const A=e.slice(0,-11);return u[A]&&s.setTransition(A,r||void 0),!1}if(!u[e])return!1;const f=s._values[e],d=f.value.isDataDriven(),g=f.value;s.setValue(e,r),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const v=s._values[e].value,T=v.isDataDriven(),E=Fi(e,"pattern")||e==="line-dasharray";return T||d||E||this._handleOverridablePaintPropertyUpdate(e,g,v)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r,s){return null}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){return Fu({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,r)=>!(e===void 0||r==="layout"&&!Object.keys(e).length||r==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof en&&Nm(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ni(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,r,s,u,f,d,g,v,T){}queryIntersectsMatchingFeature(e,r,s,u){}}const Um={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ny{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class wn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Yr(t,e=1){let r=0,s=0;return{members:t.map(u=>{const f=Um[u.type].BYTES_PER_ELEMENT,d=r=AM(r,Math.max(e,f)),g=u.components||1;return s=Math.max(s,f),r+=f*g,{name:u.name,type:u.type,components:g,offset:d}}),size:AM(r,Math.max(s,e)),alignment:e}}function AM(t,e){return Math.ceil(t/e)*e}class Ga extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const u=2*e;return this.int16[u+0]=r,this.int16[u+1]=s,e}}Ga.prototype.bytesPerElement=4,ee(Ga,"StructArrayLayout2i4");class Uy extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s)}emplace(e,r,s,u){const f=3*e;return this.int16[f+0]=r,this.int16[f+1]=s,this.int16[f+2]=u,e}}Uy.prototype.bytesPerElement=6,ee(Uy,"StructArrayLayout3i6");class ac extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,u)}emplace(e,r,s,u,f){const d=4*e;return this.int16[d+0]=r,this.int16[d+1]=s,this.int16[d+2]=u,this.int16[d+3]=f,e}}ac.prototype.bytesPerElement=8,ee(ac,"StructArrayLayout4i8");class S1 extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,f){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,u,f)}emplace(e,r,s,u,f,d){const g=5*e;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=u,this.int16[g+3]=f,this.int16[g+4]=d,e}}S1.prototype.bytesPerElement=10,ee(S1,"StructArrayLayout5i10");class E1 extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,u,f,d,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,s,u,f,d,g)}emplace(e,r,s,u,f,d,g,v){const T=6*e,E=12*e,A=3*e;return this.int16[T+0]=r,this.int16[T+1]=s,this.uint8[E+4]=u,this.uint8[E+5]=f,this.uint8[E+6]=d,this.uint8[E+7]=g,this.float32[A+2]=v,e}}E1.prototype.bytesPerElement=12,ee(E1,"StructArrayLayout2i4ub1f12");class lc extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,u)}emplace(e,r,s,u,f){const d=4*e;return this.float32[d+0]=r,this.float32[d+1]=s,this.float32[d+2]=u,this.float32[d+3]=f,e}}lc.prototype.bytesPerElement=16,ee(lc,"StructArrayLayout4f16");class uc extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s)}emplace(e,r,s,u){const f=3*e;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=u,e}}uc.prototype.bytesPerElement=12,ee(uc,"StructArrayLayout3f12");class cc extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,u,f){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,u,f)}emplace(e,r,s,u,f,d){const g=6*e,v=3*e;return this.uint16[g+0]=r,this.uint16[g+1]=s,this.uint16[g+2]=u,this.uint16[g+3]=f,this.float32[v+2]=d,e}}cc.prototype.bytesPerElement=12,ee(cc,"StructArrayLayout4ui1f12");class jy extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,u)}emplace(e,r,s,u,f){const d=4*e;return this.uint16[d+0]=r,this.uint16[d+1]=s,this.uint16[d+2]=u,this.uint16[d+3]=f,e}}jy.prototype.bytesPerElement=8,ee(jy,"StructArrayLayout4ui8");class Vy extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,f,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,s,u,f,d)}emplace(e,r,s,u,f,d,g){const v=6*e;return this.int16[v+0]=r,this.int16[v+1]=s,this.int16[v+2]=u,this.int16[v+3]=f,this.int16[v+4]=d,this.int16[v+5]=g,e}}Vy.prototype.bytesPerElement=12,ee(Vy,"StructArrayLayout6i12");class M1 extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,f,d,g,v,T,E,A,C){const k=this.length;return this.resize(k+1),this.emplace(k,e,r,s,u,f,d,g,v,T,E,A,C)}emplace(e,r,s,u,f,d,g,v,T,E,A,C,k){const L=12*e;return this.int16[L+0]=r,this.int16[L+1]=s,this.int16[L+2]=u,this.int16[L+3]=f,this.uint16[L+4]=d,this.uint16[L+5]=g,this.uint16[L+6]=v,this.uint16[L+7]=T,this.int16[L+8]=E,this.int16[L+9]=A,this.int16[L+10]=C,this.int16[L+11]=k,e}}M1.prototype.bytesPerElement=24,ee(M1,"StructArrayLayout4i4ui4i24");class I1 extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,u,f,d){const g=this.length;return this.resize(g+1),this.emplace(g,e,r,s,u,f,d)}emplace(e,r,s,u,f,d,g){const v=10*e,T=5*e;return this.int16[v+0]=r,this.int16[v+1]=s,this.int16[v+2]=u,this.float32[T+2]=f,this.float32[T+3]=d,this.float32[T+4]=g,e}}I1.prototype.bytesPerElement=20,ee(I1,"StructArrayLayout3i3f20");class A1 extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}A1.prototype.bytesPerElement=4,ee(A1,"StructArrayLayout1ul4");class Bh extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Bh.prototype.bytesPerElement=4,ee(Bh,"StructArrayLayout1f4");class hc extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=s,e}}hc.prototype.bytesPerElement=4,ee(hc,"StructArrayLayout2ui4");class C1 extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,f,d,g,v,T,E,A,C,k){const L=this.length;return this.resize(L+1),this.emplace(L,e,r,s,u,f,d,g,v,T,E,A,C,k)}emplace(e,r,s,u,f,d,g,v,T,E,A,C,k,L){const F=20*e,N=10*e;return this.int16[F+0]=r,this.int16[F+1]=s,this.int16[F+2]=u,this.int16[F+3]=f,this.int16[F+4]=d,this.float32[N+3]=g,this.float32[N+4]=v,this.float32[N+5]=T,this.float32[N+6]=E,this.int16[F+14]=A,this.uint32[N+8]=C,this.uint16[F+18]=k,this.uint16[F+19]=L,e}}C1.prototype.bytesPerElement=40,ee(C1,"StructArrayLayout5i4f1i1ul2ui40");class $y extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,f,d,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,s,u,f,d,g)}emplace(e,r,s,u,f,d,g,v){const T=8*e;return this.int16[T+0]=r,this.int16[T+1]=s,this.int16[T+2]=u,this.int16[T+4]=f,this.int16[T+5]=d,this.int16[T+6]=g,this.int16[T+7]=v,e}}$y.prototype.bytesPerElement=16,ee($y,"StructArrayLayout3i2i2i16");class P1 extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,u,f){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,u,f)}emplace(e,r,s,u,f,d){const g=4*e,v=8*e;return this.float32[g+0]=r,this.float32[g+1]=s,this.float32[g+2]=u,this.int16[v+6]=f,this.int16[v+7]=d,e}}P1.prototype.bytesPerElement=16,ee(P1,"StructArrayLayout2f1f2i16");class O1 extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,u)}emplace(e,r,s,u,f){const d=12*e,g=3*e;return this.uint8[d+0]=r,this.uint8[d+1]=s,this.float32[g+1]=u,this.float32[g+2]=f,e}}O1.prototype.bytesPerElement=12,ee(O1,"StructArrayLayout2ub2f12");class Si extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,s)}emplace(e,r,s,u){const f=3*e;return this.uint16[f+0]=r,this.uint16[f+1]=s,this.uint16[f+2]=u,e}}Si.prototype.bytesPerElement=6,ee(Si,"StructArrayLayout3ui6");class D1 extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,s,u,f,d,g,v,T,E,A,C,k,L,F,N,G,ne,ie,oe,me){const pe=this.length;return this.resize(pe+1),this.emplace(pe,e,r,s,u,f,d,g,v,T,E,A,C,k,L,F,N,G,ne,ie,oe,me)}emplace(e,r,s,u,f,d,g,v,T,E,A,C,k,L,F,N,G,ne,ie,oe,me,pe){const Ee=30*e,De=15*e,je=60*e;return this.int16[Ee+0]=r,this.int16[Ee+1]=s,this.int16[Ee+2]=u,this.float32[De+2]=f,this.float32[De+3]=d,this.uint16[Ee+8]=g,this.uint16[Ee+9]=v,this.uint32[De+5]=T,this.uint32[De+6]=E,this.uint32[De+7]=A,this.uint16[Ee+16]=C,this.uint16[Ee+17]=k,this.uint16[Ee+18]=L,this.float32[De+10]=F,this.float32[De+11]=N,this.uint8[je+48]=G,this.uint8[je+49]=ne,this.uint8[je+50]=ie,this.uint32[De+13]=oe,this.int16[Ee+28]=me,this.uint8[je+58]=pe,e}}D1.prototype.bytesPerElement=60,ee(D1,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class R1 extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,s,u,f,d,g,v,T,E,A,C,k,L,F,N,G,ne,ie,oe,me,pe,Ee,De,je,Qe,Ze,ut,vt,ot,mt,tt,_t,bt){const gt=this.length;return this.resize(gt+1),this.emplace(gt,e,r,s,u,f,d,g,v,T,E,A,C,k,L,F,N,G,ne,ie,oe,me,pe,Ee,De,je,Qe,Ze,ut,vt,ot,mt,tt,_t,bt)}emplace(e,r,s,u,f,d,g,v,T,E,A,C,k,L,F,N,G,ne,ie,oe,me,pe,Ee,De,je,Qe,Ze,ut,vt,ot,mt,tt,_t,bt,gt){const zt=22*e,xt=44*e,Tt=88*e;return this.float32[zt+0]=r,this.float32[zt+1]=s,this.int16[xt+4]=u,this.int16[xt+5]=f,this.int16[xt+6]=d,this.int16[xt+7]=g,this.int16[xt+8]=v,this.int16[xt+9]=T,this.int16[xt+10]=E,this.int16[xt+11]=A,this.int16[xt+12]=C,this.uint16[xt+13]=k,this.uint16[xt+14]=L,this.uint16[xt+15]=F,this.uint16[xt+16]=N,this.uint16[xt+17]=G,this.uint16[xt+18]=ne,this.uint16[xt+19]=ie,this.uint16[xt+20]=oe,this.uint16[xt+21]=me,this.uint16[xt+22]=pe,this.uint16[xt+23]=Ee,this.uint16[xt+24]=De,this.uint16[xt+25]=je,this.uint16[xt+26]=Qe,this.uint16[xt+27]=Ze,this.uint32[zt+14]=ut,this.float32[zt+15]=vt,this.float32[zt+16]=ot,this.float32[zt+17]=mt,this.float32[zt+18]=tt,this.float32[zt+19]=_t,this.float32[zt+20]=bt,this.uint8[Tt+84]=gt,e}}R1.prototype.bytesPerElement=88,ee(R1,"StructArrayLayout2f9i15ui1ul6f1ub88");class Nh extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,u,f){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,u,f)}emplace(e,r,s,u,f,d){const g=5*e;return this.float32[g+0]=r,this.float32[g+1]=s,this.float32[g+2]=u,this.float32[g+3]=f,this.float32[g+4]=d,e}}Nh.prototype.bytesPerElement=20,ee(Nh,"StructArrayLayout5f20");class k1 extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,u,f,d,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,s,u,f,d,g)}emplace(e,r,s,u,f,d,g,v){const T=7*e;return this.float32[T+0]=r,this.float32[T+1]=s,this.float32[T+2]=u,this.float32[T+3]=f,this.float32[T+4]=d,this.float32[T+5]=g,this.float32[T+6]=v,e}}k1.prototype.bytesPerElement=28,ee(k1,"StructArrayLayout7f28");class dd extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const u=2*e;return this.float32[u+0]=r,this.float32[u+1]=s,e}}dd.prototype.bytesPerElement=8,ee(dd,"StructArrayLayout2f8");class L1 extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,s,u)}emplace(e,r,s,u,f){const d=6*e;return this.uint32[3*e+0]=r,this.uint16[d+2]=s,this.uint16[d+3]=u,this.uint16[d+4]=f,e}}L1.prototype.bytesPerElement=12,ee(L1,"StructArrayLayout1ul3ui12");class jm extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}jm.prototype.bytesPerElement=2,ee(jm,"StructArrayLayout1ui2");class z1 extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,u,f,d,g,v,T,E,A,C,k,L,F,N){const G=this.length;return this.resize(G+1),this.emplace(G,e,r,s,u,f,d,g,v,T,E,A,C,k,L,F,N)}emplace(e,r,s,u,f,d,g,v,T,E,A,C,k,L,F,N,G){const ne=16*e;return this.float32[ne+0]=r,this.float32[ne+1]=s,this.float32[ne+2]=u,this.float32[ne+3]=f,this.float32[ne+4]=d,this.float32[ne+5]=g,this.float32[ne+6]=v,this.float32[ne+7]=T,this.float32[ne+8]=E,this.float32[ne+9]=A,this.float32[ne+10]=C,this.float32[ne+11]=k,this.float32[ne+12]=L,this.float32[ne+13]=F,this.float32[ne+14]=N,this.float32[ne+15]=G,e}}z1.prototype.bytesPerElement=64,ee(z1,"StructArrayLayout16f64");class Gy extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,u,f,d,g){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,s,u,f,d,g)}emplace(e,r,s,u,f,d,g,v){const T=10*e,E=5*e;return this.uint16[T+0]=r,this.uint16[T+1]=s,this.uint16[T+2]=u,this.uint16[T+3]=f,this.float32[E+2]=d,this.float32[E+3]=g,this.float32[E+4]=v,e}}Gy.prototype.bytesPerElement=20,ee(Gy,"StructArrayLayout4ui3f20");class F1 extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.int16[1*e+0]=r,e}}F1.prototype.bytesPerElement=2,ee(F1,"StructArrayLayout1i2");class B1 extends wn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}B1.prototype.bytesPerElement=1,ee(B1,"StructArrayLayout1ub1");class CM extends Ny{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}CM.prototype.size=40;class N1 extends C1{get(e){return new CM(this,e)}}ee(N1,"CollisionBoxArray");class PM extends Ny{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}PM.prototype.size=60;class OM extends D1{get(e){return new PM(this,e)}}ee(OM,"PlacedSymbolArray");class DM extends Ny{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get occlusionState(){return this._structArray.float32[this._pos4+19]}set occlusionState(e){this._structArray.float32[this._pos4+19]=e}get occlusionOpacity(){return this._structArray.float32[this._pos4+20]}set occlusionOpacity(e){this._structArray.float32[this._pos4+20]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+84]}}DM.prototype.size=88;class RM extends R1{get(e){return new DM(this,e)}}ee(RM,"SymbolInstanceArray");class kM extends Bh{getoffsetX(e){return this.float32[1*e+0]}}ee(kM,"GlyphOffsetArray");class LM extends Ga{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ee(LM,"SymbolLineVertexArray");class zM extends Ny{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}zM.prototype.size=12;class FM extends L1{get(e){return new zM(this,e)}}ee(FM,"FeatureIndexArray");class BM extends hc{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ee(BM,"FillExtrusionCentroidArray");const s4=Yr([{name:"a_pos",components:2,type:"Int16"}],4),a4=Yr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class In{constructor(e=[]){this.segments=e}_prepareSegment(e,r,s,u){let f=this.segments[this.segments.length-1];return e>In.MAX_VERTEX_ARRAY_LENGTH&&zn(`Max vertices per segment is ${In.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>In.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:r,primitiveOffset:s,vertexLength:0,primitiveLength:0},u!==void 0&&(f.sortKey=u),this.segments.push(f)),f}prepareSegment(e,r,s,u){return this._prepareSegment(e,r.length,s.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,u){return new In([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:u,vaos:{},sortKey:0}])}}function NM(t,e){return 256*(t=Kt(Math.floor(t),0,255))+Kt(Math.floor(e),0,255)}In.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ee(In,"SegmentVector");const l4=Yr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),u4=Yr([{name:"a_dash",components:4,type:"Uint16"}]);class Vm{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,s,u){this.ids.push(UM(e)),this.positions.push(r,s,u)}eachPosition(e,r){const s=UM(e);let u=0,f=this.ids.length-1;for(;u<f;){const d=u+f>>1;this.ids[d]>=s?f=d:u=d+1}for(;this.ids[u]===s;)r(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,r){const s=new Float64Array(e.ids),u=new Uint32Array(e.positions);return U1(s,u,0,s.length-1),r&&(r.add(s.buffer),r.add(u.buffer)),{ids:s,positions:u}}static deserialize(e){const r=new Vm;let s;r.ids=e.ids,r.positions=e.positions;for(const u of r.ids)u!==s&&r.uniqueIds.push(u),s=u;return r.indexed=!0,r}}function UM(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:yh(String(t))}function U1(t,e,r,s){for(;r<s;){const u=t[r+s>>1];let f=r-1,d=s+1;for(;;){do f++;while(t[f]<u);do d--;while(t[d]>u);if(f>=d)break;Wy(t,f,d),Wy(e,3*f,3*d),Wy(e,3*f+1,3*d+1),Wy(e,3*f+2,3*d+2)}d-r<s-d?(U1(t,e,r,d),r=d+1):(U1(t,e,d+1,s),s=d)}}function Wy(t,e,r){const s=t[e];t[e]=t[r],t[r]=s}ee(Vm,"FeaturePositionMap");class fu{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}set(e,r,s){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class qy extends fu{constructor(e){super(e),this.current=0}set(e,r,s){this.fetchUniformLocation(e,r)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class Mo extends fu{constructor(e){super(e),this.current=0}set(e,r,s){this.fetchUniformLocation(e,r)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class du extends fu{constructor(e){super(e),this.current=[0,0]}set(e,r,s){this.fetchUniformLocation(e,r)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class j1 extends fu{constructor(e){super(e),this.current=[0,0,0]}set(e,r,s){this.fetchUniformLocation(e,r)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class V1 extends fu{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,s){this.fetchUniformLocation(e,r)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class jM extends fu{constructor(e){super(e),this.current=Gr.transparent.toRenderColor(null)}set(e,r,s){this.fetchUniformLocation(e,r)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const c4=new Float32Array(16);class $m extends fu{constructor(e){super(e),this.current=c4}set(e,r,s){if(this.fetchUniformLocation(e,r)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let u=1;u<16;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const h4=new Float32Array(9),f4=new Float32Array(4);class $1 extends fu{constructor(e){super(e),this.current=f4}set(e,r,s){if(this.fetchUniformLocation(e,r)){for(let u=0;u<4;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function G1(t){return[NM(255*t.r,255*t.g),NM(255*t.b,255*t.a)]}class Gm{constructor(e,r,s,u){this.value=e,this.uniformNames=r.map(f=>`u_${f}`),this.type=s,this.context=u}setUniform(e,r,s,u,f){const d=u.constantOr(this.value);r.set(e,f,d instanceof Gr?d.toRenderColor(this.context.lut):d)}getBinding(e,r){return this.type==="color"?new jM(e):new Mo(e)}}class pd{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,s,u,f){const d=f==="u_pattern"||f==="u_dash"?this.pattern:f==="u_pixel_ratio"?this.pixelRatio:null;d&&r.set(e,f,d)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new V1(e):new Mo(e)}}class pu{constructor(e,r,s,u){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,r,s,u,f,d,g){const v=this.paintVertexArray.length,T=this.expression.evaluate(new pr(0,{brightness:d}),r,{},f,u,g);this.paintVertexArray.resize(e),this._setPaintValue(v,e,T,this.context)}updatePaintArray(e,r,s,u,f,d,g){const v=this.expression.evaluate({zoom:0,brightness:g},s,u,void 0,f);this._setPaintValue(e,r,v,this.context)}_setPaintValue(e,r,s,u){if(this.type==="color"){const f=G1(s.toRenderColor(u.lut));for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,f[0],f[1])}else{for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Wa{constructor(e,r,s,u,f,d){this.expression=e,this.uniformNames=r.map(g=>`u_${g}_t`),this.type=s,this.useIntegerZoom=u,this.context=f,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,r,s,u,f,d,g){const v=this.expression.evaluate(new pr(this.context.zoom,{brightness:d}),r,{},f,u,g),T=this.expression.evaluate(new pr(this.context.zoom+1,{brightness:d}),r,{},f,u,g),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,v,T,this.context)}updatePaintArray(e,r,s,u,f,d,g){const v=this.expression.evaluate({zoom:this.context.zoom,brightness:g},s,u,void 0,f),T=this.expression.evaluate({zoom:this.context.zoom+1,brightness:g},s,u,void 0,f);this._setPaintValue(e,r,v,T,this.context)}_setPaintValue(e,r,s,u,f){if(this.type==="color"){const d=G1(s.toRenderColor(f.lut)),g=G1(s.toRenderColor(f.lut));for(let v=e;v<r;v++)this.paintVertexArray.emplace(v,d[0],d[1],g[0],g[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,s,u);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,s,u,f){const d=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,g=Kt(this.expression.interpolationFactor(d,this.context.zoom,this.context.zoom+1),0,1);r.set(e,f,g)}getBinding(e,r){return new Mo(e)}}class fc{constructor(e,r,s,u,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=(s==="array"?u4:l4).members;for(let d=0;d<r.length;++d);this.paintVertexArray=new u}populatePaintArray(e,r,s,u){const f=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(f,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,u,f,d,g){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],d)}_setPaintValues(e,r,s,u){if(!u||!s)return;const f=u[s];if(!f)return;const{tl:d,br:g,pixelRatio:v}=f;for(let T=e;T<r;T++)this.paintVertexArray.emplace(T,d[0],d[1],g[0],g[1],v)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Uh{constructor(e,r,s=()=>!0){this.binders={},this._buffers=[],this.context=r;const u=[];for(const f in e.paint._values){const d=e.paint.get(f);if(!s(f)||!(d instanceof en&&Nm(d.property.specification)))continue;const g=p4(f,e.type),v=d.value,T=d.property.specification.type,E=!!d.property.useIntegerZoom,A=f==="line-dasharray"||f.endsWith("pattern"),C=f==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(v.kind!=="constant"||C)if(v.kind==="source"||C||A){const k=VM(f,T,"source");this.binders[f]=A?new fc(v,g,T,k,e.id):new pu(v,g,T,k),u.push(`/a_${f}`)}else{const k=VM(f,T,"composite");this.binders[f]=new Wa(v,g,T,E,r,k),u.push(`/z_${f}`)}else this.binders[f]=A?new pd(v.value,g):new Gm(v.value,g,T,r),u.push(`/u_${f}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof pu||r instanceof Wa?r.maxValue:0}populatePaintArrays(e,r,s,u,f,d,g){for(const v in this.binders){const T=this.binders[v];T.context=this.context,(T instanceof pu||T instanceof Wa||T instanceof fc)&&T.populatePaintArray(e,r,s,u,f,d,g)}}setConstantPatternPositions(e){for(const r in this.binders){const s=this.binders[r];s instanceof pd&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,r,s,u,f,d,g,v){let T=!1;const E=Object.keys(e),A=E.length!==0,C=A?E:r.uniqueIds;this.context.lut=f.lut;for(const k in this.binders){const L=this.binders[k];if(L.context=this.context,(L instanceof pu||L instanceof Wa||L instanceof fc)&&(L.expression.isStateDependent===!0||L.expression.isLightConstant===!1)){const F=f.paint.get(k);L.expression=F.value;for(const N of C){const G=e[N.toString()];r.eachPosition(N,(ne,ie,oe)=>{const me=u.feature(ne);L.updatePaintArray(ie,oe,me,G,d,g,v)})}if(!A)for(const N of s.uniqueIds){const G=e[N.toString()];s.eachPosition(N,(ne,ie,oe)=>{const me=u.feature(ne);L.updatePaintArray(ie,oe,me,G,d,g,v)})}T=!0}}return T}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Gm||s instanceof pd)&&e.push(...s.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof pu||s instanceof Wa||s instanceof fc)for(let u=0;u<s.paintVertexAttributes.length;u++)e.push(s.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Gm||s instanceof pd||s instanceof Wa)for(const u of s.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof Gm||u instanceof pd||u instanceof Wa)for(const f of u.uniformNames)r.push({name:f,property:s,binding:u.getBinding(e,f)})}return r}setUniforms(e,r,s,u,f){for(const{name:d,property:g,binding:v}of s)this.binders[g].setUniform(e,v,f,u.get(g),d)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof pu||r instanceof Wa||r instanceof fc)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof pu||s instanceof Wa||s instanceof fc)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof pu||r instanceof Wa||r instanceof fc)&&r.destroy()}}}class dc{constructor(e,r,s=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Uh(u,r,s);this.needsUpload=!1,this._featureMap=new Vm,this._featureMapWithoutIds=new Vm,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,s,u,f,d,g,v){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,r,u,f,d,g,v);r.id!==void 0?this._featureMap.add(r.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,u,f,d){for(const g of s)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,g,u,f,d||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const d4={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function p4(t,e){return d4[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const m4={"line-pattern":{source:cc,composite:cc},"fill-pattern":{source:cc,composite:cc},"fill-extrusion-pattern":{source:cc,composite:cc},"line-dasharray":{source:jy,composite:jy}},_4={color:{source:dd,composite:lc},number:{source:Bh,composite:dd}};function VM(t,e,r){const s=m4[t];return s&&s[r]||_4[e][r]}ee(Gm,"ConstantBinder"),ee(pd,"PatternConstantBinder"),ee(pu,"SourceExpressionBinder"),ee(fc,"PatternCompositeBinder"),ee(Wa,"CompositeExpressionBinder"),ee(Uh,"ProgramConfiguration",{omit:["_buffers"]}),ee(dc,"ProgramConfigurationSet");const Io=At/Math.PI/2,W1=5,$M=6,g4=16383,md=64,q1=[md,32,16],ma=-Io,_a=Io;function _d(t,e,r,s=Io){return r=Ar(r),[t*Math.sin(r)*s,-e*s,t*Math.cos(r)*s]}function jh(t,e,r){return _d(Math.cos(Ar(t)),Math.sin(Ar(t)),e,r)}const gd=63710088e-1,H1=2*Math.PI*gd;class Vr{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Vr(bn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,u=e.lat*r,f=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return gd*Math.acos(Math.min(f,1))}toBounds(e=0){const r=360*e/40075017,s=r/Math.cos(Math.PI/180*this.lat);return new pc({lng:this.lng-s,lat:this.lat-r},{lng:this.lng+s,lat:this.lat+r})}toEcef(e){return jh(this.lat,this.lng,Io+e*Io/gd)}static convert(e){if(e instanceof Vr)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Vr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Vr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class pc{constructor(e,r){if(e)if(r)this.setSouthWest(e).setNorthEast(r);else if(e.length===4){const s=e;this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]])}else{const s=e;this.setSouthWest(s[0]).setNorthEast(s[1])}}setNorthEast(e){return this._ne=e instanceof Vr?new Vr(e.lng,e.lat):Vr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Vr?new Vr(e.lng,e.lat):Vr.convert(e),this}extend(e){const r=this._sw,s=this._ne;let u,f;if(e instanceof Vr)u=e,f=e;else{if(!(e instanceof pc))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(pc.convert(e)):this.extend(Vr.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Vr.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return r||s?(r.lng=Math.min(u.lng,r.lng),r.lat=Math.min(u.lat,r.lat),s.lng=Math.max(f.lng,s.lng),s.lat=Math.max(f.lat,s.lat)):(this._sw=new Vr(u.lng,u.lat),this._ne=new Vr(f.lng,f.lat)),this}getCenter(){return new Vr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Vr(this.getWest(),this.getNorth())}getSouthEast(){return new Vr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:s}=Vr.convert(e);let u=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&u}static convert(e){return!e||e instanceof pc?e:new pc(e)}}var GM={};(function(t,e){(function(r){function s(f,d,g){var v=u(256*f,256*(d=Math.pow(2,g)-d-1),g),T=u(256*(f+1),256*(d+1),g);return v[0]+","+v[1]+","+T[0]+","+T[1]}function u(f,d,g){var v=2*Math.PI*6378137/256/Math.pow(2,g);return[f*v-2*Math.PI*6378137/2,d*v-2*Math.PI*6378137/2]}r.getURL=function(f,d,g,v,T,E){return E=E||{},f+"?"+["bbox="+s(g,v,T),"format="+(E.format||"image/png"),"service="+(E.service||"WMS"),"version="+(E.version||"1.1.1"),"request="+(E.request||"GetMap"),"srs="+(E.srs||"EPSG:3857"),"width="+(E.width||256),"height="+(E.height||256),"layers="+d].join("&")},r.getTileBBox=s,r.getMercCoords=u,Object.defineProperty(r,"__esModule",{value:!0})})(e)})(0,GM);var y4=GM;class Vh{constructor(e,r,s){this.z=e,this.x=r,this.y=s,this.key=Wm(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const s=y4.getTileBBox(this.x,this.y,this.z),u=function(f,d,g){let v,T="";for(let E=f;E>0;E--)v=1<<E-1,T+=(d&v?1:0)+(g&v?2:0);return T}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class WM{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Wm(e,r.z,r.z,r.x,r.y)}}class hi{constructor(e,r,s,u,f){this.overscaledZ=e,this.wrap=r,this.canonical=new Vh(s,+u,+f),this.key=r===0&&e===s?this.canonical.key:Wm(r,e,s,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new hi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new hi(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Wm(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Wm(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new hi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,u=2*this.canonical.y;return[new hi(r,this.wrap,r,s,u),new hi(r,this.wrap,r,s+1,u),new hi(r,this.wrap,r,s,u+1),new hi(r,this.wrap,r,s+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new hi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new hi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new WM(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Wm(t,e,r,s,u){const f=1<<Math.min(r,22);let d=f*(u%f)+s%f;return t&&r<22&&(d+=f*f*((t<0?-2*t-1:2*t)%(1<<2*(22-r)))),16*(32*d+r)+(e-r)}const v4=[t=>{let e=t.canonical.x-1,r=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,r--),new hi(t.overscaledZ,r,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,r=t.wrap;return e===1<<t.canonical.z&&(e=0,r++),new hi(t.overscaledZ,r,t.canonical.z,e,t.canonical.y)},t=>new hi(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new hi(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];ee(Vh,"CanonicalTileID"),ee(hi,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const x4=0,b4=25.5;function Z1(t){return H1*Math.cos(t*Math.PI/180)}function bl(t){return(180+t)/360}function wl(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Ao(t,e){return t/Z1(e)}function Ho(t){return 360*t-180}function Di(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function qM(t,e){return t*Z1(Di(e))}const Un=85.051129;function HM(t){return Math.cos(Ar(Kt(t,-Un,Un)))}function $h(t,e){const r=Kt(e,x4,b4),s=Math.pow(2,r);return HM(t)*H1/(512*s)}function ZM(t){return 1/Math.cos(t*Math.PI/180)}function Hy(t,e=0){const r=Math.exp(Math.PI*(1-(t.y+e/At)/(1<<t.z)*2));return 80150034*r/(r*r+1)/At/(1<<t.z)}class eo{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=Vr.convert(e);return new eo(bl(s.lng),wl(s.lat),Ao(r,s.lat))}toLngLat(){return new Vr(Ho(this.x),Di(this.y))}toAltitude(){return qM(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/H1*ZM(Di(this.y))}}function X1(t,e,r,s,u,f,d,g,v){const T=(e+s)/2,E=(r+u)/2,A=new Mt(T,E);g(A),function(C,k,L,F,N,G){const ne=L-N,ie=F-G;return Math.abs((F-k)*ne-(L-C)*ie)/Math.hypot(ne,ie)}(A.x,A.y,f.x,f.y,d.x,d.y)>=v?(X1(t,e,r,T,E,f,A,g,v),X1(t,T,E,s,u,A,d,g,v)):t.push(d)}function XM(t,e,r){let s=t[0],u=s.x,f=s.y;e(s);const d=[s];for(let g=1;g<t.length;g++){const v=t[g],{x:T,y:E}=v;e(v),X1(d,u,f,T,E,s,v,e,r),u=T,f=E,s=v}return d}function Y1(t,e,r,s){if(s(e,r)){const u=e.add(r)._mult(.5);Y1(t,e,u,s),Y1(t,u,r,s)}else t.push(r)}function w4(t,e){let r=t[0];const s=[r];for(let u=1;u<t.length;u++){const f=t[u];Y1(s,r,f,e),r=f}return s}const K1=Math.pow(2,14)-1,YM=-K1-1;function T4(t,e){const r=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=Kt(r,YM,K1),t.y=Kt(s,YM,K1),(r<t.x||r>t.x+1||s<t.y||s>t.y+1)&&zn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function qa(t,e,r){const s=t.loadGeometry(),u=t.extent,f=At/u;if(e&&r&&r.projection.isReprojectedInTileSpace){const d=1<<e.z,{scale:g,x:v,y:T,projection:E}=r,A=C=>{const k=Ho((e.x+C.x/u)/d),L=Di((e.y+C.y/u)/d),F=E.project(k,L);C.x=(F.x*g-v)*u,C.y=(F.y*g-T)*u};for(let C=0;C<s.length;C++)if(t.type!==1)s[C]=XM(s[C],A,1);else{const k=[];for(const L of s[C])L.x<0||L.x>=u||L.y<0||L.y>=u||(A(L),k.push(L));s[C]=k}}for(const d of s)for(const g of d)T4(g,f);return s}function mu(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?qa(t):[]}}function Zy(t,e,r,s,u){t.emplaceBack(2*e+(s+1)/2,2*r+(u+1)/2)}function Xy(t,e,r){t.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Q1{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ga,this.indexArray=new Si,this.segments=new In,this.programConfigurations=new dc(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}updateFootprints(e,r){}populate(e,r,s,u){const f=this.layers[0],d=[];let g=null;f.type==="circle"&&(g=f.layout.get("circle-sort-key"));for(const{feature:T,id:E,index:A,sourceLayerIndex:C}of e){const k=this.layers[0]._featureFilter.needGeometry,L=mu(T,k);if(!this.layers[0]._featureFilter.filter(new pr(this.zoom),L,s))continue;const F=g?g.evaluate(L,{},s):void 0,N={id:E,properties:T.properties,type:T.type,sourceLayerIndex:C,index:A,geometry:k?L.geometry:qa(T,s,u),patterns:{},sortKey:F};d.push(N)}g&&d.sort((T,E)=>T.sortKey-E.sortKey);let v=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new Vy,v=u.projection);for(const T of d){const{geometry:E,index:A,sourceLayerIndex:C}=T,k=e[A].feature;this.addFeature(T,E,A,r.availableImages,s,v,r.brightness),r.featureIndex.insert(k,E,A,C,this.index)}}update(e,r,s,u,f){const d=Object.keys(e).length!==0;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,d?this.stateDependentLayers:this.layers,s,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,s4.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,a4.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,s,u,f,d,g){for(const v of r)for(const T of v){const E=T.x,A=T.y;if(E<0||E>=At||A<0||A>=At)continue;if(d){const L=d.projectTilePoint(E,A,f),F=d.upVector(f,E,A),N=this.globeExtVertexArray;Xy(N,L,F),Xy(N,L,F),Xy(N,L,F),Xy(N,L,F)}const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),k=C.vertexLength;Zy(this.layoutVertexArray,E,A,-1,-1),Zy(this.layoutVertexArray,E,A,1,-1),Zy(this.layoutVertexArray,E,A,1,1),Zy(this.layoutVertexArray,E,A,-1,1),this.indexArray.emplaceBack(k,k+1,k+2),this.indexArray.emplaceBack(k,k+2,k+3),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},u,f,g)}}function J1(t,e){for(let r=0;r<t.length;r++)if(mc(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(mc(t,e[r]))return!0;return!!eb(t,e)}function S4(t,e,r){return!!mc(t,e)||!!tb(e,t,r)}function KM(t,e){if(t.length===1)return JM(e,t[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let u=0;u<s.length;u++)if(mc(t,s[u]))return!0}for(let r=0;r<t.length;r++)if(JM(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(eb(t,e[r]))return!0;return!1}function E4(t,e,r){if(t.length>1){if(eb(t,e))return!0;for(let s=0;s<e.length;s++)if(tb(e[s],t,r))return!0}for(let s=0;s<t.length;s++)if(tb(t[s],e,r))return!0;return!1}function eb(t,e){if(t.length===0||e.length===0)return!1;for(let r=0;r<t.length-1;r++){const s=t[r],u=t[r+1];for(let f=0;f<e.length-1;f++)if(M4(s,u,e[f],e[f+1]))return!0}return!1}function M4(t,e,r,s){return Wn(t,r,s)!==Wn(e,r,s)&&Wn(t,e,r)!==Wn(t,e,s)}function tb(t,e,r){const s=r*r;if(e.length===1)return t.distSqr(e[0])<s;for(let u=1;u<e.length;u++)if(QM(t,e[u-1],e[u])<s)return!0;return!1}function QM(t,e,r){const s=e.distSqr(r);if(s===0)return t.distSqr(e);const u=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/s;return t.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function JM(t,e){let r,s,u,f=!1;for(let d=0;d<t.length;d++){r=t[d];for(let g=0,v=r.length-1;g<r.length;v=g++)s=r[g],u=r[v],s.y>e.y!=u.y>e.y&&e.x<(u.x-s.x)*(e.y-s.y)/(u.y-s.y)+s.x&&(f=!f)}return f}function mc(t,e){let r=!1;for(let s=0,u=t.length-1;s<t.length;u=s++){const f=t[s],d=t[u];f.y>e.y!=d.y>e.y&&e.x<(d.x-f.x)*(e.y-f.y)/(d.y-f.y)+f.x&&(r=!r)}return r}function eI(t,e,r,s,u){for(const d of t)if(e<=d.x&&r<=d.y&&s>=d.x&&u>=d.y)return!0;const f=[new Mt(e,r),new Mt(e,u),new Mt(s,u),new Mt(s,r)];if(t.length>2){for(const d of f)if(mc(t,d))return!0}for(let d=0;d<t.length-1;d++)if(I4(t[d],t[d+1],f))return!0;return!1}function I4(t,e,r){const s=r[0],u=r[2];if(t.x<s.x&&e.x<s.x||t.x>u.x&&e.x>u.x||t.y<s.y&&e.y<s.y||t.y>u.y&&e.y>u.y)return!1;const f=Wn(t,e,r[0]);return f!==Wn(t,e,r[1])||f!==Wn(t,e,r[2])||f!==Wn(t,e,r[3])}function yd(t,e,r,s,u,f){let d=e.y-t.y,g=t.x-e.x;if(f=f||0){const v=d*d+g*g;if(v===0)return!0;const T=Math.sqrt(v);d/=T,g/=T}return!((r.x-t.x)*d+(r.y-t.y)*g-f<0||(s.x-t.x)*d+(s.y-t.y)*g-f<0||(u.x-t.x)*d+(u.y-t.y)*g-f<0)}function rb(t,e,r,s,u,f,d){return!(yd(t,e,s,u,f,d)||yd(e,r,s,u,f,d)||yd(r,t,s,u,f,d)||yd(s,u,t,e,r,d)||yd(u,f,t,e,r,d)||yd(f,s,t,e,r,d))}function vd(t,e,r){const s=e.paint.get(t).value;return s.kind==="constant"?s.value:r.programConfigurations.get(e.id).getMaxValue(t)}function Yy(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function tI(t,e,r,s,u){if(!e[0]&&!e[1])return t;const f=Mt.convert(e)._mult(u);r==="viewport"&&f._rotate(-s);const d=[];for(let g=0;g<t.length;g++)d.push(t[g].sub(f));return d}function rI(t,e,r,s){const u=Mt.convert(t)._mult(s);return e==="viewport"&&u._rotate(-r),u}ee(Q1,"CircleBucket",{omit:["layers"]});const A4=new Xr({"circle-sort-key":new Ft($e.layout_circle["circle-sort-key"]),visibility:new ct($e.layout_circle.visibility)});var C4={paint:new Xr({"circle-radius":new Ft($e.paint_circle["circle-radius"]),"circle-color":new Ft($e.paint_circle["circle-color"]),"circle-blur":new Ft($e.paint_circle["circle-blur"]),"circle-opacity":new Ft($e.paint_circle["circle-opacity"]),"circle-translate":new ct($e.paint_circle["circle-translate"]),"circle-translate-anchor":new ct($e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ct($e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ct($e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ft($e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ft($e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ft($e.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ct($e.paint_circle["circle-emissive-strength"])}),layout:A4};class nb{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,s){const u=o._.dot(r,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/u;return s[0]=this.pos[0]+this.dir[0]*f,s[1]=this.pos[1]+this.dir[1]*f,s[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,r,s){if(o._.equals(this.pos,e)||r===0)return s[0]=s[1]=s[2]=0,!1;const[u,f,d]=this.dir,g=this.pos[0]-e[0],v=this.pos[1]-e[1],T=this.pos[2]-e[2],E=u*u+f*f+d*d,A=2*(g*u+v*f+T*d),C=A*A-4*E*(g*g+v*v+T*T-r*r);if(C<0){const k=Math.max(-A/2,0),L=g+u*k,F=v+f*k,N=T+d*k,G=Math.hypot(L,F,N);return s[0]=L*r/G,s[1]=F*r/G,s[2]=N*r/G,!1}{const k=(-A-Math.sqrt(C))/(2*E);if(k<0){const L=Math.hypot(g,v,T);return s[0]=g*r/L,s[1]=v*r/L,s[2]=T*r/L,!1}return s[0]=g+u*k,s[1]=v+f*k,s[2]=T+d*k,!0}}}class ib{constructor(e,r,s,u,f){this.TL=e,this.TR=r,this.BR=s,this.BL=u,this.horizon=f}static fromInvProjectionMatrix(e,r,s){const u=[-1,1,1],f=[1,1,1],d=[1,-1,1],g=[-1,-1,1],v=o._.transformMat4(u,u,e),T=o._.transformMat4(f,f,e),E=o._.transformMat4(d,d,e),A=o._.transformMat4(g,g,e);return new ib(v,T,E,A,r/s)}}function qm(t,e,r){let s=1/0,u=-1/0;const f=[];for(const d of t){o._.sub(f,d,e);const g=o._.dot(f,r);s=Math.min(s,g),u=Math.max(u,g)}return[s,u]}function nI(t,e){let r=!0;for(let s=0;s<t.planes.length;s++){const u=t.planes[s];let f=0;for(let d=0;d<e.length;d++)f+=o._.dot(u,e[d])+u[3]>=0;if(f===0)return 0;f!==e.length&&(r=!1)}return r?2:1}function iI(t,e){for(const r of t.projections){const s=qm(e,t.points[0],r.axis);if(r.projection[1]<s[0]||r.projection[0]>s[1])return 0}return 1}function oI(t,e){let r=0;const s=[0,0,0,0];for(let u=0;u<t.length;u++)s[0]=t[u][0],s[1]=t[u][1],s[2]=t[u][2],s[3]=1,o.aA.dot(s,e)>=0&&r++;return r}class ob{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=Tn.fromPoints(this.points),this.projections=[],this.frustumEdges=[o._.sub([],this.points[2],this.points[3]),o._.sub([],this.points[0],this.points[3]),o._.sub([],this.points[4],this.points[0]),o._.sub([],this.points[5],this.points[1]),o._.sub([],this.points[6],this.points[2]),o._.sub([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const u=[0,-s[2],s[1]],f=[s[2],0,-s[0]];this.projections.push({axis:u,projection:qm(this.points,this.points[0],u)}),this.projections.push({axis:f,projection:qm(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(e,r,s,u){const f=Math.pow(2,s),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const E=o.aA.transformMat4([],T,e),A=1/E[3]/r*f;return o.aA.mul(E,E,[A,A,u?1/E[3]:A,A])}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const E=o._.sub([],d[T[0]],d[T[1]]),A=o._.sub([],d[T[2]],d[T[1]]),C=o._.normalize([],o._.cross([],E,A)),k=-o._.dot(C,d[T[1]]);return C.concat(k)}),v=[];for(let T=0;T<d.length;T++)v.push([d[T][0],d[T][1],d[T][2]]);return new ob(v,g)}intersectsPrecise(e,r,s){for(let u=0;u<r.length;u++)if(!oI(e,r[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!oI(e,this.planes[u]))return 0;for(const u of s)for(const f of this.frustumEdges){const d=o._.cross([],u,f),g=o._.length(d);if(g===0)continue;o._.scale(d,d,1/g);const v=qm(this.points,this.points[0],d),T=qm(e,this.points[0],d);if(v[0]>T[1]||T[0]>v[1])return 0}return 1}}class Tn{static fromPoints(e){const r=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const u of e)o._.min(r,r,u),o._.max(s,s,u);return new Tn(r,s)}static fromTileIdAndHeight(e,r,s){const u=1<<e.canonical.z,f=e.canonical.x,d=e.canonical.y;return new Tn([f/u,d/u,r],[(f+1)/u,(d+1)/u,s])}static applyTransform(e,r){const s=e.getCorners();for(let u=0;u<s.length;++u)o._.transformMat4(s[u],s[u],r);return Tn.fromPoints(s)}static applyTransformFast(e,r){const s=[r[12],r[13],r[14]],u=[...s];for(let f=0;f<3;f++)for(let d=0;d<3;d++){const g=r[4*d+f],v=g*e.min[d],T=g*e.max[d];s[f]+=Math.min(v,T),u[f]+=Math.max(v,T)}return new Tn(s,u)}static projectAabbCorners(e,r){const s=e.getCorners();for(let u=0;u<s.length;++u)o._.transformMat4(s[u],s[u],r);return s}constructor(e,r){this.min=e,this.max=r,this.center=o._.scale([],o._.add([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],s=o._.clone(this.min),u=o._.clone(this.max);for(let f=0;f<r.length;f++)s[f]=r[f]?this.min[f]:this.center[f],u[f]=r[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new Tn(s,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?nI(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?nI(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?iI(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?iI(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}ee(Tn,"Aabb");const P4=Yr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ky}=P4,sI=Yr([{name:"a_pos_3",components:3,type:"Int16"}]);var Hm=Yr([{name:"a_pos",type:"Int16",components:2}]);function Qy(t){return t*Io/gd}const O4=[new Tn([ma,ma,ma],[_a,_a,_a]),new Tn([ma,ma,ma],[0,0,_a]),new Tn([0,ma,ma],[_a,0,_a]),new Tn([ma,0,ma],[0,_a,_a]),new Tn([0,0,ma],[_a,_a,_a])];function aI(t,e,r,s=!0){const u=o._.scale([],t._camera.position,t.worldSize),f=[e,r,1,1];o.aA.transformMat4(f,f,t.pixelMatrixInverse),o.aA.scale(f,f,1/f[3]);const d=o._.sub([],f,u),g=o._.normalize([],d),v=t.globeMatrix,T=[v[12],v[13],v[14]],E=o._.sub([],T,u),A=o._.length(E),C=o._.normalize([],E),k=t.worldSize/(2*Math.PI),L=o._.dot(C,g),F=Math.asin(k/A);if(F<Math.acos(L)){if(!s)return null;const Ze=[],ut=[];o._.scale(Ze,g,A/L),o._.normalize(ut,o._.sub(ut,Ze,E)),o._.normalize(g,o._.add(g,E,o._.scale(g,ut,Math.tan(F)*A)))}const N=[];new nb(u,g).closestPointOnSphere(T,k,N);const G=o._.normalize([],hh(v,0)),ne=o._.normalize([],hh(v,1)),ie=o._.normalize([],hh(v,2)),oe=o._.dot(G,N),me=o._.dot(ne,N),pe=o._.dot(ie,N),Ee=li(Math.asin(-me/k));let De=li(Math.atan2(oe,pe));De=t.center.lng+function(Ze,ut){const vt=(ut-Ze+180)%360-180;return vt<-180?vt+360:vt}(t.center.lng,De);const je=bl(De),Qe=Kt(wl(Ee),0,1);return new eo(je,Qe)}class D4{constructor(e,r,s){this.a=o._.sub([],e,s),this.b=o._.sub([],r,s),this.center=s;const u=o._.normalize([],this.a),f=o._.normalize([],this.b);this.angle=Math.acos(o._.dot(u,f))}}function sb(t,e){if(t.angle===0)return null;let r;return r=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),r<0||r>1?null:function(s,u,f,d){const g=Math.sin(f);return s*(Math.sin((1-d)*f)/g)+u*(Math.sin(d*f)/g)}(t.a[e],t.b[e],t.angle,Kt(r,0,1))+t.center[e]}function Tl(t){if(t.z<=1)return O4[t.z+2*t.y+t.x];const e=ab(Jy(t));return Tn.fromPoints(e)}function _u(t,e,r){return o._.scale(t,t,1-r),o._.scaleAndAdd(t,t,e,r)}function lI(t,e){const r=gu(e.zoom);if(r===0)return Tl(t);const s=Jy(t),u=ab(s),f=bl(s.getWest())*e.worldSize,d=bl(s.getEast())*e.worldSize,g=wl(s.getNorth())*e.worldSize,v=wl(s.getSouth())*e.worldSize,T=[f,g,0],E=[d,g,0],A=[f,v,0],C=[d,v,0],k=o.ad.invert([],e.globeMatrix);return o._.transformMat4(T,T,k),o._.transformMat4(E,E,k),o._.transformMat4(A,A,k),o._.transformMat4(C,C,k),u[0]=_u(u[0],A,r),u[1]=_u(u[1],C,r),u[2]=_u(u[2],E,r),u[3]=_u(u[3],T,r),Tn.fromPoints(u)}function uI(t,e,r){for(const s of t)o._.transformMat4(s,s,e),o._.scale(s,s,r)}function cI(t,e,r,s){const u=e/t.worldSize,f=t.globeMatrix;if(r.z<=1){const je=Tl(r).getCorners();return uI(je,f,u),Tn.fromPoints(je)}const d=Jy(r,s),g=ab(d,Io+Qy(t._tileCoverLift));uI(g,f,u);const v=Number.MAX_VALUE,T=[-v,-v,-v],E=[v,v,v];if(d.contains(t.center)){for(const Ze of g)o._.min(E,E,Ze),o._.max(T,T,Ze);T[2]=0;const je=t.point,Qe=[je.x*u,je.y*u,0];return o._.min(E,E,Qe),o._.max(T,T,Qe),new Tn(E,T)}if(t._tileCoverLift>0){for(const je of g)o._.min(E,E,je),o._.max(T,T,je);return new Tn(E,T)}const A=[f[12]*u,f[13]*u,f[14]*u],C=d.getCenter(),k=Kt(t.center.lat,-Un,Un),L=Kt(C.lat,-Un,Un),F=bl(t.center.lng),N=wl(k);let G=F-bl(C.lng);const ne=N-wl(L);G>.5?G-=1:G<-.5&&(G+=1);let ie=0;if(Math.abs(G)>Math.abs(ne))ie=G>=0?1:3;else{ie=ne>=0?0:2;const je=[f[4]*u,f[5]*u,f[6]*u],Qe=-Math.sin(Ar(ne>=0?d.getSouth():d.getNorth()))*Io;o._.scaleAndAdd(A,A,je,Qe)}const oe=g[ie],me=g[(ie+1)%4],pe=new D4(oe,me,A),Ee=[sb(pe,0)||oe[0],sb(pe,1)||oe[1],sb(pe,2)||oe[2]],De=gu(t.zoom);if(De>0){const je=function({x:Ze,y:ut,z:vt},ot,mt,tt,_t){const bt=1/(1<<vt);let gt=Ze*bt,zt=gt+bt,xt=ut*bt,Tt=xt+bt,Jt=0;const Yt=(gt+zt)/2-tt;return Yt>.5?Jt=-1:Yt<-.5&&(Jt=1),gt=((gt+Jt)*ot-(tt*=ot))*mt+tt,zt=((zt+Jt)*ot-tt)*mt+tt,xt=(xt*ot-(_t*=ot))*mt+_t,Tt=(Tt*ot-_t)*mt+_t,[[gt,Tt,0],[zt,Tt,0],[zt,xt,0],[gt,xt,0]]}(r,e,t._pixelsPerMercatorPixel,F,N);for(let Ze=0;Ze<g.length;Ze++)_u(g[Ze],je[Ze],De);const Qe=o._.add([],je[ie],je[(ie+1)%4]);o._.scale(Qe,Qe,.5),_u(Ee,Qe,De)}for(const je of g)o._.min(E,E,je),o._.max(T,T,je);return E[2]=Math.min(oe[2],me[2]),o._.min(E,E,Ee),o._.max(T,T,Ee),new Tn(E,T)}function Jy({x:t,y:e,z:r},s=!1){const u=1/(1<<r),f=new Vr(Ho(t*u),e===(1<<r)-1&&s?-90:Di((e+1)*u)),d=new Vr(Ho((t+1)*u),e===0&&s?90:Di(e*u));return new pc(f,d)}function ab(t,e=Io){const r=Ar(t.getNorth()),s=Ar(t.getSouth()),u=Math.cos(r),f=Math.cos(s),d=Math.sin(r),g=Math.sin(s),v=t.getWest(),T=t.getEast();return[_d(f,g,v,e),_d(f,g,T,e),_d(u,d,T,e),_d(u,d,v,e)]}function Zm(t,e,r,s){const u=1<<r.z,f=(t/At+r.x)/u;return jh(Di((e/At+r.y)/u),Ho(f),s)}function e0({min:t,max:e}){return g4/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const hI=new Float64Array(16);function Xm(t){const e=e0(t),r=o.ad.fromScaling(hI,[e,e,e]);return o.ad.translate(r,r,o._.negate([],t.min))}function lb(t){const e=o.ad.fromTranslation(hI,t.min),r=1/e0(t);return o.ad.scale(e,e,[r,r,r])}function ub(t){const e=At/(2*Math.PI);return t/(2*Math.PI)/e}function fI(t,e){return At/(512*Math.pow(2,t))*e0(Tl(e))}function dI(t,e,r,s,u){const f=ub(r),d=[t,e,-r/(2*Math.PI)],g=o.ad.identity(new Float64Array(16));return o.ad.translate(g,g,d),o.ad.scale(g,g,[f,f,f]),o.ad.rotateX(g,g,Ar(-u)),o.ad.rotateY(g,g,Ar(-s)),g}function gu(t){return zr(W1,$M,t)}function pI(t,e){const r=jh(e.lat,e.lng),s=function(f){const d=jh(f._center.lat,f._center.lng),g=o._.fromValues(0,1,0);let v=o._.cross([],g,d);const T=o.ad.fromRotation([],-f.angle,d);v=o._.transformMat4(v,v,T),o.ad.fromRotation(T,-f._pitch,v);const E=o._.normalize([],d);return o._.scale(E,E,Qy(f.cameraToCenterDistance/f.pixelsPerMeter)),o._.transformMat4(E,E,T),o._.add([],d,E)}(t),u=o._.subtract([],s,r);return o._.angle(u,r)}function cb(t,e){return pI(t,e)>Math.PI/2*1.01}const mI=Ar(85),R4=Math.cos(mI),k4=Math.sin(mI),L4=o.ad.create(),_I=t=>{const e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function gI(t,e,r,s,u,f,d,g,v){if(f&&t.queryGeometry.isAboveHorizon)return!1;f&&(v*=t.pixelToTileUnitsFactor);const T=t.tileID.canonical,E=r.projection.upVectorScale(T,r.center.lat,r.worldSize).metersToTile;for(const A of e)for(const C of A){const k=C.add(g),L=u&&r.elevation?r.elevation.exaggeration()*u.getElevationAt(k.x,k.y,!0):0,F=r.projection.projectTilePoint(k.x,k.y,T);if(L>0){const ie=r.projection.upVector(T,k.x,k.y);F.x+=ie[0]*E*L,F.y+=ie[1]*E*L,F.z+=ie[2]*E*L}const N=f?k:z4(F.x,F.y,F.z,s),G=f?t.tilespaceRays.map(ie=>B4(ie,L)):t.queryGeometry.screenGeometry,ne=o.aA.transformMat4([],[F.x,F.y,F.z,1],s);if(!d&&f?v*=ne[3]/r.cameraToCenterDistance:d&&!f&&(v*=r.cameraToCenterDistance/ne[3]),f){const ie=Di((C.y/At+T.y)/(1<<T.z));v/=r.projection.pixelsPerMeter(ie,1)/Ao(1,ie)}if(S4(G,N,v))return!0}return!1}function z4(t,e,r,s){const u=o.aA.transformMat4([],[t,e,r,1],s);return new Mt(u[0]/u[3],u[1]/u[3])}const yI=o._.fromValues(0,0,0),F4=o._.fromValues(0,0,1);function B4(t,e){const r=o._.create();return yI[2]=e,t.intersectsPlane(yI,F4,r),new Mt(r[0],r[1])}class vI extends Q1{}function xI(t,{width:e,height:r},s,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*s)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*r*s);return t.width=e,t.height=r,t.data=u,t}function bI(t,e,r){const{width:s,height:u}=e;s===t.width&&u===t.height||(hb(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,s),height:Math.min(t.height,u)},r,null),t.width=s,t.height=u,t.data=e.data)}function hb(t,e,r,s,u,f,d,g){if(u.width===0||u.height===0)return e;if(u.width>t.width||u.height>t.height||r.x>t.width-u.width||r.y>t.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||s.x>e.width-u.width||s.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const v=t.data,T=e.data,E=f===4&&g;for(let A=0;A<u.height;A++){const C=((r.y+A)*t.width+r.x)*f,k=((s.y+A)*e.width+s.x)*f;if(E)for(let L=0;L<u.width;L++){const F=C+L*f+3,N=k+L*f;T[N+0]=255,T[N+1]=255,T[N+2]=255,T[N+3]=v[F]}else if(d)for(let L=0;L<u.width;L++){const F=C+L*f,N=k+L*f,G=v[F+3],ne=new Gr(v[F+0]/255*G,v[F+1]/255*G,v[F+2]/255*G,G).toRenderColor(d).toArray();T[N+0]=ne[0],T[N+1]=ne[1],T[N+2]=ne[2],T[N+3]=ne[3]}else for(let L=0;L<u.width*f;L++)T[k+L]=v[C+L]}return e}ee(vI,"HeatmapBucket",{omit:["layers"]});class _c{constructor(e,r){xI(this,e,1,r)}resize(e){bI(this,new _c(e),1)}clone(){return new _c({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,u,f){hb(e,r,s,u,f,1,null)}}class Vs{constructor(e,r){xI(this,e,4,r)}resize(e){bI(this,new Vs(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Vs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,u,f,d,g){hb(e,r,s,u,f,4,d,g)}}class wI{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}ee(_c,"AlphaImage"),ee(Vs,"RGBAImage");const N4=new Xr({visibility:new ct($e.layout_heatmap.visibility)});var U4={paint:new Xr({"heatmap-radius":new Ft($e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ft($e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ct($e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new wi($e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ct($e.paint_heatmap["heatmap-opacity"])}),layout:N4};function Ym(t){const e={},r=t.resolution||256,s=t.clips?t.clips.length:1,u=t.image||new Vs({width:r,height:s}),f=(d,g,v)=>{e[t.evaluationKey]=v;const T=t.expression.evaluate(e);T&&(u.data[d+g+0]=Math.floor(255*T.r/T.a),u.data[d+g+1]=Math.floor(255*T.g/T.a),u.data[d+g+2]=Math.floor(255*T.b/T.a),u.data[d+g+3]=Math.floor(255*T.a))};if(t.clips)for(let d=0,g=0;d<s;++d,g+=4*r)for(let v=0,T=0;v<r;v++,T+=4){const E=v/(r-1),{start:A,end:C}=t.clips[d];f(g,T,A*(1-E)+C*E)}else for(let d=0,g=0;d<r;d++,g+=4)f(0,g,d/(r-1));return u}const j4=new Xr({visibility:new ct($e.layout_hillshade.visibility)});var V4={paint:new Xr({"hillshade-illumination-direction":new ct($e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ct($e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ct($e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ct($e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ct($e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ct($e.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ct($e.paint_hillshade["hillshade-emissive-strength"])}),layout:j4};const $4=Yr([{name:"a_pos",components:2,type:"Int16"}],4),{members:G4}=$4;function Km(t,e,r=2){const s=e&&e.length,u=s?e[0]*r:t.length;let f=TI(t,0,u,r,!0);const d=[];if(!f||f.next===f.prev)return d;let g,v,T;if(s&&(f=function(E,A,C,k){const L=[];for(let F=0,N=A.length;F<N;F++){const G=TI(E,A[F]*k,F<N-1?A[F+1]*k:E.length,k,!1);G===G.next&&(G.steiner=!0),L.push(Q4(G))}L.sort(X4);for(let F=0;F<L.length;F++)C=Y4(L[F],C);return C}(t,e,f,r)),t.length>80*r){g=1/0,v=1/0;let E=-1/0,A=-1/0;for(let C=r;C<u;C+=r){const k=t[C],L=t[C+1];k<g&&(g=k),L<v&&(v=L),k>E&&(E=k),L>A&&(A=L)}T=Math.max(E-g,A-v),T=T!==0?32767/T:0}return Qm(f,d,r,g,v,T,0),d}function TI(t,e,r,s,u){let f;if(u===function(d,g,v,T){let E=0;for(let A=g,C=v-T;A<v;A+=T)E+=(d[C]-d[A])*(d[A+1]+d[C+1]),C=A;return E}(t,e,r,s)>0)for(let d=e;d<r;d+=s)f=MI(d/s|0,t[d],t[d+1],f);else for(let d=r-s;d>=e;d-=s)f=MI(d/s|0,t[d],t[d+1],f);return f&&t0(f,f.next)&&(e_(f),f=f.next),f}function Gh(t,e){if(!t)return t;e||(e=t);let r,s=t;do if(r=!1,s.steiner||!t0(s,s.next)&&fi(s.prev,s,s.next)!==0)s=s.next;else{if(e_(s),s=e=s.prev,s===s.next)break;r=!0}while(r||s!==e);return e}function Qm(t,e,r,s,u,f,d){if(!t)return;!d&&f&&function(v,T,E,A){let C=v;do C.z===0&&(C.z=fb(C.x,C.y,T,E,A)),C.prevZ=C.prev,C.nextZ=C.next,C=C.next;while(C!==v);C.prevZ.nextZ=null,C.prevZ=null,function(k){let L,F=1;do{let N,G=k;k=null;let ne=null;for(L=0;G;){L++;let ie=G,oe=0;for(let pe=0;pe<F&&(oe++,ie=ie.nextZ,ie);pe++);let me=F;for(;oe>0||me>0&&ie;)oe!==0&&(me===0||!ie||G.z<=ie.z)?(N=G,G=G.nextZ,oe--):(N=ie,ie=ie.nextZ,me--),ne?ne.nextZ=N:k=N,N.prevZ=ne,ne=N;G=ie}ne.nextZ=null,F*=2}while(L>1)}(C)}(t,s,u,f);let g=t;for(;t.prev!==t.next;){const v=t.prev,T=t.next;if(f?q4(t,s,u,f):W4(t))e.push(v.i,t.i,T.i),e_(t),t=T.next,g=T.next;else if((t=T)===g){d?d===1?Qm(t=H4(Gh(t),e),e,r,s,u,f,2):d===2&&Z4(t,e,r,s,u,f):Qm(Gh(t),e,r,s,u,f,1);break}}}function W4(t){const e=t.prev,r=t,s=t.next;if(fi(e,r,s)>=0)return!1;const u=e.x,f=r.x,d=s.x,g=e.y,v=r.y,T=s.y,E=u<f?u<d?u:d:f<d?f:d,A=g<v?g<T?g:T:v<T?v:T,C=u>f?u>d?u:d:f>d?f:d,k=g>v?g>T?g:T:v>T?v:T;let L=s.next;for(;L!==e;){if(L.x>=E&&L.x<=C&&L.y>=A&&L.y<=k&&xd(u,g,f,v,d,T,L.x,L.y)&&fi(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function q4(t,e,r,s){const u=t.prev,f=t,d=t.next;if(fi(u,f,d)>=0)return!1;const g=u.x,v=f.x,T=d.x,E=u.y,A=f.y,C=d.y,k=g<v?g<T?g:T:v<T?v:T,L=E<A?E<C?E:C:A<C?A:C,F=g>v?g>T?g:T:v>T?v:T,N=E>A?E>C?E:C:A>C?A:C,G=fb(k,L,e,r,s),ne=fb(F,N,e,r,s);let ie=t.prevZ,oe=t.nextZ;for(;ie&&ie.z>=G&&oe&&oe.z<=ne;){if(ie.x>=k&&ie.x<=F&&ie.y>=L&&ie.y<=N&&ie!==u&&ie!==d&&xd(g,E,v,A,T,C,ie.x,ie.y)&&fi(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,oe.x>=k&&oe.x<=F&&oe.y>=L&&oe.y<=N&&oe!==u&&oe!==d&&xd(g,E,v,A,T,C,oe.x,oe.y)&&fi(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;ie&&ie.z>=G;){if(ie.x>=k&&ie.x<=F&&ie.y>=L&&ie.y<=N&&ie!==u&&ie!==d&&xd(g,E,v,A,T,C,ie.x,ie.y)&&fi(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;oe&&oe.z<=ne;){if(oe.x>=k&&oe.x<=F&&oe.y>=L&&oe.y<=N&&oe!==u&&oe!==d&&xd(g,E,v,A,T,C,oe.x,oe.y)&&fi(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function H4(t,e){let r=t;do{const s=r.prev,u=r.next.next;!t0(s,u)&&SI(s,r,r.next,u)&&Jm(s,u)&&Jm(u,s)&&(e.push(s.i,r.i,u.i),e_(r),e_(r.next),r=t=u),r=r.next}while(r!==t);return Gh(r)}function Z4(t,e,r,s,u,f){let d=t;do{let g=d.next.next;for(;g!==d.prev;){if(d.i!==g.i&&J4(d,g)){let v=EI(d,g);return d=Gh(d,d.next),v=Gh(v,v.next),Qm(d,e,r,s,u,f,0),void Qm(v,e,r,s,u,f,0)}g=g.next}d=d.next}while(d!==t)}function X4(t,e){return t.x-e.x}function Y4(t,e){const r=function(u,f){let d=f;const g=u.x,v=u.y;let T,E=-1/0;do{if(v<=d.y&&v>=d.next.y&&d.next.y!==d.y){const F=d.x+(v-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(F<=g&&F>E&&(E=F,T=d.x<d.next.x?d:d.next,F===g))return T}d=d.next}while(d!==f);if(!T)return null;const A=T,C=T.x,k=T.y;let L=1/0;d=T;do{if(g>=d.x&&d.x>=C&&g!==d.x&&xd(v<k?g:E,v,C,k,v<k?E:g,v,d.x,d.y)){const F=Math.abs(v-d.y)/(g-d.x);Jm(d,u)&&(F<L||F===L&&(d.x>T.x||d.x===T.x&&K4(T,d)))&&(T=d,L=F)}d=d.next}while(d!==A);return T}(t,e);if(!r)return e;const s=EI(r,t);return Gh(s,s.next),Gh(r,r.next)}function K4(t,e){return fi(t.prev,t,e.prev)<0&&fi(e.next,t,t.next)<0}function fb(t,e,r,s,u){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Q4(t){let e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function xd(t,e,r,s,u,f,d,g){return(u-d)*(e-g)>=(t-d)*(f-g)&&(t-d)*(s-g)>=(r-d)*(e-g)&&(r-d)*(f-g)>=(u-d)*(s-g)}function J4(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(r,s){let u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==s.i&&u.next.i!==s.i&&SI(u,u.next,r,s))return!0;u=u.next}while(u!==r);return!1}(t,e)&&(Jm(t,e)&&Jm(e,t)&&function(r,s){let u=r,f=!1;const d=(r.x+s.x)/2,g=(r.y+s.y)/2;do u.y>g!=u.next.y>g&&u.next.y!==u.y&&d<(u.next.x-u.x)*(g-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==r);return f}(t,e)&&(fi(t.prev,t,e.prev)||fi(t,e.prev,e))||t0(t,e)&&fi(t.prev,t,t.next)>0&&fi(e.prev,e,e.next)>0)}function fi(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function t0(t,e){return t.x===e.x&&t.y===e.y}function SI(t,e,r,s){const u=n0(fi(t,e,r)),f=n0(fi(t,e,s)),d=n0(fi(r,s,t)),g=n0(fi(r,s,e));return u!==f&&d!==g||!(u!==0||!r0(t,r,e))||!(f!==0||!r0(t,s,e))||!(d!==0||!r0(r,t,s))||!(g!==0||!r0(r,e,s))}function r0(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function n0(t){return t>0?1:t<0?-1:0}function Jm(t,e){return fi(t.prev,t,t.next)<0?fi(t,e,t.next)>=0&&fi(t,t.prev,e)>=0:fi(t,e,t.prev)<0||fi(t,t.next,e)<0}function EI(t,e){const r=db(t.i,t.x,t.y),s=db(e.i,e.x,e.y),u=t.next,f=e.prev;return t.next=e,e.prev=t,r.next=u,u.prev=r,s.next=r,r.prev=s,f.next=s,s.prev=f,s}function MI(t,e,r,s){const u=db(t,e,r);return s?(u.next=s.next,u.prev=s,s.next.prev=u,s.next=u):(u.prev=u,u.next=u),u}function e_(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function db(t,e,r){return{i:t,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function i0(t,e){const r=t.length;if(r<=1)return[t];const s=[];let u,f;for(let d=0;d<r;d++){const g=Zl(t[d]);g!==0&&(t[d].area=Math.abs(g),f===void 0&&(f=g<0),f===g<0?(u&&s.push(u),u=[t[d]]):u.push(t[d]))}if(u&&s.push(u),e>1)for(let d=0;d<s.length;d++)s[d].length<=e||(ly(s[d],e,1,s[d].length-1,eF),s[d]=s[d].slice(0,e));return s}function eF(t,e){return e.area-t.area}function pb(t,e,r){const s=r.patternDependencies;let u=!1;for(const f of e){const d=f.paint.get(`${t}-pattern`);d.isConstant()||(u=!0);const g=d.constantOr(null);g&&(u=!0,s[g]=!0)}return u}function mb(t,e,r,s,u){const f=u.patternDependencies;for(const d of e){const g=d.paint.get(`${t}-pattern`).value;if(g.kind!=="constant"){let v=g.evaluate({zoom:s},r,{},u.availableImages);v=v&&v.name?v.name:v,f[v]=!0,r.patterns[d.id]=v}}return r}class o0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ga,this.indexArray=new Si,this.indexArray2=new hc,this.programConfigurations=new dc(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new In,this.segments2=new In,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}updateFootprints(e,r){}populate(e,r,s,u){this.hasPattern=pb("fill",this.layers,r);const f=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:g,id:v,index:T,sourceLayerIndex:E}of e){const A=this.layers[0]._featureFilter.needGeometry,C=mu(g,A);if(!this.layers[0]._featureFilter.filter(new pr(this.zoom),C,s))continue;const k=f?f.evaluate(C,{},s,r.availableImages):void 0,L={id:v,properties:g.properties,type:g.type,sourceLayerIndex:E,index:T,geometry:A?C.geometry:qa(g,s,u),patterns:{},sortKey:k};d.push(L)}f&&d.sort((g,v)=>g.sortKey-v.sortKey);for(const g of d){const{geometry:v,index:T,sourceLayerIndex:E}=g;if(this.hasPattern){const A=mb("fill",this.layers,g,this.zoom,r);this.patternFeatures.push(A)}else this.addFeature(g,v,T,s,{},r.availableImages,r.brightness);r.featureIndex.insert(e[T].feature,v,T,E,this.index)}}update(e,r,s,u,f){const d=Object.keys(e).length!==0;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,d?this.stateDependentLayers:this.layers,s,u,f)}addFeatures(e,r,s,u,f,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,r,s,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,G4),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,u,f,d=[],g){for(const v of i0(r,500)){let T=0;for(const F of v)T+=F.length;const E=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),A=E.vertexLength,C=[],k=[];for(const F of v){if(F.length===0)continue;F!==v[0]&&k.push(C.length/2);const N=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),G=N.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(G+F.length-1,G),C.push(F[0].x),C.push(F[0].y);for(let ne=1;ne<F.length;ne++)this.layoutVertexArray.emplaceBack(F[ne].x,F[ne].y),this.indexArray2.emplaceBack(G+ne-1,G+ne),C.push(F[ne].x),C.push(F[ne].y);N.vertexLength+=F.length,N.primitiveLength+=F.length}const L=Km(C,k);for(let F=0;F<L.length;F+=3)this.indexArray.emplaceBack(A+L[F],A+L[F+1],A+L[F+2]);E.vertexLength+=T,E.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,d,u,g)}}ee(o0,"FillBucket",{omit:["layers","patternFeatures"]});const tF=new Xr({"fill-sort-key":new Ft($e.layout_fill["fill-sort-key"]),visibility:new ct($e.layout_fill.visibility)});var rF={paint:new Xr({"fill-antialias":new ct($e.paint_fill["fill-antialias"]),"fill-opacity":new Ft($e.paint_fill["fill-opacity"]),"fill-color":new Ft($e.paint_fill["fill-color"]),"fill-outline-color":new Ft($e.paint_fill["fill-outline-color"]),"fill-translate":new ct($e.paint_fill["fill-translate"]),"fill-translate-anchor":new ct($e.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ft($e.paint_fill["fill-pattern"]),"fill-emissive-strength":new ct($e.paint_fill["fill-emissive-strength"])}),layout:tF};class _b{constructor(e,r,s,u){if(this.triangleCount=r.length/3,this.min=new Mt(0,0),this.max=new Mt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[f,d]=[e[0].clone(),e[0].clone()];for(let A=1;A<e.length;++A){const C=e[A];f.x=Math.min(f.x,C.x),f.y=Math.min(f.y,C.y),d.x=Math.max(d.x,C.x),d.y=Math.max(d.y,C.y)}if(u){const A=Math.ceil(Math.max(d.x-f.x,d.y-f.y)/u);s=Math.max(s,A)}if(s===0)return;this.min=f,this.max=d;const g=this.max.sub(this.min);g.x=Math.max(g.x,1),g.y=Math.max(g.y,1);const v=Math.max(g.x,g.y)/s;this.cellsX=Math.max(1,Math.ceil(g.x/v)),this.cellsY=Math.max(1,Math.ceil(g.y/v)),this.xScale=1/v,this.yScale=1/v;const T=[];for(let A=0;A<this.triangleCount;A++){const C=e[r[3*A+0]].sub(this.min),k=e[r[3*A+1]].sub(this.min),L=e[r[3*A+2]].sub(this.min),F=Sl(Math.floor(Math.min(C.x,k.x,L.x)),this.xScale,this.cellsX),N=Sl(Math.floor(Math.max(C.x,k.x,L.x)),this.xScale,this.cellsX),G=Sl(Math.floor(Math.min(C.y,k.y,L.y)),this.yScale,this.cellsY),ne=Sl(Math.floor(Math.max(C.y,k.y,L.y)),this.yScale,this.cellsY),ie=new Mt(0,0),oe=new Mt(0,0),me=new Mt(0,0),pe=new Mt(0,0);for(let Ee=G;Ee<=ne;++Ee){ie.y=oe.y=Ee*v,me.y=pe.y=(Ee+1)*v;for(let De=F;De<=N;++De)ie.x=me.x=De*v,oe.x=pe.x=(De+1)*v,(rb(C,k,L,ie,oe,pe)||rb(C,k,L,ie,pe,me))&&T.push({cellIdx:Ee*this.cellsX+De,triIdx:A})}}if(T.length===0)return;T.sort((A,C)=>A.cellIdx-C.cellIdx||A.triIdx-C.triIdx);let E=0;for(;E<T.length;){const A=T[E].cellIdx,C={start:this.payload.length,len:0};for(;E<T.length&&T[E].cellIdx===A;)++C.len,this.payload.push(T[E++].triIdx);this.cells[A]=C}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const s=Sl(e.x-this.min.x,this.xScale,this.cellsX),u=Sl(e.y-this.min.y,this.yScale,this.cellsY),f=this.cells[u*this.cellsX+s];if(f){this._lazyInitLookup();for(let d=0;d<f.len;d++){const g=this.payload[f.start+d],v=Math.floor(g/8),T=1<<g%8;if(!(this.lookup[v]&T)&&(this.lookup[v]|=T,r.push(g),r.length===this.triangleCount))return}}}query(e,r,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();const u=Sl(e.x-this.min.x,this.xScale,this.cellsX),f=Sl(r.x-this.min.x,this.xScale,this.cellsX),d=Sl(e.y-this.min.y,this.yScale,this.cellsY),g=Sl(r.y-this.min.y,this.yScale,this.cellsY);for(let v=d;v<=g;v++)for(let T=u;T<=f;T++){const E=this.cells[v*this.cellsX+T];if(E)for(let A=0;A<E.len;A++){const C=this.payload[E.start+A],k=Math.floor(C/8),L=1<<C%8;if(!(this.lookup[k]&L)&&(this.lookup[k]|=L,s.push(C),s.length===this.triangleCount))return}}}}function Sl(t,e,r){return Math.max(0,Math.min(r-1,Math.floor(t*e)))}ee(_b,"TriangleGridIndex");class II{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.footprints=[]}updateFootprints(e,r){for(const s of this.footprints)r.push({footprint:s,id:e})}populate(e,r,s,u){const f=[];for(const{feature:d,id:g,index:v,sourceLayerIndex:T}of e){const E=this.layers[0]._featureFilter.needGeometry,A=mu(d,E);if(!this.layers[0]._featureFilter.filter(new pr(this.zoom),A,s))continue;const C={id:g,properties:d.properties,type:d.type,sourceLayerIndex:T,index:v,geometry:E?A.geometry:qa(d,s,u),patterns:{}};f.push(C)}for(const d of f){const{geometry:g,index:v,sourceLayerIndex:T}=d;this.addFeature(d,g,v,s,{},r.availableImages,r.brightness),r.featureIndex.insert(e[v].feature,g,v,T,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,r,s,u,f){}destroy(){}addFeature(e,r,s,u,f,d=[],g){for(const v of i0(r,2)){const T=[],E=[],A=[],C=new Mt(1/0,1/0),k=new Mt(-1/0,-1/0);for(const N of v)if(N.length!==0){N!==v[0]&&A.push(E.length/2);for(let G=0;G<N.length;G++)E.push(N[G].x),E.push(N[G].y),T.push(N[G]),C.x=Math.min(C.x,N[G].x),C.y=Math.min(C.y,N[G].y),k.x=Math.max(k.x,N[G].x),k.y=Math.max(k.y,N[G].y)}const L=Km(E,A),F=new _b(T,L,8,256);this.footprints.push({vertices:T,indices:L,grid:F,min:C,max:k})}}}ee(II,"ClipBucket",{omit:["layers"]});const nF=new Xr({"clip-layer-types":new ct($e.layout_clip["clip-layer-types"])});var iF={paint:new Xr({}),layout:nF};const oF=Yr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),sF=Yr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),aF=Yr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),lF=Yr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),uF=Yr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:cF}=oF;var s0={},hF=Ds,AI=bd;function bd(t,e,r,s,u){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=u,t.readFields(fF,this,e)}function fF(t,e,r){t==1?e.id=r.readVarint():t==2?function(s,u){for(var f=s.readVarint()+s.pos;s.pos<f;){var d=u._keys[s.readVarint()],g=u._values[s.readVarint()];u.properties[d]=g}}(r,e):t==3?e.type=r.readVarint():t==4&&(e._geometry=r.pos)}function dF(t){for(var e,r,s=0,u=0,f=t.length,d=f-1;u<f;d=u++)s+=((r=t[d]).x-(e=t[u]).x)*(e.y+r.y);return s}bd.types=["Unknown","Point","LineString","Polygon"],bd.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,s=1,u=0,f=0,d=0,g=[];t.pos<r;){if(u<=0){var v=t.readVarint();s=7&v,u=v>>3}if(u--,s===1||s===2)f+=t.readSVarint(),d+=t.readSVarint(),s===1&&(e&&g.push(e),e=[]),e.push(new hF(f,d));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&g.push(e),g},bd.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,s=0,u=0,f=0,d=1/0,g=-1/0,v=1/0,T=-1/0;t.pos<e;){if(s<=0){var E=t.readVarint();r=7&E,s=E>>3}if(s--,r===1||r===2)(u+=t.readSVarint())<d&&(d=u),u>g&&(g=u),(f+=t.readSVarint())<v&&(v=f),f>T&&(T=f);else if(r!==7)throw new Error("unknown command "+r)}return[d,v,g,T]},bd.prototype.toGeoJSON=function(t,e,r){var s,u,f=this.extent*Math.pow(2,r),d=this.extent*t,g=this.extent*e,v=this.loadGeometry(),T=bd.types[this.type];function E(k){for(var L=0;L<k.length;L++){var F=k[L];k[L]=[360*(F.x+d)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(F.y+g)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(s=0;s<v.length;s++)A[s]=v[s][0];E(v=A);break;case 2:for(s=0;s<v.length;s++)E(v[s]);break;case 3:for(v=function(k){var L=k.length;if(L<=1)return[k];for(var F,N,G=[],ne=0;ne<L;ne++){var ie=dF(k[ne]);ie!==0&&(N===void 0&&(N=ie<0),N===ie<0?(F&&G.push(F),F=[k[ne]]):F.push(k[ne]))}return F&&G.push(F),G}(v),s=0;s<v.length;s++)for(u=0;u<v[s].length;u++)E(v[s][u])}v.length===1?v=v[0]:T="Multi"+T;var C={type:"Feature",geometry:{type:T,coordinates:v},properties:this.properties};return"id"in this&&(C.id=this.id),C};var pF=AI,CI=PI;function PI(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(mF,this,e),this.length=this._features.length}function mF(t,e,r){t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(function(s){for(var u=null,f=s.readVarint()+s.pos;s.pos<f;){var d=s.readVarint()>>3;u=d===1?s.readString():d===2?s.readFloat():d===3?s.readDouble():d===4?s.readVarint64():d===5?s.readVarint():d===6?s.readSVarint():d===7?s.readBoolean():null}return u}(r))}PI.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new pF(this._pbf,e,this.extent,this._keys,this._values)};var _F=CI;function gF(t,e,r){if(t===3){var s=new _F(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}var gb=s0.VectorTile=function(t,e){this.layers=t.readFields(gF,{},e)},a0=s0.VectorTileFeature=AI;s0.VectorTileLayer=CI;class Wh extends Mt{constructor(e,r,s){super(e,r),this.z=s}}class OI extends Wh{constructor(e,r,s,u){super(e,r,s),this.w=u}}function l0(t,e,r,s){const u=[],f=s===0?(d,g,v,T,E,A)=>{d.push(new Mt(A,v+(A-g)/(T-g)*(E-v)))}:(d,g,v,T,E,A)=>{d.push(new Mt(g+(A-v)/(E-v)*(T-g),A))};for(const d of t){const g=[];for(const v of d){if(v.length<=2)continue;const T=[];for(let C=0;C<v.length-1;C++){const k=v[C].x,L=v[C].y,F=v[C+1].x,N=v[C+1].y,G=s===0?k:L,ne=s===0?F:N;G<e?ne>e&&f(T,k,L,F,N,e):G>r?ne<r&&f(T,k,L,F,N,r):T.push(v[C]),ne<e&&G>=e&&f(T,k,L,F,N,e),ne>r&&G<=r&&f(T,k,L,F,N,r)}let E=v[v.length-1];const A=s===0?E.x:E.y;A>=e&&A<=r&&T.push(E),T.length&&(E=T[T.length-1],T[0].x===E.x&&T[0].y===E.y||T.push(T[0]),g.push(T))}g.length&&u.push(g)}return u}function DI(t,e,r,s){const u=r==="x"?"y":"x",f=(s-t[r])/(e[r]-t[r]);t[u]=t[u]+(e[u]-t[u])*f,t[r]=s,t.hasOwnProperty("z")&&(t.z=nr(t.z,e.z,f)),t.hasOwnProperty("w")&&(t.w=nr(t.w,e.w,f))}function RI(t,e,r,s){const u=r,f=s;for(const d of["x","y"]){let g=t,v=e;g[d]>=v[d]&&(g=e,v=t),g[d]<u&&v[d]>u&&DI(g,v,d,u),g[d]<f&&v[d]>f&&DI(v,g,d,f)}}function u0(t,e){return t.x-e.x||t.y-e.y}function kI(t,e){return u0(t.min,e.min)===0&&u0(t.max,e.max)===0}function yb(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function vb(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r].sourceId!==e[r].sourceId||!kI(t[r],e[r])||t[r].order!==e[r].order||t[r].clipMask!==e[r].clipMask)return!1;return!0}function LI(t,e,r){const s=1/At,u=1/(1<<r.canonical.z),f=(e.x*s+r.canonical.x)*u+r.wrap,d=(e.y*s+r.canonical.y)*u;return{min:new Mt((t.x*s+r.canonical.x)*u+r.wrap,(t.y*s+r.canonical.y)*u),max:new Mt(f,d)}}function yF(t,e,r){const s=1<<r.canonical.z,u=((e.x-r.wrap)*s-r.canonical.x)*At,f=(e.y*s-r.canonical.y)*At;return{min:new Mt(((t.x-r.wrap)*s-r.canonical.x)*At,(t.y*s-r.canonical.y)*At),max:new Mt(u,f)}}function zI(t,e,r,s,u,f,d){const g=t.indices,v=t.vertices,T=[];for(let E=s;E<s+u;E+=3){const A=e[r[E+0]+f],C=e[r[E+1]+f],k=e[r[E+2]+f],L=Math.min(A.x,C.x,k.x),F=Math.max(A.x,C.x,k.x),N=Math.min(A.y,C.y,k.y),G=Math.max(A.y,C.y,k.y);T.length=0,t.grid.query(new Mt(L,N),new Mt(F,G),T);for(let ne=0;ne<T.length;ne++){const ie=T[ne];if(rb(v[g[3*ie+0]],v[g[3*ie+1]],v[g[3*ie+2]],A,C,k,d))return!0}}return!1}function FI(t,e,r,s){if(!t||!r)return!1;let u=t.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(r.vertices.length<t.vertices.length)return FI(r,s,t,e);const f=e.canonical,d=s.canonical,g=Math.pow(2,d.z-f.z);u=t.vertices.map(v=>new Mt((v.x+f.x*At)*g-d.x*At,(v.y+f.y*At)*g-d.y*At))}return zI(r,u,t.indices,0,t.indices.length,0,0)}function BI(t,e,r,s){const u=Math.pow(2,s.z-r.z);return new Mt((t+r.x*At)*u-s.x*At,(e+r.y*At)*u-s.y*At)}function NI(t,e){const r=[];e.footprint.grid.queryPoint(t,r);const s=e.footprint.indices,u=e.footprint.vertices;for(let f=0;f<r.length;f++){const d=r[f];if(mc([u[s[3*d+0]],u[s[3*d+1]],u[s[3*d+2]]],t))return!0}return!1}class UI{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const s=this.toIdx(e,r);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function jI(t,e,r,s){let u=0,f=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(s[d])<1e-15){if(r[d]<t[d]||r[d]>e[d])return null}else{const g=1/s[d];let v=(t[d]-r[d])*g,T=(e[d]-r[d])*g;if(v>T){const E=v;v=T,T=E}if(v>u&&(u=v),T<f&&(f=T),u>f)return null}return u}function VI(t,e,r,s,u,f,d,g,v,T,E){const A=s-t,C=u-e,k=f-r,L=d-t,F=g-e,N=v-r,G=E[1]*N-E[2]*F,ne=E[2]*L-E[0]*N,ie=E[0]*F-E[1]*L,oe=A*G+C*ne+k*ie;if(Math.abs(oe)<1e-15)return null;const me=1/oe,pe=T[0]-t,Ee=T[1]-e,De=T[2]-r,je=(pe*G+Ee*ne+De*ie)*me;if(je<0||je>1)return null;const Qe=Ee*k-De*C,Ze=De*A-pe*k,ut=pe*C-Ee*A,vt=(E[0]*Qe+E[1]*Ze+E[2]*ut)*me;return vt<0||je+vt>1?null:(L*Qe+F*Ze+N*ut)*me}function $I(t,e,r){return(t-e)/(r-e)}function GI(t,e,r,s,u,f,d,g,v){const T=1<<r,E=f-s,A=d-u,C=(t+1)/T*E+s,k=(e+0)/T*A+u,L=(e+1)/T*A+u;g[0]=(t+0)/T*E+s,g[1]=k,v[0]=C,v[1]=L}class WI{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(f){const d=Math.ceil(Math.log2(f.dim/8)),g=[];let v=Math.ceil(Math.pow(2,d));const T=1/v,E=(k,L,F,N,G)=>{const ne=N?1:0,ie=(k+1)*F-ne,oe=L*F,me=(L+1)*F-ne;G[0]=k*F,G[1]=oe,G[2]=ie,G[3]=me};let A=new UI(v);const C=[];for(let k=0;k<v*v;k++){E(k%v,Math.floor(k/v),T,!1,C);const L=gc(C[0],C[1],f),F=gc(C[2],C[1],f),N=gc(C[2],C[3],f),G=gc(C[0],C[3],f);A.minimums.push(Math.min(L,F,N,G)),A.maximums.push(Math.max(L,F,N,G)),A.leaves.push(1)}for(g.push(A),v/=2;v>=1;v/=2){const k=g[g.length-1];A=new UI(v);for(let L=0;L<v*v;L++){E(L%v,Math.floor(L/v),2,!0,C);const F=k.getElevation(C[0],C[1]),N=k.getElevation(C[2],C[1]),G=k.getElevation(C[2],C[3]),ne=k.getElevation(C[0],C[3]),ie=k.isLeaf(C[0],C[1]),oe=k.isLeaf(C[2],C[1]),me=k.isLeaf(C[2],C[3]),pe=k.isLeaf(C[0],C[3]),Ee=Math.min(F.min,N.min,G.min,ne.min),De=Math.max(F.max,N.max,G.max,ne.max),je=ie&&oe&&me&&pe;A.maximums.push(De),A.minimums.push(Ee),A.leaves.push(De-Ee<=5&&je?1:0)}g.push(A)}return g}(this.dem),s=r.length-1,u=r[s];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(r,0,0,s,0)}raycastRoot(e,r,s,u,f,d,g=1){return jI([e,r,-100],[s,u,this.maximums[0]*g],f,d)}raycast(e,r,s,u,f,d,g=1){if(!this.nodeCount)return null;const v=this.raycastRoot(e,r,s,u,f,d,g);if(v==null)return null;const T=[],E=[],A=[],C=[],k=[{idx:0,t:v,nodex:0,nodey:0,depth:0}];for(;k.length>0;){const{idx:L,t:F,nodex:N,nodey:G,depth:ne}=k.pop();if(this.leaves[L]){GI(N,G,ne,e,r,s,u,A,C);const oe=1<<ne,me=(N+0)/oe,pe=(N+1)/oe,Ee=(G+0)/oe,De=(G+1)/oe,je=gc(me,Ee,this.dem)*g,Qe=gc(pe,Ee,this.dem)*g,Ze=gc(pe,De,this.dem)*g,ut=gc(me,De,this.dem)*g,vt=VI(A[0],A[1],je,C[0],A[1],Qe,C[0],C[1],Ze,f,d),ot=VI(C[0],C[1],Ze,A[0],C[1],ut,A[0],A[1],je,f,d),mt=Math.min(vt!==null?vt:Number.MAX_VALUE,ot!==null?ot:Number.MAX_VALUE);if(mt!==Number.MAX_VALUE)return mt;{const tt=o._.scaleAndAdd([],f,d,F);if(qI(je,Qe,ut,Ze,$I(tt[0],A[0],C[0]),$I(tt[1],A[1],C[1]))>=tt[2])return F}continue}let ie=0;for(let oe=0;oe<this._siblingOffset.length;oe++){GI((N<<1)+this._siblingOffset[oe][0],(G<<1)+this._siblingOffset[oe][1],ne+1,e,r,s,u,A,C),A[2]=-100,C[2]=this.maximums[this.childOffsets[L]+oe]*g;const me=jI(A,C,f,d);if(me!=null){const pe=me;T[oe]=pe;let Ee=!1;for(let De=0;De<ie&&!Ee;De++)pe>=T[E[De]]&&(E.splice(De,0,oe),Ee=!0);Ee||(E[ie]=oe),ie++}}for(let oe=0;oe<ie;oe++){const me=E[oe];k.push({idx:this.childOffsets[L]+me,t:T[me],nodex:(N<<1)+this._siblingOffset[me][0],nodey:(G<<1)+this._siblingOffset[me][1],depth:ne+1})}}return null}_addNode(e,r,s){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,s,u,f){if(e[u].isLeaf(r,s)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const d=u-1,g=e[d];let v=0,T=0;for(let E=0;E<this._siblingOffset.length;E++){const A=2*r+this._siblingOffset[E][0],C=2*s+this._siblingOffset[E][1],k=g.getElevation(A,C),L=g.isLeaf(A,C),F=this._addNode(k.min,k.max,L);L&&(v|=1<<E),T||(T=F)}for(let E=0;E<this._siblingOffset.length;E++)v&1<<E||this._construct(e,2*r+this._siblingOffset[E][0],2*s+this._siblingOffset[E][1],d,T+E)}}function qI(t,e,r,s,u,f){return nr(nr(t,r,f),nr(e,s,f),u)}function gc(t,e,r){const s=r.dim,u=Kt(t*s-.5,0,s-1),f=Kt(e*s-.5,0,s-1),d=Math.floor(u),g=Math.floor(f),v=Math.min(d+1,s-1),T=Math.min(g+1,s-1);return qI(r.get(d,g),r.get(v,g),r.get(d,T),r.get(v,T),u-d,f-g)}const vF={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function xF(t,e,r){return(256*t*256+256*e+r)/10-1e4}function bF(t,e,r){return 256*t+e+r/256-32768}class c0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,s,u=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return zn(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const f=this.dim=r.height-2,d=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let v=0;v<f;v++)d[this._idx(-1,v)]=d[this._idx(0,v)],d[this._idx(f,v)]=d[this._idx(f-1,v)],d[this._idx(v,-1)]=d[this._idx(v,0)],d[this._idx(v,f)]=d[this._idx(v,f-1)];d[this._idx(-1,-1)]=d[this._idx(0,0)],d[this._idx(f,-1)]=d[this._idx(f-1,0)],d[this._idx(-1,f)]=d[this._idx(0,f-1)],d[this._idx(f,f)]=d[this._idx(f-1,f-1)]}const g=s==="terrarium"?bF:xF;for(let v=0;v<d.length;++v){const T=4*v;this.floatView[v]=g(this.pixels[T],this.pixels[T+1],this.pixels[T+2])}this._timestamp=Pi.now()}_buildQuadTree(){this._tree=new WI(this)}get(e,r,s=!1){s&&(e=Kt(e,-1,this.dim),r=Kt(r,-1,this.dim));const u=this._idx(e,r);return this.floatView[u]}set(e,r,s){const u=this._idx(e,r),f=this.floatView[u];return this.floatView[u]=s,s-f}static getUnpackVector(e){return vF[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const s=[0,0,0,0],u=c0.getUnpackVector(r);let f=Math.floor((e+u[3])/u[2]);return s[2]=f%256,f=Math.floor(f/256),s[1]=f%256,f=Math.floor(f/256),s[0]=f,s}getPixels(){return new wI({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,f=r*this.dim+this.dim,d=s*this.dim,g=s*this.dim+this.dim;switch(r){case-1:u=f-1;break;case 1:f=u+1}switch(s){case-1:d=g-1;break;case 1:g=d+1}const v=-r*this.dim,T=-s*this.dim;for(let E=d;E<g;E++)for(let A=u;A<f;A++){const C=4*this._idx(A,E),k=4*this._idx(A+v,E+T);this.pixels[C+0]=e.pixels[k+0],this.pixels[C+1]=e.pixels[k+1],this.pixels[C+2]=e.pixels[k+2],this.pixels[C+3]=e.pixels[k+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ee(c0,"DEMData"),ee(WI,"DemMinMaxQuadTree",{omit:["dem"]});class wd{constructor(e,r,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=s}static create(e,r,s){const u=s||e.findDEMTileFor(r);if(!u||!u.dem)return;const f=u.dem,d=u.tileID,g=1<<r.canonical.z-d.canonical.z;return new wd(u,f.dim/At/g,[(r.canonical.x/g-d.canonical.x)*f.dim,(r.canonical.y/g-d.canonical.y)*f.dim])}tileCoordToPixel(e,r){const s=r*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(s);return new Mt(u,f)}getElevationAt(e,r,s,u){const f=e*this._scale+this._offset[0],d=r*this._scale+this._offset[1],g=Math.floor(f),v=Math.floor(d),T=this._dem;return u=!!u,s?nr(nr(T.get(g,v,u),T.get(g,v+1,u),d-v),nr(T.get(g+1,v,u),T.get(g+1,v+1,u),d-v),f-g):T.get(g,v,u)}getElevationAtPixel(e,r,s){return this._dem.get(e,r,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ao(1,e)*this._dem.stride}}const HI={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7},wF=a0.types,TF=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],SF=["fill-extrusion-flood-light-ground-radius"],EF=Math.pow(2,13),MF=Math.pow(2,15)-1,ZI=new Mt(0,1),yc=2147483648;function t_(t,e,r,s,u,f,d,g){t.emplaceBack((e<<1)+d,(r<<1)+f,(Math.floor(s*EF)<<1)+u,Math.round(g))}function h0(t,e,r,s,u,f){t.emplaceBack(e.x,e.y,(r.x<<1)+s,(r.y<<1)+u,f)}function r_(t,e,r){t.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class XI{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class YI{constructor(){this.centroidXY=new Mt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Mt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Mt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Mt(this.max.x-this.min.x,this.max.y-this.min.y)}}class KI{constructor(){this.acc=new Mt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,s){this.accCount++,this.acc._add(r);let u=!!this.borders;r.x<e.min.x?(e.min.x=r.x,u=!0):r.x>e.max.x&&(e.max.x=r.x,u=!0),r.y<e.min.y?(e.min.y=r.y,u=!0):r.y>e.max.y&&(e.max.y=r.y,u=!0),((r.x===0||r.x===At)&&r.x===s.x)!=((r.y===0||r.y===At)&&r.y===s.y)&&this.processBorderOverlap(r,s),u&&this.checkBorderIntersection(r,s)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,nr(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>At!=e.x>At&&this.addBorderIntersection(1,nr(r.y,e.y,(At-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,nr(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>At!=e.y>At&&this.addBorderIntersection(3,nr(r.x,e.x,(At-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];r<s[0]&&(s[0]=r),r>s[1]&&(s[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,r.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,r.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new Mt(0,0):new Mt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0):0}}function QI(t,e){const r=t.add(e)._unit(),s=Kt(t.x*r.x+t.y*r.y,-1,1);var u,f,d;return u=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(u)))/4*MF*((f=t).x*(d=e).y-f.y*d.x<0?-1:1)}const IF=[t=>t.x<0,t=>t.x>At,t=>t.y<0,t=>t.y>At];function AF(t,e,r,s){const u=[4];if(s===0)return u;r._mult(s);const f=t.sub(r),d=e.sub(r),g=[t,e,f,d];for(let v=0;v<4;v++)for(const T of g)if(IF[v](T)){u.push(v);break}return u}class JI{constructor(e){this.vertexArray=new S1,this.indexArray=new Si,this.programConfigurations=new dc(e.layers,{zoom:e.zoom,lut:e.lut},r=>SF.includes(r)),this._segments=new In,this.hiddenByLandmarkVertexArray=new B1,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new In}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,s,u=!1){const f=e.length;if(f>2){let d=Math.max(0,this._segments.get().length-1);const g=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[d].length);let v;d!==this._segments.get().length-1&&(d++,this._segmentToGroundQuads[d]=[],this._segmentToRegionTriCounts[d]=[0,0,0,0,0]);{const T=e[0],E=e[1];v=QI(T.sub(e[f-1])._perp()._unit(),E.sub(T)._perp()._unit())}for(let T=0;T<f;T++){const E=T===f-1?0:T+1,A=e[T],C=e[E],k=e[E===f-1?0:E+1],L=C.sub(A)._perp()._unit(),F=QI(L,k.sub(C)._perp()._unit()),N=v,G=F;if(xb(A,C,r)||u&&rA(A,r)&&rA(C,r)){v=F;continue}const ne=g.vertexLength;h0(this.vertexArray,A,C,1,1,N),h0(this.vertexArray,A,C,1,0,N),h0(this.vertexArray,A,C,0,1,G),h0(this.vertexArray,A,C,0,0,G),g.vertexLength+=4;const ie=AF(A,C,L,s);for(const oe of ie)this._segmentToGroundQuads[d].push({id:ne,region:oe}),this._segmentToRegionTriCounts[d][oe]+=2,g.primitiveLength+=2;v=F}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),r=e.length;for(let s=0;s<r;s++)this._segmentToGroundQuads[s].sort((u,f)=>u.region-f.region);for(let s=0;s<r;s++){const u=this._segmentToGroundQuads[s],f=e[s],d=this._segmentToRegionTriCounts[s];d.reduce((v,T)=>v+T,0);let g=0;for(let v=0;v<=4;v++){const T=d[v];if(T!==0){let E=this.regionSegments[v];E||(E=this.regionSegments[v]=new In);const A={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+g,vertexLength:f.vertexLength,primitiveLength:T};E.get().push(A)}g+=T}for(let v=0;v<u.length;v++){const T=u[v].id;this.indexArray.emplaceBack(T,T+1,T+3),this.indexArray.emplaceBack(T,T+3,T+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,s,u,f,d){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,s,u,f,d)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,sF.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,s,u,f,d){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,s,u,f,d)}updateHiddenByLandmark(e){if(!this.hasData())return;const r=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const s=e.flags&yc?1:0;for(let u=e.groundVertexArrayOffset;u<r;++u)this.hiddenByLandmarkVertexArray.emplace(u,s);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,lF.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const r=this.regionSegments[e];r&&r.destroy()}}}}class f0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Si,this.footprintVertices=new Ga,this.footprintSegments=[],this.layoutVertexArray=new ac,this.centroidVertexArray=new BM,this.indexArray=new Si,this.programConfigurations=new dc(e.layers,{zoom:e.zoom,lut:e.lut},r=>TF.includes(r)),this.segments=new In,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new JI(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,r){}populate(e,r,s,u){this.features=[],this.hasPattern=pb("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Hy(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:d,index:g,sourceLayerIndex:v}of e){const T=this.layers[0]._featureFilter.needGeometry,E=mu(f,T);if(!this.layers[0]._featureFilter.filter(new pr(this.zoom),E,s))continue;const A={id:d,sourceLayerIndex:v,index:g,geometry:T?E.geometry:qa(f,s,u),properties:f.properties,type:f.type,patterns:{}},C=this.layoutVertexArray.length;this.hasPattern?this.features.push(mb("fill-extrusion",this.layers,A,this.zoom,r)):this.addFeature(A,A.geometry,g,s,{},r.availableImages,u,r.brightness),r.featureIndex.insert(f,A.geometry,g,v,this.index,C)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,s,u,f,d){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,r,s,u,f,d)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,s,u,f){const d=Object.keys(e).length!==0;if(d&&!this.stateDependentLayers.length)return;const g=d?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,r,g,s,u,f),this.groundEffect.update(e,r,g,s,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cF),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,uF.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,aF.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,u,f,d,g,v){const T=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,E=[new Mt(0,0),new Mt(At,At)],A=g.projection,C=A.name==="globe",k=wF[e.type]==="Polygon",L=new KI;L.centroidDataIndex=this.centroidData.length;const F=new YI,N=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},u)<=0,G=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},u);F.height=G,F.vertexArrayOffset=this.layoutVertexArray.length,F.groundVertexArrayOffset=this.groundEffect.vertexArray.length,C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Vy);const ne=i0(r,500);for(let De=ne.length-1;De>=0;De--){const je=ne[De];(je.length===0||(ie=je[0]).every(Qe=>Qe.x<=0)||ie.every(Qe=>Qe.x>=At)||ie.every(Qe=>Qe.y<=0)||ie.every(Qe=>Qe.y>=At))&&ne.splice(De,1)}var ie;let oe;if(C)oe=sA(ne,E,u);else{oe=[];for(const De of ne)oe.push({polygon:De,bounds:E})}const me=k?this.edgeRadius:0,pe=me>0&&this.zoom<17,Ee=(De,je)=>{if(De.length===0)return!1;const Qe=De[De.length-1];return je.x===Qe.x&&je.y===Qe.y};for(const{polygon:De,bounds:je}of oe){let Qe=0,Ze=0;for(const mt of De)k&&!mt[0].equals(mt[mt.length-1])&&mt.push(mt[0]),Ze+=k?mt.length-1:mt.length;const ut=this.segments.prepareSegment((k?5:4)*Ze,this.layoutVertexArray,this.indexArray);F.footprintSegIdx<0&&(F.footprintSegIdx=this.footprintSegments.length),F.polygonSegIdx<0&&(F.polygonSegIdx=this.polygonSegments.length);const vt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ot=new XI;if(ot.vertexOffset=this.footprintVertices.length,ot.indexOffset=3*this.footprintIndices.length,ot.ringIndices=[],k){const mt=[],tt=[];Qe=ut.vertexLength;for(let bt=0;bt<De.length;bt++){const gt=De[bt];gt.length&&bt!==0&&tt.push(mt.length/2);const zt=[];let xt,Tt;xt=gt[1].sub(gt[0])._perp()._unit(),ot.ringIndices.push(gt.length-1);for(let Jt=1;Jt<gt.length;Jt++){const Yt=gt[Jt],Xt=gt[Jt===gt.length-1?1:Jt+1],wt=Yt.clone();if(me){Tt=Xt.sub(Yt)._perp()._unit();const tr=xt.add(Tt)._unit(),wr=me*Math.min(4,1/(xt.x*tr.x+xt.y*tr.y));wt.x+=wr*tr.x,wt.y+=wr*tr.y,wt.x=Math.round(wt.x),wt.y=Math.round(wt.y),xt=Tt}!N||me!==0&&!pe||Ee(zt,wt)||zt.push(wt),t_(this.layoutVertexArray,wt.x,wt.y,0,0,1,1,0),ut.vertexLength++,this.footprintVertices.emplaceBack(Yt.x,Yt.y),mt.push(Yt.x,Yt.y),C&&r_(this.layoutVertexExtArray,A.projectTilePoint(wt.x,wt.y,u),A.upVector(u,wt.x,wt.y))}N&&(me===0||pe)&&(zt.length!==0&&Ee(zt,zt[0])&&zt.pop(),this.groundEffect.addData(zt,je,T))}const _t=Km(mt,tt);for(let bt=0;bt<_t.length;bt+=3)this.footprintIndices.emplaceBack(ot.vertexOffset+_t[bt+0],ot.vertexOffset+_t[bt+1],ot.vertexOffset+_t[bt+2]),this.indexArray.emplaceBack(Qe+_t[bt],Qe+_t[bt+2],Qe+_t[bt+1]),ut.primitiveLength++;ot.indexCount+=_t.length,ot.vertexCount+=this.footprintVertices.length-ot.vertexOffset}for(let mt=0;mt<De.length;mt++){const tt=De[mt];L.startRing(F,tt[0]);let _t=tt.length>4&&nA(tt[tt.length-2],tt[0],tt[1]),bt=me?CF(tt[tt.length-2],tt[0],tt[1],me):0;const gt=[];let zt,xt,Tt;xt=tt[1].sub(tt[0])._perp()._unit();let Jt=!0;for(let Yt=1,Xt=0;Yt<tt.length;Yt++){let wt=tt[Yt-1],tr=tt[Yt];const wr=tt[Yt===tt.length-1?1:Yt+1];if(L.appendEdge(F,tr,wt),xb(tr,wt,je)){me&&(xt=wr.sub(tr)._perp()._unit(),Jt=!Jt);continue}const fr=tr.sub(wt)._perp(),Mr=fr.x/(Math.abs(fr.x)+Math.abs(fr.y)),Tr=fr.y>0?1:0,Or=wt.dist(tr);if(Xt+Or>32768&&(Xt=0),me){Tt=wr.sub(tr)._perp()._unit();let qr=tA(wt,tr,wr,eA(xt,Tt),me);isNaN(qr)&&(qr=0);const Nr=tr.sub(wt)._unit();wt=wt.add(Nr.mult(bt))._round(),tr=tr.add(Nr.mult(-qr))._round(),bt=qr,xt=Tt,N&&this.zoom>=17&&(Ee(gt,wt)||gt.push(wt),Ee(gt,tr)||gt.push(tr))}const ur=ut.vertexLength,nn=tt.length>4&&nA(wt,tr,wr);let tn=iA(Xt,_t,Jt);if(t_(this.layoutVertexArray,wt.x,wt.y,Mr,Tr,0,0,tn),t_(this.layoutVertexArray,wt.x,wt.y,Mr,Tr,0,1,tn),Xt+=Or,tn=iA(Xt,nn,!Jt),_t=nn,t_(this.layoutVertexArray,tr.x,tr.y,Mr,Tr,0,0,tn),t_(this.layoutVertexArray,tr.x,tr.y,Mr,Tr,0,1,tn),ut.vertexLength+=4,this.indexArray.emplaceBack(ur+0,ur+1,ur+2),this.indexArray.emplaceBack(ur+1,ur+3,ur+2),ut.primitiveLength+=2,me){const qr=Qe+(Yt===1?tt.length-2:Yt-2),Nr=Yt===1?Qe:qr+1;if(this.indexArray.emplaceBack(ur+1,qr,ur+3),this.indexArray.emplaceBack(qr,Nr,ur+3),ut.primitiveLength+=2,zt===void 0&&(zt=ur),!xb(wr,tt[Yt],je)){const Hr=Yt===tt.length-1?zt:ut.vertexLength;this.indexArray.emplaceBack(ur+2,ur+3,Hr),this.indexArray.emplaceBack(ur+3,Hr+1,Hr),this.indexArray.emplaceBack(ur+3,Nr,Hr+1),ut.primitiveLength+=3}Jt=!Jt}if(C){const qr=this.layoutVertexExtArray,Nr=A.projectTilePoint(wt.x,wt.y,u),Hr=A.projectTilePoint(tr.x,tr.y,u),gn=A.upVector(u,wt.x,wt.y),un=A.upVector(u,tr.x,tr.y);r_(qr,Nr,gn),r_(qr,Nr,gn),r_(qr,Hr,un),r_(qr,Hr,un)}}k&&(Qe+=tt.length-1),N&&me&&this.zoom>=17&&(gt.length!==0&&Ee(gt,gt[0])&&gt.pop(),this.groundEffect.addData(gt,je,T,me>0))}this.footprintSegments.push(ot),vt.triangleCount=this.indexArray.length-vt.triangleArrayOffset,this.polygonSegments.push(vt),++F.footprintSegLen,++F.polygonSegLen}if(F.vertexCount=this.layoutVertexArray.length-F.vertexArrayOffset,F.groundVertexCount=this.groundEffect.vertexArray.length-F.groundVertexArrayOffset,F.vertexCount!==0){if(F.centroidXY=L.borders?ZI:this.encodeCentroid(L,F),this.centroidData.push(F),L.borders){this.featuresOnBorder.push(L);const De=this.featuresOnBorder.length-1;for(let je=0;je<L.borders.length;je++)L.borders[je][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[je].push(De)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,d,u,v),this.groundEffect.addPaintPropertiesData(e,s,f,d,u,v),this.maxHeight=Math.max(this.maxHeight,G)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((r,s)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}splitToSubtiles(){const e=[];for(let g=0;g<this.centroidData.length;g++){const v=this.centroidData[g],T=+(v.min.y+v.max.y>At),E=2*T+(+(v.min.x+v.max.x>At)^T);for(let A=0;A<v.polygonSegLen;A++){const C=v.polygonSegIdx+A;e.push({centroidIdx:g,subtile:E,polygonSegmentIdx:C,triangleSegmentIdx:this.polygonSegments[C].triangleSegIdx})}}const r=new Si;e.sort((g,v)=>g.triangleSegmentIdx===v.triangleSegmentIdx?g.subtile-v.subtile:g.triangleSegmentIdx-v.triangleSegmentIdx);let s=0,u=0,f=0;for(const g of e){if(g.triangleSegmentIdx!==s)break;f++}const d=e.length;for(;u!==e.length;){s=e[u].triangleSegmentIdx;let g=0,v=u,T=u;for(let E=v;E<f&&e[E].subtile===g;E++)T++;for(;v!==f;){const E=e[v];g=E.subtile;const A=this.centroidData[E.centroidIdx].min.clone(),C=this.centroidData[E.centroidIdx].max.clone(),k={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let L=v;L<T;L++){const F=e[L],N=this.polygonSegments[F.polygonSegmentIdx],G=this.centroidData[F.centroidIdx].min,ne=this.centroidData[F.centroidIdx].max,ie=this.indexArray.uint16;for(let oe=N.triangleArrayOffset;oe<N.triangleArrayOffset+N.triangleCount;oe++)r.emplaceBack(ie[3*oe],ie[3*oe+1],ie[3*oe+2]);k.primitiveLength+=N.triangleCount,A.x=Math.min(A.x,G.x),A.y=Math.min(A.y,G.y),C.x=Math.max(C.x,ne.x),C.y=Math.max(C.y,ne.y)}k.primitiveLength>0&&this.triangleSubSegments.push({segment:k,min:A,max:C}),v=T;for(let L=v;L<f&&e[L].subtile===e[v].subtile;L++)T++}u=f;for(let E=u;E<d&&e[E].triangleSegmentIdx===e[u].triangleSegmentIdx;E++)f++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,s){let u=0,f=0;const d=1<<e.canonical.z;if(r){const F=r.getMinMaxForTile(e);F&&(u=F.min,f=F.max)}f+=this.maxHeight;const g=e.toUnwrapped();let v;const T=[g.canonical.x/d+g.wrap,g.canonical.y/d],E=[(g.canonical.x+1)/d+g.wrap,(g.canonical.y+1)/d],A=new In,C=(F,N,G)=>[F[0]*(1-G[0])+N[0]*G[0],F[1]*(1-G[1])+N[1]*G[1]],k=[],L=[];for(const F of this.triangleSubSegments){k[0]=F.min.x/At,k[1]=F.min.y/At,L[0]=F.max.x/At,L[1]=F.max.y/At;const N=C(T,E,k),G=C(T,E,L);if(new Tn([N[0],N[1],u],[G[0],G[1],f]).intersectsPrecise(s)===0){v&&(A.segments.push(v),v=void 0);continue}const ne=F.segment;v&&v.vertexOffset!==ne.vertexOffset&&(A.segments.push(v),v=void 0),v?(v.vertexLength+=ne.vertexLength,v.primitiveLength+=ne.primitiveLength):v={vertexOffset:ne.vertexOffset,primitiveLength:ne.primitiveLength,vertexLength:ne.vertexLength,primitiveOffset:ne.primitiveOffset,sortKey:void 0,vaos:{}}}return v&&A.segments.push(v),A}encodeCentroid(e,r){const s=e.centroid(),u=r.span(),f=Math.min(7,Math.round(u.x*this.tileToMeter/10)),d=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new Mt(Kt(s.x,1,At-1)<<3|f,Kt(s.y,1,At-1)<<3|d)}encodeBorderCentroid(e){if(!e.borders)return new Mt(0,0);const r=e.borders,s=Number.MAX_VALUE;if(r[0][0]!==s||r[1][0]!==s){const u=r[0][0]!==s?0:1;return new Mt(6|(r[0][0]!==s?0:65528),(r[u][0]+r[u][1])/2<<3|6)}{const u=r[2][0]!==s?2:3;return new Mt((r[u][0]+r[u][1])/2<<3|6,6|(r[2][0]!==s?0:65528))}}showCentroid(e){const r=this.centroidData[e.centroidDataIndex];r.flags&=yc,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const r=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,u=e.flags&yc?ZI:e.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==u.y||f!==u.x){for(let d=r;d<s;++d)this.centroidVertexArray.emplace(d,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r,s){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const u=r.getReplacementRegionsForTile(e.toUnwrapped());if(vb(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const d of this.centroidData)d.flags&=2147483647;const f=[];for(const d of this.activeReplacements){if(d.order<s)continue;const g=Math.pow(2,d.footprintTileId.canonical.z-e.canonical.z);for(const v of this.centroidData)if(!(v.flags&yc||d.min.x>v.max.x||v.min.x>d.max.x||d.min.y>v.max.y||v.min.y>d.max.y))for(let T=0;T<v.footprintSegLen;T++){const E=this.footprintSegments[v.footprintSegIdx+T];if(f.length=0,PF(this.footprintVertices,E.vertexOffset,E.vertexCount,d.footprintTileId.canonical,e.canonical,f),zI(d.footprint,f,this.footprintIndices.uint16,E.indexOffset,E.indexCount,-E.vertexOffset,-g)){v.flags|=yc;break}}}for(const d of this.centroidData)this.writeCentroidToBuffer(d);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,s){let u=!1;for(let f=0;f<s.footprintSegLen;f++){const d=this.footprintSegments[s.footprintSegIdx+f];let g=0;for(const v of d.ringIndices){for(let T=g,E=v+g-1;T<v+g;E=T++){const A=this.footprintVertices.int16[2*(T+d.vertexOffset)+0],C=this.footprintVertices.int16[2*(T+d.vertexOffset)+1],k=this.footprintVertices.int16[2*(E+d.vertexOffset)+1];C>r!=k>r&&e<(this.footprintVertices.int16[2*(E+d.vertexOffset)+0]-A)*(r-C)/(k-C)+A&&(u=!u)}g=v}}return u}getHeightAtTileCoord(e,r){let s=Number.NEGATIVE_INFINITY,u=!0;const f=4*(e+At)*At+(r+At);if(this.partLookup.hasOwnProperty(f)){const d=this.partLookup[f];return d?{height:d.height,hidden:!!(d.flags&yc)}:void 0}for(const d of this.centroidData)e>d.max.x||d.min.x>e||r>d.max.y||d.min.y>r||this.footprintContainsPoint(e,r,d)&&d&&d.height>s&&(s=d.height,this.partLookup[f]=d,u=!!(d.flags&yc));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:u};this.partLookup[f]=void 0}}function eA(t,e){const r=t.add(e)._unit();return t.x*r.x+t.y*r.y}function CF(t,e,r,s){const u=e.sub(t)._perp()._unit(),f=r.sub(e)._perp()._unit();return tA(t,e,r,eA(u,f),s)}function tA(t,e,r,s,u){const f=Math.sqrt(1-s*s);return Math.min(t.dist(e)/3,e.dist(r)/3,u*f/s)}function xb(t,e,r){return t.x<r[0].x&&e.x<r[0].x||t.x>r[1].x&&e.x>r[1].x||t.y<r[0].y&&e.y<r[0].y||t.y>r[1].y&&e.y>r[1].y}function rA(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function nA(t,e,r){if(t.x<0||t.x>=At||e.x<0||e.x>=At||r.x<0||r.x>=At)return!1;const s=r.sub(e),u=s.perp(),f=t.sub(e);return(s.x*f.x+s.y*f.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(f.x*f.x+f.y*f.y))>-.866&&u.x*f.x+u.y*f.y<0}function iA(t,e,r){const s=e?2|t:-3&t;return r?1|s:-2&s}function oA(){const t=Math.PI/32,e=Math.tan(t),r=gd;return r*Math.sqrt(1+2*e*e)-r}function sA(t,e,r){const s=1<<r.z,u=Ho(r.x/s),f=Ho((r.x+1)/s),d=Di(r.y/s),g=Di((r.y+1)/s);return function(v,T,E,A,C=0,k){const L=[];if(!v.length||!E||!A)return L;const F=(pe,Ee)=>{for(const De of pe)L.push({polygon:De,bounds:Ee})},N=Math.ceil(Math.log2(E)),G=Math.ceil(Math.log2(A)),ne=N-G,ie=[];for(let pe=0;pe<Math.abs(ne);pe++)ie.push(ne>0?0:1);for(let pe=0;pe<Math.min(N,G);pe++)ie.push(0),ie.push(1);let oe=v;if(oe=l0(oe,T[0].y-C,T[1].y+C,1),oe=l0(oe,T[0].x-C,T[1].x+C,0),!oe.length)return L;const me=[];for(ie.length?me.push({polygons:oe,bounds:T,depth:0}):F(oe,T);me.length;){const pe=me.pop(),Ee=pe.depth,De=ie[Ee],je=pe.bounds[0],Qe=pe.bounds[1],Ze=De===0?je.x:je.y,ut=De===0?Qe.x:Qe.y,vt=k?k(De,Ze,ut):.5*(Ze+ut),ot=l0(pe.polygons,Ze-C,vt+C,De),mt=l0(pe.polygons,vt-C,ut+C,De);if(ot.length){const tt=[je,new Mt(De===0?vt:Qe.x,De===1?vt:Qe.y)];ie.length>Ee+1?me.push({polygons:ot,bounds:tt,depth:Ee+1}):F(ot,tt)}if(mt.length){const tt=[new Mt(De===0?vt:je.x,De===1?vt:je.y),Qe];ie.length>Ee+1?me.push({polygons:mt,bounds:tt,depth:Ee+1}):F(mt,tt)}}return L}(t,e,Math.ceil((f-u)/11.25),Math.ceil((d-g)/11.25),1,(v,T,E)=>{if(v===0)return .5*(T+E);{const A=Di((r.y+T/At)/s);return(wl(.5*(Di((r.y+E/At)/s)+A))*s-r.y)*At}})}function PF(t,e,r,s,u,f){const d=Math.pow(2,s.z-u.z);for(let g=0;g<r;g++){let v=t.int16[2*(g+e)+0],T=t.int16[2*(g+e)+1];v=(v+u.x*At)*d-s.x*At,T=(T+u.y*At)*d-s.y*At,f.push(new Mt(v,T))}}ee(f0,"FillExtrusionBucket",{omit:["layers","features"]}),ee(YI,"PartData"),ee(XI,"FootprintSegment"),ee(KI,"BorderCentroidData"),ee(JI,"GroundEffect");const OF=new Xr({visibility:new ct($e["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ct($e["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var DF={paint:new Xr({"fill-extrusion-opacity":new ct($e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ft($e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ct($e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ct($e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ft($e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ft($e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ft($e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ct($e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ct($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ct($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ct($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ct($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ct($e["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ct($e["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ct($e["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ft($e["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ft($e["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ct($e["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ct($e["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ct($e["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ct($e["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ct($e["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:OF};function n_(t,e){return t.x*e.x+t.y*e.y}function aA(t,e){if(t.length===1){let r=0;const s=e[r++];let u;for(;!u||s.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){const f=e[r],d=t[0],g=u.sub(s),v=f.sub(s),T=d.sub(s),E=n_(g,g),A=n_(g,v),C=n_(v,v),k=n_(T,g),L=n_(T,v),F=E*C-A*A,N=(C*k-A*L)/F,G=(E*L-A*k)/F,ne=s.z*(1-N-G)+u.z*N+f.z*G;if(isFinite(ne))return ne}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}function lA(t,e,r,s,u,f,d,g){const v=d*u.getElevationAt(t,e,!0,!0),T=f[0]!==0,E=T?f[1]===0?d*(f[0]/7-450):d*function(A,C,k){const L=Math.floor(C[0]/8),F=Math.floor(C[1]/8),N=10*(C[0]-8*L),G=10*(C[1]-8*F),ne=A.getElevationAt(L,F,!0,!0),ie=A.getMeterToDEM(k),oe=Math.floor(.5*(N*ie-1)),me=Math.floor(.5*(G*ie-1)),pe=A.tileCoordToPixel(L,F),Ee=2*oe+1,De=2*me+1,je=function(mt,tt,_t,bt,gt){return[mt.getElevationAtPixel(tt,_t,!0),mt.getElevationAtPixel(tt+gt,_t,!0),mt.getElevationAtPixel(tt,_t+gt,!0),mt.getElevationAtPixel(tt+bt,_t+gt,!0)]}(A,pe.x-oe,pe.y-me,Ee,De),Qe=Math.abs(je[0]-je[1]),Ze=Math.abs(je[2]-je[3]),ut=Math.abs(je[0]-je[2])+Math.abs(je[1]-je[3]),vt=Math.min(.25,.5*ie*(Qe+Ze)/Ee),ot=Math.min(.25,.5*ie*ut/De);return ne+Math.max(vt*N,ot*G)}(u,f,g):v;return{base:v+(r===0)?-1:r,top:T?Math.max(E+s,v+r+2):v+s}}const RF=Yr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:kF}=RF,LF=Yr([{name:"a_packed",components:4,type:"Float32"}]),{members:zF}=LF,FF=Yr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:BF}=FF,NF=Yr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),UF=Yr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),jF=Yr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Yr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const bb=Yr([{name:"a_occlusion_query_opacity",components:1,type:"Float32"}],4),uA=Yr([{name:"a_z_offset",components:1,type:"Float32"}],4),VF=Yr([{name:"a_texb",components:2,type:"Uint16"}]),$F=Yr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),GF=Yr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Yr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const cA=Yr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),WF=Yr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Yr([{name:"triangle",components:3,type:"Uint16"}]),Yr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Yr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Float32",name:"occlusionState"},{type:"Float32",name:"occlusionOpacity"},{type:"Uint8",name:"hasIconTextFit"}]),Yr([{type:"Float32",name:"offsetX"}]),Yr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);class hA{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new _c({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const s=this.getKey(e,r);return this.positions[s]}trim(){const e=this.width,r=this.height=Zi(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,s){const u=[];let f=e.length%2==1?-e[e.length-1]*s:0,d=e[0]*s,g=!0;u.push({left:f,right:d,isDash:g,zeroLength:e[0]===0});let v=e[0];for(let T=1;T<e.length;T++){g=!g;const E=e[T];f=v*s,v+=E,d=v*s,u.push({left:f,right:d,isDash:g,zeroLength:E===0})}return u}addRoundDash(e,r,s){const u=r/2;for(let f=-s;f<=s;f++){const d=this.width*(this.nextRow+s+f);let g=0,v=e[g];for(let T=0;T<this.width;T++){T/v.right>1&&(v=e[++g]);const E=Math.abs(T-v.left),A=Math.abs(T-v.right),C=Math.min(E,A);let k;const L=f/s*(u+1);if(v.isDash){const F=u-Math.abs(L);k=Math.sqrt(C*C+F*F)}else k=u-Math.sqrt(C*C+L*L);this.image.data[d+T]=Math.max(0,Math.min(255,k+128))}}}addRegularDash(e,r){for(let v=e.length-1;v>=0;--v){const T=e[v],E=e[v+1];T.zeroLength?e.splice(v,1):E&&E.isDash===T.isDash&&(E.left=T.left,e.splice(v,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const f=this.width*this.nextRow;let d=0,g=e[d];for(let v=0;v<this.width;v++){v/g.right>1&&(g=e[++d]);const T=Math.abs(v-g.left),E=Math.abs(v-g.right),A=Math.min(T,E);this.image.data[f+v]=Math.max(0,Math.min(255,(g.isDash?A:-A)+r+128))}}addDash(e,r){const s=this.getKey(e,r);if(this.positions[s])return this.positions[s];const u=r==="round",f=u?7:0,d=2*f+1;if(this.nextRow+d>this.height)return zn("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let E=0;E<e.length;E++)e[E]<0&&(zn("Negative value is found in line dasharray, replacing values with 0"),e[E]=0),g+=e[E];if(g!==0){const E=this.width/g,A=this.getDashRanges(e,this.width,E);u?this.addRoundDash(A,E,f):this.addRegularDash(A,r==="square"?.5*E:0)}const v=this.nextRow+f;this.nextRow+=d;const T={tl:[v,f],br:[g,0]};return this.positions[s]=T,T}}ee(hA,"LineAtlas");const qF=a0.types,HF=Math.cos(Math.PI/180*37.5),ZF=Math.cos(Math.PI/180*5);class d0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new E1,this.layoutVertexArray2=new lc,this.patternVertexArray=new uc,this.indexArray=new Si,this.programConfigurations=new dc(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new In,this.maxLineLength=0,this.zOffsetVertexArray=new Bh,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:At/64}updateFootprints(e,r){}populate(e,r,s,u){this.hasPattern=pb("line",this.layers,r);const f=this.layers[0].layout.get("line-sort-key"),d=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!d.isConstant()||!!d.constantOr(0);const g=[];for(const{feature:A,id:C,index:k,sourceLayerIndex:L}of e){const F=this.layers[0]._featureFilter.needGeometry,N=mu(A,F);if(!this.layers[0]._featureFilter.filter(new pr(this.zoom),N,s))continue;const G=f?f.evaluate(N,{},s):void 0,ne={id:C,properties:A.properties,type:A.type,sourceLayerIndex:L,index:k,geometry:F?N.geometry:qa(A,s,u),patterns:{},sortKey:G};g.push(ne)}f&&g.sort((A,C)=>A.sortKey-C.sortKey);const{lineAtlas:v,featureIndex:T}=r,E=this.addConstantDashes(v);for(const A of g){const{geometry:C,index:k,sourceLayerIndex:L}=A;if(E&&this.addFeatureDashes(A,v),this.hasPattern){const F=mb("line",this.layers,A,this.zoom,r);this.patternFeatures.push(F)}else this.addFeature(A,C,k,s,v.positions,r.availableImages,r.brightness);T.insert(e[k].feature,C,k,L,this.index)}}addConstantDashes(e){let r=!1;for(const s of this.layers){const u=s.paint.get("line-dasharray").value,f=s.layout.get("line-cap").value;if(u.kind!=="constant"||f.kind!=="constant")r=!0;else{const d=f.value,g=u.value;if(!g)continue;e.addDash(g,d)}}return r}addFeatureDashes(e,r){const s=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,d=u.layout.get("line-cap").value;if(f.kind==="constant"&&d.kind==="constant")continue;let g,v;if(f.kind==="constant"){if(g=f.value,!g)continue}else g=f.evaluate({zoom:s},e);v=d.kind==="constant"?d.value:d.evaluate({zoom:s},e),r.addDash(g,v),e.patterns[u.id]=r.getKey(g,v)}}update(e,r,s,u,f){const d=Object.keys(e).length!==0;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,r,d?this.stateDependentLayers:this.layers,s,u,f)}addFeatures(e,r,s,u,f,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,r,s,u,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,zF)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,BF)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,uA.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kF),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,u,f,d,g){const v=this.layers[0].layout,T=v.get("line-join").evaluate(e,{}),E=v.get("line-cap").evaluate(e,{}),A=v.get("line-miter-limit"),C=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const k of r)this.addLine(k,e,u,T,E,A,C);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,d,u,g)}addLine(e,r,s,u,f,d,g){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const v={zoom:this.zoom,lineProgress:void 0},T=this.layers[0].layout,E=u==="none";if(this.patternJoinNone=this.hasPattern&&E,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let pe=0;pe<e.length-1;pe++)this.totalDistance+=e[pe].dist(e[pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=qF[r.type]==="Polygon";let C=e.length;for(;C>=2&&e[C-1].equals(e[C-2]);)C--;let k=0;for(;k<C-1&&e[k].equals(e[k+1]);)k++;if(C<(A?3:2))return;u==="bevel"&&(d=1.05);const L=this.overscaling<=16?15*At/(512*this.overscaling):0,F=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let N,G,ne,ie,oe,me;this.e1=this.e2=-1,A&&(N=e[C-2],oe=e[k].sub(N)._unit()._perp());for(let pe=k;pe<C;pe++){if(ne=pe===C-1?A?e[k+1]:void 0:e[pe+1],ne&&e[pe].equals(ne))continue;if(oe&&(ie=oe),N&&(G=N),N=e[pe],this.hasZOffset){const tt=T.get("line-z-offset").value;if(tt.kind==="constant")me=tt.value;else{if(this.lineClips){const _t=this.totalDistance/(this.lineClips.end-this.lineClips.start);v.lineProgress=(_t*this.lineClips.start+this.distance+(G?G.dist(N):0))/_t}else zn(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),v.lineProgress=0;me=tt.evaluate(v,r)}me=me||0}oe=ne?ne.sub(N)._unit()._perp():ie,ie=ie||oe;const Ee=G&&ne;let De=Ee?u:A||E?"butt":f;const je=ie.x*oe.x+ie.y*oe.y;if(E){const tt=function(_t){if(_t.patternJoinNone){const bt=_t.segmentPoints.length/2,gt=_t.lineSoFar-_t.segmentStart;for(let zt=0;zt<bt;++zt){const xt=_t.segmentPoints[2*zt+1],Tt=Math.round(_t.segmentPoints[2*zt])+.5+.25*xt;_t.patternVertexArray.emplaceBack(Tt,gt,_t.segmentStart),_t.patternVertexArray.emplaceBack(Tt,gt,_t.segmentStart)}_t.segmentPoints.length=0}_t.e1=_t.e2=-1};if(Ee&&je<ZF){this.updateDistance(G,N),this.addCurrentVertex(N,ie,1,1,F,me),tt(this),this.addCurrentVertex(N,oe,-1,-1,F,me);continue}if(G){if(!ne){this.updateDistance(G,N),this.addCurrentVertex(N,ie,1,1,F,me),tt(this);continue}De="miter"}}let Qe=ie.add(oe);Qe.x===0&&Qe.y===0||Qe._unit();const Ze=Qe.x*oe.x+Qe.y*oe.y,ut=Ze!==0?1/Ze:1/0,vt=2*Math.sqrt(2-2*Ze),ot=Ze<HF&&G&&ne,mt=ie.x*oe.y-ie.y*oe.x>0;if(ot&&pe>k){const tt=N.dist(G);if(tt>2*L){const _t=N.sub(N.sub(G)._mult(L/tt)._round());this.updateDistance(G,_t),this.addCurrentVertex(_t,ie,0,0,F,me),G=_t}}if(Ee&&De==="round"&&(ut<g?De="miter":ut<=2&&(De="fakeround")),De==="miter"&&ut>d&&(De="bevel"),De==="bevel"&&(ut>2&&(De="flipbevel"),ut<d&&(De="miter")),G&&this.updateDistance(G,N),De==="miter")Qe._mult(ut),this.addCurrentVertex(N,Qe,0,0,F,me);else if(De==="flipbevel"){if(ut>100)Qe=oe.mult(-1);else{const tt=ut*ie.add(oe).mag()/ie.sub(oe).mag();Qe._perp()._mult(tt*(mt?-1:1))}this.addCurrentVertex(N,Qe,0,0,F,me),this.addCurrentVertex(N,Qe.mult(-1),0,0,F,me)}else if(De==="bevel"||De==="fakeround"){const tt=-Math.sqrt(ut*ut-1),_t=mt?tt:0,bt=mt?0:tt;if(G&&this.addCurrentVertex(N,ie,_t,bt,F,me),De==="fakeround"){const gt=Math.round(180*vt/Math.PI/20);for(let zt=1;zt<gt;zt++){let xt=zt/gt;if(xt!==.5){const Jt=xt-.5;xt+=xt*Jt*(xt-1)*((1.0904+je*(je*(3.55645-1.43519*je)-3.2452))*Jt*Jt+(.848013+je*(.215638*je-1.06021)))}const Tt=oe.sub(ie)._mult(xt)._add(ie)._unit()._mult(mt?-1:1);this.addHalfVertex(N,Tt.x,Tt.y,!1,mt,0,F,me)}}ne&&this.addCurrentVertex(N,oe,-_t,-bt,F,me)}else De==="butt"?this.addCurrentVertex(N,Qe,0,0,F,me):De==="square"?(G||this.addCurrentVertex(N,Qe,-1,-1,F,me),this.addCurrentVertex(N,Qe,0,0,F,me),G&&this.addCurrentVertex(N,Qe,1,1,F,me)):De==="round"&&(G&&(this.addCurrentVertex(N,ie,0,0,F,me),this.addCurrentVertex(N,ie,1,1,F,me,!0)),ne&&(this.addCurrentVertex(N,oe,-1,-1,F,me,!0),this.addCurrentVertex(N,oe,0,0,F,me)));if(ot&&pe<C-1){const tt=N.dist(ne);if(tt>2*L){const _t=N.add(ne.sub(N)._mult(L/tt)._round());this.updateDistance(N,_t),this.addCurrentVertex(_t,oe,0,0,F,me),N=_t}}}}addVerticesTo(e,r,s,u,f,d,g,v,T,E){const A=(r.w-e.w)/this.tessellationStep|0;if(A>1){this.lineSoFar=e.w;const C=(r.x-e.x)/A,k=(r.y-e.y)/A,L=(r.z-e.z)/A,F=(r.w-e.w)/A;for(let N=1;N<A;++N)e.x+=C,e.y+=k,e.z+=L,this.lineSoFar+=F,this.addHalfVertex(e,s,u,E,!1,g,T,e.z),this.addHalfVertex(e,f,d,E,!0,-v,T,e.z)}this.lineSoFar=r.w,this.addHalfVertex(r,s,u,E,!1,g,T,r.z),this.addHalfVertex(r,f,d,E,!0,-v,T,r.z)}addCurrentVertex(e,r,s,u,f,d,g=!1){const v=r.x+r.y*s,T=r.y-r.x*s,E=r.y*u-r.x,A=-r.y-r.x*u;if(d!=null){const k=At+10,L=d,F=new OI(e.x,e.y,L,this.lineSoFar),N=fA(e,-10,k),G=this.lineSoFar;if(this.currentVertex)if(N){const ne=this.currentVertexIsOutside,ie=this.currentVertex,oe=new OI(e.x,e.y,L,this.lineSoFar);RI(ie,oe,-10,k),fA(oe,-10,k)||(ne&&(this.e1=this.e2=-1,this.lineSoFar=ie.w,this.addHalfVertex(ie,v,T,g,!1,s,f,ie.z),this.addHalfVertex(ie,E,A,g,!0,-u,f,ie.z)),this.addVerticesTo(ie,oe,v,T,E,A,s,u,f,g))}else{const ne=this.currentVertex;this.currentVertexIsOutside&&(RI(ne,F,-10,k),this.e1=this.e2=-1,this.lineSoFar=ne.w,this.addHalfVertex(ne,v,T,g,!1,s,f,ne.z),this.addHalfVertex(ne,E,A,g,!0,-u,f,ne.z)),this.addVerticesTo(ne,F,v,T,E,A,s,u,f,g)}else N||(this.addHalfVertex(e,v,T,g,!1,s,f,d),this.addHalfVertex(e,E,A,g,!0,-u,f,d));this.currentVertex=F,this.currentVertexIsOutside=N,this.lineSoFar=G}else this.addHalfVertex(e,v,T,g,!1,s,f,d),this.addHalfVertex(e,E,A,g,!0,-u,f,d)}addHalfVertex({x:e,y:r},s,u,f,d,g,v,T){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),d||this.segmentPoints.push(this.lineSoFar-this.segmentStart,g)),this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(r<<1)+(d?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),v.primitiveLength++),d?this.e2=E:this.e1=E,T!=null&&this.zOffsetVertexArray.emplaceBack(T)}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}function fA(t,e,r){return t.x<e||t.x>r||t.y<e||t.y>r}ee(d0,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const XF=new Xr({"line-cap":new Ft($e.layout_line["line-cap"]),"line-join":new Ft($e.layout_line["line-join"]),"line-miter-limit":new ct($e.layout_line["line-miter-limit"]),"line-round-limit":new ct($e.layout_line["line-round-limit"]),"line-sort-key":new Ft($e.layout_line["line-sort-key"]),"line-z-offset":new Ft($e.layout_line["line-z-offset"]),visibility:new ct($e.layout_line.visibility)});var p0={paint:new Xr({"line-opacity":new Ft($e.paint_line["line-opacity"]),"line-color":new Ft($e.paint_line["line-color"]),"line-translate":new ct($e.paint_line["line-translate"]),"line-translate-anchor":new ct($e.paint_line["line-translate-anchor"]),"line-width":new Ft($e.paint_line["line-width"]),"line-gap-width":new Ft($e.paint_line["line-gap-width"]),"line-offset":new Ft($e.paint_line["line-offset"]),"line-blur":new Ft($e.paint_line["line-blur"]),"line-dasharray":new Ft($e.paint_line["line-dasharray"]),"line-pattern":new Ft($e.paint_line["line-pattern"]),"line-gradient":new wi($e.paint_line["line-gradient"]),"line-trim-offset":new ct($e.paint_line["line-trim-offset"]),"line-trim-fade-range":new ct($e.paint_line["line-trim-fade-range"]),"line-trim-color":new ct($e.paint_line["line-trim-color"]),"line-emissive-strength":new ct($e.paint_line["line-emissive-strength"]),"line-border-width":new Ft($e.paint_line["line-border-width"]),"line-border-color":new Ft($e.paint_line["line-border-color"]),"line-occlusion-opacity":new ct($e.paint_line["line-occlusion-opacity"])}),layout:XF};function dA(t,e,r){return e*(At/(t.tileSize*Math.pow(2,r-t.tileID.overscaledZ)))}function pA(t,e){return 1/dA(t,1,e.tileZoom)}function mA(t,e,r,s){return t.translatePosMatrix(s||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const _A=t=>{const e=[];gA(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const r=t.paint.get("line-trim-offset");r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const s=t.layout.get("line-join").constantOr("miter")==="none",u=!!t.paint.get("line-pattern").constantOr(1);return s&&u&&e.push("LINE_JOIN_NONE"),e};function gA(t){const e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}class yA{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var YF={read:function(t,e,r,s,u){var f,d,g=8*u-s-1,v=(1<<g)-1,T=v>>1,E=-7,A=r?u-1:0,C=r?-1:1,k=t[e+A];for(A+=C,f=k&(1<<-E)-1,k>>=-E,E+=g;E>0;f=256*f+t[e+A],A+=C,E-=8);for(d=f&(1<<-E)-1,f>>=-E,E+=s;E>0;d=256*d+t[e+A],A+=C,E-=8);if(f===0)f=1-T;else{if(f===v)return d?NaN:1/0*(k?-1:1);d+=Math.pow(2,s),f-=T}return(k?-1:1)*d*Math.pow(2,f-s)},write:function(t,e,r,s,u,f){var d,g,v,T=8*f-u-1,E=(1<<T)-1,A=E>>1,C=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,k=s?0:f-1,L=s?1:-1,F=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,d=E):(d=Math.floor(Math.log(e)/Math.LN2),e*(v=Math.pow(2,-d))<1&&(d--,v*=2),(e+=d+A>=1?C/v:C*Math.pow(2,1-A))*v>=2&&(d++,v/=2),d+A>=E?(g=0,d=E):d+A>=1?(g=(e*v-1)*Math.pow(2,u),d+=A):(g=e*Math.pow(2,A-1)*Math.pow(2,u),d=0));u>=8;t[r+k]=255&g,k+=L,g/=256,u-=8);for(d=d<<u|g,T+=u;T>0;t[r+k]=255&d,k+=L,d/=256,T-=8);t[r+k-L]|=128*F}},vA=Sn,m0=YF;function Sn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Sn.Varint=0,Sn.Fixed64=1,Sn.Bytes=2,Sn.Fixed32=5;var wb=4294967296,xA=1/wb,bA=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function yu(t){return t.type===Sn.Bytes?t.readVarint()+t.pos:t.pos+1}function Td(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function wA(t,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var u=r.pos-1;u>=t;u--)r.buf[u+s]=r.buf[u]}function KF(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function QF(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function JF(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function eB(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function tB(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function rB(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function nB(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function iB(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function oB(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function _0(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Sd(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function TA(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Sn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),u=s>>3,f=this.pos;this.type=7&s,t(u,e,this),this.pos===f&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=_0(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=TA(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=_0(this.buf,this.pos)+_0(this.buf,this.pos+4)*wb;return this.pos+=8,t},readSFixed64:function(){var t=_0(this.buf,this.pos)+TA(this.buf,this.pos+4)*wb;return this.pos+=8,t},readFloat:function(){var t=m0.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=m0.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(u,f,d){var g,v,T=d.buf;if(g=(112&(v=T[d.pos++]))>>4,v<128||(g|=(127&(v=T[d.pos++]))<<3,v<128)||(g|=(127&(v=T[d.pos++]))<<10,v<128)||(g|=(127&(v=T[d.pos++]))<<17,v<128)||(g|=(127&(v=T[d.pos++]))<<24,v<128)||(g|=(1&(v=T[d.pos++]))<<31,v<128))return Td(u,g,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&bA?function(r,s,u){return bA.decode(r.subarray(s,u))}(this.buf,e,t):function(r,s,u){for(var f="",d=s;d<u;){var g,v,T,E=r[d],A=null,C=E>239?4:E>223?3:E>191?2:1;if(d+C>u)break;C===1?E<128&&(A=E):C===2?(192&(g=r[d+1]))==128&&(A=(31&E)<<6|63&g)<=127&&(A=null):C===3?(v=r[d+2],(192&(g=r[d+1]))==128&&(192&v)==128&&((A=(15&E)<<12|(63&g)<<6|63&v)<=2047||A>=55296&&A<=57343)&&(A=null)):C===4&&(v=r[d+2],T=r[d+3],(192&(g=r[d+1]))==128&&(192&v)==128&&(192&T)==128&&((A=(15&E)<<18|(63&g)<<12|(63&v)<<6|63&T)<=65535||A>=1114112)&&(A=null)),A===null?(A=65533,C=1):A>65535&&(A-=65536,f+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),f+=String.fromCharCode(A),d+=C}return f}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Sn.Bytes)return t.push(this.readVarint(e));var r=yu(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Sn.Bytes)return t.push(this.readSVarint());var e=yu(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Sn.Bytes)return t.push(this.readBoolean());var e=yu(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Sn.Bytes)return t.push(this.readFloat());var e=yu(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Sn.Bytes)return t.push(this.readDouble());var e=yu(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Sn.Bytes)return t.push(this.readFixed32());var e=yu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Sn.Bytes)return t.push(this.readSFixed32());var e=yu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Sn.Bytes)return t.push(this.readFixed64());var e=yu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Sn.Bytes)return t.push(this.readSFixed64());var e=yu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Sn.Varint)for(;this.buf[this.pos++]>127;);else if(e===Sn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Sn.Fixed32)this.pos+=4;else{if(e!==Sn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Sd(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Sd(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Sd(this.buf,-1&t,this.pos),Sd(this.buf,Math.floor(t*xA),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Sd(this.buf,-1&t,this.pos),Sd(this.buf,Math.floor(t*xA),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,r){var s,u;if(e>=0?(s=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(f,d,g){g.buf[g.pos++]=127&f|128,f>>>=7,g.buf[g.pos++]=127&f|128,f>>>=7,g.buf[g.pos++]=127&f|128,f>>>=7,g.buf[g.pos++]=127&f|128,g.buf[g.pos]=127&(f>>>=7)}(s,0,r),function(f,d){var g=(7&f)<<4;d.buf[d.pos++]|=g|((f>>>=3)?128:0),f&&(d.buf[d.pos++]=127&f|((f>>>=7)?128:0),f&&(d.buf[d.pos++]=127&f|((f>>>=7)?128:0),f&&(d.buf[d.pos++]=127&f|((f>>>=7)?128:0),f&&(d.buf[d.pos++]=127&f|((f>>>=7)?128:0),f&&(d.buf[d.pos++]=127&f)))))}(u,r)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(s,u,f){for(var d,g,v=0;v<u.length;v++){if((d=u.charCodeAt(v))>55295&&d<57344){if(!g){d>56319||v+1===u.length?(s[f++]=239,s[f++]=191,s[f++]=189):g=d;continue}if(d<56320){s[f++]=239,s[f++]=191,s[f++]=189,g=d;continue}d=g-55296<<10|d-56320|65536,g=null}else g&&(s[f++]=239,s[f++]=191,s[f++]=189,g=null);d<128?s[f++]=d:(d<2048?s[f++]=d>>6|192:(d<65536?s[f++]=d>>12|224:(s[f++]=d>>18|240,s[f++]=d>>12&63|128),s[f++]=d>>6&63|128),s[f++]=63&d|128)}return f}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&wA(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),m0.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),m0.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var s=this.pos-r;s>=128&&wA(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,r){this.writeTag(t,Sn.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,KF,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,QF,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,tB,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,JF,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,eB,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,rB,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,nB,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,iB,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,oB,e)},writeBytesField:function(t,e){this.writeTag(t,Sn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Sn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Sn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Sn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Sn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Sn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Sn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Sn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Sn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Sn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Ed=le(vA);const sB=["id","tile","layer","source","sourceLayer","state"];class SA{constructor(e,r,s,u,f){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=s,this._y=u,this.properties=e.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const r of sB)this[r]!==void 0&&(e[r]=this[r]);return e}}class aB{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,s){const u=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Qr(this.stateChanges[e][u],s),this.deletedStates[e]===null){this.deletedStates[e]={};for(const f in this.state[e])f!==u&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const f in this.state[e][u])s[f]||(this.deletedStates[e][u][f]=null)}else for(const f in s)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][f]===null&&delete this.deletedStates[e][u][f]}removeFeatureState(e,r,s){if(this.deletedStates[e]===null)return;const u=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&r!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][s]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(s in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][s]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,r){const s=String(r),u=Qr({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const f=this.deletedStates[e][r];if(f===null)return{};for(const d in f)delete u[d]}return u}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const s={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const f={};for(const d in this.stateChanges[u])this.state[u][d]||(this.state[u][d]={}),Qr(this.state[u][d],this.stateChanges[u][d]),f[d]=this.state[u][d];s[u]=f}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const f={};if(this.deletedStates[u]===null)for(const d in this.state[u])f[d]={},this.state[u][d]={};else for(const d in this.deletedStates[u]){if(this.deletedStates[u][d]===null)this.state[u][d]={};else if(this.state[u][d])for(const g of Object.keys(this.deletedStates[u][d]))delete this.state[u][d][g];f[d]=this.state[u][d]}s[u]=s[u]||{},Qr(s[u],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(const u in e)e[u].setFeatureState(s,r)}}class EA{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new _e(At,16,0),this.featureIndexArray=new FM,this.promoteId=r,this.is3DTile=!1}insert(e,r,s,u,f,d=0,g=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,u,f,d);const T=this.grid;for(let E=0;E<r.length;E++){const A=r[E],C=[1/0,1/0,-1/0,-1/0];for(let k=0;k<A.length;k++){const L=A[k];C[0]=Math.min(C[0],L.x),C[1]=Math.min(C[1],L.y),C[2]=Math.max(C[2],L.x),C[3]=Math.max(C[3],L.y)}g!==0&&(C[0]-=g,C[1]-=g,C[2]+=g,C[3]+=g),C[0]<At&&C[1]<At&&C[2]>=0&&C[3]>=0&&T.insert(v,C[0],C[1],C[2],C[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new gb(new Ed(this.rawTileData)).layers,this.sourceLayerCoder=new yA(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,s,u){this.loadVTLayers();const f=e.params||{},d=Ni(f.filter),g=e.tileResult,v=e.transform,T=g.bufferedTilespaceBounds,E=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(L,F,N,G)=>eI(g.bufferedTilespaceGeometry,L,F,N,G));E.sort(lB);let A=null;v.elevation&&E.length>0&&(A=wd.create(v.elevation,this.tileID));const C={};let k;for(let L=0;L<E.length;L++){const F=E[L];if(F===k)continue;k=F;const N=this.featureIndexArray.get(F);let G=null;if(this.is3DTile){const ne=this.bucketLayerIDs[0][0],ie=r[ne];if(ie.type!=="model")continue;const{queryFeature:oe,intersectionZ:me}=ie.queryIntersectsMatchingFeature(g,N.featureIndex,d,v);oe&&this.appendToResult(C,ne,N.featureIndex,oe,me)}else this.loadMatchingFeature(C,N,d,f.layers,f.availableImages,r,s,u,(ne,ie,oe,me=0)=>(G||(G=qa(ne,this.tileID.canonical,e.tileTransform)),ie.queryIntersectsFeature(g,ne,oe,G,this.z,e.transform,e.pixelPosMatrix,A,me)))}return C}loadMatchingFeature(e,r,s,u,f,d,g,v,T){const{featureIndex:E,bucketIndex:A,sourceLayerIndex:C,layoutVertexArrayOffset:k}=r,L=this.bucketLayerIDs[A];if(u&&!function(ne,ie){for(let oe=0;oe<ne.length;oe++)if(ie.indexOf(ne[oe])>=0)return!0;return!1}(u,L))return;const F=this.sourceLayerCoder.decode(C),N=this.vtLayers[F].feature(E);if(s.needGeometry){const ne=mu(N,!0);if(!s.filter(new pr(this.tileID.overscaledZ),ne,this.tileID.canonical))return}else if(!s.filter(new pr(this.tileID.overscaledZ),N))return;const G=this.getId(N,F);for(let ne=0;ne<L.length;ne++){const ie=L[ne];if(u&&u.indexOf(ie)<0)continue;const oe=d[ie];if(!oe)continue;let me={};G!==void 0&&v&&(me=v.getState(oe.sourceLayer||"_geojsonTileLayer",G));const pe=!T||T(N,oe,me,k);if(!pe)continue;const Ee=new SA(N,this.z,this.x,this.y,G),De=Qr({},g[ie]);De.paint=MA(De.paint,oe.paint,N,me,f),De.layout=MA(De.layout,oe.layout,N,me,f),Ee.layer=De,this.appendToResult(e,ie,E,Ee,pe)}}appendToResult(e,r,s,u,f){let d=e[r];d===void 0&&(d=e[r]=[]),d.push({featureIndex:s,feature:u,intersectionZ:f})}lookupSymbolFeatures(e,r,s,u,f,d,g,v){const T={};this.loadVTLayers();const E=Ni(f);for(const A of e)this.loadMatchingFeature(T,{bucketIndex:s,sourceLayerIndex:u,featureIndex:A,layoutVertexArrayOffset:0},E,d,g,v,r);return T}loadFeature(e){const{featureIndex:r,sourceLayerIndex:s}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(s),f=this.vtFeatures[u];if(f[r])return f[r];const d=this.vtLayers[u].feature(r);return f[r]=d,d}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;if(this.promoteId){const u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[r];u!=null&&(s=e.properties[u]),typeof s=="boolean"&&(s=Number(s))}return s}}function MA(t,e,r,s,u){return Yi(t,(f,d)=>{const g=e instanceof pn?e.get(d):null;return g&&g.evaluate?g.evaluate(r,s,u):g})}function lB(t,e){return e-t}ee(EA,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var ji=24;const Ha=128;function Tb(t,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new pr(t+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:u}=r;let f=0;for(;f<s.length&&s[f]<=t;)f++;f=Math.max(0,f-1);let d=f;for(;d<s.length&&s[d]<t+1;)d++;d=Math.min(s.length-1,d);const g=s[f],v=s[d];return r.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:v,interpolationType:u}:{kind:"camera",minZoom:g,maxZoom:v,minSize:r.evaluate(new pr(g)),maxSize:r.evaluate(new pr(v)),interpolationType:u}}}function g0(t,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:u}){return t.kind==="source"?s/Ha:t.kind==="composite"?nr(s/Ha,u/Ha,r):e}function Md(t,e){let r=0,s=0;if(t.kind==="constant")s=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:u,minZoom:f,maxZoom:d}=t,g=u?Kt(Wo.interpolationFactor(u,e,f,d),0,1):0;t.kind==="camera"?s=nr(t.minSize,t.maxSize,g):r=g}return{uSizeT:r,uSize:s}}var uB=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ha,evaluateSizeForFeature:g0,evaluateSizeForZoom:Md,getSizeData:Tb});function cB(t,e,r){return t.sections.forEach(s=>{s.text=function(u,f,d){const g=f.layout.get("text-transform").evaluate(d,{});return g==="uppercase"?u=u.toLocaleUpperCase():g==="lowercase"&&(u=u.toLocaleLowerCase()),Pr.applyArabicShaping&&(u=Pr.applyArabicShaping(u)),u}(s.text,e,r)}),t}const i_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function hB(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}function fB(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}const Sb=3;function dB(t,e,r){e.glyphs=[],t===1&&r.readMessage(pB,e)}function pB(t,e,r){if(t===3){const{id:s,bitmap:u,width:f,height:d,left:g,top:v,advance:T}=r.readMessage(mB,{});e.glyphs.push({id:s,bitmap:new _c({width:f+2*Sb,height:d+2*Sb},u),metrics:{width:f,height:d,left:g,top:v,advance:T}})}else t===4?e.ascender=r.readSVarint():t===5&&(e.descender=r.readSVarint())}function mB(t,e,r){t===1?e.id=r.readVarint():t===2?e.bitmap=r.readBytes():t===3?e.width=r.readVarint():t===4?e.height=r.readVarint():t===5?e.left=r.readSVarint():t===6?e.top=r.readSVarint():t===7&&(e.advance=r.readVarint())}const IA=Sb,$s={horizontal:1,vertical:2,horizontalOnly:3};class o_{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new o_;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new o_;return r.imageName=e,r}}class Id{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new Id;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?s.addImageSection(f):s.addTextSection(f,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(r,s){let u="";for(let f=0;f<r.length;f++){const d=r.charCodeAt(f+1)||null,g=r.charCodeAt(f-1)||null;u+=!s&&(d&&Fe(d)&&!i_[r[f+1]]||g&&Fe(g)&&!i_[r[f-1]])||!i_[r[f]]?r[f]:i_[r[f]]}return u}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&y0[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&y0[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new Id;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(o_.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.namePrimary:"";if(r.length===0)return void zn("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCodePoint(s),this.sections.push(o_.forImage(r)),this.sectionIndex.push(this.sections.length-1)):zn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Eb(t,e,r,s,u,f,d,g,v,T,E,A,C,k,L){const F=Id.fromFeature(t,u);A===$s.vertical&&F.verticalizePunctuation(C);let N=[];const G=function(pe,Ee,De,je,Qe,Ze){if(!pe)return[];const ut=[],vt=function(_t,bt,gt,zt,xt,Tt){let Jt=0;for(let Yt=0;Yt<_t.length();Yt++){const Xt=_t.getSection(Yt);Jt+=AA(_t.getCodePoint(Yt),Xt,zt,xt,bt,Tt)}return Jt/Math.max(1,Math.ceil(Jt/gt))}(pe,Ee,De,je,Qe,Ze),ot=pe.text.indexOf("")>=0;let mt=0;for(let _t=0;_t<pe.length();_t++){const bt=pe.getSection(_t),gt=pe.getCodePoint(_t);if(y0[gt]||(mt+=AA(gt,bt,je,Qe,Ee,Ze)),_t<pe.length()-1){const zt=!((tt=gt)<11904||!(be["Bopomofo Extended"](tt)||be.Bopomofo(tt)||be["CJK Compatibility Forms"](tt)||be["CJK Compatibility Ideographs"](tt)||be["CJK Compatibility"](tt)||be["CJK Radicals Supplement"](tt)||be["CJK Strokes"](tt)||be["CJK Symbols and Punctuation"](tt)||be["CJK Unified Ideographs Extension A"](tt)||be["CJK Unified Ideographs"](tt)||be["Enclosed CJK Letters and Months"](tt)||be["Halfwidth and Fullwidth Forms"](tt)||be.Hiragana(tt)||be["Ideographic Description Characters"](tt)||be["Kangxi Radicals"](tt)||be["Katakana Phonetic Extensions"](tt)||be.Katakana(tt)||be["Vertical Forms"](tt)||be["Yi Radicals"](tt)||be["Yi Syllables"](tt)));(_B[gt]||zt||bt.imageName)&&ut.push(PA(_t+1,mt,vt,ut,gB(gt,pe.getCodePoint(_t+1),zt&&ot),!1))}}var tt;return OA(PA(pe.length(),mt,vt,ut,0,!0))}(F,T,f,e,s,k),{processBidirectionalText:ne,processStyledBidirectionalText:ie}=Pr;if(ne&&F.sections.length===1){const pe=ne(F.toString(),G);for(const Ee of pe){const De=new Id;De.text=Ee,De.sections=F.sections;for(let je=0;je<Ee.length;je++)De.sectionIndex.push(0);N.push(De)}}else if(ie){const pe=ie(F.text,F.sectionIndex,G);for(const Ee of pe){const De=new Id;De.text=Ee[0],De.sectionIndex=Ee[1],De.sections=F.sections,N.push(De)}}else N=function(pe,Ee){const De=[],je=pe.text;let Qe=0;for(const Ze of Ee)De.push(pe.substring(Qe,Ze)),Qe=Ze;return Qe<je.length&&De.push(pe.substring(Qe,je.length)),De}(F,G);const oe=[],me={positionedLines:oe,text:F.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(pe,Ee,De,je,Qe,Ze,ut,vt,ot,mt,tt,_t){let bt=0,gt=0,zt=0;const xt=vt==="right"?1:vt==="left"?0:.5;let Tt=!1;for(const wr of Qe){const fr=wr.getSections();for(const Mr of fr){if(Mr.imageName)continue;const Tr=Ee[Mr.fontStack];if(Tr&&(Tt=Tr.ascender!==void 0&&Tr.descender!==void 0,!Tt))break}if(!Tt)break}let Jt=0;for(const wr of Qe){wr.trim();const fr=wr.getMaxScale(),Mr=(fr-1)*ji,Tr={positionedGlyphs:[],lineOffset:0};pe.positionedLines[Jt]=Tr;const Or=Tr.positionedGlyphs;let ur=0;if(!wr.length()){gt+=Ze,++Jt;continue}let nn=0,tn=0;for(let Nr=0;Nr<wr.length();Nr++){const Hr=wr.getSection(Nr),gn=wr.getSectionIndex(Nr),un=wr.getCodePoint(Nr);let Cn=Hr.scale,An=null,to=null,Fn=null,En=ji,ei=0;const Ri=!(ot===$s.horizontal||!tt&&!ft(un)||tt&&(y0[un]||(Yt=un,be.Arabic(Yt)||be["Arabic Supplement"](Yt)||be["Arabic Extended-A"](Yt)||be["Arabic Presentation Forms-A"](Yt)||be["Arabic Presentation Forms-B"](Yt))));if(Hr.imageName){const ki=je[Hr.imageName];if(!ki)continue;Fn=Hr.imageName,pe.iconsInText=pe.iconsInText||!0,to=ki.paddedRect;const mn=ki.displaySize;Cn=Cn*ji/_t,An={width:mn[0],height:mn[1],left:0,top:-IA,advance:Ri?mn[1]:mn[0],localGlyph:!1},ei=Tt?-An.height*Cn:fr*ji-17-mn[1]*Cn,En=An.advance;const Co=(Ri?mn[0]:mn[1])*Cn-ji*fr;Co>0&&Co>ur&&(ur=Co)}else{const ki=De[Hr.fontStack];if(!ki)continue;ki[un]&&(to=ki[un]);const mn=Ee[Hr.fontStack];if(!mn)continue;const Co=mn.glyphs[un];if(!Co)continue;if(An=Co.metrics,En=un!==8203?ji:0,Tt){const xu=mn.ascender!==void 0?Math.abs(mn.ascender):0,va=mn.descender!==void 0?Math.abs(mn.descender):0,Ja=(xu+va)*Cn;nn<Ja&&(nn=Ja,tn=(xu-va)/2*Cn),ei=-xu*Cn}else ei=(fr-Cn)*ji-17}Ri?(pe.verticalizable=!0,Or.push({glyph:un,imageName:Fn,x:bt,y:gt+ei,vertical:Ri,scale:Cn,localGlyph:An.localGlyph,fontStack:Hr.fontStack,sectionIndex:gn,metrics:An,rect:to}),bt+=En*Cn+mt):(Or.push({glyph:un,imageName:Fn,x:bt,y:gt+ei,vertical:Ri,scale:Cn,localGlyph:An.localGlyph,fontStack:Hr.fontStack,sectionIndex:gn,metrics:An,rect:to}),bt+=An.advance*Cn+mt)}Or.length!==0&&(zt=Math.max(bt-mt,zt),Tt?DA(Or,xt,ur,tn,Ze*fr/2):DA(Or,xt,ur,0,Ze/2)),bt=0;const qr=Ze*fr+ur;Tr.lineOffset=Math.max(ur,Mr),gt+=qr,++Jt}var Yt;const Xt=gt,{horizontalAlign:wt,verticalAlign:tr}=Mb(ut);(function(wr,fr,Mr,Tr,Or,ur){const nn=(fr-Mr)*Or,tn=-ur*Tr;for(const qr of wr)for(const Nr of qr.positionedGlyphs)Nr.x+=nn,Nr.y+=tn})(pe.positionedLines,xt,wt,tr,zt,Xt),pe.top+=-tr*Xt,pe.bottom=pe.top+Xt,pe.left+=-wt*zt,pe.right=pe.left+zt,pe.hasBaseline=Tt}(me,e,r,s,N,d,g,v,A,T,C,L),!function(pe){for(const Ee of pe)if(Ee.positionedGlyphs.length!==0)return!1;return!0}(oe)&&me}const y0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_B={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function AA(t,e,r,s,u,f){if(e.imageName){const d=s[e.imageName];return d?d.displaySize[0]*e.scale*ji/f+u:0}{const d=r[e.fontStack],g=d&&d.glyphs[t];return g?g.metrics.advance*e.scale+u:0}}function CA(t,e,r,s){const u=Math.pow(t-e,2);return s?t<e?u/2:2*u:u+Math.abs(r)*r}function gB(t,e,r){let s=0;return t===10&&(s-=1e4),r&&(s+=150),t!==40&&t!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function PA(t,e,r,s,u,f){let d=null,g=CA(e,r,u,f);for(const v of s){const T=CA(e-v.x,r,u,f)+v.badness;T<=g&&(d=v,g=T)}return{index:t,x:e,priorBreak:d,badness:g}}function OA(t){return t?OA(t.priorBreak).concat(t.index):[]}function Mb(t){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function DA(t,e,r,s,u){if(!(e||r||s||u))return;const f=t.length-1,d=t[f],g=(d.x+d.metrics.advance*d.scale)*e;for(let v=0;v<=f;v++)t[v].x-=g,t[v].y+=r+s+u}function yB(t,e,r,s){const{horizontalAlign:u,verticalAlign:f}=Mb(s),d=r[0]-t.displaySize[0]*u,g=r[1]-t.displaySize[1]*f;return{imagePrimary:t,imageSecondary:e,top:g,bottom:g+t.displaySize[1],left:d,right:d+t.displaySize[0]}}function RA(t,e,r,s,u,f){const d=t.imagePrimary;let g;if(d.content){const N=d.content,G=d.pixelRatio||1;g=[N[0]/G,N[1]/G,d.displaySize[0]-N[2]/G,d.displaySize[1]-N[3]/G]}const v=e.left*f,T=e.right*f;let E,A,C,k;r==="width"||r==="both"?(k=u[0]+v-s[3],A=u[0]+T+s[1]):(k=u[0]+(v+T-d.displaySize[0])/2,A=k+d.displaySize[0]);const L=e.top*f,F=e.bottom*f;return r==="height"||r==="both"?(E=u[1]+L-s[0],C=u[1]+F+s[2]):(E=u[1]+(L+F-d.displaySize[1])/2,C=E+d.displaySize[1]),{imagePrimary:d,imageSecondary:void 0,top:E,right:A,bottom:C,left:k,collisionPadding:g}}class vu extends Mt{constructor(e,r,s,u,f){super(e,r),this.angle=u,this.z=s,f!==void 0&&(this.segment=f)}clone(){return new vu(this.x,this.y,this.z,this.angle,this.segment)}}function kA(t,e,r,s,u){if(e.segment===void 0)return!0;let f=e,d=e.segment+1,g=0;for(;g>-r/2;){if(d--,d<0)return!1;g-=t[d].dist(f),f=t[d]}g+=t[d].dist(t[d+1]),d++;const v=[];let T=0;for(;g<r/2;){const E=t[d],A=t[d+1];if(!A)return!1;let C=t[d-1].angleTo(E)-E.angleTo(A);for(C=Math.abs((C+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:g,angleDelta:C}),T+=C;g-v[0].distance>s;)T-=v.shift().angleDelta;if(T>u)return!1;d++,g+=E.dist(A)}return!0}function LA(t){let e=0;for(let r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function zA(t,e,r){return t?.6*e*r:0}function FA(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function vB(t,e,r,s,u,f){const d=zA(r,u,f),g=FA(r,s)*f;let v=0;const T=LA(t)/2;for(let E=0;E<t.length-1;E++){const A=t[E],C=t[E+1],k=A.dist(C);if(v+k>T){const L=(T-v)/k,F=nr(A.x,C.x,L),N=nr(A.y,C.y,L),G=new vu(F,N,0,C.angleTo(A),E);return!d||kA(t,G,g,d,e)?G:void 0}v+=k}}function xB(t,e,r,s,u,f,d,g,v){const T=zA(s,f,d),E=FA(s,u),A=E*d,C=t[0].x===0||t[0].x===v||t[0].y===0||t[0].y===v;return e-A<e/4&&(e=A+e/4),BA(t,C?e/2*g%e:(E/2+2*f)*d*g%e,e,T,r,A,C,!1,v)}function BA(t,e,r,s,u,f,d,g,v){const T=f/2,E=LA(t);let A=0,C=e-r,k=[];for(let L=0;L<t.length-1;L++){const F=t[L],N=t[L+1],G=F.dist(N),ne=N.angleTo(F);for(;C+r<A+G;){C+=r;const ie=(C-A)/G,oe=nr(F.x,N.x,ie),me=nr(F.y,N.y,ie);if(oe>=0&&oe<v&&me>=0&&me<v&&C-T>=0&&C+T<=E){const pe=new vu(oe,me,0,ne,L);s&&!kA(t,pe,f,s,u)||k.push(pe)}}A+=G}return g||k.length||d||(k=BA(t,A/2,r,s,u,f,d,!0,v)),k}function NA(t,e,r,s,u){const f=[];for(let d=0;d<t.length;d++){const g=t[d];let v;for(let T=0;T<g.length-1;T++){let E=g[T],A=g[T+1];E.x<e&&A.x<e||(E.x<e?E=new Mt(e,E.y+(e-E.x)/(A.x-E.x)*(A.y-E.y))._round():A.x<e&&(A=new Mt(e,E.y+(e-E.x)/(A.x-E.x)*(A.y-E.y))._round()),E.y<r&&A.y<r||(E.y<r?E=new Mt(E.x+(r-E.y)/(A.y-E.y)*(A.x-E.x),r)._round():A.y<r&&(A=new Mt(E.x+(r-E.y)/(A.y-E.y)*(A.x-E.x),r)._round()),E.x>=s&&A.x>=s||(E.x>=s?E=new Mt(s,E.y+(s-E.x)/(A.x-E.x)*(A.y-E.y))._round():A.x>=s&&(A=new Mt(s,E.y+(s-E.x)/(A.x-E.x)*(A.y-E.y))._round()),E.y>=u&&A.y>=u||(E.y>=u?E=new Mt(E.x+(u-E.y)/(A.y-E.y)*(A.x-E.x),u)._round():A.y>=u&&(A=new Mt(E.x+(u-E.y)/(A.y-E.y)*(A.x-E.x),u)._round()),v&&E.equals(v[v.length-1])||(v=[E],f.push(v)),v.push(A)))))}}return f}function UA(t){let e=0,r=0;for(const d of t)e+=d.w*d.h,r=Math.max(r,d.w);t.sort((d,g)=>g.h-d.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let u=0,f=0;for(const d of t)for(let g=s.length-1;g>=0;g--){const v=s[g];if(!(d.w>v.w||d.h>v.h)){if(d.x=v.x,d.y=v.y,f=Math.max(f,d.y+d.h),u=Math.max(u,d.x+d.w),d.w===v.w&&d.h===v.h){const T=s.pop();g<s.length&&(s[g]=T)}else d.h===v.h?(v.x+=d.w,v.w-=d.w):d.w===v.w?(v.y+=d.h,v.h-=d.h):(s.push({x:v.x+d.w,y:v.y,w:v.w-d.w,h:d.h}),v.y+=d.h,v.h-=d.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}ee(vu,"Anchor");const as=1;class Ib{constructor(e,{pixelRatio:r,version:s,stretchX:u,stretchY:f,content:d}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=u,this.stretchY=f,this.content=d,this.version=s}get tl(){return[this.paddedRect.x+as,this.paddedRect.y+as]}get br(){return[this.paddedRect.x+this.paddedRect.w-as,this.paddedRect.y+this.paddedRect.h-as]}get displaySize(){return[(this.paddedRect.w-2*as)/this.pixelRatio,(this.paddedRect.h-2*as)/this.pixelRatio]}}class jA{constructor(e,r,s){const u={},f={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,u,d),this.addImages(r,f,d);const{w:g,h:v}=UA(d),T=new Vs({width:g||1,height:v||1});for(const E in e){const A=e[E],C=u[E].paddedRect;Vs.copy(A.data,T,{x:0,y:0},{x:C.x+as,y:C.y+as},A.data,s,A.sdf)}for(const E in r){const A=r[E],C=f[E].paddedRect,k=C.x+as,L=C.y+as,F=A.data.width,N=A.data.height;Vs.copy(A.data,T,{x:0,y:0},{x:k,y:L},A.data,s),Vs.copy(A.data,T,{x:0,y:N-1},{x:k,y:L-1},{width:F,height:1},s),Vs.copy(A.data,T,{x:0,y:0},{x:k,y:L+N},{width:F,height:1},s),Vs.copy(A.data,T,{x:F-1,y:0},{x:k-1,y:L},{width:1,height:N},s),Vs.copy(A.data,T,{x:0,y:0},{x:k+F,y:L},{width:1,height:N},s)}this.image=T,this.iconPositions=u,this.patternPositions=f}addImages(e,r,s){for(const u in e){const f=e[u],d={x:0,y:0,w:f.data.width+2*as,h:f.data.height+2*as};s.push(d),r[u]=new Ib(d,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,r,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const u in e.getUpdatedImages(s))this.patchUpdatedImage(this.iconPositions[u],e.getImage(u,s),r),this.patchUpdatedImage(this.patternPositions[u],e.getImage(u,s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[u,f]=e.tl,d=!!Object.keys(this.patternPositions).length;s.update(r.data,{useMipmap:d},{x:u,y:f})}}ee(Ib,"ImagePosition"),ee(jA,"ImageAtlas");const s_=1e20;function VA(t,e,r,s,u,f,d,g,v){for(let T=e;T<e+s;T++)$A(t,r*f+T,f,u,d,g,v);for(let T=r;T<r+u;T++)$A(t,T*f+e,1,s,d,g,v)}function $A(t,e,r,s,u,f,d){f[0]=0,d[0]=-s_,d[1]=s_,u[0]=t[e];for(let g=1,v=0,T=0;g<s;g++){u[g]=t[e+g*r];const E=g*g;do{const A=f[v];T=(u[g]-u[A]+E-A*A)/(g-A)/2}while(T<=d[v]&&--v>-1);v++,f[v]=g,d[v]=T,d[v+1]=s_}for(let g=0,v=0;g<s;g++){for(;d[v+1]<g;)v++;const T=f[v],E=g-T;t[e+g*r]=u[T]+E*E}}const Za=2,Ab={none:0,ideographs:1,all:2};class Ad{constructor(e,r,s){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=s,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,r){this.urls[r]=e}getGlyphs(e,r,s){const u=[],f=this.urls[r]||V.GLYPHS_URL;for(const d in e)for(const g of e[d])u.push({stack:d,id:g});fn(u,({stack:d,id:g},v)=>{let T=this.entries[d];T||(T=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let E=T.glyphs[g];if(E!==void 0)return void v(null,{stack:d,id:g,glyph:E});if(E=this._tinySDF(T,d,g),E)return T.glyphs[g]=E,void v(null,{stack:d,id:g,glyph:E});const A=Math.floor(g/256);if(256*A>65535)return void v(new Error("glyphs > 65535 not supported"));if(T.ranges[A])return void v(null,{stack:d,id:g,glyph:E});let C=T.requests[A];C||(C=T.requests[A]=[],Ad.loadGlyphRange(d,A,f,this.requestManager,(k,L)=>{if(L){T.ascender=L.ascender,T.descender=L.descender;for(const F in L.glyphs)this._doesCharSupportLocalGlyph(+F)||(T.glyphs[+F]=L.glyphs[+F]);T.ranges[A]=!0}for(const F of C)F(k,L);delete T.requests[A]})),C.push((k,L)=>{k?v(k):L&&v(null,{stack:d,id:g,glyph:L.glyphs[g]||null})})},(d,g)=>{if(d)s(d);else if(g){const v={};for(const{stack:T,id:E,glyph:A}of g)v[T]===void 0&&(v[T]={}),v[T].glyphs===void 0&&(v[T].glyphs={}),v[T].glyphs[E]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},v[T].ascender=this.entries[T].ascender,v[T].descender=this.entries[T].descender;s(null,v)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Ab.none&&(this.localGlyphMode===Ab.all?!!this.localFontFamily:!!this.localFontFamily&&(be["CJK Unified Ideographs"](e)||be["Hangul Syllables"](e)||be.Hiragana(e)||be.Katakana(e)||be["CJK Symbols and Punctuation"](e)||be["CJK Unified Ideographs Extension A"](e)||be["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,r,s){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(s))return;let f=e.tinySDF;if(!f){let F="400";/bold/i.test(r)?F="900":/medium/i.test(r)?F="500":/light/i.test(r)&&(F="200"),f=e.tinySDF=new Ad.TinySDF({fontFamily:u,fontWeight:F,fontSize:24*Za,buffer:3*Za,radius:8*Za}),f.fontWeight=F}if(this.localGlyphs[f.fontWeight][s])return this.localGlyphs[f.fontWeight][s];const d=String.fromCodePoint(s),{data:g,width:v,height:T,glyphWidth:E,glyphHeight:A,glyphLeft:C,glyphTop:k,glyphAdvance:L}=f.draw(d);return this.localGlyphs[f.fontWeight][s]={id:s,bitmap:new _c({width:v,height:T},g),metrics:{width:E/Za,height:A/Za,left:C/Za,top:k/Za-27,advance:L/Za,localGlyph:!0}}}}Ad.loadGlyphRange=function(t,e,r,s,u){const f=256*e,d=f+255,g=s.transformRequest(s.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",`${f}-${d}`),Uf.Glyphs);ml(g,(v,T)=>{if(v)u(v);else if(T){const E={},A=function(C){return new Ed(C).readFields(dB,{})}(T);for(const C of A.glyphs)E[C.id]=C;u(null,{glyphs:E,ascender:A.ascender,descender:A.descender})}})},Ad.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:r=8,cutoff:s=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=r;const g=this.size=t+4*e,v=this._createCanvas(g),T=this.ctx=v.getContext("2d",{willReadFrequently:!0});T.font=`${d} ${f} ${t}px ${u}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:s,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(t),d=Math.ceil(r),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-u))),v=Math.min(this.size-this.buffer,d+Math.ceil(s)),T=g+2*this.buffer,E=v+2*this.buffer,A=Math.max(T*E,0),C=new Uint8ClampedArray(A),k={data:C,width:T,height:E,glyphWidth:g,glyphHeight:v,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(g===0||v===0)return k;const{ctx:L,buffer:F,gridInner:N,gridOuter:G}=this;L.clearRect(F,F,g,v),L.fillText(t,F,F+d);const ne=L.getImageData(F,F,g,v);G.fill(s_,0,A),N.fill(0,0,A);for(let ie=0;ie<v;ie++)for(let oe=0;oe<g;oe++){const me=ne.data[4*(ie*g+oe)+3]/255;if(me===0)continue;const pe=(ie+F)*T+oe+F;if(me===1)G[pe]=0,N[pe]=s_;else{const Ee=.5-me;G[pe]=Ee>0?Ee*Ee:0,N[pe]=Ee<0?Ee*Ee:0}}VA(G,0,0,T,E,T,this.f,this.v,this.z),VA(N,F,F,g,v,T,this.f,this.v,this.z);for(let ie=0;ie<A;ie++){const oe=Math.sqrt(G[ie])-Math.sqrt(N[ie]);C[ie]=Math.round(255-255*(oe/this.radius+this.cutoff))}return k}};const vc=as;function GA(t,e,r,s){const u=[],f=t.imagePrimary,d=f.pixelRatio,g=f.paddedRect.w-2*vc,v=f.paddedRect.h-2*vc,T=t.right-t.left,E=t.bottom-t.top,A=f.stretchX||[[0,g]],C=f.stretchY||[[0,v]],k=(Ze,ut)=>Ze+ut[1]-ut[0],L=A.reduce(k,0),F=C.reduce(k,0),N=g-L,G=v-F;let ne=0,ie=L,oe=0,me=F,pe=0,Ee=N,De=0,je=G;if(f.content&&s){const Ze=f.content;ne=v0(A,0,Ze[0]),oe=v0(C,0,Ze[1]),ie=v0(A,Ze[0],Ze[2]),me=v0(C,Ze[1],Ze[3]),pe=Ze[0]-ne,De=Ze[1]-oe,Ee=Ze[2]-Ze[0]-ie,je=Ze[3]-Ze[1]-me}const Qe=(Ze,ut,vt,ot)=>{const mt=x0(Ze.stretch-ne,ie,T,t.left),tt=b0(Ze.fixed-pe,Ee,Ze.stretch,L),_t=x0(ut.stretch-oe,me,E,t.top),bt=b0(ut.fixed-De,je,ut.stretch,F),gt=x0(vt.stretch-ne,ie,T,t.left),zt=b0(vt.fixed-pe,Ee,vt.stretch,L),xt=x0(ot.stretch-oe,me,E,t.top),Tt=b0(ot.fixed-De,je,ot.stretch,F),Jt=new Mt(mt,_t),Yt=new Mt(gt,_t),Xt=new Mt(gt,xt),wt=new Mt(mt,xt),tr=new Mt(tt/d,bt/d),wr=new Mt(zt/d,Tt/d),fr=e*Math.PI/180;if(fr){const tn=Math.sin(fr),qr=Math.cos(fr),Nr=[qr,-tn,tn,qr];Jt._matMult(Nr),Yt._matMult(Nr),wt._matMult(Nr),Xt._matMult(Nr)}const Mr=Ze.stretch+Ze.fixed,Tr=vt.stretch+vt.fixed,Or=ut.stretch+ut.fixed,ur=ot.stretch+ot.fixed,nn=t.imageSecondary;return{tl:Jt,tr:Yt,bl:wt,br:Xt,texPrimary:{x:f.paddedRect.x+vc+Mr,y:f.paddedRect.y+vc+Or,w:Tr-Mr,h:ur-Or},texSecondary:nn?{x:nn.paddedRect.x+vc+Mr,y:nn.paddedRect.y+vc+Or,w:Tr-Mr,h:ur-Or}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:tr,pixelOffsetBR:wr,minFontScaleX:Ee/d/T,minFontScaleY:je/d/E,isSDF:r}};if(s&&(f.stretchX||f.stretchY)){const Ze=WA(A,N,L),ut=WA(C,G,F);for(let vt=0;vt<Ze.length-1;vt++){const ot=Ze[vt],mt=Ze[vt+1];for(let tt=0;tt<ut.length-1;tt++)u.push(Qe(ot,ut[tt],mt,ut[tt+1]))}}else u.push(Qe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:v+1}));return u}function v0(t,e,r){let s=0;for(const u of t)s+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return s}function WA(t,e,r){const s=[{fixed:-vc,stretch:0}];for(const[u,f]of t){const d=s[s.length-1];s.push({fixed:u-d.stretch,stretch:d.stretch}),s.push({fixed:u-d.stretch,stretch:d.stretch+(f-u)})}return s.push({fixed:e+vc,stretch:r}),s}function x0(t,e,r,s){return t/e*r+s}function b0(t,e,r,s){return t-e*r/s}function bB(t,e,r,s){const u=e+t.positionedLines[s].lineOffset;return s===0?r+u/2:r+(u+(e+t.positionedLines[s-1].lineOffset))/2}function wB(t,e=1,r=!1){let s=1/0,u=1/0,f=-1/0,d=-1/0;const g=t[0];for(let k=0;k<g.length;k++){const L=g[k];(!k||L.x<s)&&(s=L.x),(!k||L.y<u)&&(u=L.y),(!k||L.x>f)&&(f=L.x),(!k||L.y>d)&&(d=L.y)}const v=Math.min(f-s,d-u);let T=v/2;const E=new fm([],TB);if(v===0)return new Mt(s,u);for(let k=s;k<f;k+=v)for(let L=u;L<d;L+=v)E.push(new Cd(k+T,L+T,T,t));let A=function(k){let L=0,F=0,N=0;const G=k[0];for(let ne=0,ie=G.length,oe=ie-1;ne<ie;oe=ne++){const me=G[ne],pe=G[oe],Ee=me.x*pe.y-pe.x*me.y;F+=(me.x+pe.x)*Ee,N+=(me.y+pe.y)*Ee,L+=3*Ee}return new Cd(F/L,N/L,0,k)}(t),C=E.length;for(;E.length;){const k=E.pop();(k.d>A.d||!A.d)&&(A=k,r&&console.log("found best %d after %d probes",Math.round(1e4*k.d)/1e4,C)),k.max-A.d<=e||(T=k.h/2,E.push(new Cd(k.p.x-T,k.p.y-T,T,t)),E.push(new Cd(k.p.x+T,k.p.y-T,T,t)),E.push(new Cd(k.p.x-T,k.p.y+T,T,t)),E.push(new Cd(k.p.x+T,k.p.y+T,T,t)),C+=4)}return r&&(console.log(`num probes: ${C}`),console.log(`best distance: ${A.d}`)),A.p}function TB(t,e){return e.max-t.max}class Cd{constructor(e,r,s,u){this.p=new Mt(e,r),this.h=s,this.d=function(f,d){let g=!1,v=1/0;for(let T=0;T<d.length;T++){const E=d[T];for(let A=0,C=E.length,k=C-1;A<C;k=A++){const L=E[A],F=E[k];L.y>f.y!=F.y>f.y&&f.x<(F.x-L.x)*(f.y-L.y)/(F.y-L.y)+L.x&&(g=!g),v=Math.min(v,QM(f,L,F))}}return(g?1:-1)*Math.sqrt(v)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const Cb=Number.POSITIVE_INFINITY,SB=Math.sqrt(2);function qA(t,[e,r]){let s=0,u=0;if(r===Cb){e<0&&(e=0);const f=e/SB;switch(t){case"top-right":case"top-left":u=f-7;break;case"bottom-right":case"bottom-left":u=7-f;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(t){case"top-right":case"bottom-right":s=-f;break;case"top-left":case"bottom-left":s=f;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),t){case"top-right":case"top-left":case"top":u=r-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-r}switch(t){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,u]}function Pb(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function EB(t,e,r,s,u,f,d,g,v,T,E,A,C,k,L){let F=f.textMaxSize.evaluate(e,{},A);F===void 0&&(F=d);const N=t.layers[0].layout,G=N.get("icon-offset").evaluate(e,{},A),ne=ZA(r.horizontal)||r.vertical,ie=C.name==="globe",oe=ji,me=d/oe,pe=t.tilePixelRatio*F/oe,Ee=(mt=t.overscaling,t.zoom>18&&mt>2&&(mt>>=1),Math.max(At/(512*mt),1)*N.get("symbol-spacing")),De=N.get("text-padding")*t.tilePixelRatio,je=N.get("icon-padding")*t.tilePixelRatio,Qe=Ar(N.get("text-max-angle")),Ze=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",ut=N.get("icon-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",vt=N.get("symbol-placement"),ot=Ee/2;var mt;const tt=N.get("icon-text-fit").evaluate(e,{},A),_t=N.get("icon-text-fit-padding").evaluate(e,{},A),bt=tt!=="none";let gt;t.hasAnyIconTextFit===!1&&bt&&(t.hasAnyIconTextFit=!0),s&&bt&&(t.allowVerticalPlacement&&r.vertical&&(gt=RA(s,r.vertical,tt,_t,G,me)),ne&&(s=RA(s,ne,tt,_t,G,me)));const zt=(xt,Tt,Jt)=>{if(Tt.x<0||Tt.x>=At||Tt.y<0||Tt.y>=At)return;let Yt=null;if(ie){const{x:Xt,y:wt,z:tr}=C.projectTilePoint(Tt.x,Tt.y,Jt);Yt={anchor:new vu(Xt,wt,tr,0,void 0),up:C.upVector(Jt,Tt.x,Tt.y)}}(function(Xt,wt,tr,wr,fr,Mr,Tr,Or,ur,nn,tn,qr,Nr,Hr,gn,un,Cn,An,to,Fn,En,ei,Ri,ki,mn,Co,xu){const va=Xt.addToLineVertexArray(wt,wr);let Ja,Mc,Ic,Qh,YC,KC,QC,JC=0,e3=0,t3=0,r3=0,nw=-1,iw=-1;const Il={};let n3=yh("");const Jh=tr?tr.anchor:wt,ow=ur.layout.get("icon-text-fit").evaluate(En,{},mn)!=="none";let sw=0,aw=0;if(ur._unevaluatedLayout.getValue("text-radial-offset")===void 0?[sw,aw]=ur.layout.get("text-offset").evaluate(En,{},mn).map(us=>us*ji):(sw=ur.layout.get("text-radial-offset").evaluate(En,{},mn)*ji,aw=Cb),Xt.allowVerticalPlacement&&fr.vertical){const us=fr.vertical;if(gn)KC=Ob(us),Or&&(QC=Ob(Or));else{const cs=ur.layout.get("text-rotate").evaluate(En,{},mn)+90;Ic=w0(nn,Jh,wt,tn,qr,Nr,us,Hr,cs,un),Or&&(Qh=w0(nn,Jh,wt,tn,qr,Nr,Or,An,cs))}}if(Mr){const us=ur.layout.get("icon-rotate").evaluate(En,{},mn),cs=GA(Mr,us,Ri,ow),Bd=Or?GA(Or,us,Ri,ow):void 0;Mc=w0(nn,Jh,wt,tn,qr,Nr,Mr,An,us),JC=4*cs.length;const i3=Xt.iconSizeData;let ef=null;i3.kind==="source"?(ef=[Ha*ur.layout.get("icon-size").evaluate(En,{},mn)],ef[0]>xc&&zn(`${Xt.layerIds[0]}: Value for "icon-size" is >= ${a_}. Reduce your "icon-size".`)):i3.kind==="composite"&&(ef=[Ha*ei.compositeIconSizes[0].evaluate(En,{},mn),Ha*ei.compositeIconSizes[1].evaluate(En,{},mn)],(ef[0]>xc||ef[1]>xc)&&zn(`${Xt.layerIds[0]}: Value for "icon-size" is >= ${a_}. Reduce your "icon-size".`)),Xt.addSymbols(Xt.icon,cs,ef,Fn,to,En,!1,tr,wt,va.lineStartIndex,va.lineLength,-1,ki,mn,Co,xu),nw=Xt.icon.placedSymbolArray.length-1,Bd&&(e3=4*Bd.length,Xt.addSymbols(Xt.icon,Bd,ef,Fn,to,En,$s.vertical,tr,wt,va.lineStartIndex,va.lineLength,-1,ki,mn,Co,xu),iw=Xt.icon.placedSymbolArray.length-1)}for(const us in fr.horizontal){const cs=fr.horizontal[us];Ja||(n3=yh(cs.text),gn?YC=Ob(cs):Ja=w0(nn,Jh,wt,tn,qr,Nr,cs,Hr,ur.layout.get("text-rotate").evaluate(En,{},mn),un));const Bd=cs.positionedLines.length===1;if(t3+=HA(Xt,tr,wt,cs,Tr,ur,gn,En,un,va,fr.vertical?$s.horizontal:$s.horizontalOnly,Bd?Object.keys(fr.horizontal):[us],Il,nw,ei,ki,mn,Co),Bd)break}fr.vertical&&(r3+=HA(Xt,tr,wt,fr.vertical,Tr,ur,gn,En,un,va,$s.vertical,["vertical"],Il,iw,ei,ki,mn,Co));let Ac=-1;const lw=(us,cs)=>us?Math.max(us,cs):cs;Ac=lw(YC,Ac),Ac=lw(KC,Ac),Ac=lw(QC,Ac);const K5=Ac>-1?1:0;Xt.glyphOffsetArray.length>=65535&&zn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),En.sortKey!==void 0&&Xt.addToSortKeyRanges(Xt.symbolInstances.length,En.sortKey),Xt.symbolInstances.emplaceBack(wt.x,wt.y,Jh.x,Jh.y,Jh.z,Il.right>=0?Il.right:-1,Il.center>=0?Il.center:-1,Il.left>=0?Il.left:-1,Il.vertical>=0?Il.vertical:-1,nw,iw,n3,Ja!==void 0?Ja:Xt.collisionBoxArray.length,Ja!==void 0?Ja+1:Xt.collisionBoxArray.length,Ic!==void 0?Ic:Xt.collisionBoxArray.length,Ic!==void 0?Ic+1:Xt.collisionBoxArray.length,Mc!==void 0?Mc:Xt.collisionBoxArray.length,Mc!==void 0?Mc+1:Xt.collisionBoxArray.length,Qh||Xt.collisionBoxArray.length,Qh?Qh+1:Xt.collisionBoxArray.length,tn,t3,r3,JC,e3,K5,0,sw,aw,Ac,0,1,1,ow?1:0)})(t,Tt,Yt,xt,r,s,u,gt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,De,Ze,v,0,je,ut,G,e,f,T,E,A,k,L)};if(vt==="line")for(const xt of NA(e.geometry,0,0,At,At)){const Tt=xB(xt,Ee,Qe,r.vertical||ne,s,oe,pe,t.overscaling,At);for(const Jt of Tt)ne&&MB(t,ne.text,ot,Jt)||zt(xt,Jt,A)}else if(vt==="line-center"){for(const xt of e.geometry)if(xt.length>1){const Tt=vB(xt,Qe,r.vertical||ne,s,oe,pe);Tt&&zt(xt,Tt,A)}}else if(e.type==="Polygon")for(const xt of i0(e.geometry,0)){const Tt=wB(xt,16);zt(xt[0],new vu(Tt.x,Tt.y,0,0,void 0),A)}else if(e.type==="LineString")for(const xt of e.geometry)zt(xt,new vu(xt[0].x,xt[0].y,0,0,void 0),A);else if(e.type==="Point")for(const xt of e.geometry)for(const Tt of xt)zt([Tt],new vu(Tt.x,Tt.y,0,0,void 0),A)}const a_=255,xc=a_*Ha;function HA(t,e,r,s,u,f,d,g,v,T,E,A,C,k,L,F,N,G){const ne=function(me,pe,Ee,De,je,Qe,Ze,ut){const vt=[];if(pe.positionedLines.length===0)return vt;const ot=De.layout.get("text-rotate").evaluate(Qe,{})*Math.PI/180,mt=function(zt){const xt=zt[0],Tt=zt[1],Jt=xt*Tt;return Jt>0?[xt,-Tt]:Jt<0?[-xt,Tt]:xt===0?[Tt,xt]:[Tt,-xt]}(Ee);let tt=Math.abs(pe.top-pe.bottom);for(const zt of pe.positionedLines)tt-=zt.lineOffset;const _t=pe.positionedLines.length,bt=tt/_t;let gt=pe.top-Ee[1];for(let zt=0;zt<_t;++zt){const xt=pe.positionedLines[zt];gt=bB(pe,bt,gt,zt);for(const Tt of xt.positionedGlyphs){if(!Tt.rect)continue;const Jt=Tt.rect||{};let Yt=IA+1,Xt=!0,wt=1,tr=0;if(Tt.imageName){const Fn=Ze[Tt.imageName];if(!Fn)continue;if(Fn.sdf){zn("SDF images are not supported in formatted text and will be ignored.");continue}Xt=!1,wt=Fn.pixelRatio,Yt=as/wt}const wr=(je||ut)&&Tt.vertical,fr=Tt.metrics.advance*Tt.scale/2,Mr=Tt.metrics,Tr=Tt.rect;if(Tr===null)continue;ut&&pe.verticalizable&&(tr=Tt.imageName?fr-Tt.metrics.width*Tt.scale/2:0);const Or=je?[Tt.x+fr,Tt.y]:[0,0];let ur=[0,0],nn=[0,0],tn=!1;je||(wr?(nn=[Tt.x+fr+mt[0],Tt.y+mt[1]-tr],tn=!0):ur=[Tt.x+fr+Ee[0],Tt.y+Ee[1]-tr]);const qr=Tr.w*Tt.scale/(wt*(Tt.localGlyph?Za:1)),Nr=Tr.h*Tt.scale/(wt*(Tt.localGlyph?Za:1));let Hr,gn,un,Cn;if(wr){const Fn=Tt.y-gt,En=new Mt(-fr,fr-Fn),ei=-Math.PI/2,Ri=new Mt(...nn);Hr=new Mt(-fr+ur[0],ur[1]),Hr._rotateAround(ei,En)._add(Ri),Hr.x+=-Fn+fr,Hr.y-=(Mr.left-Yt)*Tt.scale;const ki=Tt.imageName?Mr.advance*Tt.scale:ji*Tt.scale,mn=String.fromCodePoint(Tt.glyph);hB(mn)?Hr.x+=(1-Yt)*Tt.scale:fB(mn)?Hr.x+=ki-Mr.height*Tt.scale+(-Yt-1)*Tt.scale:Hr.x+=Tt.imageName||Mr.width+2*Yt===Tr.w&&Mr.height+2*Yt===Tr.h?(ki-Nr)/2:(ki-(Mr.height+2*Yt)*Tt.scale)/2,gn=new Mt(Hr.x,Hr.y-qr),un=new Mt(Hr.x+Nr,Hr.y),Cn=new Mt(Hr.x+Nr,Hr.y-qr)}else{const Fn=(Mr.left-Yt)*Tt.scale-fr+ur[0],En=(-Mr.top-Yt)*Tt.scale+ur[1],ei=Fn+qr,Ri=En+Nr;Hr=new Mt(Fn,En),gn=new Mt(ei,En),un=new Mt(Fn,Ri),Cn=new Mt(ei,Ri)}if(ot){let Fn;Fn=je?new Mt(0,0):tn?new Mt(mt[0],mt[1]):new Mt(Ee[0],Ee[1]),Hr._rotateAround(ot,Fn),gn._rotateAround(ot,Fn),un._rotateAround(ot,Fn),Cn._rotateAround(ot,Fn)}const An=new Mt(0,0),to=new Mt(0,0);vt.push({tl:Hr,tr:gn,bl:un,br:Cn,texPrimary:Jt,texSecondary:void 0,writingMode:pe.writingMode,glyphOffset:Or,sectionIndex:Tt.sectionIndex,isSDF:Xt,pixelOffsetTL:An,pixelOffsetBR:to,minFontScaleX:0,minFontScaleY:0})}}return vt}(0,s,v,f,d,g,u,t.allowVerticalPlacement),ie=t.textSizeData;let oe=null;ie.kind==="source"?(oe=[Ha*f.layout.get("text-size").evaluate(g,{},N)],oe[0]>xc&&zn(`${t.layerIds[0]}: Value for "text-size" is >= ${a_}. Reduce your "text-size".`)):ie.kind==="composite"&&(oe=[Ha*L.compositeTextSizes[0].evaluate(g,{},N),Ha*L.compositeTextSizes[1].evaluate(g,{},N)],(oe[0]>xc||oe[1]>xc)&&zn(`${t.layerIds[0]}: Value for "text-size" is >= ${a_}. Reduce your "text-size".`)),t.addSymbols(t.text,ne,oe,v,d,g,E,e,r,T.lineStartIndex,T.lineLength,k,F,N,G,!1);for(const me of A)C[me]=t.text.placedSymbolArray.length-1;return 4*ne.length}function ZA(t){for(const e in t)return t[e];return null}function w0(t,e,r,s,u,f,d,g,v,T){let E=d.top,A=d.bottom,C=d.left,k=d.right;const L=d.collisionPadding;if(L&&(C-=L[0],E-=L[1],k+=L[2],A+=L[3]),v){const F=new Mt(C,E),N=new Mt(k,E),G=new Mt(C,A),ne=new Mt(k,A),ie=Ar(v);let oe=new Mt(0,0);T&&(oe=new Mt(T[0],T[1])),F._rotateAround(ie,oe),N._rotateAround(ie,oe),G._rotateAround(ie,oe),ne._rotateAround(ie,oe),C=Math.min(F.x,N.x,G.x,ne.x),k=Math.max(F.x,N.x,G.x,ne.x),E=Math.min(F.y,N.y,G.y,ne.y),A=Math.max(F.y,N.y,G.y,ne.y)}return t.emplaceBack(e.x,e.y,e.z,r.x,r.y,C,E,k,A,g,s,u,f),t.length-1}function Ob(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function MB(t,e,r,s){const u=t.compareText;if(e in u){const f=u[e];for(let d=f.length-1;d>=0;d--)if(s.dist(f[d])<r)return!0}else u[e]=[];return u[e].push(s),!1}function XA(t,e){const r=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,u=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),f=Math.sin(r)*u/Math.sin(Math.max(Math.PI/2-t._pitch-r,.01)),d=Math.sin(t._pitch)*f+u;return Math.min(1.01*d,u*(1/t._horizonShift))}function qh(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const r=Math.pow(2,-t.z),s=t.x*r,u=(t.x+1)*r,f=t.y*r,d=(t.y+1)*r,g=Ho(s),v=Ho(u),T=Di(f),E=Di(d),A=e.project(g,T),C=e.project(v,T),k=e.project(v,E),L=e.project(g,E);let F=Math.min(A.x,C.x,k.x,L.x),N=Math.min(A.y,C.y,k.y,L.y),G=Math.max(A.x,C.x,k.x,L.x),ne=Math.max(A.y,C.y,k.y,L.y);const ie=r/16;function oe(pe,Ee,De,je,Qe,Ze){const ut=(De+Qe)/2,vt=(je+Ze)/2,ot=e.project(Ho(ut),Di(vt)),mt=Math.max(0,F-ot.x,N-ot.y,ot.x-G,ot.y-ne);F=Math.min(F,ot.x),G=Math.max(G,ot.x),N=Math.min(N,ot.y),ne=Math.max(ne,ot.y),mt>ie&&(oe(pe,ot,De,je,ut,vt),oe(ot,Ee,ut,vt,Qe,Ze))}oe(A,C,s,f,u,f),oe(C,k,u,f,u,d),oe(k,L,u,d,s,d),oe(L,A,s,d,s,f),F-=ie,N-=ie,G+=ie,ne+=ie;const me=1/Math.max(G-F,ne-N);return{scale:me,x:F*me,y:N*me,x2:G*me,y2:ne*me,projection:e}}function YA(t,{x:e,y:r},s=0){return new Mt(((e-s)*t.scale-t.x)*At,(r*t.scale-t.y)*At)}const IB=o.ad.identity(new Float32Array(16));class bc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new Vr(0,0)}projectTilePoint(e,r,s){return{x:e,y:r,z:0}}locationPoint(e,r,s=!0){return e._coordinatePoint(e.locationCoordinate(r),s)}pixelsPerMeter(e,r){return Ao(1,e)*r}pixelSpaceConversion(e,r,s){return 1}farthestPixelDistance(e){return XA(e,e.pixelsPerMeter)}pointCoordinate(e,r,s,u){const f=e.horizonLineFromTop(!1),d=new Mt(r,Math.max(f,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,u))}pointCoordinate3D(e,r,s){const u=new Mt(r,s);if(e.elevation)return e.elevation.pointCoordinate(u);{const f=this.pointCoordinate(e,u.x,u.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,r){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,r.x,r.y);const s=e.horizonLineFromTop();return r.y<s}createInversionMatrix(e,r){return IB}createTileMatrix(e,r,s){let u,f,d;const g=s.canonical,v=o.ad.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=qh(g,this);u=1,f=T.x+s.wrap*T.scale,d=T.y,o.ad.scale(v,v,[u/T.scale,u/T.scale,e.pixelsPerMeter/r])}else u=r/e.zoomScale(g.z),f=(g.x+Math.pow(2,g.z)*s.wrap)*u,d=g.y*u;return o.ad.translate(v,v,[f,d,0]),o.ad.scale(v,v,[u/At,u/At,1]),v}upVector(e,r,s){return[0,0,1]}upVectorScale(e,r,s){return{metersToTile:1}}}class AB extends bc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,s]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(Ar(r));this.n=(u+Math.sin(Ar(s)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:s,c:u,r0:f}=this,d=Ar(e-this.center[0]),g=Ar(r),v=Math.sqrt(u-2*s*Math.sin(g))/s;return{x:v*Math.sin(d*s),y:v*Math.cos(d*s)-f,z:0}}unproject(e,r){const{n:s,c:u,r0:f}=this,d=f+r;let g=Math.atan2(e,Math.abs(d))*Math.sign(d);d*s<0&&(g-=Math.PI*Math.sign(e)*Math.sign(d));const v=Ar(this.center[0])*s;g=bn(g,-Math.PI-v,Math.PI-v);const T=Kt(li(g/s)+this.center[0],-180,180),E=Math.asin(Kt((u-(e*e+d*d)*s*s)/(2*s),-1,1)),A=Kt(li(E),-Un,Un);return new Vr(T,A)}}const l_=1.340264,u_=-.081106,c_=893e-6,h_=.003796,T0=Math.sqrt(3)/2;class CB extends bc{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(T0*Math.sin(r)),u=s*s,f=u*u*u;return{x:.5*(e*Math.cos(s)/(T0*(l_+3*u_*u+f*(7*c_+9*h_*u)))/Math.PI+.5),y:1-.5*(s*(l_+u_*u+f*(c_+h_*u))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,u=s*s,f=u*u*u;for(let E,A,C,k=0;k<12&&(A=s*(l_+u_*u+f*(c_+h_*u))-r,C=l_+3*u_*u+f*(7*c_+9*h_*u),E=A/C,s=Kt(s-E,-Math.PI/3,Math.PI/3),u=s*s,f=u*u*u,!(Math.abs(E)<1e-12));++k);const d=T0*e*(l_+3*u_*u+f*(7*c_+9*h_*u))/Math.cos(s),g=Math.asin(Math.sin(s)/T0),v=Kt(180*d/Math.PI,-180,180),T=Kt(180*g/Math.PI,-Un,Un);return new Vr(v,T)}}class PB extends bc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const s=360*(e-.5),u=Kt(360*(.5-r),-Un,Un);return new Vr(s,u)}}const Pd=Math.PI/2;function S0(t){return Math.tan((Pd+t)/2)}class OB extends bc{constructor(e){super(e),this.center=e.center||[0,30];const[r,s]=this.parallels=e.parallels||[30,30];let u=Ar(r),f=Ar(s);this.southernCenter=u+f<0,this.southernCenter&&(u=-u,f=-f);const d=Math.cos(u),g=S0(u);this.n=u===f?Math.sin(u):Math.log(d/Math.cos(f))/Math.log(S0(f)/g),this.f=d*Math.pow(S0(u),this.n)/this.n}project(e,r){r=Ar(r),this.southernCenter&&(r=-r),e=Ar(e-this.center[0]);const s=1e-6,{n:u,f}=this;f>0?r<-Pd+s&&(r=-Pd+s):r>Pd-s&&(r=Pd-s);const d=f/Math.pow(S0(r),u);let g=d*Math.sin(u*e),v=f-d*Math.cos(u*e);return g=.5*(g/Math.PI+.5),v=.5*(v/Math.PI+.5),{x:g,y:this.southernCenter?v:1-v,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:s,f:u}=this,f=u-r,d=Math.sign(f),g=Math.sign(s)*Math.sqrt(e*e+f*f);let v=Math.atan2(e,Math.abs(f))*d;f*s<0&&(v-=Math.PI*Math.sign(e)*d);const T=Kt(li(v/s)+this.center[0],-180,180),E=Kt(li(2*Math.atan(Math.pow(u/g,1/s))-Pd),-Un,Un);return new Vr(T,this.southernCenter?-E:E)}}class KA extends bc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:bl(e),y:wl(r),z:0}}unproject(e,r){const s=Ho(e),u=Di(r);return new Vr(s,u)}}const QA=Ar(Un);class DB extends bc{project(e,r){const s=(r=Ar(r))*r,u=s*s;return{x:.5*((e=Ar(e))*(.8707-.131979*s+u*(u*(.003971*s-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+s*(.015085+u*(.028874*s-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let s=r=(2*(1-r)-1)*Math.PI,u=25,f=0,d=s*s;do{d=s*s;const T=d*d;f=(s*(1.007226+d*(.015085+T*(.028874*d-.044475-.005916*T)))-r)/(1.007226+d*(.045255+T*(.259866*d-.311325-.005916*11*T))),s=Kt(s-f,-QA,QA)}while(Math.abs(f)>1e-6&&--u>0);d=s*s;const g=Kt(li(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),v=li(s);return new Vr(g,v)}}const JA=Ar(Un);class RB extends bc{project(e,r){r=Ar(r),e=Ar(e);const s=Math.cos(r),u=2/Math.PI,f=Math.acos(s*Math.cos(e/2)),d=Math.sin(f)/f,g=.5*(e*u+2*s*Math.sin(e/2)/d)||0,v=.5*(r+Math.sin(r)/d)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(v/Math.PI+1),z:0}}unproject(e,r){let s=e=(2*e-.5)*Math.PI,u=r=(2*(1-r)-1)*Math.PI,f=25;const d=1e-6;let g=0,v=0;do{const T=Math.cos(u),E=Math.sin(u),A=2*E*T,C=E*E,k=T*T,L=Math.cos(s/2),F=Math.sin(s/2),N=2*L*F,G=F*F,ne=1-k*L*L,ie=ne?1/ne:0,oe=ne?Math.acos(T*L)*Math.sqrt(1/ne):0,me=.5*(2*oe*T*F+2*s/Math.PI)-e,pe=.5*(oe*E+u)-r,Ee=.5*ie*(k*G+oe*T*L*C)+1/Math.PI,De=ie*(N*A/4-oe*E*F),je=.125*ie*(A*F-oe*E*k*N),Qe=.5*ie*(C*L+oe*G*T)+.5,Ze=De*je-Qe*Ee;g=(pe*De-me*Qe)/Ze,v=(me*je-pe*Ee)/Ze,s=Kt(s-g,-Math.PI,Math.PI),u=Kt(u-v,-JA,JA)}while((Math.abs(g)>d||Math.abs(v)>d)&&--f>0);return new Vr(li(s),li(u))}}class eC extends bc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ar(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:s,cosPhi:u}=this;return{x:Ar(e)*u*s+.5,y:-Math.sin(Ar(r))/u*s+.5,z:0}}unproject(e,r){const{scale:s,cosPhi:u}=this,f=-(r-.5)/s,d=Kt(li((e-.5)/s)/u,-180,180),g=Math.asin(Kt(f*u,-1,1)),v=Kt(li(g),-Un,Un);return new Vr(d,v)}}class kB extends KA{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,s){const u=Zm(e,r,s),f=Xm(Tl(s));return o._.transformMat4(u,u,f),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,r){const s=jh(r.lat,r.lng),u=o._.normalize([],s),f=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude,d=Ao(1,0)*At*f;o._.scaleAndAdd(s,s,u,d);const g=o.ad.identity(new Float64Array(16));return o.ad.multiply(g,e.pixelMatrix,e.globeMatrix),o._.transformMat4(s,s,g),new Mt(s[0],s[1])}pixelsPerMeter(e,r){return Ao(1,0)*r}pixelSpaceConversion(e,r,s){const u=Ao(1,e)*r,f=nr(Ao(1,45)*r,u,s);return this.pixelsPerMeter(e,r)/f}createTileMatrix(e,r,s){const u=lb(Tl(s.canonical));return o.ad.multiply(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,r){const{center:s}=e,u=Xm(Tl(r));return o.ad.rotateY(u,u,Ar(s.lng)),o.ad.rotateX(u,u,Ar(s.lat)),o.ad.scale(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,r,s,u){return aI(e,r,s,!0)||new eo(0,0)}pointCoordinate3D(e,r,s){const u=this.pointCoordinate(e,r,s,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,r){return!aI(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(u,f){const d=u.cameraToCenterDistance,g=u._centerAltitude*f,v=u._camera,T=u._camera.forward(),E=o._.add([],o._.scale([],T,-d),[0,0,g]),A=u.worldSize/(2*Math.PI),C=[0,0,-A],k=u.width/u.height,L=Math.tan(u.fovAboveCenter),F=o._.scale([],v.up(),L),N=o._.scale([],v.right(),L*k),G=o._.normalize([],o._.add([],o._.add([],T,F),N)),ne=[];let ie;if(new nb(E,G).closestPointOnSphere(C,A,ne)){const oe=o._.add([],ne,C),me=o._.sub([],oe,E);ie=Math.cos(u.fovAboveCenter)*o._.length(me)}else{const oe=o._.sub([],E,C),me=o._.sub([],C,E);o._.normalize(me,me);const pe=o._.length(oe)-A;ie=Math.sqrt(pe*(pe+2*A));const Ee=Math.acos(ie/(A+pe))-Math.acos(o._.dot(T,me));ie*=Math.cos(Ee)}return 1.01*ie}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=gu(e.zoom);if(s>0){const u=XA(e,Ao(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return nr(r,u+f*(1-Math.cos(d)),Math.pow(s,10))}return r}upVector(e,r,s){return Zm(r,s,e,1)}upVectorScale(e){return{metersToTile:Qy(e0(Tl(e)))}}}function tC(t){const e=t.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new KA(t);case"equirectangular":return new PB(t);case"naturalEarth":return new DB(t);case"equalEarth":return new CB(t);case"winkelTripel":return new RB(t);case"albers":return r?new eC(t):new AB(t);case"lambertConformalConic":return r?new eC(t):new OB(t);case"globe":return new kB(t)}throw new Error(`Invalid projection name: ${t.name}`)}class Hh{constructor(e,r,s,u){this.id=Hh.uniqueIdxCounter,Hh.uniqueIdxCounter++,this.context=e;const f=e.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!s,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||u||r.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=Hh.uniqueIdxCounter,Hh.uniqueIdxCounter++;const r=this.context.gl;this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Hh.uniqueIdxCounter=0;class Od{constructor(e,r,s){this.func=e,this.mask=r,this.range=s}}Od.ReadOnly=!1,Od.ReadWrite=!0,Od.disabled=new Od(519,Od.ReadOnly,[0,1]);const Db=7680;class Rb{constructor(e,r,s,u,f,d){this.test=e,this.ref=r,this.mask=s,this.fail=u,this.depthFail=f,this.pass=d}}Rb.disabled=new Rb({func:519,mask:0},0,0,Db,Db,Db);const f_=771;class ls{constructor(e,r,s,u){this.blendFunction=e,this.blendColor=r,this.mask=s,this.blendEquation=u}}ls.Replace=[1,0,1,0],ls.disabled=new ls(ls.Replace,Gr.transparent,[!1,!1,!1,!1]),ls.unblended=new ls(ls.Replace,Gr.transparent,[!0,!0,!0,!0]),ls.alphaBlended=new ls([1,f_,1,f_],Gr.transparent,[!0,!0,!0,!0]),ls.alphaBlendedNonPremultiplied=new ls([770,f_,770,f_],Gr.transparent,[!0,!0,!0,!0]),ls.multiply=new ls([774,0,774,0],Gr.transparent,[!0,!0,!0,!0]);const kb=1029,Lb=2305;class Xa{constructor(e,r,s){this.enable=e,this.mode=r,this.frontFace=s}}Xa.disabled=new Xa(!1,kb,Lb),Xa.backCCW=new Xa(!0,kb,Lb),Xa.backCW=new Xa(!0,kb,2304),Xa.frontCW=new Xa(!0,1028,2304),Xa.frontCCW=new Xa(!0,1028,Lb);const LB=a0.types,zB=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function E0(t,e,r,s,u,f,d,g,v,T,E,A,C){const k=g?Math.min(xc,Math.round(g[0])):0,L=g?Math.min(xc,Math.round(g[1])):0;t.emplaceBack(e,r,Math.round(32*s),Math.round(32*u),f,d,(k<<1)+(v?1:0),L,16*T,16*E,256*A,256*C)}function M0(t,e,r){t.emplaceBack(e,r)}function I0(t,e,r,s,u,f,d){t.emplaceBack(e,r,s,u,f,d)}function A0(t,e,r,s,u){t.emplaceBack(e,r,s,u),t.emplaceBack(e,r,s,u),t.emplaceBack(e,r,s,u),t.emplaceBack(e,r,s,u)}function FB(t){for(const e of t.sections)if(Ct(e.text))return!0;return!1}class zb{constructor(e){this.layoutVertexArray=new M1,this.indexArray=new Si,this.programConfigurations=e,this.segments=new In,this.dynamicLayoutVertexArray=new lc,this.opacityVertexArray=new A1,this.occlusionQueryOpacityVertexArray=new Bh,this.placedSymbolArray=new OM,this.iconTransitioningVertexArray=new hc,this.globeExtVertexArray=new I1,this.zOffsetVertexArray=new Bh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,r,s,u,f){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,NF.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,jF.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,zB,!0),this.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(this.occlusionQueryOpacityVertexArray,bb.members,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,VF.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,UF.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,uA.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.occlusionQueryOpacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}ee(zb,"SymbolBuffers");class Fb{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new In,this.collisionVertexArray=new O1,this.collisionVertexArrayExt=new lc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,$F.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,GF.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ee(Fb,"CollisionBuffers");class Dd{constructor(e){this.queries=new Map,this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=o.ad.identity([]),this.placementViewportMatrix=o.ad.identity([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Tb(this.zoom,r["text-size"]),this.iconSizeData=Tb(this.zoom,r["icon-size"]);const s=this.layers[0].layout,u=s.get("symbol-sort-key"),f=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(d=>$s[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=s.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new zb(new dc(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^text/.test(e))),this.icon=new zb(new dc(this.layers,{zoom:this.zoom,lut:this.lut},e=>/^icon/.test(e))),this.glyphOffsetArray=new kM,this.lineVertexArray=new LM,this.symbolInstances=new RM}calculateGlyphDependencies(e,r,s,u,f){for(let d=0;d<e.length;d++){const g=e.codePointAt(d);if(g===void 0)break;if(r[g]=!0,u&&f&&g<=65535){const v=i_[e.charAt(d)];v&&(r[v.charCodeAt(0)]=!0)}}}updateFootprints(e,r){}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const s=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!vb(this.activeReplacements,s)&&(this.activeReplacements=s,!0)}populate(e,r,s,u){const f=this.layers[0],d=f.layout,g=this.projection.name==="globe",v=d.get("text-font"),T=d.get("text-field"),E=d.get("icon-image"),A=(T.value.kind!=="constant"||T.value.value instanceof Oi&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),C=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,k=d.get("symbol-sort-key");if(this.features=[],!A&&!C)return;const L=r.iconDependencies,F=r.glyphDependencies,N=r.availableImages,G=new pr(this.zoom);for(const{feature:ne,id:ie,index:oe,sourceLayerIndex:me}of e){const pe=f._featureFilter.needGeometry,Ee=mu(ne,pe);if(!f._featureFilter.filter(G,Ee,s))continue;if(pe||(Ee.geometry=qa(ne,s,u)),g&&ne.type!==1&&s.z<=5){const Ze=Ee.geometry,ut=.98078528056,vt=(ot,mt)=>{const tt=Zm(ot.x,ot.y,s,1),_t=Zm(mt.x,mt.y,s,1);return o._.dot(tt,_t)<ut};for(let ot=0;ot<Ze.length;ot++)Ze[ot]=w4(Ze[ot],vt)}let De,je;if(A){const Ze=f.getValueAndResolveTokens("text-field",Ee,s,N),ut=Oi.factory(Ze);FB(ut)&&(this.hasRTLText=!0),(!this.hasRTLText||Rr()==="unavailable"||this.hasRTLText&&Pr.isParsed())&&(De=cB(ut,f,Ee))}if(C){const Ze=f.getValueAndResolveTokens("icon-image",Ee,s,N);je=Ze instanceof Go?Ze:Go.fromString(Ze)}if(!De&&!je)continue;const Qe=this.sortFeaturesByKey?k.evaluate(Ee,{},s):void 0;if(this.features.push({id:ie,text:De,icon:je,index:oe,sourceLayerIndex:me,geometry:Ee.geometry,properties:ne.properties,type:LB[ne.type],sortKey:Qe}),je&&(L[je.namePrimary]=!0,je.nameSecondary&&(L[je.nameSecondary]=!0)),De){const Ze=v.evaluate(Ee,{},s).join(","),ut=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf($s.vertical)>=0;for(const vt of De.sections)if(vt.image)L[vt.image.namePrimary]=!0;else{const ot=Xe(De.toString()),mt=vt.fontStack||Ze,tt=F[mt]=F[mt]||{};this.calculateGlyphDependencies(vt.text,tt,ut,this.allowVerticalPlacement,ot)}}}d.get("symbol-placement")==="line"&&(this.features=function(ne){const ie={},oe={},me=[];let pe=0;function Ee(Ze){me.push(ne[Ze]),pe++}function De(Ze,ut,vt){const ot=oe[Ze];return delete oe[Ze],oe[ut]=ot,me[ot].geometry[0].pop(),me[ot].geometry[0]=me[ot].geometry[0].concat(vt[0]),ot}function je(Ze,ut,vt){const ot=ie[ut];return delete ie[ut],ie[Ze]=ot,me[ot].geometry[0].shift(),me[ot].geometry[0]=vt[0].concat(me[ot].geometry[0]),ot}function Qe(Ze,ut,vt){const ot=vt?ut[0][ut[0].length-1]:ut[0][0];return`${Ze}:${ot.x}:${ot.y}`}for(let Ze=0;Ze<ne.length;Ze++){const ut=ne[Ze],vt=ut.geometry,ot=ut.text?ut.text.toString():null;if(!ot){Ee(Ze);continue}const mt=Qe(ot,vt),tt=Qe(ot,vt,!0);if(mt in oe&&tt in ie&&oe[mt]!==ie[tt]){const _t=je(mt,tt,vt),bt=De(mt,tt,me[_t].geometry);delete ie[mt],delete oe[tt],oe[Qe(ot,me[bt].geometry,!0)]=bt,me[_t].geometry=null}else mt in oe?De(mt,tt,vt):tt in ie?je(mt,tt,vt):(Ee(Ze),ie[mt]=pe-1,oe[tt]=pe-1)}return me.filter(Ze=>Ze.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ne,ie)=>ne.sortKey-ie.sortKey)}update(e,r,s,u,f){const d=Object.keys(e).length!==0;if(d&&!this.stateDependentLayers.length)return;const g=d?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,r,g,s,u,f),this.icon.programConfigurations.updatePaintArrays(e,r,g,s,u,f)}updateOcclusionOpacities(e,r,s){if(!r.useOcclusionQueries)return!1;const u=this;if(u.projection.name==="globe")return!1;let f=!1;u.hasTextData()&&(f=f||u.text.occlusionQueryOpacityVertexArray.length!==0),u.hasIconData()&&(f=f||u.icon.occlusionQueryOpacityVertexArray.length!==0);const d=u.layers[0].paint,g=d.get("icon-occlusion-opacity").constantOr(0),v=d.get("text-occlusion-opacity").constantOr(0);if(!u.layers[0].hasInitialOcclusionOpacityProperties||g===1&&v===1)return!1;let T=!f;for(let k=0;k<u.symbolInstances.length;k++){const L=u.symbolInstances.get(k),F=L.occlusionOpacity;L.occlusionOpacity+=(L.occlusionState>.5?1:-1)*r.fadeSpeed*s*.001,L.occlusionOpacity=Kt(L.occlusionOpacity,0,1),T=T||L.occlusionOpacity!==F}if(!T)return!1;let E=0,A=0;const C=(k,L,F,N)=>{let G=0,ne=0;F?(G=A,A+=N,ne=A):(G=E,E+=N,ne=E),ne>L.occlusionQueryOpacityVertexArray.length&&L.occlusionQueryOpacityVertexArray.resize(ne);const ie=k.occlusionOpacity;for(let oe=0;oe<N;oe++)L.occlusionQueryOpacityVertexArray.emplace(oe+G,ie)};for(let k=0;k<u.symbolInstances.length;k++){const L=u.symbolInstances.get(k),{numHorizontalGlyphVertices:F,numVerticalGlyphVertices:N,numIconVertices:G}=L,ne=G>0;if((F>0||N>0)&&(C(L,u.text,!1,F),C(L,u.text,!1,N)),ne){const{placedIconSymbolIndex:ie,verticalPlacedIconSymbolIndex:oe}=L;ie>=0&&C(L,u.icon,!0,G),oe>=0&&C(L,u.icon,!0,L.numVerticalIconVertices)}}return u.hasTextData()&&u.text.occlusionQueryOpacityVertexBuffer&&(u.text.occlusionQueryOpacityVertexBuffer.length<u.text.occlusionQueryOpacityVertexArray.length?u.text.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(u.text.occlusionQueryOpacityVertexArray,bb.members,!0):u.text.occlusionQueryOpacityVertexBuffer.updateData(u.text.occlusionQueryOpacityVertexArray)),u.hasIconData()&&u.icon.occlusionQueryOpacityVertexBuffer&&(u.icon.occlusionQueryOpacityVertexBuffer.length<u.icon.occlusionQueryOpacityVertexArray.length?u.icon.occlusionQueryOpacityVertexBuffer=e.createVertexBuffer(u.icon.occlusionQueryOpacityVertexArray,bb.members,!0):u.icon.occlusionQueryOpacityVertexBuffer.updateData(u.icon.occlusionQueryOpacityVertexArray)),!0}updateZOffset(){const e=(f,d,g)=>{s+=d,s>f.length&&f.resize(s);for(let v=-d;v<0;v++)f.emplace(v+s,g)},r=(f,d,g)=>{u+=d,u>f.length&&f.resize(u);for(let v=-d;v<0;v++)f.emplace(v+u,g)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,u=0;for(let f=0;f<this.symbolInstances.length;f++){const d=this.symbolInstances.get(f),{numHorizontalGlyphVertices:g,numVerticalGlyphVertices:v,numIconVertices:T}=d,E=d.zOffset,A=T>0;if((g>0||v>0)&&(e(this.text.zOffsetVertexArray,g,E),e(this.text.zOffsetVertexArray,v,E)),A){const{placedIconSymbolIndex:C,verticalPlacedIconSymbolIndex:k}=d;C>=0&&r(this.icon.zOffsetVertexArray,T,E),k>=0&&r(this.icon.zOffsetVertexArray,d.numVerticalIconVertices,E)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=tC(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData();for(const e of this.queries.values())e.destroy()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:f}of r)this.lineVertexArray.emplaceBack(u,f);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,u,f,d,g,v,T,E,A,C,k,L,F,N){const G=e.indexArray,ne=e.layoutVertexArray,ie=e.globeExtVertexArray,oe=e.segments.prepareSegment(4*r.length,ne,G,this.canOverlap?d.sortKey:void 0),me=this.glyphOffsetArray.length,pe=oe.vertexLength,Ee=this.allowVerticalPlacement&&g===$s.vertical?Math.PI/2:0,De=d.text&&d.text.sections;for(let Qe=0;Qe<r.length;Qe++){const{tl:Ze,tr:ut,bl:vt,br:ot,texPrimary:mt,texSecondary:tt,pixelOffsetTL:_t,pixelOffsetBR:bt,minFontScaleX:gt,minFontScaleY:zt,glyphOffset:xt,isSDF:Tt,sectionIndex:Jt}=r[Qe],Yt=oe.vertexLength,Xt=xt[1];if(E0(ne,T.x,T.y,Ze.x,Xt+Ze.y,mt.x,mt.y,s,Tt,_t.x,_t.y,gt,zt),E0(ne,T.x,T.y,ut.x,Xt+ut.y,mt.x+mt.w,mt.y,s,Tt,bt.x,_t.y,gt,zt),E0(ne,T.x,T.y,vt.x,Xt+vt.y,mt.x,mt.y+mt.h,s,Tt,_t.x,bt.y,gt,zt),E0(ne,T.x,T.y,ot.x,Xt+ot.y,mt.x+mt.w,mt.y+mt.h,s,Tt,bt.x,bt.y,gt,zt),v){const{x:wt,y:tr,z:wr}=v.anchor,[fr,Mr,Tr]=v.up;I0(ie,wt,tr,wr,fr,Mr,Tr),I0(ie,wt,tr,wr,fr,Mr,Tr),I0(ie,wt,tr,wr,fr,Mr,Tr),I0(ie,wt,tr,wr,fr,Mr,Tr),A0(e.dynamicLayoutVertexArray,wt,tr,wr,Ee)}else A0(e.dynamicLayoutVertexArray,T.x,T.y,T.z,Ee);if(N){const wt=tt||mt;M0(e.iconTransitioningVertexArray,wt.x,wt.y),M0(e.iconTransitioningVertexArray,wt.x+wt.w,wt.y),M0(e.iconTransitioningVertexArray,wt.x,wt.y+wt.h),M0(e.iconTransitioningVertexArray,wt.x+wt.w,wt.y+wt.h)}G.emplaceBack(Yt,Yt+1,Yt+2),G.emplaceBack(Yt+1,Yt+2,Yt+3),oe.vertexLength+=4,oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(xt[0]),Qe!==r.length-1&&Jt===r[Qe+1].sectionIndex||e.programConfigurations.populatePaintArrays(ne.length,d,d.index,{},k,L,F,De&&De[Jt])}const je=v?v.anchor:T;e.placedSymbolArray.emplaceBack(je.x,je.y,je.z,T.x,T.y,me,this.glyphOffsetArray.length-me,pe,E,A,T.segment,s?s[0]:0,s?s[1]:0,u[0],u[1],g,0,!1,0,C,0)}_commitLayoutVertex(e,r,s,u,f,d,g){e.emplaceBack(r,s,u,f,d,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,r,s,u,f,d,g){const v=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),T=v.vertexLength,E=g.tileAnchorX,A=g.tileAnchorY;for(let k=0;k<4;k++)s.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,r,e.padding,g.zOffset),this._commitLayoutVertex(s.layoutVertexArray,u,f,d,E,A,new Mt(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,f,d,E,A,new Mt(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,f,d,E,A,new Mt(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,u,f,d,E,A,new Mt(e.x1,e.y2)),v.vertexLength+=4;const C=s.indexArray;C.emplaceBack(T,T+1),C.emplaceBack(T+1,T+2),C.emplaceBack(T+2,T+3),C.emplaceBack(T+3,T),v.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,s,u,f,d){for(let g=u;g<f;g++){const v=s.get(g),T=this.getSymbolInstanceTextSize(e,d,r,g);this._addCollisionDebugVertices(v,T,this.textCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,r,s,u,f,d){for(let g=u;g<f;g++){const v=s.get(g),T=this.getSymbolInstanceIconSize(e,r,d.placedIconSymbolIndex);this._addCollisionDebugVertices(v,T,this.iconCollisionBox,v.projectedAnchorX,v.projectedAnchorY,v.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Fb($y,cA.members,hc),this.iconCollisionBox=new Fb($y,cA.members,hc);const s=Md(this.iconSizeData,e),u=Md(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const d=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(u,e,r,d.textBoxStartIndex,d.textBoxEndIndex,d),this._addTextDebugCollisionBoxes(u,e,r,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._addIconDebugCollisionBoxes(s,e,r,d.iconBoxStartIndex,d.iconBoxEndIndex,d),this._addIconDebugCollisionBoxes(s,e,r,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d)}}getSymbolInstanceTextSize(e,r,s,u){const f=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:u),d=g0(this.textSizeData,e,f)/ji;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,r,s){const u=this.icon.placedSymbolArray.get(s),f=g0(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,r,s,u){e.emplaceBack(r,-s,-s,u),e.emplaceBack(r,s,-s,u),e.emplaceBack(r,s,s,u),e.emplaceBack(r,-s,s,u)}_updateTextDebugCollisionBoxes(e,r,s,u,f,d){for(let g=u;g<f;g++){const v=s.get(g),T=this.getSymbolInstanceTextSize(e,d,r,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,v.padding,d.zOffset)}}_updateIconDebugCollisionBoxes(e,r,s,u,f,d){for(let g=u;g<f;g++){const v=s.get(g),T=this.getSymbolInstanceIconSize(e,r,d.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,T,v.padding,d.zOffset)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=Md(this.iconSizeData,e),u=Md(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const d=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(u,e,r,d.textBoxStartIndex,d.textBoxEndIndex,d),this._updateTextDebugCollisionBoxes(u,e,r,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._updateIconDebugCollisionBoxes(s,e,r,d.iconBoxStartIndex,d.iconBoxEndIndex,d),this._updateIconDebugCollisionBoxes(s,e,r,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,s,u,f,d,g,v,T){const E={};if(r<s){const{x1:A,y1:C,x2:k,y2:L,padding:F,projectedAnchorX:N,projectedAnchorY:G,projectedAnchorZ:ne,tileAnchorX:ie,tileAnchorY:oe,featureIndex:me}=e.get(r);E.textBox={x1:A,y1:C,x2:k,y2:L,padding:F,projectedAnchorX:N,projectedAnchorY:G,projectedAnchorZ:ne,tileAnchorX:ie,tileAnchorY:oe},E.textFeatureIndex=me}if(u<f){const{x1:A,y1:C,x2:k,y2:L,padding:F,projectedAnchorX:N,projectedAnchorY:G,projectedAnchorZ:ne,tileAnchorX:ie,tileAnchorY:oe,featureIndex:me}=e.get(u);E.verticalTextBox={x1:A,y1:C,x2:k,y2:L,padding:F,projectedAnchorX:N,projectedAnchorY:G,projectedAnchorZ:ne,tileAnchorX:ie,tileAnchorY:oe},E.verticalTextFeatureIndex=me}if(d<g){const{x1:A,y1:C,x2:k,y2:L,padding:F,projectedAnchorX:N,projectedAnchorY:G,projectedAnchorZ:ne,tileAnchorX:ie,tileAnchorY:oe,featureIndex:me}=e.get(d);E.iconBox={x1:A,y1:C,x2:k,y2:L,padding:F,projectedAnchorX:N,projectedAnchorY:G,projectedAnchorZ:ne,tileAnchorX:ie,tileAnchorY:oe},E.iconFeatureIndex=me}if(v<T){const{x1:A,y1:C,x2:k,y2:L,padding:F,projectedAnchorX:N,projectedAnchorY:G,projectedAnchorZ:ne,tileAnchorX:ie,tileAnchorY:oe,featureIndex:me}=e.get(v);E.verticalIconBox={x1:A,y1:C,x2:k,y2:L,padding:F,projectedAnchorX:N,projectedAnchorY:G,projectedAnchorZ:ne,tileAnchorX:ie,tileAnchorY:oe},E.verticalIconFeatureIndex=me}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),u=s.vertexStartIndex+4*s.numGlyphs;for(let f=s.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),u=[],f=[],d=[];for(let g=0;g<this.symbolInstances.length;++g){d.push(g);const v=this.symbolInstances.get(g);u.push(0|Math.round(r*v.tileAnchorX+s*v.tileAnchorY)),f.push(v.featureIndex)}return d.sort((g,v)=>u[g]-u[v]||f[v]-f[g]),d}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:g,placedIconSymbolIndex:v,verticalPlacedIconSymbolIndex:T}=s;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),f>=0&&f!==u&&this.addIndicesForPlacedSymbol(this.text,f),d>=0&&d!==f&&d!==u&&this.addIndicesForPlacedSymbol(this.text,d),g>=0&&this.addIndicesForPlacedSymbol(this.text,g),v>=0&&this.addIndicesForPlacedSymbol(this.icon,v),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ee(Dd,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Dd.addDynamicAttributes=A0;class ga{constructor(e,r,s,u){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(r,u)}update(e,r,s){const{width:u,height:f}=e,{context:d}=this,{gl:g}=d;if(g.bindTexture(g.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!r||r.premultiply!==!1)),this.useMipmap=!!(r&&r.useMipmap),s||this.size&&this.size[0]===u&&this.size[1]===f){const{x:v,y:T}=s||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)g.texSubImage2D(g.TEXTURE_2D,0,v,T,g.RGBA,g.UNSIGNED_BYTE,e);else{let E=this.format,A=g.UNSIGNED_BYTE;this.format===g.R32F&&(E=g.RED,A=g.FLOAT),g.texSubImage2D(g.TEXTURE_2D,0,v,T,u,f,E,A,e.data)}}else if(this.size=[u,f],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let v=this.format;this.format===g.R8&&(v=g.RED),g.texImage2D(g.TEXTURE_2D,0,this.format,v,g.UNSIGNED_BYTE,e)}else{let v=this.format,T=this.format,E=g.UNSIGNED_BYTE,A=!1;this.format===g.DEPTH_COMPONENT&&(v=g.DEPTH_COMPONENT16,E=g.UNSIGNED_SHORT),this.format===g.DEPTH_STENCIL&&(v=g.DEPTH24_STENCIL8,E=g.UNSIGNED_INT_24_8,A=!0),this.format===g.R8&&(T=g.RED),this.format===g.R32F&&(E=g.FLOAT,T=g.RED),!this.useMipmap&&A?g.texStorage2D(g.TEXTURE_2D,1,v,u,f):g.texImage2D(g.TEXTURE_2D,0,v,u,f,0,T,E,e.data)}this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,r,s=!1){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,r),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,s,u){const{context:f}=this,{gl:d}=f;d.bindTexture(d.TEXTURE_2D,this.texture),r!==this.magFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),this.wrapS=s),u!==this.wrapT&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,u),this.wrapT=u)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class C0{constructor(e,r){this.context=e,this.texture=r}bind(e,r){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}}const ya=32,El=33,wc=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,r=0,s=0,u=0,f=0,d=0,g=0;for(1&e?u=f=d=ya:r=s=g=ya;(e>>=1)>1;){const T=r+u>>1,E=s+f>>1;1&e?(u=r,f=s,r=d,s=g):(r=u,s=f,u=d,f=g),d=T,g=E}const v=4*t;wc[v+0]=r,wc[v+1]=s,wc[v+2]=u,wc[v+3]=f}const Ml=new Uint16Array(2178),Tc=new Uint8Array(1089),P0=new Uint16Array(1089);function rC(t){return t===0?-.03125:t===32?.03125:0}var O0=Yr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),BB=Yr([{name:"a_index",type:"Int16",components:1}]);const nC={type:2,extent:At,loadGeometry:()=>[[new Mt(0,0),new Mt(At+1,0),new Mt(At+1,At+1),new Mt(0,At+1),new Mt(0,0)]]};class D0{constructor(e,r,s,u,f){this.tileID=e,this.uid=Hi(),this.uses=0,this.tileSize=r,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,u&&u.style&&(this._lastUpdatedBrightness=u.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<Pi.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=qh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,f){const d={};if(!f)return d;for(const g of u){const v=g.layerIds.map(T=>f.getLayer(T)).filter(Boolean);if(v.length!==0){g.layers=v,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(T=>v.filter(E=>E.id===T)[0]));for(const T of v)d[T.fqid]=g}}return d}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const f=this.buckets[u];if(f instanceof Dd){if(this.hasSymbolBuckets=!0,!s)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const f=this.buckets[u];if(f instanceof Dd&&f.hasRTLText){this.hasRTLText=!0,Pr.isLoading()||Pr.isLoaded()||Rr()!=="deferred"||yn();break}}this.queryPadding=0;for(const u in this.buckets){const f=this.buckets[u],d=r.style.getOwnLayer(u);if(!d)continue;const g=d.queryRadius(f);this.queryPadding=Math.max(this.queryPadding,g)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new N1}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const u in this.buckets){const f=this.buckets[u];f.uploadPending()&&f.upload(e)}const r=e.gl,s=this.imageAtlas;if(s&&!s.uploaded){const u=!!Object.keys(s.patternPositions).length;this.imageAtlasTexture=new ga(e,s.image,r.RGBA,{useMipmap:u}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new ga(e,this.glyphAtlasImage,r.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ga(e,this.lineAtlas.image,r.R8),this.lineAtlas.uploaded=!0)}prepare(e,r,s){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,s),!r||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const u=r.style.getBrightness();(this._lastUpdatedBrightness||u)&&(this._lastUpdatedBrightness&&u&&Math.abs(this._lastUpdatedBrightness-u)<.001||(this._lastUpdatedBrightness=u,this.updateBuckets(void 0,r)))}queryRenderedFeatures(e,r,s,u,f,d,g,v){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:g,transform:d,params:f,tileTransform:this.tileTransform},e,r,s):{}}querySourceFeatures(e,r){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const u=s.loadVTLayers(),f=r?r.sourceLayer:"",d=u._geojsonTileLayer||u[f];if(!d)return;const g=Ni(r&&r.filter),{z:v,x:T,y:E}=this.tileID.canonical,A={z:v,x:T,y:E};for(let C=0;C<d.length;C++){const k=d.feature(C);if(g.needGeometry){const N=mu(k,!0);if(!g.filter(new pr(this.tileID.overscaledZ),N,this.tileID.canonical))continue}else if(!g.filter(new pr(this.tileID.overscaledZ),k))continue;const L=s.getId(k,f),F=new SA(k,v,T,E,L);F.tile=A,e.push(F)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const s=jp(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let u=!1;if(this.expirationTime>s)u=!1;else if(r)if(this.expirationTime<r)u=!0;else{const f=this.expirationTime-r;f?this.expirationTime=s+Math.max(f,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&r&&this.updateBuckets(e,r)}updateBuckets(e,r){if(!this.latestFeatureIndex)return;const s=this.latestFeatureIndex.loadVTLayers(),u=r.style.listImages(),f=r.style.getBrightness();for(const d in this.buckets){if(!r.style.hasLayer(d))continue;const g=this.buckets[d],v=g.layers[0].sourceLayer||"_geojsonTileLayer",T=s[v];let E={};if(e&&(E=e[v],!T||!E||Object.keys(E).length===0))continue;if(g.update(E,T,u,this.imageAtlas&&this.imageAtlas.patternPositions||{},f),g instanceof d0||g instanceof o0){const C=r.style.getOwnSourceCache(g.layers[0].source);r._terrain&&r._terrain.enabled&&C&&g.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(C.id,this.tileID)}const A=r&&r.style&&r.style.getOwnLayer(d);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Pi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Pi.now()+e}setTexture(e,r){const s=r.context,u=s.gl;this.texture=this.texture||r.getTileTexture(e.width),this.texture&&this.texture instanceof ga?this.texture.update(e,{useMipmap:!0}):(this.texture=new ga(s,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE))}setDependencies(e,r){const s={};for(const u of r)s[u]=!0;this.dependencies[e]=s}hasDependency(e,r){for(const s of e){const u=this.dependencies[s];if(u){for(const f of r)if(u[f])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const s=qa(nC,this.tileID.canonical,this.tileTransform)[0],u=new Ga,f=new jm;for(let d=0;d<s.length;d++){const{x:g,y:v}=s[d];u.emplaceBack(g,v),f.emplaceBack(d)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(u,Hm.members),this._tileDebugSegments=In.simpleSegment(0,0,u.length,f.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const s=qa(nC,this.tileID.canonical,this.tileTransform)[0];let u,f;if(this.isRaster){const d=function(g,v){const T=qh(g,v),E=Math.pow(2,g.z);for(let N=0;N<El;N++)for(let G=0;G<El;G++){const ne=Ho((g.x+(G+rC(G))/ya)/E),ie=Di((g.y+(N+rC(N))/ya)/E),oe=v.project(ne,ie),me=N*El+G;Ml[2*me+0]=Math.round((oe.x*T.scale-T.x)*At),Ml[2*me+1]=Math.round((oe.y*T.scale-T.y)*At)}Tc.fill(0),P0.fill(0);for(let N=2045;N>=0;N--){const G=4*N,ne=wc[G+0],ie=wc[G+1],oe=wc[G+2],me=wc[G+3],pe=ne+oe>>1,Ee=ie+me>>1,De=pe+Ee-ie,je=Ee+ne-pe,Qe=ie*El+ne,Ze=me*El+oe,ut=Ee*El+pe,vt=Math.hypot((Ml[2*Qe+0]+Ml[2*Ze+0])/2-Ml[2*ut+0],(Ml[2*Qe+1]+Ml[2*Ze+1])/2-Ml[2*ut+1])>=16;Tc[ut]=Tc[ut]||(vt?1:0),N<1022&&(Tc[ut]=Tc[ut]||Tc[(ie+je>>1)*El+(ne+De>>1)]||Tc[(me+je>>1)*El+(oe+De>>1)])}const A=new ac,C=new Si;let k=0;function L(N,G){const ne=G*El+N;return P0[ne]===0&&(A.emplaceBack(Ml[2*ne+0],Ml[2*ne+1],N*At/ya,G*At/ya),P0[ne]=++k),P0[ne]-1}function F(N,G,ne,ie,oe,me){const pe=N+ne>>1,Ee=G+ie>>1;if(Math.abs(N-oe)+Math.abs(G-me)>1&&Tc[Ee*El+pe])F(oe,me,N,G,pe,Ee),F(ne,ie,oe,me,pe,Ee);else{const De=L(N,G),je=L(ne,ie),Qe=L(oe,me);C.emplaceBack(De,je,Qe)}}return F(0,0,ya,ya,ya,0),F(ya,ya,0,0,0,ya),{vertices:A,indices:C}}(this.tileID.canonical,r);u=d.vertices,f=d.indices}else{u=new ac,f=new Si;for(const{x:g,y:v}of s)u.emplaceBack(g,v,0,0);const d=Km(u.int16,void 0,4);for(let g=0;g<d.length;g+=3)f.emplaceBack(d[g],d[g+1],d[g+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,O0.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=In.simpleSegment(0,0,u.length,f.length)}_makeGlobeTileDebugBuffers(e,r){const s=r.projection;if(!s||s.name!=="globe"||r.freezeTileCoverage)return;const u=this.tileID.canonical,f=Xm(lI(u,r)),d=gu(r.zoom);let g;d>0&&(g=o.ad.invert(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,r,f,g,d),this._makeGlobeTileDebugTextBuffer(e,u,r,f,g,d)}_globePoint(e,r,s,u,f,d,g){let v=Zm(e,r,s);if(d){const T=1<<s.z,E=bl(u.center.lng),A=wl(u.center.lat),C=(s.x+.5)/T-E;let k=0;C>.5?k=-1:C<-.5&&(k=1);let L=(e/At+s.x)/T+k,F=(r/At+s.y)/T;L=(L-E)*u._pixelsPerMercatorPixel+E,F=(F-A)*u._pixelsPerMercatorPixel+A;const N=[L*u.worldSize,F*u.worldSize,0];o._.transformMat4(N,N,d),v=_u(v,N,g)}return o._.transformMat4(v,v,f)}_makeGlobeTileDebugBorderBuffer(e,r,s,u,f,d){const g=new Ga,v=new jm,T=new Uy,E=(C,k,L,F,N)=>{const G=(L-C)/(N-1),ne=(F-k)/(N-1),ie=g.length;for(let oe=0;oe<N;oe++){const me=C+oe*G,pe=k+oe*ne;g.emplaceBack(me,pe);const Ee=this._globePoint(me,pe,r,s,u,f,d);T.emplaceBack(Ee[0],Ee[1],Ee[2]),v.emplaceBack(ie+oe)}},A=At;E(0,0,A,0,16),E(A,0,A,A,16),E(A,A,0,A,16),E(0,A,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(v),this._tileDebugBuffer=e.createVertexBuffer(g,Hm.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(T,sI.members),this._tileDebugSegments=In.simpleSegment(0,0,g.length,v.length)}_makeGlobeTileDebugTextBuffer(e,r,s,u,f,d){const g=At/4,v=new Ga,T=new Si,E=new Uy,A=25;T.reserve(32),v.reserve(A),E.reserve(A);const C=(k,L)=>A*k+L;for(let k=0;k<A;k++){const L=k*g;for(let F=0;F<A;F++){const N=F*g;v.emplaceBack(N,L);const G=this._globePoint(N,L,r,s,u,f,d);E.emplaceBack(G[0],G[1],G[2])}}for(let k=0;k<4;k++)for(let L=0;L<4;L++){const F=C(k,L),N=C(k,L+1),G=C(k+1,L),ne=C(k+1,L+1);T.emplaceBack(F,N,G),T.emplaceBack(G,N,ne)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(T),this._tileDebugTextBuffer=e.createVertexBuffer(v,Hm.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(E,sI.members),this._tileDebugTextSegments=In.simpleSegment(0,0,A,32)}destroy(e=!1){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof ga&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}function NB(t,e,r){t===1?e.header_length=r.readFixed32():t===2?e.x=r.readVarint():t===3?e.y=r.readVarint():t===4?e.z=r.readVarint():t===5&&e.layers.push(function(s,u){return s.readFields(GB,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},u)}(r,r.readVarint()+r.pos))}function UB(t,e,r){t===1?(e.delta_filter=function(s,u){return s.readFields(jB,{block_size:0},u)}(r,r.readVarint()+r.pos),e.filter="delta_filter"):t===2?(r.readVarint(),e.filter="zigzag_filter"):t===3?(r.readVarint(),e.filter="bitshuffle_filter"):t===4&&(r.readVarint(),e.filter="byteshuffle_filter")}function jB(t,e,r){t===1&&(e.block_size=r.readVarint())}function VB(t,e,r){t===1?(r.readVarint(),e.codec="gzip_data"):t===2?(r.readVarint(),e.codec="jpeg_image"):t===3?(r.readVarint(),e.codec="webp_image"):t===4&&(r.readVarint(),e.codec="png_image")}function $B(t,e,r){t===1?e.first_byte=r.readFixed64():t===2?e.last_byte=r.readFixed64():t===3?e.filters.push(function(s,u){return s.readFields(UB,{},u)}(r,r.readVarint()+r.pos)):t===4?e.codec=function(s,u){return s.readFields(VB,{},u)}(r,r.readVarint()+r.pos):t===5?e.offset=r.readFloat():t===6?e.scale=r.readFloat():t===7&&e.bands.push(r.readString())}function GB(t,e,r){t===1?e.version=r.readVarint():t===2?e.name=r.readString():t===3?e.units=r.readString():t===4?e.tilesize=r.readVarint():t===5?e.buffer=r.readVarint():t===6?e.pixel_format=r.readVarint():t===7&&e.data_index.push(function(s,u){return s.readFields($B,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},u)}(r,r.readVarint()+r.pos))}function WB(t,e,r){if(t===2)(function(s,u,f){s.readFields(qB,f,u)})(r,r.readVarint()+r.pos,e);else if(t===3)throw new Error("Not implemented")}function qB(t,e,r){if(t===1){let s=0;const u=r.readVarint()+r.pos;for(;r.pos<u;)e[s++]=r.readVarint()}}/**
 * tiny-lru
 *
 * @copyright 2024 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.2.11
 */class HB{constructor(e=0,r=0,s=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=s,this.size=0,this.ttl=r}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){const r=this.items[e];delete this.items[e],this.size--,r.prev!==null&&(r.prev.next=r.next),r.next!==null&&(r.next.prev=r.prev),this.first===r&&(this.first=r.next),this.last===r&&(this.last=r.prev)}return this}entries(e=this.keys()){return e.map(r=>[r,this.get(r)])}evict(e=!1){if(e||this.size>0){const r=this.first;delete this.items[r.key],--this.size==0?(this.first=null,this.last=null):(this.first=r.next,this.first.prev=null)}return this}expiresAt(e){let r;return this.has(e)&&(r=this.items[e].expiry),r}get(e){let r;if(this.has(e)){const s=this.items[e];this.ttl>0&&s.expiry<=Date.now()?this.delete(e):(r=s.value,this.set(e,r,!0))}return r}has(e){return e in this.items}keys(){const e=[];let r=this.first;for(;r!==null;)e.push(r.key),r=r.next;return e}set(e,r,s=!1,u=this.resetTtl){let f;if(s||this.has(e)){if(f=this.items[e],f.value=r,s===!1&&u&&(f.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==f){const d=this.last,g=f.next,v=f.prev;this.first===f&&(this.first=f.next),f.next=null,f.prev=this.last,d.next=f,v!==null&&(v.next=g),g!==null&&(g.prev=v)}}else this.max>0&&this.size===this.max&&this.evict(!0),f=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:r},++this.size==1?this.first=f:this.last.next=f;return this.last=f,this}values(e=this.keys()){return e.map(r=>this.get(r))}}function ZB(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let s=2;s>=1;s--){const u=s===1?1:0,f=s===2?1:0;for(let d=0;d<e[0];d++){const g=e[1]*d;for(let v=u;v<e[1];v++){const T=e[2]*(v+g);for(let E=f;E<e[2];E++){const A=e[3]*(E+T);for(let C=0;C<e[3];C++){const k=A+C;t[k]+=t[k-r]}}}}r*=e[s]}return t}function XB(t){for(let e=0,r=t.length;e<r;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function YB(t,e){switch(e){case"uint32":return t;case"uint16":for(let r=0;r<t.length;r+=2){const s=t[r],u=t[r+1];t[r]=(240&s)>>4|(61440&s)>>8|(240&u)<<4|61440&u,t[r+1]=15&s|(3840&s)>>4|(15&u)<<8|(3840&u)<<4}return t;case"uint8":for(let r=0;r<t.length;r+=4){const s=t[r],u=t[r+1],f=t[r+2],d=t[r+3];t[r+0]=(192&s)>>6|(192&u)>>4|(192&f)>>2|192&d,t[r+1]=(48&s)>>4|(48&u)>>2|48&f|(48&d)<<2,t[r+2]=(12&s)>>2|12&u|(12&f)<<2|(12&d)<<4,t[r+3]=3&s|(3&u)<<2|(3&f)<<4|(3&d)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Sc extends Error{constructor(e){super(e),this.name="MRTError"}}var Gs=Uint8Array,d_=Uint16Array,KB=Int32Array,iC=new Gs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),oC=new Gs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),QB=new Gs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),sC=function(t,e){for(var r=new d_(31),s=0;s<31;++s)r[s]=e+=1<<t[s-1];var u=new KB(r[30]);for(s=1;s<30;++s)for(var f=r[s];f<r[s+1];++f)u[f]=f-r[s]<<5|s;return{b:r,r:u}},aC=sC(iC,2),lC=aC.b,JB=aC.r;lC[28]=258,JB[258]=28;for(var e5=sC(oC,0).b,uC=new d_(32768),Hn=0;Hn<32768;++Hn){var Rd=(43690&Hn)>>1|(21845&Hn)<<1;uC[Hn]=((65280&(Rd=(61680&(Rd=(52428&Rd)>>2|(13107&Rd)<<2))>>4|(3855&Rd)<<4))>>8|(255&Rd)<<8)>>1}var p_=function(t,e,r){for(var s=t.length,u=0,f=new d_(e);u<s;++u)t[u]&&++f[t[u]-1];var d,g=new d_(e);for(u=1;u<e;++u)g[u]=g[u-1]+f[u-1]<<1;{d=new d_(1<<e);var v=15-e;for(u=0;u<s;++u)if(t[u])for(var T=u<<4|t[u],E=e-t[u],A=g[t[u]-1]++<<E,C=A|(1<<E)-1;A<=C;++A)d[uC[A]>>v]=T}return d},m_=new Gs(288);for(Hn=0;Hn<144;++Hn)m_[Hn]=8;for(Hn=144;Hn<256;++Hn)m_[Hn]=9;for(Hn=256;Hn<280;++Hn)m_[Hn]=7;for(Hn=280;Hn<288;++Hn)m_[Hn]=8;var cC=new Gs(32);for(Hn=0;Hn<32;++Hn)cC[Hn]=5;var t5=p_(m_,9),r5=p_(cC,5),Bb=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},Ya=function(t,e,r){var s=e/8|0;return(t[s]|t[s+1]<<8)>>(7&e)&r},Nb=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(7&e)},n5=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ka=function(t,e,r){var s=new Error(e||n5[t]);if(s.code=t,Error.captureStackTrace&&Error.captureStackTrace(s,Ka),!r)throw s;return s},i5=new Gs(0),o5=typeof TextDecoder<"u"&&new TextDecoder;try{o5.decode(i5,{stream:!0})}catch{}const s5={gzip_data:"gzip"},a5={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},l5={uint32:1,uint16:2,uint8:4},u5={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class Ub{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){const r=new Uint8Array(e),s=new DataView(e);if(r[0]!==13)throw new Sc("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){const r=new Uint8Array(e),s=this.getHeaderLength(e);if(r.length<s)throw new Sc(`Expected header with length >= ${s} but got buffer of length ${r.length}`);const u=function(f,d){return f.readFields(NB,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new Ed(r.subarray(0,s)));if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new Sc(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const f of u.layers)this.layers[f.name]=new c5(f,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const r=[],s=this.getLayer(e.layerName);for(let u=0;u<s.dataIndex.length;u++){const f=s.dataIndex[u],d=f.first_byte-e.firstByte,g=f.last_byte+1-e.firstByte;if(u<e.firstBlock||u>e.lastBlock||s._blocksInProgress.has(u))continue;const v={layerName:s.name,firstByte:d,lastByte:g,pixelFormat:s.pixelFormat,blockIndex:u,blockShape:[f.bands.length].concat(s.bandShape),buffer:s.buffer,codec:f.codec.codec,filters:f.filters.map(T=>T.filter)};s._blocksInProgress.add(u),r.push(v)}return new hC(r,()=>{r.forEach(u=>s._blocksInProgress.delete(u.blockIndex))},(u,f)=>{if(r.forEach(d=>s._blocksInProgress.delete(d.blockIndex)),u)throw u;f.forEach(d=>{this.getLayer(d.layerName).processDecodedData(d)})})}}class c5{constructor({version:e,name:r,units:s,tilesize:u,pixel_format:f,buffer:d,data_index:g},v){if(this.version=e,this.version!==1)throw new Sc(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=r,this.units=s,this.tileSize=u,this.buffer=d,this.pixelFormat=a5[f],this.dataIndex=g,this.bandShape=[u+2*d,u+2*d,l5[this.pixelFormat]],this._decodedBlocks=function(T=1e3,E=0,A=!1){if(isNaN(T)||T<0)throw new TypeError("Invalid max value");if(isNaN(E)||E<0)throw new TypeError("Invalid ttl value");if(typeof A!="boolean")throw new TypeError("Invalid resetTtl value");return new HB(T,E,A)}(v?v.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){const r=e.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.set(r,e.data)}getBlockForBand(e){let r=0;switch(typeof e){case"string":for(const[s,u]of this.dataIndex.entries()){for(const[f,d]of u.bands.entries())if(d===e)return{bandIndex:r+f,blockIndex:s,blockBandIndex:f};r+=u.bands.length}break;case"number":for(const[s,u]of this.dataIndex.entries()){if(e>=r&&e<r+u.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-r};r+=u.bands.length}break;default:throw new Sc(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Sc(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let r=1/0,s=-1/0,u=1/0,f=-1/0;for(const d of e){const{blockIndex:g}=this.getBlockForBand(d);if(g<0)throw new Sc(`Invalid band: ${JSON.stringify(d)}`);const v=this.dataIndex[g];u=Math.min(u,g),f=Math.max(f,g),r=Math.min(r,v.first_byte),s=Math.max(s,v.last_byte)}return{layerName:this.name,firstByte:r,lastByte:s,firstBlock:u,lastBlock:f}}hasBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0}hasDataForBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(e){const{blockIndex:r,blockBandIndex:s}=this.getBlockForBand(e),u=this._decodedBlocks.get(r.toString());if(!u)throw new Sc(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const f=this.dataIndex[r],d=this.bandShape.reduce((T,E)=>T*E,1),g=s*d,v=u.subarray(g,g+d);return{data:v,bytes:new Uint8Array(v.buffer).subarray(v.byteOffset,v.byteOffset+v.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:f.offset,scale:f.scale}}}class hC{constructor(e,r,s){this.tasks=e,this._onCancel=r,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,r){this._finalized||(this._onComplete(e,r),this._finalized=!0)}}Ub.performDecoding=function(t,e){return Promise.all(e.tasks.map(r=>{const{layerName:s,firstByte:u,lastByte:f,pixelFormat:d,blockShape:g,blockIndex:v,filters:T,codec:E}=r,A=new Uint8Array(t).subarray(u,f+1),C=new Uint32Array(g[0]*g[1]*g[2]);let k;if(E!=="gzip_data")throw new Error(`Unhandled codec: ${E}`);return k=function(L,F){if(!globalThis.DecompressionStream&&F==="gzip_data")return Promise.resolve(((ie=function(pe){pe[0]==31&&pe[1]==139&&pe[2]==8||Ka(6,"invalid gzip data");var Ee=pe[3],De=10;4&Ee&&(De+=2+(pe[10]|pe[11]<<8));for(var je=(Ee>>3&1)+(Ee>>4&1);je>0;je-=!pe[De++]);return De+(2&Ee)}(ne=L))+8>ne.length&&Ka(6,"invalid gzip data"),function(pe,Ee,De,je){var Qe=pe.length;if(!Qe||Ee.f&&!Ee.l)return De||new Gs(0);var Ze=!De,ut=Ze||Ee.i!=2,vt=Ee.i;Ze&&(De=new Gs(3*Qe));var ot,mt,tt=function(Mc){var Ic=De.length;if(Mc>Ic){var Qh=new Gs(Math.max(2*Ic,Mc));Qh.set(De),De=Qh}},_t=Ee.f||0,bt=Ee.p||0,gt=Ee.b||0,zt=Ee.l,xt=Ee.d,Tt=Ee.m,Jt=Ee.n,Yt=8*Qe;do{if(!zt){_t=Ya(pe,bt,1);var Xt=Ya(pe,bt+1,3);if(bt+=3,!Xt){var wt=pe[(Nr=4+((bt+7)/8|0))-4]|pe[Nr-3]<<8,tr=Nr+wt;if(tr>Qe){vt&&Ka(0);break}ut&&tt(gt+wt),De.set(pe.subarray(Nr,tr),gt),Ee.b=gt+=wt,Ee.p=bt=8*tr,Ee.f=_t;continue}if(Xt==1)zt=t5,xt=r5,Tt=9,Jt=5;else if(Xt==2){var wr=Ya(pe,bt,31)+257,fr=Ya(pe,bt+10,15)+4,Mr=wr+Ya(pe,bt+5,31)+1;bt+=14;for(var Tr=new Gs(Mr),Or=new Gs(19),ur=0;ur<fr;++ur)Or[QB[ur]]=Ya(pe,bt+3*ur,7);bt+=3*fr;var nn=Bb(Or),tn=(1<<nn)-1,qr=p_(Or,nn);for(ur=0;ur<Mr;){var Nr,Hr=qr[Ya(pe,bt,tn)];if(bt+=15&Hr,(Nr=Hr>>4)<16)Tr[ur++]=Nr;else{var gn=0,un=0;for(Nr==16?(un=3+Ya(pe,bt,3),bt+=2,gn=Tr[ur-1]):Nr==17?(un=3+Ya(pe,bt,7),bt+=3):Nr==18&&(un=11+Ya(pe,bt,127),bt+=7);un--;)Tr[ur++]=gn}}var Cn=Tr.subarray(0,wr),An=Tr.subarray(wr);Tt=Bb(Cn),Jt=Bb(An),zt=p_(Cn,Tt),xt=p_(An,Jt)}else Ka(1);if(bt>Yt){vt&&Ka(0);break}}ut&&tt(gt+131072);for(var to=(1<<Tt)-1,Fn=(1<<Jt)-1,En=bt;;En=bt){var ei=(gn=zt[Nb(pe,bt)&to])>>4;if((bt+=15&gn)>Yt){vt&&Ka(0);break}if(gn||Ka(2),ei<256)De[gt++]=ei;else{if(ei==256){En=bt,zt=null;break}var Ri=ei-254;ei>264&&(Ri=Ya(pe,bt,(1<<(Co=iC[ur=ei-257]))-1)+lC[ur],bt+=Co);var ki=xt[Nb(pe,bt)&Fn],mn=ki>>4;if(ki||Ka(3),bt+=15&ki,An=e5[mn],mn>3){var Co=oC[mn];An+=Nb(pe,bt)&(1<<Co)-1,bt+=Co}if(bt>Yt){vt&&Ka(0);break}ut&&tt(gt+131072);var xu=gt+Ri;if(gt<An){var va=0-An,Ja=Math.min(An,xu);for(va+gt<0&&Ka(3);gt<Ja;++gt)De[gt]=(void 0)[va+gt]}for(;gt<xu;++gt)De[gt]=De[gt-An]}}Ee.l=zt,Ee.p=En,Ee.b=gt,Ee.f=_t,zt&&(_t=1,Ee.m=Tt,Ee.d=xt,Ee.n=Jt)}while(!_t);return gt!=De.length&&Ze?(ot=De,((mt=gt)==null||mt>ot.length)&&(mt=ot.length),new Gs(ot.subarray(0,mt))):De.subarray(0,gt)}(ne.subarray(ie,-8),{i:2},new Gs(((N=ne)[(G=N.length)-4]|N[G-3]<<8|N[G-2]<<16|N[G-1]<<24)>>>0))));var N,G,ne,ie;const oe=s5[F];if(!oe)throw new Error(`Unhandled codec: ${F}`);const me=new globalThis.DecompressionStream(oe);return new Response(new Blob([L]).stream().pipeThrough(me)).arrayBuffer().then(pe=>new Uint8Array(pe))}(A,E).then(L=>(function(F,N){F.readFields(WB,N)}(new Ed(L),C),new u5[d](C.buffer))),k.then(L=>{for(let F=T.length-1;F>=0;F--)switch(T[F]){case"delta_filter":ZB(L,g);break;case"zigzag_filter":XB(L);break;case"bitshuffle_filter":YB(L,d);break;default:throw new Error(`Unhandled filter "${T[F]}"`)}return{layerName:s,blockIndex:v,data:L}}).catch(L=>{throw L})}))};class fC extends D0{constructor(e,r,s,u,f){super(e,r,s,u,f),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(e,r){const s=r.context,u=s.gl;this.texture=this.texture||r.getTileTexture(e.width),this.texture&&this.texture instanceof ga?this.texture.update(e,{useMipmap:!1,premultiply:!1}):this.texture=new ga(s,e,u.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(e=16384,r){const s=this._mrt=new Ub(30),u=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(e-1)}});return this.entireBuffer=null,this.request=ml(u,(f,d,g,v)=>{if(f)r(f);else try{const T=s.getHeaderLength(d);if(T>e)return void(this.request=this.fetchHeader(T,r));s.parseHeader(d),this._isHeaderLoaded=!0;let E=0;for(const A of Object.values(s.layers))E=Math.max(E,A.dataIndex[A.dataIndex.length-1].last_byte);d.byteLength>=E&&(this.entireBuffer=d),r(null,this.entireBuffer||d,g,v)}catch(T){r(T)}}),this.request}fetchBand(e,r,s){const u=this._mrt;if(!this._isHeaderLoaded||!u)return void s(new Error("Tile header is not ready"));const f=this.actor;if(!f)return void s(new Error("Can't fetch tile band without an actor"));let d;const g=(A,C)=>{d.complete(A,C),A?s(A):(this.updateTextureDescriptor(e,r),s(null,this.textureDescriptor&&this.textureDescriptor.img))},v=(A,C)=>{if(A)return s(A);const k=f.send("decodeRasterArray",{buffer:C,task:d},g,void 0,!0);this._workQueue.push(()=>{k&&k.cancel(),d.cancel()})},T=u.getLayer(e);if(!T)return void s(new Error(`Unknown sourceLayer "${e}"`));if(T.hasDataForBand(r))return this.updateTextureDescriptor(e,r),void s(null,this.textureDescriptor?this.textureDescriptor.img:null);const E=T.getDataRange([r]);if(d=u.createDecodingTask(E),!d||d.tasks.length)if(this.flushQueues(),this.entireBuffer)v(null,this.entireBuffer.slice(E.firstByte,E.lastByte+1));else{const A=Object.assign({},this.requestParams,{headers:{Range:`bytes=${E.firstByte}-${E.lastByte}`}}),C=ml(A,v);this._fetchQueue.push(()=>{C.cancel(),d.cancel()})}else s(null)}updateNeeded(e,r){return(!this.textureDescriptor||this.textureDescriptor.band!==r||this.textureDescriptor.layer!==e)&&this.state!=="errored"}updateTextureDescriptor(e,r){if(!this._mrt)return;const s=this._mrt.getLayer(e);if(!s||!s.hasBand(r)||!s.hasDataForBand(r))return;const{bytes:u,tileSize:f,buffer:d,offset:g,scale:v}=s.getBandView(r),T=f+2*d,E={data:u,width:T,height:T},A=this.texture;A&&A instanceof ga&&A.update(E,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:e,band:r,img:E,buffer:d,offset:g,tileSize:f,format:s.pixelFormat,mix:[v,256*v,65536*v,16777216*v]}}}class h5{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,s){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const f={value:r,timeout:void 0};if(s!==void 0&&(f.timeout=setTimeout(()=>{this.remove(e,f)},s)),this.data[u].push(f),this.order.push(u),this.order.length>this.max){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const s=e.wrapped().key,u=r===void 0?0:this.data[s].indexOf(r),f=this.data[s][u];return this.data[s].splice(u,1),f.timeout&&clearTimeout(f.timeout),this.data[s].length===0&&delete this.data[s],this.onRemove(f.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const s in this.data)for(const u of this.data[s])e(u.value)||r.push(u);for(const s of r)this.remove(s.value.tileID,s)}}class Zh extends Jl{constructor(e,r,s){super(),this.id=e,this._onlySymbols=s,r.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new h5(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new aB,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if(r.state!=="errored"&&(r.state!=="loaded"||!r.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const s=this._tiles[r];s.upload(e),s.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return ui(this._tiles).map(e=>e.tileID).sort(dC).map(e=>e.key)}getRenderableIds(e,r){const s=[];for(const u in this._tiles)this._isIdRenderable(+u,e,r)&&s.push(this._tiles[u]);return e?s.sort((u,f)=>{const d=u.tileID,g=f.tileID,v=new Mt(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),T=new Mt(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-g.overscaledZ||T.y-v.y||T.x-v.x}).map(u=>u.tileID.key):s.map(u=>u.tileID).sort(dC).map(u=>u.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())&&(s||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const s=this._tiles[e];s&&(s.state!=="loading"&&(s.state=r),this._loadTile(s,this._tileLoaded.bind(this,s,e,r)))}_tileLoaded(e,r,s,u){if(u)if(e.state="errored",u.status!==404)this._source.fire(new Na(u,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new $o("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=Pi.now(),s==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new $o("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let u=0;u<r.length;u++){const f=r[u];if(e.neighboringTiles&&e.neighboringTiles[f]){const d=this.getTileByID(f);s(e,d),s(d,e)}}function s(u,f){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let d=f.tileID.canonical.x-u.tileID.canonical.x;const g=f.tileID.canonical.y-u.tileID.canonical.y,v=Math.pow(2,u.tileID.canonical.z),T=f.tileID.key;d===0&&g===0||Math.abs(g)>1||(Math.abs(d)>1&&(Math.abs(d+v)===1?d+=v:Math.abs(d-v)===1&&(d-=v)),f.dem&&u.dem&&(u.dem.backfillBorder(f.dem,d,g),u.neighboringTiles&&u.neighboringTiles[T]&&(u.neighboringTiles[T].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,s,u){for(const f in this._tiles){let d=this._tiles[f];if(u[f]||!d.hasData()||d.tileID.overscaledZ<=r||d.tileID.overscaledZ>s)continue;let g=d.tileID;for(;d&&d.tileID.overscaledZ>r+1;){const T=d.tileID.scaledTo(d.tileID.overscaledZ-1);d=this._tiles[T.key],d&&d.hasData()&&(g=T)}let v=g;for(;v.overscaledZ>r;)if(v=v.scaledTo(v.overscaledZ-1),e[v.key]){u[g.key]=g;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=r?s:null}for(let s=e.overscaledZ-1;s>=r;s--){const u=e.scaledTo(s),f=this._getLoadedTile(u);if(f)return f}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const s=Math.ceil(e.width/r)+1,u=Math.ceil(e.height/r)+1,f=Math.floor(s*u*5),d=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,f):f,g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(g)}handleWrapJump(e){const r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){const s={};for(const u in this._tiles){const f=this._tiles[u];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+r),s[f.tileID.key]=f}this._tiles=s;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,r,s,u){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let f;if(this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain){if(this._source.tileID)f=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new hi(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y));else if(this.tileCoverLift!==0){const v=e.clone();v.tileCoverLift=this.tileCoverLift,f=v.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&e.projection.name==="globe"&&(f.push(new hi(1,0,1,0,0)),f.push(new hi(1,0,1,1,0)),f.push(new hi(1,0,1,0,1)),f.push(new hi(1,0,1,1,1)))}else if(f=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile){const v=this._source.hasTile.bind(this._source);f=f.filter(T=>v(T))}}else f=[];if(f.length>0&&this.castsShadows&&u&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!jb(this._source.type)){const v=e.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!s}),T=Math.min(v,this._source.maxzoom),E=e.extendTileCoverForShadows(f,u,T);for(const A of E)this._shadowCasterTiles[A.key]=!0,f.push(A)}const d=this._updateRetainedTiles(f);if(jb(this._source.type)&&f.length!==0){const v={},T={},E=Object.keys(d);for(const C of E){const k=d[C],L=this._tiles[C];if(!L||L.fadeEndTime&&L.fadeEndTime<=Pi.now())continue;const F=this.findLoadedParent(k,Math.max(k.overscaledZ-Zh.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),v[F.tileID.key]=F.tileID),T[C]=k}const A=f[f.length-1].overscaledZ;for(const C in this._tiles){const k=this._tiles[C];if(d[C]||!k.hasData())continue;let L=k.tileID;for(;L.overscaledZ>A;){L=L.scaledTo(L.overscaledZ-1);const F=this._tiles[L.key];if(F&&F.hasData()&&T[L.key]){d[C]=k.tileID;break}}}for(const C in v)d[C]||(this._coveredTiles[C]=!0,d[C]=v[C])}for(const v in d)this._tiles[v].clearFadeHold();const g=function(v,T){const E=[];for(const A in v)A in T||E.push(A);return E}(this._tiles,d);for(const v of g){const T=this._tiles[v];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(e.length===0)return r;const s={},u=e.reduce((T,E)=>Math.min(T,E.overscaledZ),1/0),f=e[0].overscaledZ,d=Math.max(f-Zh.maxOverzooming,this._source.minzoom),g=Math.max(f+Zh.maxUnderzooming,this._source.minzoom),v={};for(const T of e){const E=this._addTile(T);r[T.key]=T,E.hasData()||u<this._source.maxzoom&&(v[T.key]=T)}this._retainLoadedChildren(v,u,g,r);for(const T of e){let E=this._tiles[T.key];if(E.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const C=T.children(this._source.maxzoom)[0],k=this.getTile(C);if(k&&k.hasData()){r[C.key]=C;continue}}else{const C=T.children(this._source.maxzoom);if(r[C[0].key]&&r[C[1].key]&&r[C[2].key]&&r[C[3].key])continue}let A=E.wasRequested();for(let C=T.overscaledZ-1;C>=d;--C){const k=T.scaledTo(C);if(s[k.key]||(s[k.key]=!0,E=this.getTile(k),!E&&A&&(E=this._addTile(k)),E&&(r[k.key]=k,A=E.wasRequested(),E.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let s,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){s=this._loadedParentTiles[u.key];break}r.push(u.key);const f=u.scaledTo(u.overscaledZ-1);if(s=this._getLoadedTile(f),s)break;u=f}for(const f of r)this._loadedParentTiles[f]=s}}_addTile(e){let r=this._tiles[e.key];if(r)return r.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const s=!!r;if(!s){const u=this.map?this.map.painter:null,f=this._source.tileSize*e.overscaleFactor();r=this._source.type==="raster-array"?new fC(e,f,this.transform.tileZoom,u,this._isRaster):new D0(e,f,this.transform.tileZoom,u,this._isRaster),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,s||this._source.fire(new $o("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=r.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"||r.state==="empty"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,s){const u=[],f=this.transform;if(!f)return u;const d=f.projection.name==="globe",g=bl(f.center.lng);for(const v in this._tiles){const T=this._tiles[v];if(s&&T.clearQueryDebugViz(),T.holdingForFade())continue;let E;if(d){const A=T.tileID.canonical;if(A.z===0){const C=[Math.abs(Kt(g,...__(A,-1))-g),Math.abs(Kt(g,...__(A,1))-g)];E=[0,2*C.indexOf(Math.min(...C))-1]}else{const C=[Math.abs(Kt(g,...__(A,-1))-g),Math.abs(Kt(g,...__(A,0))-g),Math.abs(Kt(g,...__(A,1))-g)];E=[C.indexOf(Math.min(...C))-1]}}else E=[0];for(const A of E){const C=e.containsTile(T,f,r,A);C&&u.push(C)}}return u}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,r){const s=this.getRenderableIds(e,r).map(f=>this._tiles[f].tileID),u=this.transform.projection.name==="globe";for(const f of s)f.projMatrix=this.transform.calculateProjMatrix(f.toUnwrapped()),f.expandedProjMatrix=u?this.transform.calculateProjMatrix(f.toUnwrapped(),!1,!0):f.projMatrix;return s}sortCoordinatesByDistance(e){const r=e.slice(),s=this.transform._camera.position,u=this.transform._camera.forward(),f={};for(const d of r){const g=1/(1<<d.canonical.z);f[d.key]=((d.canonical.x+.5)*g+d.wrap-s[0])*u[0]+((d.canonical.y+.5)*g-s[1])*u[1]-s[2]*u[2]}return r.sort((d,g)=>f[d.key]-f[g.key]),r}hasTransition(){if(this._source.hasTransition())return!0;if(jb(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=Pi.now())return!0}return!1}setFeatureState(e,r,s){this._state.updateState(e=e||"_geojsonTileLayer",r,s)}removeFeatureState(e,r,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,s)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,s){const u=this._tiles[e];u&&u.setDependencies(r,s)}reloadTilesForDependencies(e,r){for(const s in this._tiles)this._tiles[s].hasDependency(e,r)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,r))}_preloadTiles(e,r){if(!this._sourceLoaded){const g=()=>{this._sourceLoaded&&(this._source.off("data",g),this._preloadTiles(e,r))};return void this._source.on("data",g)}const s=new Map,u=Array.isArray(e)?e:[e],f=this.map.painter.terrain,d=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const g of u){const v=g.coveringTiles({tileSize:d,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const T of v)s.set(T.key,T);this.usedForTerrain&&g.updateElevation(!1)}fn(Array.from(s.values()),(g,v)=>{const T=new D0(g,this._source.tileSize*g.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(T,E=>{this._source.type==="raster-dem"&&T.dem&&this._backfillDEM(T),v(E,T)})},r)}}function dC(t,e){const r=Math.abs(2*t.wrap)-+(t.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||s-r||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function jb(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function __(t,e){const r=1<<t.z;return[t.x/r+e,(t.x+1)/r+e]}Zh.maxOverzooming=10,Zh.maxUnderzooming=3;const pC=new class extends Ft{possiblyEvaluate(t,e){return e=new pr(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,r,s){return e=Qr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,r,s)}}(p0.paint.properties["line-width"].specification);function mC(t,e){return e>0?e+2*t:t}pC.useIntegerZoom=!0;const f5=new Xr({"symbol-placement":new ct($e.layout_symbol["symbol-placement"]),"symbol-spacing":new ct($e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ct($e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ft($e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ct($e.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ct($e.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new ct($e.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ct($e.layout_symbol["icon-ignore-placement"]),"icon-optional":new ct($e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ct($e.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ft($e.layout_symbol["icon-size"]),"icon-text-fit":new Ft($e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ft($e.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ft($e.layout_symbol["icon-image"]),"icon-rotate":new Ft($e.layout_symbol["icon-rotate"]),"icon-padding":new ct($e.layout_symbol["icon-padding"]),"icon-keep-upright":new ct($e.layout_symbol["icon-keep-upright"]),"icon-offset":new Ft($e.layout_symbol["icon-offset"]),"icon-anchor":new Ft($e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ct($e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ct($e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ct($e.layout_symbol["text-rotation-alignment"]),"text-field":new Ft($e.layout_symbol["text-field"]),"text-font":new Ft($e.layout_symbol["text-font"]),"text-size":new Ft($e.layout_symbol["text-size"]),"text-max-width":new Ft($e.layout_symbol["text-max-width"]),"text-line-height":new Ft($e.layout_symbol["text-line-height"]),"text-letter-spacing":new Ft($e.layout_symbol["text-letter-spacing"]),"text-justify":new Ft($e.layout_symbol["text-justify"]),"text-radial-offset":new Ft($e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ct($e.layout_symbol["text-variable-anchor"]),"text-anchor":new Ft($e.layout_symbol["text-anchor"]),"text-max-angle":new ct($e.layout_symbol["text-max-angle"]),"text-writing-mode":new ct($e.layout_symbol["text-writing-mode"]),"text-rotate":new Ft($e.layout_symbol["text-rotate"]),"text-padding":new ct($e.layout_symbol["text-padding"]),"text-keep-upright":new ct($e.layout_symbol["text-keep-upright"]),"text-transform":new Ft($e.layout_symbol["text-transform"]),"text-offset":new Ft($e.layout_symbol["text-offset"]),"text-allow-overlap":new ct($e.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ct($e.layout_symbol["text-ignore-placement"]),"text-optional":new ct($e.layout_symbol["text-optional"]),visibility:new ct($e.layout_symbol.visibility)});var Vb={paint:new Xr({"icon-opacity":new Ft($e.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Ft($e.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Ft($e.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ft($e.paint_symbol["text-emissive-strength"]),"icon-color":new Ft($e.paint_symbol["icon-color"]),"icon-halo-color":new Ft($e.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ft($e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ft($e.paint_symbol["icon-halo-blur"]),"icon-translate":new ct($e.paint_symbol["icon-translate"]),"icon-translate-anchor":new ct($e.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ft($e.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ft($e.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Ft($e.paint_symbol["text-occlusion-opacity"]),"text-color":new Ft($e.paint_symbol["text-color"],{runtimeType:os,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Ft($e.paint_symbol["text-halo-color"]),"text-halo-width":new Ft($e.paint_symbol["text-halo-width"]),"text-halo-blur":new Ft($e.paint_symbol["text-halo-blur"]),"text-translate":new ct($e.paint_symbol["text-translate"]),"text-translate-anchor":new ct($e.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ct($e.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new ct($e.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new ct($e.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new ct($e.paint_symbol["icon-color-brightness-max"])}),layout:f5};class _C{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ls,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ee(_C,"FormatSectionOverride",{omit:["defaultValue"]});class R0 extends Ui{constructor(e,r,s,u){super(e,Vb,r,s,u),this._colorAdjustmentMatrix=o.ad.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const u=[];for(const f of s)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,r,s,u){return this._saturation===e&&this._contrast===r&&this._brightnessMin===s&&this._brightnessMax===u||(this._colorAdjustmentMatrix=function(f,d,g,v){f=Uu(f),d=zf(d);const T=o.ad.create(),E=f/3,A=1-2*E,C=[A,E,E,0,E,A,E,0,E,E,A,0,0,0,0,1],k=.5-.5*d,L=v-g;return o.ad.multiply(T,[L,0,0,0,0,L,0,0,0,0,L,0,g,g,g,1],[d,0,0,0,0,d,0,0,0,0,d,0,k,k,k,1]),o.ad.multiply(T,T,C),T}(e,r,s,u),this._saturation=e,this._contrast=r,this._brightnessMin=s,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,r,s,u){const f=this.layout.get(e).evaluate(r,{},s,u),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||j(d.value)||!f?f:function(g,v){return v.replace(/{([^{}]+)}/g,(T,E)=>E in g?String(g[E]):"")}(r.properties,f)}createBucket(e){return new Dd(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Vb.paint.overridableProperties){if(!R0.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new _C(r),u=new B(s,r.property.specification,this.scope,this.options);let f=null;f=r.value.kind==="constant"||r.value.kind==="source"?new H("source",u):new X("composite",u,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new en(r.property,f,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&R0.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),u=Vb.paint.properties[r];let f=!1;const d=g=>{for(const v of g)if(u.overrides&&u.overrides.hasOverride(v))return void(f=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Oi)d(s.value.value.sections);else if(s.value.kind==="source"){const g=T=>{f||(T instanceof Ua&&qn(T.value)===ha?d(T.value.sections):T instanceof Th?d(T.sections):T.eachChild(g))},v=s.value;v._styleExpression&&g(v._styleExpression.expression)}return f}getProgramIds(){const e=this.paint.get("icon-opacity").constantOr(1)!==0,r=this.paint.get("text-opacity").constantOr(1)!==0,s=[];return e&&s.push("symbolIcon"),r&&s.push("symbolSDF"),s}getDefaultProgramParams(e,r,s){return{config:new Uh(this,{zoom:r,lut:s}),overrideFog:!1}}}const d5=new Xr({visibility:new ct($e.layout_background.visibility)});var p5={paint:new Xr({"background-color":new ct($e.paint_background["background-color"]),"background-pattern":new ct($e.paint_background["background-pattern"]),"background-opacity":new ct($e.paint_background["background-opacity"]),"background-emissive-strength":new ct($e.paint_background["background-emissive-strength"])}),layout:d5};const m5=new Xr({visibility:new ct($e.layout_raster.visibility)});var _5={paint:new Xr({"raster-opacity":new ct($e.paint_raster["raster-opacity"]),"raster-color":new wi($e.paint_raster["raster-color"]),"raster-color-mix":new ct($e.paint_raster["raster-color-mix"]),"raster-color-range":new ct($e.paint_raster["raster-color-range"]),"raster-hue-rotate":new ct($e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ct($e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ct($e.paint_raster["raster-brightness-max"]),"raster-saturation":new ct($e.paint_raster["raster-saturation"]),"raster-contrast":new ct($e.paint_raster["raster-contrast"]),"raster-resampling":new ct($e.paint_raster["raster-resampling"]),"raster-fade-duration":new ct($e.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ct($e.paint_raster["raster-emissive-strength"]),"raster-array-band":new ct($e.paint_raster["raster-array-band"]),"raster-elevation":new ct($e.paint_raster["raster-elevation"])}),layout:m5};function k0(t,e,r,s,u,f,d,g){const v=[t,e,1,r,s,1,u,f,1],T=[d,g,1],E=o.bC.adjoint([],v),[A,C,k]=o._.transformMat3(T,T,E);return o.bC.multiply(v,v,[A,0,0,0,C,0,0,0,k])}function gC(t,e,r,s,u,f,d,g){const v=function(T,E,A,C,k,L,F,N){const G=k0(0,0,1,0,1,1,0,1),ne=k0(T,E,A,C,k,L,F,N),ie=o.bC.adjoint([],G);return o.bC.multiply(ne,ne,ie)}(t,e,r,s,u,f,d,g);return[v[2]/v[8]/At,v[5]/v[8]/At]}function L0(t){return[t[0],Math.min(Math.max(t[1],-Un),Un)]}class yC extends Jl{constructor(e,r,s,u){super(),this.id=e,this.dispatcher=s,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new $o("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Qp(this.map._requestManager.transformRequest(this.url,Uf.Image),(s,u)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new Na(s)):u&&(this.image=u instanceof HTMLImageElement?Pi.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new C0(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new $o("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof C0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],s=e[0][1];for(const f of e)f[1]>s&&(s=f[1]),f[1]<r&&(r=f[1]);const u=(s+r)/2;if(u>Un?this.onNorthPole=!0:u<-Un&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=e.map(eo.fromLngLat);this.tileID=function(d){let g=1/0,v=1/0,T=-1/0,E=-1/0;for(const F of d)g=Math.min(g,F.x),v=Math.min(v,F.y),T=Math.max(T,F.x),E=Math.max(E,F.y);const A=Math.max(T-g,E-v),C=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),k=Math.pow(2,C);let L=Math.floor((g+T)/2*k);return L>1&&(L-=1),new Vh(C,L,Math.floor((v+E)/2*k))}(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new $o("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const N in this.tiles){const G=this.tiles[N];G.state!=="loaded"&&(G.state="loaded",G.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=qh(new Vh(0,0,0),this.map.transform.projection),s=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(N){const G=N[1].x-N[0].x,ne=N[1].y-N[0].y,ie=N[2].x-N[1].x,oe=N[2].y-N[1].y,me=N[3].x-N[2].x,pe=N[3].y-N[2].y,Ee=N[0].x-N[3].x,De=N[0].y-N[3].y,je=G*oe-ie*ne,Qe=ie*pe-me*oe,Ze=me*De-Ee*pe,ut=Ee*ne-G*De;return je>0&&Qe>0&&Ze>0&&ut>0||je<0&&Qe<0&&Ze<0&&ut<0}(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=qh(this.tileID,this.map.transform.projection),[f,d,g,v]=this.coordinates.map(N=>{const G=u.projection.project(N[0],N[1]);return YA(u,G)._round()});this.perspectiveTransform=gC(f.x,f.y,d.x,d.y,g.x,g.y,v.x,v.y);const T=this._boundsArray=new ac;T.emplaceBack(f.x,f.y,0,0),T.emplaceBack(d.x,d.y,At,0),T.emplaceBack(v.x,v.y,0,At),T.emplaceBack(g.x,g.y,At,At),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(T,O0.members),this.boundsSegments=In.simpleSegment(0,0,4,2);const E=[],A=function(N){return[L0(N[0]),L0(N[1]),L0(N[2]),L0(N[3])]}(this.coordinates),[C,k,L,F]=function(N){let G=N[0][0],ne=G,ie=N[0][1],oe=ie;for(let me=1;me<N.length;me++)N[me][0]<G?G=N[me][0]:N[me][0]>ne&&(ne=N[me][0]),N[me][1]<ie?ie=N[me][1]:N[me][1]>oe&&(oe=N[me][1]);return[G,ie,ne-G,oe-ie]}(A);{const N=new ac,[G,ne,ie,oe]=function(tt){let _t=tt[0].x,bt=_t,gt=tt[0].y,zt=gt;for(let xt=1;xt<tt.length;xt++)tt[xt].x<_t?_t=tt[xt].x:tt[xt].x>bt&&(bt=tt[xt].x),tt[xt].y<gt?gt=tt[xt].y:tt[xt].y>zt&&(zt=tt[xt].y);return[_t,gt,bt-_t,zt-gt]}(s),me=tt=>[(tt.x-G)/ie,(tt.y-ne)/oe],[pe,Ee,De,je]=s.map(me),Qe=function(tt,_t,bt,gt,zt,xt,Tt,Jt){const Yt=k0(0,0,1,0,1,1,0,1),Xt=k0(tt,_t,bt,gt,zt,xt,Tt,Jt),wt=o.bC.adjoint([],Xt);return o.bC.multiply(Yt,Yt,wt)}(pe[0],pe[1],Ee[0],Ee[1],De[0],De[1],je[0],je[1]);this.elevatedGlobePerspectiveTransform=gC(pe[0],pe[1],Ee[0],Ee[1],De[0],De[1],je[0],je[1]);const Ze=(tt,_t)=>{E.push(tt.lng);const bt=Math.round((tt.lng-C)/L*At),gt=Math.round((tt.lat-k)/F*At),zt=me(_t),xt=o._.transformMat3([],[zt[0],zt[1],1],Qe),Tt=Math.round(xt[0]/xt[2]*At),Jt=Math.round(xt[1]/xt[2]*At);N.emplaceBack(bt,gt,Tt,Jt)},ut=s[3].x-s[0].x,vt=s[3].y-s[0].y,ot=s[2].x-s[1].x,mt=s[2].y-s[1].y;for(let tt=0;tt<65;tt++){const _t=tt/64,bt=[s[0].x+_t*ut,s[0].y+_t*vt],gt=[s[1].x+_t*ot,s[1].y+_t*mt],zt=gt[0]-bt[0],xt=gt[1]-bt[1];for(let Tt=0;Tt<65;Tt++){const Jt=Tt/64,Yt={x:bt[0]+zt*Jt,y:bt[1]+xt*Jt,z:0};Ze(r.projection.unproject(Yt.x,Yt.y),Yt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(N,O0.members)}{this.maxLongitudeTriangleSize=0;let N=[],G=new Si;const ne=(ie,oe,me)=>{G.emplaceBack(ie,oe,me);const pe=E[ie],Ee=E[oe],De=E[me],je=Math.min(Math.min(pe,Ee),De),Qe=Math.max(Math.max(pe,Ee),De)-je;Qe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Qe),N.push(je+Qe/2)};for(let ie=0;ie<64;ie++)for(let oe=0;oe<64;oe++){const me=65*ie+oe,pe=me+1,Ee=me+65,De=Ee+1;ne(me,Ee,pe),ne(pe,Ee,De)}[N,G]=function(ie,oe){const me=Array.from({length:ie.length},(De,je)=>je);me.sort((De,je)=>ie[De]-ie[je]);const pe=[],Ee=new Si;for(let De=0;De<me.length;De++){const je=me[De];pe.push(ie[je]);const Qe=3*je,Ze=Qe+1;Ee.emplaceBack(oe.uint16[Qe],oe.uint16[Ze],oe.uint16[Ze+1])}return[pe,Ee]}(N,G),this.elevatedGlobeTrianglesCenterLongitudes=N,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(G)}this.elevatedGlobeSegments=In.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,L/At,0,F/At,0,0,k,C,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const r=this.map.painter.context,s=r.gl;!this._dirty||this.texture instanceof C0||(this.texture?this.texture.update(this.image):(this.texture=new ga(r,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const s=this.elevatedGlobeTrianglesCenterLongitudes;let u=(f=e+180)+360*Math.round((s[0]-f)/360);var f;const d=new In,g=(A,C)=>{d.segments.push({vertexOffset:0,primitiveOffset:A,vertexLength:r.segments[0].vertexLength,primitiveLength:C,sortKey:void 0,vaos:{}})},v=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-u)<=v){const A=Lf(s,0,s.length,u+v);return A===s.length||g(A,Hg(s,A+1,s.length,u+360-v)-A),d}u<s[0]&&(u+=360);const T=Hg(s,0,s.length,u-v);if(T===s.length)return g(0,s.length),d;g(0,T-0);const E=Lf(s,T+1,s.length,u+v);return E!==s.length&&g(E,s.length-E),d}}const g5=(Math.pow(256,2)-1)/16907520;class vC extends Ui{constructor(e,r,s,u){super(e,_5,r,s,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof yC&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const r=this._transitionablePaint._values["raster-color"].value.expression,[s,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(u)||s===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=Ym({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,u])}}const y5=new Xr({visibility:new ct($e["layout_raster-particle"].visibility)});var v5={paint:new Xr({"raster-particle-array-band":new ct($e["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new ct($e["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new wi($e["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new ct($e["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new ct($e["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new ct($e["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new ct($e["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:y5};class xC extends Ui{constructor(e,r,s,u){super(e,v5,r,s,u),this._updateColorRamp(),this.lastInvalidatedAt=Pi.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Ym({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Pi.now()}}class x5 extends Ui{constructor(e,r){super(e,{},r,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const b5=new Xr({visibility:new ct($e.layout_sky.visibility)});var w5={paint:new Xr({"sky-type":new ct($e.paint_sky["sky-type"]),"sky-atmosphere-sun":new ct($e.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ct($e.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ct($e.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ct($e.paint_sky["sky-gradient-radius"]),"sky-gradient":new wi($e.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ct($e.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ct($e.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ct($e.paint_sky["sky-opacity"])}),layout:b5};function $b(t,e,r){const s=[0,0,1],u=o.av.identity([]);return o.av.rotateY(u,u,r?-Ar(t)+Math.PI:Ar(t)),o.av.rotateX(u,u,-Ar(e)),o._.transformQuat(s,s,u),o._.normalize(s,s)}var T5={paint:new Xr({})};function bC(t,e){const r=z0(t.projection,t.zoom,t.width,t.height),s=function(f,d,g,v,T){const E=new Vr(g.lng-180*Ec,g.lat),A=new Vr(g.lng+180*Ec,g.lat),C=f.project(E.lng,E.lat),k=f.project(A.lng,A.lat),L=-Math.atan2(k.y-C.y,k.x-C.x),F=eo.fromLngLat(g);F.y=Kt(F.y,-1+Ec,1-Ec);const N=F.toLngLat(),G=f.project(N.lng,N.lat),ne=eo.fromLngLat(N);ne.x+=Ec;const ie=ne.toLngLat(),oe=f.project(ie.lng,ie.lat),me=SC(oe.x-G.x,oe.y-G.y,L),pe=eo.fromLngLat(N);pe.y+=Ec;const Ee=pe.toLngLat(),De=f.project(Ee.lng,Ee.lat),je=SC(De.x-G.x,De.y-G.y,L),Qe=Math.abs(me.x)/Math.abs(je.y),Ze=o.ad.identity([]);o.ad.rotateZ(Ze,Ze,-L*(1-(T?0:v)));const ut=o.ad.identity([]);return o.ad.scale(ut,ut,[1,1-(1-Qe)*v,1]),ut[4]=-je.x/je.y*v,o.ad.rotateZ(ut,ut,L),o.ad.multiply(ut,Ze,ut),ut}(t.projection,0,t.center,r,e),u=wC(t);return o.ad.scale(s,s,[u,u,1]),s}function wC(t){const e=t.projection,r=z0(t.projection,t.zoom,t.width,t.height),s=TC(e,t.center),u=TC(e,Vr.convert(e.center));return Math.pow(2,s*r+(1-r)*u)}function z0(t,e,r,s,u=1/0){const f=t.range;if(!f)return 0;const d=Math.min(u,Math.max(r,s)),g=Math.log(d/1024)/Math.LN2;return zr(f[0]+g,f[1]+g,e)}const Ec=1/4e4;function TC(t,e){const r=Kt(e.lat,-Un,Un),s=new Vr(e.lng-180*Ec,r),u=new Vr(e.lng+180*Ec,r),f=t.project(s.lng,r),d=t.project(u.lng,r),g=eo.fromLngLat(s),v=eo.fromLngLat(u),T=d.x-f.x,E=d.y-f.y,A=v.x-g.x,C=v.y-g.y,k=Math.sqrt((A*A+C*C)/(T*T+E*E));return Math.log(k)/Math.LN2}function SC(t,e,r){const s=Math.cos(r),u=Math.sin(r);return{x:t*s-e*u,y:t*u+e*s}}function EC(t,e,r){o.ad.identity(t),o.ad.rotateZ(t,t,Ar(e[2])),o.ad.rotateX(t,t,Ar(e[0])),o.ad.rotateY(t,t,Ar(e[1])),o.ad.scale(t,t,r),o.ad.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function F0(t,e,r,s,u,f,d,g){const v=[r[0]-e[0],r[1]-e[1],0],T=[s[0]-e[0],s[1]-e[1],0];if(o._.length(v)<1e-12||o._.length(T)<1e-12)return o.av.identity(t);const E=o._.cross([],v,T);o._.normalize(E,E),o._.subtract(T,s,e),v[2]=(f-u)*g,T[2]=(d-u)*g;const A=v;return o._.cross(A,v,T),o._.normalize(A,A),o.av.rotationTo(t,E,A)}function Gb(t,e,r=!1){const s=gu(e.zoom),u=function(f,d,g){const v=d.worldSize,T=[f[12],f[13],f[14]],E=Di(T[1]/v),A=Ho(T[0]/v),C=o.ad.identity([]),k=Ao(1,E)*v,L=Ao(1,0)*v*$h(E,d.zoom),F=1/ub(v);let N=L*F;if(g){const oe=z0(d.projection,d.zoom,d.width,d.height,1024);N=F*d.projection.pixelSpaceConversion(d.center.lat,v,oe)}const G=jh(E,A);o._.add(G,G,o._.scale([],o._.normalize([],G),k*N*T[2]));const ne=function(oe){const me=[oe[0],oe[1],oe[2]];let pe=[0,1,0];const Ee=o._.cross([],pe,me);return o._.cross(pe,me,Ee),o._.squaredLength(pe)===0&&(pe=[0,1,0],o._.cross(Ee,me,pe)),o._.normalize(Ee,Ee),o._.normalize(pe,pe),o._.normalize(me,me),[Ee[0],Ee[1],Ee[2],0,pe[0],pe[1],pe[2],0,me[0],me[1],me[2],0,oe[0],oe[1],oe[2],1]}(G);o.ad.scale(C,C,[N,N,N*k]),o.ad.translate(C,C,[-T[0],-T[1],-T[2]]);const ie=o.ad.multiply([],d.globeMatrix,ne);return o.ad.multiply(ie,ie,C),o.ad.multiply(ie,ie,f),ie}(t,e,r);if(s>0){const f=function(d,g){const v=g.worldSize,T=Ao(1,0)*v*$h(g.center.lat,g.zoom)/ub(v),E=Ao(1,g.center.lat)*v,A=o.ad.identity([]);return o.ad.rotateY(A,A,Ar(g.center.lng)),o.ad.rotateX(A,A,Ar(g.center.lat)),o.ad.translate(A,A,[0,0,Io]),o.ad.scale(A,A,[T,T,T*E]),o.ad.translate(A,A,[g.point.x-.5*v,g.point.y-.5*v,0]),o.ad.multiply(A,A,d),o.ad.multiply(A,g.globeMatrix,A)}(t,e);return function(d,g,v){const T=(L,F,N)=>{const G=o._.length(L),ne=o._.length(F),ie=_u(L,F,N);return o._.scale(ie,ie,1/o._.length(ie)*nr(G,ne,N))},E=T([d[0],d[1],d[2]],[g[0],g[1],g[2]],v),A=T([d[4],d[5],d[6]],[g[4],g[5],g[6]],v),C=T([d[8],d[9],d[10]],[g[8],g[9],g[10]],v),k=_u([d[12],d[13],d[14]],[g[12],g[13],g[14]],v);return[E[0],E[1],E[2],0,A[0],A[1],A[2],0,C[0],C[1],C[2],0,k[0],k[1],k[2],1]}(u,f,s)}return u}function MC(t,e,r,s){const u=Tn.projectAabbCorners(s,r);let f=Number.MAX_VALUE,d=-1;for(let T=0;T<u.length;++T){const E=u[T];E[0]=(.5*E[0]+.5)*e.width,E[1]=(.5-.5*E[1])*e.height,E[2]<f&&(d=T,f=E[2])}const g=T=>new Mt(u[T][0],u[T][1]);let v;switch(d){case 0:case 6:v=[g(1),g(5),g(4),g(7),g(3),g(2),g(1)];break;case 1:case 7:v=[g(0),g(4),g(5),g(6),g(2),g(3),g(0)];break;case 3:case 5:v=[g(1),g(0),g(4),g(7),g(6),g(2),g(1)];break;default:v=[g(1),g(5),g(6),g(7),g(3),g(0),g(1)]}if(J1(t,v))return f}const S5=Yr([{name:"a_pos_3f",components:3,type:"Float32"}]),E5=Yr([{name:"a_color_3f",components:3,type:"Float32"}]),M5=Yr([{name:"a_color_4f",components:4,type:"Float32"}]),I5=Yr([{name:"a_uv_2f",components:2,type:"Float32"}]),A5=Yr([{name:"a_normal_3f",components:3,type:"Float32"}]),C5=Yr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),P5=Yr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class B0{constructor(e,r,s,u){this.message=(e?`${e}: `:"")+s,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function IC(t,e){const r=t.indexOf("://")===-1;try{return new URL(t,r&&e?"http://example.com":void 0),!0}catch{return!1}}class AC{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class CC{constructor(){this.instancedDataArray=new z1,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Wb{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,r){}populate(e,r,s,u){this.tileToMeter=Hy(s);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:d,id:g,index:v,sourceLayerIndex:T}of e){const E=g??(d.properties&&d.properties.hasOwnProperty("id")?d.properties.id:void 0),A=mu(d,f);if(!this.layers[0]._featureFilter.filter(new pr(this.zoom),A,s))continue;const C={id:E,sourceLayerIndex:T,index:v,geometry:f?A.geometry:qa(d,s,u),properties:d.properties,type:d.type,patterns:{}},k=this.addFeature(C,C.geometry,A);k&&r.featureIndex.insert(d,C.geometry,v,T,this.index,this.instancesPerModel[k].instancedDataArray.length,At/32)}this.lookup=null}update(e,r,s,u){for(const f in this.instancesPerModel){const d=this.instancesPerModel[f];for(const g in e)d.idToFeaturesIndex.hasOwnProperty(g)&&(this.evaluate(d.features[d.idToFeaturesIndex[g]],e[g],d,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const r in this.instancesPerModel){const s=this.instancesPerModel[r];for(const u of s.features){const f=this.layers[0],d=u.feature,g=this.canonical,v=f.paint.get("model-rotation").evaluate(d,{},g),T=f.paint.get("model-scale").evaluate(d,{},g),E=f.paint.get("model-translation").evaluate(d,{},g);o._.exactEquals(u.rotation,v)&&o._.exactEquals(u.scale,T)&&o._.exactEquals(u.translation,E)||(this.evaluate(u,u.featureStates,s,!0),e=!0)}}return e}updateReplacement(e,r,s){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const u=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(vb(this.activeReplacements,u))return!1;this.activeReplacements=u;let f=!1;for(const d in this.instancesPerModel){const g=this.instancesPerModel[d],v=g.instancedDataArray;for(const T of g.features){const E=T.instancedDataOffset,A=T.instancedDataCount;for(let C=0;C<A;C++){const k=16*(C+E);let L=v.float32[k+0];L=L>At?L-At:L;const F=Math.floor(L),N=v.float32[k+1];let G=!1;for(const ne of this.activeReplacements)if(!(ne.order<s||ne.order===1/0)&&ne.clipMask&HI.Model&&!(ne.min.x>F||F>ne.max.x||ne.min.y>N||N>ne.max.y)&&(G=NI(BI(F,N,e.canonical,ne.footprintTileId.canonical),ne),G))break;v.float32[k]=G?L+At:L,f=f||G}}}return f}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const r in this.instancesPerModel){const s=this.instancesPerModel[r];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,C5.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const r in this.instancesPerModel){const s=this.instancesPerModel[r];s.instancedDataArray.length!==0&&s.instancedDataBuffer&&s.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const r of this.modelUris)e.removeModel(r,"")}addFeature(e,r,s){const u=this.layers[0],f=u.layout.get("model-id").evaluate(s,{},this.canonical);if(!f)return zn(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),f;IC(f,!1)&&(this.modelUris.includes(f)||this.modelUris.push(f)),this.instancesPerModel[f]||(this.instancesPerModel[f]=new CC);const d=this.instancesPerModel[f],g=d.instancedDataArray,v=new AC(s,g.length);for(const T of r)for(const E of T){if(E.x<0||E.x>=At||E.y<0||E.y>=At)continue;const A=(this.lookupDim-1)/At,C=this.lookupDim*(E.y*A|0)+E.x*A|0;if(this.lookup){if(this.lookup[C]!==0)continue;this.lookup[C]=1}this.instanceCount++;const k=g.length;g.resize(k+1),d.instancesEvaluatedElevation.push(0),g.float32[16*k]=E.x,g.float32[16*k+1]=E.y}return v.instancedDataCount=d.instancedDataArray.length-v.instancedDataOffset,v.instancedDataCount>0&&(e.id&&(d.idToFeaturesIndex[e.id]=d.features.length),d.features.push(v),this.evaluate(v,{},d,!1)),f}getModelUris(){return this.modelUris}evaluate(e,r,s,u){const f=this.layers[0],d=e.feature,g=this.canonical,v=e.rotation=f.paint.get("model-rotation").evaluate(d,r,g),T=e.scale=f.paint.get("model-scale").evaluate(d,r,g),E=e.translation=f.paint.get("model-translation").evaluate(d,r,g),A=f.paint.get("model-color").evaluate(d,r,g);A.a=f.paint.get("model-color-mix-intensity").evaluate(d,r,g);const C=[];this.maxVerticalOffset<E[2]&&(this.maxVerticalOffset=E[2]),this.maxScale=Math.max(Math.max(this.maxScale,T[0]),Math.max(T[1],T[2])),EC(C,v,T);const k=Math.round(100*A.a)+A.b/1.05;for(let L=0;L<e.instancedDataCount;++L){const F=e.instancedDataOffset+L,N=16*F,G=s.instancedDataArray.float32;let ne=0;u&&(ne=G[N+6]-s.instancesEvaluatedElevation[F]);const ie=0|G[N+1];G[N]=(0|G[N])+A.r/1.05,G[N+1]=ie+A.g/1.05,G[N+2]=k,G[N+3]=1/(g.z>10?this.tileToMeter:Hy(g,ie)),G[N+4]=E[0],G[N+5]=E[1],G[N+6]=E[2]+ne,G[N+7]=C[0],G[N+8]=C[1],G[N+9]=C[2],G[N+10]=C[4],G[N+11]=C[5],G[N+12]=C[6],G[N+13]=C[8],G[N+14]=C[9],G[N+15]=C[10],s.instancesEvaluatedElevation[F]=E[2]}}}ee(Wb,"ModelBucket",{omit:["layers"]}),ee(CC,"PerModelAttributes"),ee(AC,"ModelFeature");const O5=new Xr({visibility:new ct($e.layout_model.visibility),"model-id":new Ft($e.layout_model["model-id"])});var D5={paint:new Xr({"model-opacity":new ct($e.paint_model["model-opacity"]),"model-rotation":new Ft($e.paint_model["model-rotation"]),"model-scale":new Ft($e.paint_model["model-scale"]),"model-translation":new Ft($e.paint_model["model-translation"]),"model-color":new Ft($e.paint_model["model-color"]),"model-color-mix-intensity":new Ft($e.paint_model["model-color-mix-intensity"]),"model-type":new ct($e.paint_model["model-type"]),"model-cast-shadows":new ct($e.paint_model["model-cast-shadows"]),"model-receive-shadows":new ct($e.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ct($e.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ft($e.paint_model["model-emissive-strength"]),"model-roughness":new Ft($e.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ft($e.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ct($e.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new ct($e.paint_model["model-front-cutoff"])}),layout:O5};const Xh=64,kd={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function PC(t,e,r,s,u,f,d,g,v,T=!1){const E=r.zoom,A=r.project(s),C=$h(s.lat,E),k=1/C;o.ad.identity(t),o.ad.translate(t,t,[A.x+d[0]*k,A.y+d[1]*k,d[2]]);let L=1,F=1;const N=r.worldSize;if(T){if(r.projection.name==="mercator"){let oe=0;r.elevation&&(oe=r.elevation.getAtPointOrZero(new eo(A.x/N,A.y/N),0));const me=o.aA.transformMat4([],[A.x,A.y,oe,1],r.projMatrix)[3]/r.cameraToCenterDistance;L=me,F=me*$h(r.center.lat,E)}else if(r.projection.name==="globe"){const oe=Gb(t,r),me=o.ad.multiply([],r.projMatrix,oe),pe=[0,0,0,1];o.aA.transformMat4(pe,pe,me);const Ee=pe[3]/r.cameraToCenterDistance,De=gu(E),je=r.projection.pixelsPerMeter(s.lat,N)*$h(s.lat,E),Qe=r.projection.pixelsPerMeter(r.center.lat,N)*$h(r.center.lat,E);L=Ee/nr(je,HM(r.center.lat),De),F=Ee*C/je,L*=Qe,F*=Qe}}else L=k;o.ad.scale(t,t,[L,L,F]);const G=[...t],ne=e.orientation,ie=[];if(EC(ie,[ne[0]+u[0],ne[1]+u[1],ne[2]+u[2]],f),o.ad.multiply(t,G,ie),g&&r.elevation){let oe=0;const me=[];if(v&&r.elevation){oe=function(De,je,Qe,Ze,ut){const vt=je.elevation;if(!vt)return 0;const ot=Tn.projectAabbCorners(Qe,Ze),mt=Ao(1,ut.lat)*je.worldSize,tt=function(tr,wr){const fr=[0,0,1],Mr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Tr of Mr){const Or=tr[Tr.corners[0]],ur=tr[Tr.corners[1]],nn=tr[Tr.corners[2]],tn=[ur[0]-Or[0],ur[1]-Or[1],wr*(ur[2]-Or[2])],qr=o._.cross(tn,tn,[nn[0]-Or[0],nn[1]-Or[1],wr*(nn[2]-Or[2])]);o._.normalize(qr,qr),Tr.dotProductWithUp=o._.dot(qr,fr)}return Mr.sort((Tr,Or)=>Tr.dotProductWithUp-Or.dotProductWithUp),Mr[0].corners}(ot,mt),_t=ot[tt[0]],bt=ot[tt[1]],gt=ot[tt[2]],zt=ot[tt[3]],xt=vt.getAtPointOrZero(new eo(_t[0]/je.worldSize,_t[1]/je.worldSize),0),Tt=vt.getAtPointOrZero(new eo(bt[0]/je.worldSize,bt[1]/je.worldSize),0),Jt=vt.getAtPointOrZero(new eo(gt[0]/je.worldSize,gt[1]/je.worldSize),0),Yt=vt.getAtPointOrZero(new eo(zt[0]/je.worldSize,zt[1]/je.worldSize),0),Xt=(xt+Yt)/2,wt=(Tt+Jt)/2;return Xt>wt?Tt<Jt?F0(De,bt,zt,_t,Tt,Yt,xt,mt):F0(De,gt,_t,zt,Jt,xt,Yt,mt):xt<Yt?F0(De,_t,bt,gt,xt,Tt,Jt,mt):F0(De,zt,gt,bt,Yt,Jt,Tt,mt),Math.max(Xt,wt)}(me,r,e.aabb,t,s);const pe=o.ad.fromQuat([],me),Ee=o.ad.multiply([],pe,ie);o.ad.multiply(t,G,Ee)}else oe=r.elevation.getAtPointOrZero(new eo(A.x/N,A.y/N),0);oe!==0&&(t[14]+=oe)}}function g_(t,e,r=!1){t.uploaded||(t.gfxTexture=new ga(e,t.image,r?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function R5(t,e,r){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,S5.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,A5.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,I5.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?E5:M5).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,P5.members,!0)),t.segments=In.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const s=t.material;s.pbrMetallicRoughness.baseColorTexture&&g_(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&g_(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&g_(s.normalTexture,e),s.occlusionTexture&&g_(s.occlusionTexture,e,r),s.emissionTexture&&g_(s.emissionTexture,e)}function qb(t,e,r){if(t.meshes)for(const s of t.meshes)R5(s,e,r);if(t.children)for(const s of t.children)qb(s,e,r)}function N0(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)N0(e)}function Hb(t){if(t.meshes)for(const r of t.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const r of t.children)Hb(r)}class k5{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class L5{constructor(){this.tasks={},this.taskQueue=[],Vo(["process"],this),this.invoker=new k5(this.process),this.nextId=0}add(e,r){const s=this.nextId++,u=function({type:f,isSymbolTile:d,zoom:g}){return g=g||0,f==="message"?0:f!=="maybePrepare"||d?f!=="parseTile"||d?f==="parseTile"&&d?300-g:f==="maybePrepare"&&d?400-g:500:200-g:100-g}(r);if(u===0){try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:r,priority:u,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<r&&(r=f.priority,e=u)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class OC{constructor(e,r,s){this.target=e,this.parent=r,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Vo(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new L5}send(e,r,s,u,f=!1,d){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=d,this.callbacks[g]=s);const v=new Set;return this.target.postMessage({id:g,type:e,hasCallback:!!s,targetMapId:u,mustQueue:f,sourceMapId:this.mapId,data:We(r,v)},v),{cancel:()=>{s&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const r=e.data,s=r.id;if(s&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const u=this.cancelCallbacks[s];delete this.cancelCallbacks[s],u&&u.cancel()}else if(r.mustQueue||ch()){const u=this.callbacks[s],f=this.scheduler.add(()=>this.processTask(s,r),u&&u.metadata||{type:"message"});f&&(this.cancelCallbacks[s]=f)}else this.processTask(s,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){const s=this.callbacks[e];delete this.callbacks[e],s&&(r.error?s(ke(r.error)):s(null,ke(r.data)))}else{const s=new Set,u=r.hasCallback?(d,g)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:d?We(d):null,data:We(g,s)},s)}:d=>{},f=ke(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,f,u);else if(this.parent.getWorkerSource){const d=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,d[0],f.source,f.scope)[d[1]](f,u)}else u(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Ld{constructor(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Hi();const s=this.workerPool.acquire(this.id);for(let u=0;u<s.length;u++){const f=new Ld.Actor(s[u],r,this.id);f.name=`Worker ${u}`,this.actors.push(f)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,r,s){fn(this.actors,(u,f)=>{u.send(e,r,f)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}Ld.Actor=OC;var y_={workerUrl:"",workerClass:null,workerParams:void 0};function z5(){return y_.workerClass!=null?new y_.workerClass:new self.Worker(y_.workerUrl,y_.workerParams)}const Zb="mapboxgl_preloaded_worker_pool";class v_{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<v_.workerCount;)this.workers.push(new z5);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Zb]}numActive(){return Object.keys(this.active).length}}let x_;function U0(){return x_||(x_=new v_),x_}v_.workerCount=2;let j0,Xb,Qa,zd,Yb,Fd=null;function DC(){return ch()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Xb||V.DRACO_URL}function RC(){if(ch()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(zd)return zd;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return zd=WebAssembly.validate(t)?V.MESHOPT_SIMD_URL:V.MESHOPT_URL,zd}const V0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},F5={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},b_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function kC(t,e,r){const s=r.json.bufferViews.length,u=r.buffers.length;e.bufferView=s,r.json.bufferViews[s]={buffer:u,byteLength:t.byteLength},r.buffers[u]=t}const Kb="KHR_draco_mesh_compression";function B5(t,e){const r=t.extensions&&t.extensions[Kb];if(!r)return;const s=new Qa.Decoder,u=BC(e,r.bufferView),f=new Qa.Mesh;if(!s.DecodeArrayToMesh(u,u.byteLength,f))throw new Error("Failed to decode Draco mesh");const d=e.json.accessors[t.indices],g=V0[d.componentType],v=d.count*g.BYTES_PER_ELEMENT,T=Qa._malloc(v);g===Uint16Array?s.GetTrianglesUInt16Array(f,v,T):s.GetTrianglesUInt32Array(f,v,T),kC(Qa.memory.buffer.slice(T,T+v),d,e),Qa._free(T);for(const E of Object.keys(r.attributes)){const A=s.GetAttributeByUniqueId(f,r.attributes[E]),C=e.json.accessors[t.attributes[E]],k=F5[C.componentType],L=C.count*b_[C.type]*V0[C.componentType].BYTES_PER_ELEMENT,F=Qa._malloc(L);s.GetAttributeDataArrayForAllPoints(f,A,Qa[k],L,F),kC(Qa.memory.buffer.slice(F,F+L),C,e),Qa._free(F)}s.destroy(),f.destroy(),delete t.extensions[Kb]}const $0="EXT_meshopt_compression";function N5(t,e){if(!t.extensions||!t.extensions[$0])return;const r=t.extensions[$0],s=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),u=new Uint8Array(r.count*r.byteStride);Yb.decodeGltfBuffer(u,r.count,r.byteStride,s,r.mode,r.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=u.buffer,delete t.extensions[$0]}const LC=1179937895,zC=new TextDecoder("utf8");function FC(t,e){return new URL(t,e).href}function U5(t,e,r,s){return fetch(FC(t.uri,s)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[r]=u})}function BC(t,e){const r=t.json.bufferViews[e];return new Uint8Array(t.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function j5(t,e,r,s){if(t.uri){const u=FC(t.uri,s);return fetch(u).then(f=>f.blob()).then(f=>createImageBitmap(f)).then(f=>{e.images[r]=f})}if(t.bufferView!==void 0){const u=BC(e,t.bufferView),f=new Blob([u],{type:t.mimeType});return createImageBitmap(f).then(d=>{e.images[r]=d})}}function NC(t,e=0,r){const s={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===LC){const E=new Uint32Array(t,e);let A=2;const C=(E[A++]>>2)-3,k=E[A++]>>2;if(A++,s.json=JSON.parse(zC.decode(E.subarray(A,A+k))),A+=k,A<C){const L=E[A++];A++;const F=e+(A<<2);s.buffers[0]=t.slice(F,F+L)}}else s.json=JSON.parse(zC.decode(new Uint8Array(t,e)));const{buffers:u,images:f,meshes:d,extensionsUsed:g,bufferViews:v}=s.json;let T=Promise.resolve();if(u){const E=[];for(let A=0;A<u.length;A++){const C=u[A];C.uri?E.push(U5(C,s,A,r)):s.buffers[A]||(s.buffers[A]=null)}T=Promise.all(E)}return T.then(()=>{const E=[],A=g&&g.includes(Kb),C=g&&g.includes($0);if(A&&E.push(function(){if(!Qa)return j0||(j0=function(k){let L,F=null;function N(){L=new Uint8Array(F.buffer)}function G(){throw new Error("Unexpected Draco error.")}const ne={a:{a:G,d:function(ie,oe,me){return L.copyWithin(ie,oe,oe+me)},c:function(ie){const oe=L.length,me=Math.max(ie>>>0,Math.ceil(1.2*oe)),pe=Math.ceil((me-oe)/65536);try{return F.grow(pe),N(),!0}catch{return!1}},b:G}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(k,ne):k.then(ie=>ie.arrayBuffer()).then(ie=>WebAssembly.instantiate(ie,ne))).then(ie=>{const{Rb:oe,Qb:me,P:pe,T:Ee,X:De,Ja:je,La:Qe,Qa:Ze,Va:ut,Wa:vt,eb:ot,jb:mt,f:tt,e:_t,yb:bt,zb:gt,Ab:zt,Bb:xt,Db:Tt,Gb:Jt}=ie.instance.exports;F=_t;const Yt=(()=>{let Xt=0,wt=0,tr=0,wr=0;return fr=>{tr&&(oe(wr),oe(Xt),wt+=tr,tr=Xt=0),Xt||(wt+=128,Xt=me(wt));const Mr=fr.length+7&-8;let Tr=Xt;Mr>=wt&&(tr=Mr,Tr=wr=me(Mr));for(let Or=0;Or<fr.length;Or++)L[Tr+Or]=fr[Or];return Tr}})();return N(),tt(),{memory:_t,_free:oe,_malloc:me,Mesh:class{constructor(){this.ptr=pe()}destroy(){Ee(this.ptr)}},Decoder:class{constructor(){this.ptr=je()}destroy(){mt(this.ptr)}DecodeArrayToMesh(Xt,wt,tr){const wr=Yt(Xt),fr=Qe(this.ptr,wr,wt,tr.ptr);return!!De(fr)}GetAttributeByUniqueId(Xt,wt){return{ptr:Ze(this.ptr,Xt.ptr,wt)}}GetTrianglesUInt16Array(Xt,wt,tr){ut(this.ptr,Xt.ptr,wt,tr)}GetTrianglesUInt32Array(Xt,wt,tr){vt(this.ptr,Xt.ptr,wt,tr)}GetAttributeDataArrayForAllPoints(Xt,wt,tr,wr,fr){ot(this.ptr,Xt.ptr,wt.ptr,tr,wr,fr)}},DT_INT8:bt(),DT_UINT8:gt(),DT_INT16:zt(),DT_UINT16:xt(),DT_UINT32:Tt(),DT_FLOAT32:Jt()}})}(fetch(DC())),j0.then(k=>{Qa=k,j0=void 0}))}()),C&&E.push(function(){if(Yb)return;const k=function(L){let F;const N=WebAssembly.instantiateStreaming(L,{}).then(ie=>{F=ie.instance,F.exports.__wasm_call_ctors()}),G={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ne={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:N,supported:!0,decodeGltfBuffer(ie,oe,me,pe,Ee,De){(function(je,Qe,Ze,ut,vt,ot,mt){const tt=je.exports.sbrk,_t=ut+3&-4,bt=tt(_t*vt),gt=tt(ot.length),zt=new Uint8Array(je.exports.memory.buffer);zt.set(ot,gt);const xt=Qe(bt,ut,vt,gt,ot.length);if(xt===0&&mt&&mt(bt,_t,vt),Ze.set(zt.subarray(bt,bt+ut*vt)),tt(bt-tt(0)),xt!==0)throw new Error(`Malformed buffer data: ${xt}`)})(F,F.exports[ne[Ee]],ie,oe,me,pe,F.exports[G[De]])}}}(fetch(RC()));return k.ready.then(()=>{Yb=k})}()),f)for(let k=0;k<f.length;k++)E.push(j5(f[k],s,k,r));return(E.length?Promise.all(E):Promise.resolve()).then(()=>{if(A&&d)for(const{primitives:k}of d)for(const L of k)B5(L,s);if(C&&d&&v)for(const k of v)N5(k,s);return s})})}function Yh(t,e){const r=t.json.bufferViews[e.bufferView],s=V0[e.componentType];return new s(t.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==b_[e.type]*s.BYTES_PER_ELEMENT?r.byteStride/s.BYTES_PER_ELEMENT:b_[e.type]))}function Qb(t,e,r,s){const u=V0[e.componentType],f=function(E){switch(E){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(u),d=t.json.bufferViews[e.bufferView],g=d.byteStride?d.byteStride/u.BYTES_PER_ELEMENT:b_[e.type],v=r.float32,T=v.length/r.capacity;for(let E=0,A=0;E<e.count*g;E+=g,A+=T)for(let C=0;C<T;C++)v[A+C]=s[E+C]*f;r._trim()}function V5(t,e,r){const s=t.indices,u=t.attributes,f={};f.indexArray=new Si;const d=e.json.accessors[s],g=d.count/3;f.indexArray.reserve(g);const v=Yh(e,d);for(let C=0;C<g;C++)f.indexArray.emplaceBack(v[3*C],v[3*C+1],v[3*C+2]);f.indexArray._trim(),f.vertexArray=new uc;const T=e.json.accessors[u.POSITION];f.vertexArray.reserve(T.count);const E=Yh(e,T);for(let C=0;C<T.count;C++)f.vertexArray.emplaceBack(E[3*C],E[3*C+1],E[3*C+2]);if(f.vertexArray._trim(),f.aabb=new Tn(T.min,T.max),f.centroid=function(C,k){const L=[0,0,0],F=C.length;if(F>0){for(let N=0;N<F;N++){const G=3*C[N];L[0]+=k[G],L[1]+=k[G+1],L[2]+=k[G+2]}L[0]/=F,L[1]/=F,L[2]/=F}return L}(v,E),u.COLOR_0!==void 0){const C=e.json.accessors[u.COLOR_0],k=b_[C.type],L=Yh(e,C);f.colorArray=k===3?new uc:new lc,f.colorArray.resize(C.count),Qb(e,C,f.colorArray,L)}if(u.NORMAL!==void 0){f.normalArray=new uc;const C=e.json.accessors[u.NORMAL];f.normalArray.resize(C.count);const k=Yh(e,C);Qb(e,C,f.normalArray,k)}if(u.TEXCOORD_0!==void 0&&r.length>0){f.texcoordArray=new dd;const C=e.json.accessors[u.TEXCOORD_0];f.texcoordArray.resize(C.count);const k=Yh(e,C);Qb(e,C,f.texcoordArray,k)}if(u._FEATURE_ID_RGBA4444!==void 0){const C=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(f.featureData=Yh(e,C))}u._FEATURE_RGBA4444!==void 0&&(f.featureData=new Uint32Array(Yh(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));const A=t.material;return f.material=function(C,k){const{emissiveFactor:L=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:N=.5,normalTexture:G,occlusionTexture:ne,emissiveTexture:ie,doubleSided:oe}=C,{baseColorFactor:me=[1,1,1,1],metallicFactor:pe=1,roughnessFactor:Ee=1,baseColorTexture:De,metallicRoughnessTexture:je}=C.pbrMetallicRoughness||{},Qe=ne?k[ne.index]:void 0;if(ne&&ne.extensions&&ne.extensions.KHR_texture_transform&&Qe){const Ze=ne.extensions.KHR_texture_transform;Qe.offsetScale=[Ze.offset[0],Ze.offset[1],Ze.scale[0],Ze.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Gr(...me),metallicFactor:pe,roughnessFactor:Ee,baseColorTexture:De?k[De.index]:void 0,metallicRoughnessTexture:je?k[je.index]:void 0},doubleSided:oe,emissiveFactor:L,alphaMode:F,alphaCutoff:N,normalTexture:G?k[G.index]:void 0,occlusionTexture:Qe,emissionTexture:ie?k[ie.index]:void 0,defined:C.defined===void 0}}(A!==void 0?e.json.materials[A]:{defined:!1},r),f}function UC(t,e,r){const{matrix:s,rotation:u,translation:f,scale:d,mesh:g,extras:v,children:T}=t,E={};if(E.matrix=s||o.ad.fromRotationTranslationScale([],u||[0,0,0,1],f||[0,0,0],d||[1,1,1]),g!==void 0){E.meshes=r[g];const A=E.anchor=[0,0];for(const C of E.meshes){const{min:k,max:L}=C.aabb;A[0]+=k[0]+L[0],A[1]+=k[1]+L[1]}A[0]=Math.floor(A[0]/E.meshes.length/2),A[1]=Math.floor(A[1]/E.meshes.length/2)}if(v&&(v.id&&(E.id=v.id),v.lights&&(E.lights=function(A){if(!A.length)return[];const C=function(G){const ne=atob(G),ie=new Uint8Array(ne.length);for(let oe=0;oe<ne.length;oe++)ie[oe]=ne.codePointAt(oe);return ie}(A),k=[],L=C.length/24,F=new Uint16Array(C.buffer),N=new Float32Array(C.buffer);for(let G=0;G<L;G++){const ne=F[2*G*6]/30,ie=F[2*G*6+1]/30,oe=F[2*G*6+10]/100,me=N[6*G+1],pe=N[6*G+2],Ee=N[6*G+3],De=N[6*G+4],je=Ee-me,Qe=De-pe,Ze=Math.hypot(je,Qe);k.push({pos:[me+.5*je,pe+.5*Qe,ie],normal:[Qe/Ze,-je/Ze,0],width:Ze,height:ne,depth:oe,points:[me,pe,Ee,De]})}return k}(v.lights))),T){const A=[];for(const C of T)A.push(UC(e.json.nodes[C],e,r));E.children=A}return E}function $5(t){if(t.vertices.length===0||t.indices.length===0)return null;const e=new _b(t.vertices,t.indices,8,256),[r,s]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:r,max:s}}function G5(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;const s=[];for(const d of r){if(!Array.isArray(d)||d.length!==2)continue;const g=d[0],v=d[1];typeof g=="number"&&typeof v=="number"&&s.push(new Mt(g,v))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let u=0;for(let d=0;d<s.length;d++){const g=s[d],v=s[(d+1)%s.length],T=s[(d+2)%s.length];u+=(g.x-v.x)*(T.y-v.y)-(T.x-v.x)*(g.y-v.y)}u>0&&s.reverse();const f=Km(s.flatMap(d=>[d.x,d.y]),[]);return f.length===0?null:{vertices:s,indices:f}}function W5(t,e){const r=[],s=[];let u=0;const f=[];for(const d of t){u=r.length;const g=d.vertexArray.float32,v=d.indexArray.uint16;for(let T=0;T<d.vertexArray.length;T++)f[0]=g[3*T+0],f[1]=g[3*T+1],f[2]=g[3*T+2],o._.transformMat4(f,f,e),r.push(new Mt(f[0],f[1]));for(let T=0;T<3*d.indexArray.length;T++)s.push(v[T]+u)}if(s.length%3!=0)return null;for(let d=0;d<s.length;d+=3){const g=r[s[d+0]],v=r[s[d+1]],T=r[s[d+2]];(g.x-v.x)*(T.y-v.y)-(T.x-v.x)*(g.y-v.y)>0&&([s[d+1],s[d+2]]=[s[d+2],s[d+1]])}return{vertices:r,indices:s}}function jC(t){const e=function(v,T){const E=[],A=WebGL2RenderingContext;if(v.json.textures)for(const C of v.json.textures){const k={magFilter:A.LINEAR,minFilter:A.NEAREST,wrapS:A.REPEAT,wrapT:A.REPEAT};C.sampler!==void 0&&Object.assign(k,v.json.samplers[C.sampler]),E.push({image:T[C.source],sampler:k,uploaded:!1})}return E}(t,t.images),r=function(v,T){const E=[];for(const A of v.json.meshes){const C=[];for(const k of A.primitives)C.push(V5(k,v,T));E.push(C)}return E}(t,e),{scenes:s,scene:u,nodes:f}=t.json,d=s?s[u||0].nodes:f,g=[];for(const v of d)g.push(UC(f[v],t,r));return function(v,T,E){const A={},C=new Set;for(let k=0;k<v.length;k++){const L=E[T[k]];if(!L.extras)continue;const F=L.extras["mapbox:footprint:version"],N=L.extras["mapbox:footprint:id"];(F||N)&&C.add(k),F==="1.0.0"&&N&&(A[N]=k)}for(let k=0;k<v.length;k++){if(C.has(k))continue;const L=v[k],F=E[T[k]];if(!F.extras)continue;let N=null;L.id in A&&(N=W5(v[A[L.id]].meshes,L.matrix)),N||(N=G5(F)),N&&(L.footprint=$5(N))}if(C.size>0){const k=Array.from(C.values()).sort((L,F)=>L-F);for(let L=k.length-1;L>=0;L--)v.splice(k[L],1)}}(g,d,t.json.nodes),g}function q5(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,r=t.aabb.min[0]-1,s=t.aabb.min[1]-1,u=Xh/(t.aabb.max[0]-r+2),f=Xh/(t.aabb.max[1]-s+2);for(let d=0;d<e.length;d+=3){const g=e[d+2],v=(e[d+0]-r)*u|0,T=(e[d+1]-s)*f|0;g>t.heightmap[T*Xh+v]&&(t.heightmap[T*Xh+v]=g)}}function H5(t,e){const r={};r.indexArray=new Si,r.indexArray.reserve(4*t.length),r.vertexArray=new uc,r.vertexArray.reserve(10*t.length),r.colorArray=new lc,r.vertexArray.reserve(10*t.length);let s=0;for(const d of t){const g=Math.min(10,Math.max(4,1.3*d.height))*e,v=[-d.normal[1],d.normal[0],0],T=Math.min(.29,.1*d.width/d.depth),E=d.width-2*d.depth*e*(T+.01),A=o._.scaleAndAdd([],d.pos,v,E/2),C=o._.scaleAndAdd([],d.pos,v,-E/2),k=[A[0],A[1],A[2]+d.height],L=[C[0],C[1],C[2]+d.height],F=o._.scaleAndAdd([],d.normal,v,T);o._.scale(F,F,g);const N=o._.scaleAndAdd([],d.normal,v,-T);o._.scale(N,N,g),o._.add(F,A,F),o._.add(N,C,N),A[2]+=.1,C[2]+=.1,r.vertexArray.emplaceBack(F[0],F[1],F[2]),r.vertexArray.emplaceBack(N[0],N[1],N[2]),r.vertexArray.emplaceBack(A[0],A[1],A[2]),r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(k[0],k[1],k[2]),r.vertexArray.emplaceBack(L[0],L[1],L[2]),r.vertexArray.emplaceBack(A[0],A[1],A[2]),r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(F[0],F[1],F[2]),r.vertexArray.emplaceBack(N[0],N[1],N[2]);const G=E/g/2;r.colorArray.emplaceBack(-G-T,-1,G,.8),r.colorArray.emplaceBack(G+T,-1,G,.8),r.colorArray.emplaceBack(-G,0,G,1.3),r.colorArray.emplaceBack(G,0,G,1.3),r.colorArray.emplaceBack(G+T,-.8,G,.7),r.colorArray.emplaceBack(G+T,-.8,G,.7),r.colorArray.emplaceBack(0,0,G,1.3),r.colorArray.emplaceBack(0,0,G,1.3),r.colorArray.emplaceBack(G+T,-1.2,G,.8),r.colorArray.emplaceBack(G+T,-1.2,G,.8),r.indexArray.emplaceBack(6+s,4+s,8+s),r.indexArray.emplaceBack(7+s,9+s,5+s),r.indexArray.emplaceBack(0+s,1+s,2+s),r.indexArray.emplaceBack(1+s,3+s,2+s),s+=10}const u={defined:!0,emissiveFactor:[0,0,0]},f={};return f.baseColorFactor=Gr.white,u.pbrMetallicRoughness=f,r.material=u,r.aabb=new Tn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}const Jb=new Float32Array(262144),Kh=new Uint8Array(262144);function VC(t){let e=0;if(t.meshes)for(const r of t.meshes)e=Math.max(e,r.aabb.max[2]);if(t.children)for(const r of t.children)e=Math.max(e,VC(r));return e}function $C(t,e,r){if(t.meshes)for(const s of t.meshes)s.aabb.min[0]!==1/0&&r.insert(e,s.aabb.min[0],s.aabb.min[1],s.aabb.max[0],s.aabb.max[1]);if(t.children)for(const s of t.children)$C(s,e,r)}const GC=["","wall","door","roof","window","lamp","logo"];class WC{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:VC(e)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new Tn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const r=new Tn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.node.meshes)this.node.lightMeshIndex!==e&&(s.transformedAabb=Tn.applyTransformFast(s.aabb,this.node.matrix),r.encapsulate(s.transformedAabb)),e++;this.aabb=r}return this.aabb}}class G0{constructor(e,r,s,u,f,d){this.id=r,this.modelTraits|=kd.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,s&&(this.modelTraits|=kd.HasMapboxMeshFeatures),u&&(this.modelTraits|=kd.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=f,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const g of e)this.nodesInfo.push(new WC(g)),$C(g,d.featureIndexArray.length,d.grid),d.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,d.bucketLayerIDs.length-1,0)}updateFootprints(e,r){for(const s of this.getNodesInfo()){const u=s.node;u.footprint&&r.push({footprint:u.footprint,id:e})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const s of r){const u=s.node;this.uploaded?this.updatePbrBuffer(u):qb(u,e,!0)}for(const s of r)N0(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(const s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),r=!0);return r}needsReEvaluation(e,r,s){const u=e.transform.projectionOptions,f=e.style.getBrightness(),d=this.brightness!==f;return!!(!this.uploaded||this.dirty||u.name!==this.projection.name||w_(s.paint.get("model-color").value,d)||w_(s.paint.get("model-color-mix-intensity").value,d)||w_(s.paint.get("model-roughness").value,d)||w_(s.paint.get("model-emissive-strength").value,d)||w_(s.paint.get("model-height-based-emissive-strength-multiplier").value,d))&&(this.projection=u,this.brightness=f,!0)}evaluateScale(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const s=this.getNodesInfo(),u=this.id.canonical;for(const f of s){const d=f.feature;f.evaluatedScale=r.paint.get("model-scale").evaluate(d,{},u)}}evaluate(e){const r=this.getNodesInfo();for(const s of r){if(!s.node.meshes)continue;const u=s.feature,f=s.node.meshes&&s.node.meshes[0].featureData,d=s.evaluatedColor[2],g=s.evaluatedRMEA[2],v=this.id.canonical;if(s.hasTranslucentParts=!1,f){for(let T=0;T<GC.length;T++){const E=GC[T];E.length&&(u.properties.part=E);const A=e.paint.get("model-color").evaluate(u,{},v).toRenderColor(null),C=e.paint.get("model-color-mix-intensity").evaluate(u,{},v);s.evaluatedColor[T]=[A.r,A.g,A.b,C],s.evaluatedRMEA[T][0]=e.paint.get("model-roughness").evaluate(u,{},v),s.evaluatedRMEA[T][2]=e.paint.get("model-emissive-strength").evaluate(u,{},v),s.evaluatedRMEA[T][3]=A.a,s.emissionHeightBasedParams[T]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,{},v),!s.hasTranslucentParts&&A.a<1&&(s.hasTranslucentParts=!0)}delete u.properties.part,X5(s,d!==s.evaluatedColor[2]||g!==s.evaluatedRMEA[2],this.modelTraits)}else s.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,{},v);s.evaluatedScale=e.paint.get("model-scale").evaluate(u,{},v),this.updatePbrBuffer(s.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,s,u){const f=e.findDEMTileFor(s);if(f&&(f.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const d=wd.create(e,s,f);if(!d)return;this.modelTraits&kd.HasMapboxMeshFeatures&&this.updateDEM(e,d,s,u);for(const g of this.getNodesInfo()){const v=g.node;if(!v.footprint||!v.footprint.vertices||!v.footprint.vertices.length)continue;const T=v.footprint.vertices;let E=d.getElevationAt(T[0].x,T[0].y,!0,!0);for(let A=1;A<T.length;A++)E=Math.min(E,d.getElevationAt(T[A].x,T[A].y,!0,!0));v.elevation=E}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,s,u){let f=r._dem._modifiedForSources[u];if(f===void 0&&(r._dem._modifiedForSources[u]=[],f=r._dem._modifiedForSources[u]),f.includes(s.canonical))return;const d=r._dem.dim;f.push(s.canonical);let g=!1;for(const v of this.getNodesInfo()){const T=v.node;if(!T.footprint||!T.footprint.grid)continue;const E=T.footprint.grid,A=r.tileCoordToPixel(E.min.x,E.min.y),C=r.tileCoordToPixel(E.max.x,E.max.y),k=Math.min(Math.min(d-C.y,A.x),Math.min(A.y,d-C.x));if(k<0)continue;const L=Kt(k,2,5);let F=Math.max(0,A.x-L),N=Math.max(0,A.y-L),G=Math.min(C.x+L,d-1),ne=Math.min(C.y+L,d-1);for(let pe=N;pe<=ne;++pe)for(let Ee=F;Ee<=G;++Ee)Kh[pe*d+Ee]=255;let ie=0,oe=0;for(let pe=0;pe<E.cellsY;++pe)for(let Ee=0;Ee<E.cellsX;++Ee){if(!E.cells[pe*E.cellsX+Ee])continue;const De=r.tileCoordToPixel(E.min.x+Ee/E.xScale,E.min.y+pe/E.yScale),je=r.tileCoordToPixel(E.min.x+(Ee+1)/E.xScale,E.min.y+(pe+1)/E.yScale);for(let Qe=De.y;Qe<=Math.min(je.y+1,d-1);++Qe)for(let Ze=De.x;Ze<=Math.min(je.x+1,d-1);++Ze)Kh[Qe*d+Ze]===255&&(Kh[Qe*d+Ze]=0,ie+=r.getElevationAtPixel(Ze,Qe),oe++)}const me=ie/oe;F=Math.max(1,A.x-L),N=Math.max(1,A.y-L),G=Math.min(C.x+L,d-2),ne=Math.min(C.y+L,d-2),g=!0;for(let pe=N;pe<=ne;++pe)for(let Ee=F;Ee<=G;++Ee)Kh[pe*d+Ee]===0&&(Jb[pe*d+Ee]=r._dem.set(Ee,pe,me));for(let pe=1;pe<L;++pe){F=Math.max(1,A.x-pe),N=Math.max(1,A.y-pe),G=Math.min(C.x+pe,d-2),ne=Math.min(C.y+pe,d-2);for(let Ee=N;Ee<=ne;++Ee)for(let De=F;De<=G;++De){const je=Ee*d+De;if(Kh[je]===255){let Qe=0,Ze=0,ut=-1,vt=-1;for(let ot=-1;ot<=1;++ot)for(let mt=-1;mt<=1;++mt){const tt=(Ee+ot)*d+De+mt;if(Kh[tt]>=pe)continue;const _t=Jb[tt],bt=Math.abs(_t);bt>Ze&&(Qe=_t,Ze=bt,ut=mt,vt=ot)}if(Ze>.1){const ot=1-(pe+.5*Math.abs(ut*vt))/L;let mt=r._dem.get(De,Ee)+Qe*ot;const tt=r._dem.get(De+ut,Ee+vt),_t=r._dem.get(De-ut,Ee-vt,!0);(mt-tt)*(mt-_t)>0&&(mt=(tt+_t)/2),Jb[je]=r._dem.set(De,Ee,mt),Kh[je]=pe}}}}}g&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=Pi.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const r of e)N0(r.node),Hb(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const s=r.getReplacementRegionsForTile(e.toUnwrapped()),u=this.getNodesInfo();for(let f=0;f<this.nodesInfo.length;f++){const d=u[f].node;u[f].hiddenByReplacement=!!d.footprint&&!s.find(g=>g.footprint===d.footprint)}}getHeightAtTileCoord(e,r){const s=this.getNodesInfo(),u=[],f=[0,0,0],d=o.ad.identity([]);for(let g=0;g<this.nodesInfo.length;g++){const v=s[g],T=v.node.meshes[0],E=T.transformedAabb;if(e<E.min[0]||r<E.min[1]||e>E.max[0]||r>E.max[1])continue;if(v.node.hidden===!0)return{height:0,maxHeight:v.feature.properties.height,hidden:!1,verticalScale:v.evaluatedScale[2]};o.ad.invert(d,v.node.matrix),f[0]=e,f[1]=r,o._.transformMat4(f,f,d);const A=(f[0]-T.aabb.min[0])/(T.aabb.max[0]-T.aabb.min[0])*Xh|0,C=Math.min(63,(f[1]-T.aabb.min[1])/(T.aabb.max[1]-T.aabb.min[1])*Xh|0)*Xh+Math.min(63,A),k=T.heightmap[C];if(!(k<0&&v.node.footprint))return v.hiddenByReplacement?void 0:{height:k,maxHeight:v.feature.properties.height,hidden:!1,verticalScale:v.evaluatedScale[2]};if(v.node.footprint.grid.query(new Mt(e,r),new Mt(e,r),u),u.length>0)return{height:void 0,maxHeight:v.feature.properties.height,hidden:v.hiddenByReplacement,verticalScale:v.evaluatedScale[2]}}}}function w_(t,e){return!t.isLightConstant&&e}function Z5(t,e,r,s,u,f,d,g){let v=(61440&e|(61440&e)>>4)>>8,T=(3840&e|(3840&e)>>4)>>4,E=240&e|(240&e)>>4;r[3]>0&&(v=nr(v,255*r[0],r[3]),T=nr(T,255*r[1],r[3]),E=nr(E,255*r[2],r[3]));const A=v<<8|T,C=E<<8|Math.floor(255*s[3]),k=function(pe){const Ee=Kt(pe,0,2);return Math.min(Math.round(.5*Ee*255),255)}(s[2])<<8|15*s[0]<<4|15*s[1],L=Kt(u[0],0,1),F=Kt(u[1],0,1),N=Kt(u[2],0,1),G=Kt(u[3],0,1);let ne,ie,oe,me;if(L!==F&&d!==f&&F!==L){const pe=d-f;ie=1/(pe*(F-L)),oe=-(f+pe*L)/(pe*(F-L));const Ee=Kt(u[4],-1,1);me=Math.pow(10,Ee),ne=255*N<<8|255*G}else ne=65535,ie=0,oe=1,me=1;if(t.emplaceBack(A,C,k,ne,ie,oe,me),g){const pe=g.length;g.clear();for(let Ee=0;Ee<pe;Ee++)g.emplaceBack(A,C,k,ne,ie,oe,me)}}function X5(t,e,r){const s=t.node;let u=0;const f=r&kd.HasMeshoptCompression;for(const d of s.meshes){if(s.lights&&s.lightMeshIndex===u||!d.featureData)continue;d.featureArray=new Gy,d.featureArray.reserve(d.featureData.length);let g=e;for(const v of d.featureData){const T=f?65535&v:v>>16&65535,E=f?v>>16&65535:65535&v,A=(15&E)<8?15&E:0,C=t.evaluatedRMEA[A],k=t.evaluatedColor[A],L=t.emissionHeightBasedParams[A];let F;if(g&&A===2&&s.lights&&(F=new Gy,F.resize(10*s.lights.length)),Z5(d.featureArray,T,k,C,L,d.aabb.min[2],d.aabb.max[2],F),F&&g){g=!1;const N=s.meshes[s.lightMeshIndex];N.featureArray=F,N.featureArray._trim()}}d.featureArray._trim(),u++}}function qC(t,e,r,s){const u=1<<t.z;e.lat=Di((s/At+t.y)/u),e.lng=Ho((r/At+t.x)/u)}ee(G0,"Tiled3dModelBucket",{omit:["layers"]}),ee(WC,"Tiled3dModelFeature");const Y5={circle:class extends Ui{constructor(t,e,r,s){super(t,C4,e,r,s)}createBucket(t){return new Q1(t)}queryRadius(t){const e=t;return vd("circle-radius",this,e)+vd("circle-stroke-width",this,e)+Yy(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,r,s,u,f,d,g){const v=rI(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return gI(t,s,f,d,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",v,T)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e,r){const s=_I(this);return{config:new Uh(this,{zoom:e,lut:r}),defines:s,overrideFog:!1}}},heatmap:class extends Ui{createBucket(t){return new vI(t)}constructor(t,e,r,s){super(t,U4,e,r,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ym({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return vd("heatmap-radius",this,t)}queryIntersectsFeature(t,e,r,s,u,f,d,g){const v=this.paint.get("heatmap-radius").evaluate(e,r);return gI(t,s,f,d,g,!0,!0,new Mt(0,0),v)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e,r){return t==="heatmap"?{config:new Uh(this,{zoom:e,lut:r}),overrideFog:!1}:{}}},hillshade:class extends Ui{constructor(t,e,r,s){super(t,V4,e,r,s)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e,r){return{overrideFog:!1}}},fill:class extends Ui{constructor(t,e,r,s){super(t,rF,e,r,s)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(t,e,r){return{config:new Uh(this,{zoom:e,lut:r}),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new o0(t)}queryRadius(){return Yy(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,r,s,u,f){return!t.queryGeometry.isAboveHorizon&&KM(tI(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Ui{constructor(t,e,r,s){super(t,DF,e,r,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new f0(t)}queryRadius(){return Yy(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,r,s,u,f,d,g,v){const T=rI(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(e,r),A=this.paint.get("fill-extrusion-base").evaluate(e,r),C=[0,0],k=g&&f.elevation,L=f.elevation?f.elevation.exaggeration():1,F=t.tile.getBucket(this);if(k&&F instanceof f0){const oe=F.centroidVertexArray,me=v+1;me<oe.length&&(C[0]=oe.geta_centroid_pos0(me),C[1]=oe.geta_centroid_pos1(me))}if(C[0]===0&&C[1]===1)return!1;f.projection.name==="globe"&&(s=sA([s],[new Mt(0,0),new Mt(At,At)],t.tileID.canonical).map(oe=>oe.polygon).flat());const N=k?g:null,[G,ne]=function(oe,me,pe,Ee,De,je,Qe,Ze,ut,vt,ot){return oe.projection.name==="globe"?function(mt,tt,_t,bt,gt,zt,xt,Tt,Jt,Yt,Xt){const wt=[],tr=[],wr=mt.projection.upVectorScale(Xt,mt.center.lat,mt.worldSize).metersToTile,fr=[0,0,0,1],Mr=[0,0,0,1],Tr=(ur,nn,tn,qr)=>{ur[0]=nn,ur[1]=tn,ur[2]=qr,ur[3]=1},Or=oA();_t>0&&(_t+=Or),bt+=Or;for(const ur of tt){const nn=[],tn=[];for(const qr of ur){const Nr=qr.x+gt.x,Hr=qr.y+gt.y,gn=mt.projection.projectTilePoint(Nr,Hr,Xt),un=mt.projection.upVector(Xt,qr.x,qr.y);let Cn=_t,An=bt;if(xt){const to=lA(Nr,Hr,_t,bt,xt,Tt,Jt,Yt);Cn+=to.base,An+=to.top}_t!==0?Tr(fr,gn.x+un[0]*wr*Cn,gn.y+un[1]*wr*Cn,gn.z+un[2]*wr*Cn):Tr(fr,gn.x,gn.y,gn.z),Tr(Mr,gn.x+un[0]*wr*An,gn.y+un[1]*wr*An,gn.z+un[2]*wr*An),o._.transformMat4(fr,fr,zt),o._.transformMat4(Mr,Mr,zt),nn.push(new Wh(fr[0],fr[1],fr[2])),tn.push(new Wh(Mr[0],Mr[1],Mr[2]))}wt.push(nn),tr.push(tn)}return[wt,tr]}(oe,me,pe,Ee,De,je,Qe,Ze,ut,vt,ot):Qe?function(mt,tt,_t,bt,gt,zt,xt,Tt,Jt){const Yt=[],Xt=[],wt=[0,0,0,1];for(const tr of mt){const wr=[],fr=[];for(const Mr of tr){const Tr=Mr.x+bt.x,Or=Mr.y+bt.y,ur=lA(Tr,Or,tt,_t,zt,xt,Tt,Jt);wt[0]=Tr,wt[1]=Or,wt[2]=ur.base,wt[3]=1,o.aA.transformMat4(wt,wt,gt),wt[3]=Math.max(wt[3],1e-5);const nn=new Wh(wt[0]/wt[3],wt[1]/wt[3],wt[2]/wt[3]);wt[0]=Tr,wt[1]=Or,wt[2]=ur.top,wt[3]=1,o.aA.transformMat4(wt,wt,gt),wt[3]=Math.max(wt[3],1e-5);const tn=new Wh(wt[0]/wt[3],wt[1]/wt[3],wt[2]/wt[3]);wr.push(nn),fr.push(tn)}Yt.push(wr),Xt.push(fr)}return[Yt,Xt]}(me,pe,Ee,De,je,Qe,Ze,ut,vt):function(mt,tt,_t,bt,gt){const zt=[],xt=[],Tt=gt[8]*tt,Jt=gt[9]*tt,Yt=gt[10]*tt,Xt=gt[11]*tt,wt=gt[8]*_t,tr=gt[9]*_t,wr=gt[10]*_t,fr=gt[11]*_t;for(const Mr of mt){const Tr=[],Or=[];for(const ur of Mr){const nn=ur.x+bt.x,tn=ur.y+bt.y,qr=gt[0]*nn+gt[4]*tn+gt[12],Nr=gt[1]*nn+gt[5]*tn+gt[13],Hr=gt[2]*nn+gt[6]*tn+gt[14],gn=gt[3]*nn+gt[7]*tn+gt[15],un=qr+Tt,Cn=Nr+Jt,An=Hr+Yt,to=Math.max(gn+Xt,1e-5),Fn=qr+wt,En=Nr+tr,ei=Hr+wr,Ri=Math.max(gn+fr,1e-5);Tr.push(new Wh(un/to,Cn/to,An/to)),Or.push(new Wh(Fn/Ri,En/Ri,ei/Ri))}zt.push(Tr),xt.push(Or)}return[zt,xt]}(me,pe,Ee,De,je)}(f,s,A,E,T,d,N,C,L,f.center.lat,t.tileID.canonical),ie=t.queryGeometry;return function(oe,me,pe){let Ee=1/0;KM(pe,me)&&(Ee=aA(pe,me[0]));for(let De=0;De<me.length;De++){const je=me[De],Qe=oe[De];for(let Ze=0;Ze<je.length-1;Ze++){const ut=je[Ze],vt=[ut,je[Ze+1],Qe[Ze+1],Qe[Ze],ut];J1(pe,vt)&&(Ee=Math.min(Ee,aA(pe,vt)))}}return Ee!==1/0&&Ee}(G,ne,ie.isPointQuery()?ie.screenBounds:ie.screenGeometry)}},line:class extends Ui{constructor(t,e,r,s){super(t,p0,e,r,s),p0.layout&&(this.layout=new pn(p0.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ou,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=pC.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new d0(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e,r){const s=_A(this);return{config:new Uh(this,{zoom:e,lut:r}),defines:s,overrideFog:!1}}queryRadius(t){const e=t,r=mC(vd("line-width",this,e),vd("line-gap-width",this,e)),s=vd("line-offset",this,e);return r/2+Math.abs(s)+Yy(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,r,s,u,f){if(t.queryGeometry.isAboveHorizon)return!1;const d=tI(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),g=t.pixelToTileUnitsFactor/2*mC(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),v=this.paint.get("line-offset").evaluate(e,r);return v&&(s=function(T,E){const A=[],C=new Mt(0,0);for(let k=0;k<T.length;k++){const L=T[k],F=[];for(let N=0;N<L.length;N++){const G=L[N],ne=L[N+1],ie=N===0?C:G.sub(L[N-1])._unit()._perp(),oe=N===L.length-1?C:ne.sub(G)._unit()._perp(),me=ie._add(oe)._unit();me._mult(1/(me.x*oe.x+me.y*oe.y)),F.push(me._mult(E)._add(G))}A.push(F)}return A}(s,v*t.pixelToTileUnitsFactor)),function(T,E,A){for(let C=0;C<E.length;C++){const k=E[C];if(T.length>=3){for(let L=0;L<k.length;L++)if(mc(T,k[L]))return!0}if(E4(T,k,A))return!0}return!1}(d,s,g)}isTileClipped(){return!0}isDraped(t){const e=this.layout.get("line-z-offset");return e.isConstant()&&!e.constantOr(0)}},symbol:R0,background:class extends Ui{constructor(t,e,r,s){super(t,p5,e,r,s)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e,r){return{overrideFog:!1}}},raster:vC,"raster-particle":xC,sky:class extends Ui{constructor(t,e,r,s){super(t,w5,e,r,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ym({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),u=!s,f=t.style.light,d=f.properties.get("position");return u&&f.properties.get("anchor")==="viewport"&&zn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?$b(d.azimuthal,90-d.polar,e):$b(s[0],90-s[1],e)}const r=this.paint.get("sky-gradient-center");return $b(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends Ui{constructor(t,e,r,s){super(t,T5,e,null)}},model:class extends Ui{constructor(t,e,r,s){super(t,D5,e,r,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new Wb(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof G0?At-1:0}queryIntersectsFeature(t,e,r,s,u,f){if(!this.modelManager)return!1;const d=this.modelManager,g=t.tile.getBucket(this);if(!(g&&g instanceof Wb))return!1;const v=g;for(const T in v.instancesPerModel){const E=v.instancesPerModel[T],A=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(E.idToFeaturesIndex.hasOwnProperty(A)){const C=E.features[E.idToFeaturesIndex[A]],k=d.getModel(T,this.scope);if(!k)return!1;let L=o.ad.create();const F=new Vr(0,0),N=v.canonical;let G=Number.MAX_VALUE;for(let ne=0;ne<C.instancedDataCount;++ne){const ie=16*(C.instancedDataOffset+ne),oe=E.instancedDataArray.float32,me=[oe[ie+4],oe[ie+5],oe[ie+6]];qC(N,F,oe[ie],0|oe[ie+1]),PC(L,k,f,F,C.rotation,C.scale,me,!1,!1,!1),f.projection.name==="globe"&&(L=Gb(L,f));const pe=o.ad.multiply([],f.projMatrix,L),Ee=t.queryGeometry,De=MC(Ee.isPointQuery()?Ee.screenBounds:Ee.screenGeometry,f,pe,k.aabb);De!=null&&(G=Math.min(De,G))}return G!==Number.MAX_VALUE&&G}}return!1}_handleOverridablePaintPropertyUpdate(t,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof X}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,r,s){const u=t.tile,f=u.getBucket(this);let d=null,g=Number.MAX_VALUE;if(!(f&&f instanceof G0))return{queryFeature:d,intersectionZ:g};const v=f.getNodesInfo()[e];if(v.hiddenByReplacement||!v.node.meshes||!r.filter(new pr(u.tileID.overscaledZ),v.feature,u.tileID.canonical))return{queryFeature:d,intersectionZ:g};const T=v.node,E=s.calculatePosMatrix(u.tileID.toUnwrapped(),s.worldSize),A=v.evaluatedScale;let C=0;s.elevation&&T.elevation&&(C=T.elevation*s.elevation.exaggeration()),o.ad.translate(E,E,[(T.anchor?T.anchor[0]:0)*(A[0]-1),(T.anchor?T.anchor[1]:0)*(A[1]-1),C]),o.ad.scale(E,E,A),o.ad.multiply(E,E,T.matrix);const k=t.queryGeometry,L=k.isPointQuery()?k.screenBounds:k.screenGeometry,F=function(G){const ne=o.ad.multiply([],E,G.matrix),ie=o.ad.multiply(ne,s.expandedFarZProjMatrix,ne);for(let oe=0;oe<G.meshes.length;++oe){const me=G.meshes[oe];if(oe===G.lightMeshIndex)continue;const pe=MC(L,s,ie,me.aabb);pe!=null&&(g=Math.min(pe,g))}if(G.children)for(const oe of G.children)F(oe)};if(F(T),g===Number.MAX_VALUE)return{queryFeature:d,intersectionZ:g};const N=new Vr(0,0);return qC(u.tileID.canonical,N,v.node.anchor[0],v.node.anchor[1]),d={type:"Feature",geometry:{type:"Point",coordinates:[N.lng,N.lat]},properties:v.feature.properties,id:v.feature.id,state:{},layer:this.serialize()},{queryFeature:d,intersectionZ:g}}},clip:class extends Ui{constructor(t,e,r,s){super(t,iF,e,r,s)}recalculate(t,e){super.recalculate(t,e)}createBucket(t){return new II(t)}isTileClipped(){return!0}is3D(){return!0}}};ee(hC,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const HC=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ew{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=s>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const f=HC[15&s];if(!f)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new ew(g,d,f,e)}constructor(e,r=64,s=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=HC.indexOf(this.ArrayType),d=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,v=(8-g%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${s}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+v,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+d+g+v),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+v,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=r,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return tw(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:d,nodeSize:g}=this,v=[0,f.length-1,0],T=[];for(;v.length;){const E=v.pop()||0,A=v.pop()||0,C=v.pop()||0;if(A-C<=g){for(let N=C;N<=A;N++){const G=d[2*N],ne=d[2*N+1];G>=e&&G<=s&&ne>=r&&ne<=u&&T.push(f[N])}continue}const k=C+A>>1,L=d[2*k],F=d[2*k+1];L>=e&&L<=s&&F>=r&&F<=u&&T.push(f[k]),(E===0?e<=L:r<=F)&&(v.push(C),v.push(k-1),v.push(1-E)),(E===0?s>=L:u>=F)&&(v.push(k+1),v.push(A),v.push(1-E))}return T}within(e,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:d}=this,g=[0,u.length-1,0],v=[],T=s*s;for(;g.length;){const E=g.pop()||0,A=g.pop()||0,C=g.pop()||0;if(A-C<=d){for(let N=C;N<=A;N++)XC(f[2*N],f[2*N+1],e,r)<=T&&v.push(u[N]);continue}const k=C+A>>1,L=f[2*k],F=f[2*k+1];XC(L,F,e,r)<=T&&v.push(u[k]),(E===0?e-s<=L:r-s<=F)&&(g.push(C),g.push(k-1),g.push(1-E)),(E===0?e+s>=L:r+s>=F)&&(g.push(k+1),g.push(A),g.push(1-E))}return v}}function tw(t,e,r,s,u,f){if(u-s<=r)return;const d=s+u>>1;ZC(t,e,d,s,u,f),tw(t,e,r,s,d-1,1-f),tw(t,e,r,d+1,u,1-f)}function ZC(t,e,r,s,u,f){for(;u>s;){if(u-s>600){const T=u-s+1,E=r-s+1,A=Math.log(T),C=.5*Math.exp(2*A/3),k=.5*Math.sqrt(A*C*(T-C)/T)*(E-T/2<0?-1:1);ZC(t,e,r,Math.max(s,Math.floor(r-E*C/T+k)),Math.min(u,Math.floor(r+(T-E)*C/T+k)),f)}const d=e[2*r+f];let g=s,v=u;for(T_(t,e,s,r),e[2*u+f]>d&&T_(t,e,s,u);g<v;){for(T_(t,e,g,v),g++,v--;e[2*g+f]<d;)g++;for(;e[2*v+f]>d;)v--}e[2*s+f]===d?T_(t,e,s,v):(v++,T_(t,e,v,u)),v<=r&&(s=v+1),r<=v&&(u=v-1)}}function T_(t,e,r,s){rw(t,r,s),rw(e,2*r,2*s),rw(e,2*r+1,2*s+1)}function rw(t,e,r){const s=t[e];t[e]=t[r],t[r]=s}function XC(t,e,r,s){const u=t-r,f=e-s;return u*u+f*f}o.$=zr,o.A=kh,o.B=Rh,o.C=Gr,o.D=Qi,o.E=Jl,o.G=Ti,o.H=_,o.I=Hh,o.J=p,o.K=function(t){const e=t.value;let r=[];if(!e)return r;const s=tu(e);return s!=="string"?(r=r.concat([new B0(t.key,e,`string expected, "${s}" found`)]),r):(IC(e,!0)||(r=r.concat([new B0(t.key,e,`invalid url "${e}"`)])),r)},o.L=$e,o.M=class{constructor(t,e,r,s){this.id=t,this.position=e!=null?new Vr(e[0],e[1]):new Vr(0,0),this.orientation=r??[0,0,0],this.nodes=s,this.uploaded=!1,this.aabb=new Tn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(o.ad.multiply(t.matrix,e,t.matrix),t.meshes)for(const r of t.meshes){const s=Tn.applyTransformFast(r.aabb,t.matrix);this.aabb.encapsulate(s)}if(t.children)for(const r of t.children)this._applyTransformations(r,t.matrix)}computeBoundsAndApplyParent(){const t=o.ad.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,r,s,u,f,d=!1){PC(this.matrix,this,t.transform,this.position,e,r,s,u,f,d)}upload(t){if(!this.uploaded){for(const e of this.nodes)qb(e,t);for(const e of this.nodes)N0(e);this.uploaded=!0}}destroy(){for(const t of this.nodes)Hb(t)}},o.N=Xr,o.O=ct,o.P=Mt,o.Q=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return Ki(t.expression.evaluate(e))}interpolate(t,e,r){return{x:nr(t.x,e.x,r),y:nr(t.y,e.y,r),z:nr(t.z,e.z,r),azimuthal:nr(t.azimuthal,e.azimuthal,r),polar:nr(t.polar,e.polar,r)}}},o.R=Uf,o.S=F1,o.T=ga,o.U=kr,o.V=B0,o.W=Qr,o.X=pr,o.Y=eo,o.Z=X,o.a=ls,o.a$=function(t){const{x:e,y:r}=t.point,{lng:s,lat:u}=t._center;return dI(e,r,t.worldSize,s,u)},o.a0=pn,o.a1=gu,o.a2=nr,o.a3=At,o.a4=ay,o.a5=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([r,s]){const u=Ki([1,r,s]);return{x:u.x,y:u.y,z:u.z}}(t.expression.evaluate(e))}interpolate(t,e,r){return{x:nr(t.x,e.x,r),y:nr(t.y,e.y,r),z:nr(t.z,e.z,r)}}},o.a6=$m,o.a7=qy,o.a8=du,o.a9=jM,o.aB=function(t,e){const{x:r,y:s}=t.point,u=dI(r,s,t.worldSize/t._pixelsPerMercatorPixel,0,0);return o.ad.multiply(u,u,lb(Tl(e)))},o.aD=Md,o.aE=$s,o.aF=g0,o.aG=function(t,e,r,s,u){const f=5*e+2;t.float32[f+0]=r,t.float32[f+1]=s,t.float32[f+2]=u},o.aH=A0,o.aI=Vr,o.aJ=tC,o.aK=WM,o.aL=hi,o.aM=ob,o.aN=wC,o.aO=Vh,o.aP=cI,o.aQ=function(t,e,r,s,u,f,d,g,v){if(v.name==="globe")return cI(t,e,new Vh(r,s,u),!1);const T=qh({z:r,x:s,y:u},v);return new Tn([(f+T.x/T.scale)*e,e*(T.y/T.scale),d],[(f+T.x2/T.scale)*e,e*(T.y2/T.scale),g])},o.aR=function(t,e,r){let s=0;for(let u=0;u<2;++u)t[u]>0&&(s+=(t[u]-0)*(t[u]-0)),e[u]<0&&(s+=(0-e[u])*(0-e[u]));return s},o.aS=Un,o.aT=nb,o.aU=$M,o.aV=function(t){const e=o.ad.identity(new Float64Array(16));o.ad.multiply(e,t.pixelMatrix,t.globeMatrix);const r=[0,ma,0],s=[0,_a,0];return o._.transformMat4(r,r,e),o._.transformMat4(s,s,e),[r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!cb(t,new Vr(t.center.lat,90)),s[0]>0&&s[0]<=t.width&&s[1]>0&&s[1]<=t.height&&!cb(t,new Vr(t.center.lat,-90))]},o.aW=function(t,e){const{scale:r}=t.tileTransform,s=r*At/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return o.aC.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},o.aX=z0,o.aY=bC,o.aZ=function(t){const e=bC(t,!0);return o.aC.invert([],[e[0],e[1],e[4],e[5]])},o.a_=ib,o.aa=Mo,o.ab=Ar,o.ac=function(t,e,r){const s=Math.sqrt(t*t+e*e+r*r),u=s>0?Math.acos(r/s)*Rs:0;let f=t!==0||e!==0?Math.atan2(-e,-t)*Rs+90:0;return f<0&&(f+=360),[s,f,u]},o.ae=Od,o.af=Xa,o.ag=Rb,o.ah=function(t,e){const r={};for(let s=0;s<e.length;s++){const u=e[s];u in t&&(r[u]=t[u])}return r},o.ai=pc,o.aj=bl,o.ak=wl,o.al=hd,o.am=function(t){Zp++,Zp>Xg&&(t.getActor().send("enforceCacheSizeLimit",qp),Zp=0)},o.an=tm,o.ao=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,r,s){const u=this.entries[t]=this.entries[t]||{callbacks:[]};if(u.result){const[f,d]=u.result;return this.scheduler?this.scheduler.add(()=>{s(f,d)},e):s(f,d),()=>{}}return u.callbacks.push(s),u.cancel||(u.cancel=r((f,d)=>{u.result=[f,d];for(const g of u.callbacks)this.scheduler?this.scheduler.add(()=>{g(f,d)},e):g(f,d);setTimeout(()=>delete this.entries[t],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(f=>f!==s),u.callbacks.length||(u.cancel(),delete this.entries[t]))}}},o.ap=function(t,e,r){const s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},u=>{const f=ml(t.request,(d,g,v,T)=>{d?u(d):g&&u(null,{vectorTile:r?void 0:new gb(new Ed(g)),rawData:g,cacheControl:v,expires:T})});return()=>{f.cancel(),u()}},e)},o.aq=j1,o.ar=class extends fu{constructor(t){super(t),this.current=h4}set(t,e,r){if(this.fetchUniformLocation(t,e)){for(let s=0;s<9;s++)if(r[s]!==this.current[s]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},o.as=V1,o.at=Kt,o.au=bn,o.aw=hh,o.ax=Ao,o.ay=Di,o.az=function(t,e,r){t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},o.b=In,o.b$=yc,o.b0=li,o.b1=W1,o.b2=function(t){const e=Math.round((t+45+360)%360/90)%4;return Oe[e]},o.b3=45,o.b4=Z1,o.b5=Hy,o.b6=Tn,o.b7=Ki,o.b8=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},o.b9=nt,o.bA=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},o.bB=dA,o.bD=fI,o.bE=Uu,o.bF=zf,o.bG=256,o.bH=function(t,e){const r=[0,0,0],s=Xm(Tl(e.canonical));return o._.transformMat4(r,r,s),o._.transformMat4(r,r,t),r},o.bI=t=>({u_camera_to_center_distance:new Mo(t),u_extrude_scale:new $1(t),u_device_pixel_ratio:new Mo(t),u_matrix:new $m(t),u_inv_rot_matrix:new $m(t),u_merc_center:new du(t),u_tile_id:new j1(t),u_zoom_transition:new Mo(t),u_up_dir:new j1(t),u_emissive_strength:new Mo(t)}),o.bJ=t=>({u_matrix:new $m(t),u_pixels_to_tile_units:new $1(t),u_device_pixel_ratio:new Mo(t),u_units_to_pixels:new du(t),u_dash_image:new qy(t),u_gradient_image:new qy(t),u_image_height:new Mo(t),u_texsize:new du(t),u_tile_units_to_pixels:new Mo(t),u_alpha_discard_threshold:new Mo(t),u_trim_offset:new du(t),u_trim_fade_range:new du(t),u_trim_color:new V1(t),u_emissive_strength:new Mo(t)}),o.bK=t=>({u_matrix:new $m(t),u_texsize:new du(t),u_pixels_to_tile_units:new $1(t),u_device_pixel_ratio:new Mo(t),u_image:new qy(t),u_units_to_pixels:new du(t),u_tile_units_to_pixels:new Mo(t),u_alpha_discard_threshold:new Mo(t),u_trim_offset:new du(t)}),o.bL=P1,o.bM=WF,o.bN=ji,o.bO=uB,o.bP=qA,o.bQ=Mb,o.bR=_I,o.bS=(t,e,r,s,u,f)=>{const d=t.transform,g=d.projection.name==="globe";let v;if(f.paint.get("circle-pitch-alignment")==="map")if(g){const E=fI(d.zoom,e.canonical)*d._pixelsPerMercatorPixel;v=Float32Array.from([E,0,0,E])}else v=d.calculatePixelsToTileUnitsMatrix(r);else v=new Float32Array([d.pixelsToGLUnits[0],0,0,d.pixelsToGLUnits[1]]);const T={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(d.projection),u_matrix:t.translatePosMatrix(e.projMatrix,r,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Pi.devicePixelRatio,u_extrude_scale:v,u_inv_rot_matrix:L4,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(g){T.u_inv_rot_matrix=s,T.u_merc_center=u,T.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],T.u_zoom_transition=gu(d.zoom);const E=u[0]*At,A=u[1]*At;T.u_up_dir=d.projection.upVector(new Vh(0,0,0),E,A)}return T},o.bT=_A,o.bU=(t,e,r,s,u,f)=>{const d=t.transform;return{u_matrix:mA(t,e,r,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:d.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_image:0,u_tile_units_to_pixels:pA(e,d),u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:f}},o.bV=(t,e,r,s,u,f,d)=>{const g=t.transform,v=g.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:mA(t,e,r,s),u_pixels_to_tile_units:v,u_device_pixel_ratio:f,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:gA(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:pA(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:d,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength")}},o.bW=Zi,o.bX=Ym,o.bY=oA,o.bZ=v4,o.b_=f0,o.ba=function(t,e,r){const s=gu(r.zoom),u=t.style.map._antialias,f=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return s===0&&!u&&!f},o.bb=function(t){const e=t.pixelsPerMeter,r=e/Ao(1,t.center.lat),s=o.ad.identity(new Float64Array(16));return o.ad.translate(s,s,[t.point.x,t.point.y,0]),o.ad.scale(s,s,[r,r,e]),Float32Array.from(s)},o.bc=Jy,o.bd=function(t){const e=Un-5;t=Kt(t,-e,e)/e*90;const r=Math.pow(Math.abs(Math.sin(Ar(t))),3);return Math.round(r*(q1.length-1))},o.be=function(t,e,r,s){const u=e.getNorth(),f=e.getSouth(),d=e.getWest(),g=e.getEast(),v=1<<t.z,T=g-d,E=u-f,A=T/md,C=-E/q1[r],k=[0,A,0,C,0,0,u,d,0];if(t.z>0){const L=180/s;o.bC.multiply(k,k,[L/T+1,0,0,0,L/E+1,0,-.5*L/A,.5*L/C,1])}return k[2]=v,k[5]=t.x,k[8]=t.y,k},o.bf=Xm,o.bg=Tl,o.bh=function(t,e,r){const s=o.ad.identity(new Float64Array(16)),u=(e/(1<<t)-.5)*Math.PI*2;return o.ad.rotateY(s,r.globeMatrix,u),Float32Array.from(s)},o.bi=Ff,o.bj=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},o.bk=vC,o.bl=xC,o.bm=yC,o.bn=function(t,e){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<t.length;s++){const u=document.createElement("source");Qg(t[s])||(r.crossOrigin="Anonymous"),u.src=t[s],r.appendChild(u)}return{cancel:()=>{}}},o.bo=C0,o.bp=Vo,o.bq=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const r=e.getSource().maxzoom,s=1<<r,u=Math.floor(t.x),f=Math.floor((t.x-u)*s),d=Math.floor(t.y*s),g=this.findDEMTileFor(new hi(r,u,r,f,d));return!(!g||!g.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||t.y<0||t.y>1)return e;const u=s.getSource().maxzoom,f=1<<u,d=Math.floor(t.x),g=t.x-d,v=new hi(u,d,u,Math.floor(g*f),Math.floor(t.y*f)),T=this.findDEMTileFor(v);if(!T||!T.dem)return e;const E=T.dem,A=1<<T.tileID.canonical.z,C=(g*A-T.tileID.canonical.x)*E.dim,k=(t.y*A-T.tileID.canonical.y)*E.dim,L=Math.floor(C),F=Math.floor(k);return(r?this.exaggeration():1)*nr(nr(E.get(L,F),E.get(L,F+1),k-F),nr(E.get(L+1,F),E.get(L+1,F+1),k-F),C-L)}getAtTileOffset(t,e,r){const s=1<<t.canonical.z;return this.getAtPointOrZero(new eo(t.wrap+(t.canonical.x+e/At)/s,(t.canonical.y+r/At)/s))}getAtTileOffsetFunc(t,e,r,s){return u=>{const f=this.getAtTileOffset(t,u.x,u.y),d=s.upVector(t.canonical,u.x,u.y),g=s.upVectorScale(t.canonical,e,r).metersToTile;return o._.scale(d,d,f*g),d}}getForTilePoints(t,e,r,s){if(this.isUsingMockSource())return!1;const u=wd.create(this,t,s);return!!u&&(e.forEach(f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],r)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const r=e.dem.tree,s=e.tileID,u=1<<t.canonical.z-s.canonical.z;let f=t.canonical.x/u-s.canonical.x,d=t.canonical.y/u-s.canonical.y,g=0;for(let v=0;v<t.canonical.z-s.canonical.z&&!r.leaves[g];v++){f*=2,d*=2;const T=2*Math.floor(d)+Math.floor(f);g=r.childOffsets[g]+T,f%=1,d%=1}return{min:this.exaggeration()*r.minimums[g],max:this.exaggeration()*r.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,r=Number.MAX_VALUE,s=Number.MIN_VALUE;for(const u of t){const f=this.getMinMaxForTile(u.tileID);f&&(r=Math.min(r,f.min),s=Math.max(s,f.max),e=!0)}return e?{min:r,max:s}:null}},o.br=Hm,o.bs=Qy,o.bt=Ga,o.bu=Si,o.bv=Zh,o.bw=Ld,o.bx=U0,o.by=D0,o.bz=wI,o.c=jC,o.c$=mh,o.c0=450,o.c1=7,o.c2=g5,o.c3=fC,o.c4=256,o.c5=lI,o.c6=lb,o.c7=Yr,o.c8=uc,o.c9=Nh,o.cA=function(t){let e=1/0,r=1/0,s=-1/0,u=-1/0;for(const f of t)e=Math.min(e,f.x),r=Math.min(r,f.y),s=Math.max(s,f.x),u=Math.max(u,f.y);return{min:new Mt(e,r),max:new Mt(s,u)}},o.cB=mc,o.cC=XM,o.cD=Io,o.cE=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.cF=NA,o.cG=J1,o.cH=BI,o.cI=NI,o.cJ=Pb,o.cK=ew,o.cL=function(t){return t({pluginStatus:it,pluginURL:jt}),yr.on("pluginStateChange",t),t},o.cM=Ad,o.cN=Ab,o.cO=Yp,o.cP=Er,o.cQ=te,o.cR=Gp,o.cS=yh,o.cT=ho,o.cU=function(t){const e=t.indexOf(sc);return e>=0?t.slice(0,e):t},o.cV=function(t){return t.indexOf(sc)>=0},o.cW=function(t){const e=t.indexOf(sc);return e>=0?t.slice(e+1):""},o.cX=function(t){const e=[],r=t.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},o.cY=function(t,e,r,s){return t.type==="custom"?new x5(t,e):new Y5[t.type](t,e,r,s)},o.cZ=Fu,o.c_=yr,o.ca=1,o.cb=f_,o.cc=0,o.cd=k1,o.ce=function(t,e,r,s,u){return Kt((t-e)/(r-e)*(u-s)+s,s,u)},o.cf=Fm,o.cg=$h,o.ch=class{constructor(t,e,r,s){this.context=t,this.format=s,this.size=r,this.texture=t.gl.createTexture();const[u,f,d]=this.size,{gl:g}=t;g.bindTexture(g.TEXTURE_3D,this.texture),t.pixelStoreUnpackFlipY.set(!1),t.pixelStoreUnpack.set(1),t.pixelStoreUnpackPremultiplyAlpha.set(!1);let v=this.format,T=g.UNSIGNED_BYTE;this.format===g.DEPTH_COMPONENT&&(v=g.DEPTH_COMPONENT16,T=g.UNSIGNED_SHORT),this.format===g.R8&&(s=g.RED),this.format===g.R32F&&(T=g.FLOAT,s=g.RED),g.texImage3D(g.TEXTURE_3D,0,v,u,f,d,0,s,T,e.data)}bind(t,e){const{context:r}=this,{gl:s}=r;s.bindTexture(s.TEXTURE_3D,this.texture),t!==this.minFilter&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MAG_FILTER,t),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MIN_FILTER,t),this.minFilter=t),e!==this.wrapS&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}},o.ci=Gb,o.cj=[1,1,1],o.ck=wd,o.cl=kd,o.cm=hc,o.cn=dd,o.co=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Mt(1/0,1/0),max:new Mt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t,e=!1){const r=LI(new Mt(0,0),new Mt(At,At),t),s=[];if(e&&!yb(r,this._globalClipBounds))return s;for(const u of this._activeRegions){if(u.hiddenByOverlap||!yb(r,u))continue;const f=yF(u.min,u.max,t);s.push({min:f.min,max:f.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask})}return s}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const r=[];for(const s of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(s).buckets[e.layer];u&&u.updateFootprints(s.toUnwrapped(),r)}return r},getOrder:()=>e.order,getClipMask:()=>e.clipMask})))}_addSource(t){const e=t.getFootprints();if(e.length===0)return;const r=t.getOrder(),s=t.getClipMask();for(const u of e){if(!u.footprint)continue;const f=LI(u.footprint.min,u.footprint.max,u.id);this._activeRegions.push({min:f.min,max:f.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:u.id,footprint:u.footprint,order:r,clipMask:s})}this._sourceIds.push(t.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,r)=>e.priority-r.priority||u0(e.min,r.min)||u0(e.max,r.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0;for(;!t&&e!==this._activeRegions.length;){const r=this._activeRegions[e],s=this._prevRegions[e];t=r.priority!==s.priority||!kI(r,s)||r.order!==s.order||r.clipMask!==s.clipMask,++e}}if(t){++this._updateTime;for(const r of this._activeRegions)r.order!==1/0&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));const e=r=>{const s=this._activeRegions;if(r>=s.length)return r;const u=s[r].priority;for(;r<s.length&&s[r].priority===u;)++r;return r};if(this._sourceIds.length>1){let r=0,s=e(r);for(;r!==s;){let u=r;const f=r;for(;u!==s;){const d=this._activeRegions[u];d.hiddenByOverlap=!1;for(let g=0;g<f;g++){const v=this._activeRegions[g];if(!v.hiddenByOverlap&&d.order===1/0&&yb(d,v)&&(d.hiddenByOverlap=FI(d.footprint,d.tileId,v.footprint,v.tileId),d.hiddenByOverlap))break}++u}r=s,s=e(r)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},o.cp=ac,o.cq=O0,o.cr=jm,o.cs=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const r=new Ga,s=new Si,u=[],f=t+1+2,d=e[0]+1,g=e[0]+1+(1+e.length),v=(T,E,A)=>{let C=T===f-1?T-2:T===0?T:T-1;return C+=A?24575:0,[C,E]};for(let T=0;T<f;++T)r.emplaceBack(...v(T,0,!0));for(let T=0;T<d;++T)for(let E=0;E<f;++E)r.emplaceBack(...v(E,T,(E===0||E===f-1)&&!0));for(let T=0;T<e.length;++T){const E=e[T];for(let A=0;A<f;++A)r.emplaceBack(...v(A,E,!0))}for(let T=0;T<e.length;++T){const E=s.length,A=e[T]+1+2,C=new Si;for(let F=0;F<A-1;F++){const N=F===A-2,G=N?f*(g-e.length+T-F):f;for(let ne=0;ne<f-1;ne++){const ie=F*f+ne;F===0||N||ne===0||ne===f-2?(C.emplaceBack(ie+1,ie,ie+G),C.emplaceBack(ie+G,ie+G+1,ie+1)):(s.emplaceBack(ie+1,ie,ie+G),s.emplaceBack(ie+G,ie+G+1,ie+1))}}const k=In.simpleSegment(0,E,r.length,s.length-E);for(let F=0;F<C.uint16.length;F+=3)s.emplaceBack(C.uint16[F],C.uint16[F+1],C.uint16[F+2]);const L=In.simpleSegment(0,E,r.length,s.length-E);u.push({withoutSkirts:k,withSkirts:L})}return{vertices:r,indices:s,segments:u}}_createGrid(t){const e=this._fillGridMeshWithLods(md,q1);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Hm.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new Si;for(let d=0;d<=md;d++)e.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const r=new Nh,s=new Nh,u=new Nh,f=new Nh;this._poleSegments=[];for(let d=0,g=0;d<W1;d++){const v=360/(1<<d);r.emplaceBack(0,-Io,0,.5,0),s.emplaceBack(0,-Io,0,.5,1),u.emplaceBack(0,-Io,0,.5,.5),f.emplaceBack(0,-Io,0,.5,.5);for(let T=0;T<=md;T++){let E=T/md,A=0;const C=nr(0,v,E),[k,L,F]=_d(R4,k4,C,Io);r.emplaceBack(k,L,F,E,A),s.emplaceBack(k,L,F,E,1-A);const N=Ar(C);E=.5+.5*Math.sin(N),A=.5+.5*Math.cos(N),u.emplaceBack(k,L,F,E,A),f.emplaceBack(k,L,F,E,1-A)}this._poleSegments.push(In.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(r,Ky,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(s,Ky,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(u,Ky,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(f,Ky,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},o.ct=function(t){return Ql.has(t)},o.cu=HI,o.cv=function(t,e,r=0,s=!0){const u=new Mt(r,r),f=t.sub(u),d=e.add(u),g=[f,new Mt(d.x,f.y),d,new Mt(f.x,d.y)];return s&&g.push(f.clone()),g},o.cw=function(t,e){const r=[];for(let s=0;s<t.length;s++){const u=bn(s-1,-1,t.length-1),f=bn(s+1,-1,t.length-1),d=t[s],g=t[f],v=t[u].sub(d).unit(),T=g.sub(d).unit(),E=T.angleWithSep(v.x,v.y),A=v.add(T).unit().mult(-1*e/Math.sin(E/2));r.push(d.add(A))}return r},o.cx=YA,o.cy=eI,o.cz=function(t,e,r=0){return o._.fromValues(((e.x-r)*t.scale-t.x)*At,(e.y*t.scale-t.y)*At,qM(e.z,e.y))},o.d=Na,o.d$=Ds,o.d0=Rt,o.d1=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.d2=hr,o.d3=ZM,o.d4=jh,o.d5=function([t,e,r]){const s=Math.hypot(t,e,r),u=Math.atan2(t,r),f=.5*Math.PI-Math.acos(-e/s);return new Vr(li(u),li(f))},o.d6=Ho,o.d7=gd,o.d8=V,o.d9=cb,o.dA=function(t){const e=Hp();if(!e)return;const r=e.delete(Wp);t&&r.catch(t).then(()=>t())},o.dB=y_,o.dC=DC,o.dD=function(t){Xb=Pi.resolveURL(t),Fd||(Fd=new Ld(U0(),new Jl)),Fd.broadcast("setDracoUrl",Xb)},o.dE=RC,o.dF=function(t){zd=Pi.resolveURL(t),Fd||(Fd=new Ld(U0(),new Jl)),Fd.broadcast("setMeshoptUrl",zd)},o.dG=ui,o.dH=ee,o.dI=_c,o.dJ=Za,o.dK=qh,o.dL=N1,o.dM=yA,o.dN=EA,o.dO=hA,o.dP=Yi,o.dQ=jA,o.dR=Dd,o.dS=function(t,e,r,s,u,f,d,g,v,T,E){t.createArrays(),t.tilePixelRatio=At/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const A=t.layers[0].layout,C=t.layers[0]._unevaluatedLayout._values,k={};if(t.textSizeData.kind==="composite"){const{minZoom:G,maxZoom:ne}=t.textSizeData;k.compositeTextSizes=[C["text-size"].possiblyEvaluate(new pr(G),g),C["text-size"].possiblyEvaluate(new pr(ne),g)]}if(t.iconSizeData.kind==="composite"){const{minZoom:G,maxZoom:ne}=t.iconSizeData;k.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new pr(G),g),C["icon-size"].possiblyEvaluate(new pr(ne),g)]}k.layoutTextSize=C["text-size"].possiblyEvaluate(new pr(v+1),g),k.layoutIconSize=C["icon-size"].possiblyEvaluate(new pr(v+1),g),k.textMaxSize=C["text-size"].possiblyEvaluate(new pr(18),g);const L=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",F=A.get("text-size");let N=!1;for(const G of t.features)if(G.icon&&G.icon.nameSecondary){N=!0;break}for(const G of t.features){const ne=A.get("text-font").evaluate(G,{},g).join(","),ie=F.evaluate(G,{},g),oe=k.layoutTextSize.evaluate(G,{},g),me=(k.layoutIconSize.evaluate(G,{},g),{horizontal:{},vertical:void 0}),pe=G.text;let Ee,De=[0,0];if(pe){const Ze=pe.toString(),ut=A.get("text-letter-spacing").evaluate(G,{},g)*ji,vt=A.get("text-line-height").evaluate(G,{},g)*ji,ot=dt(Ze)?ut:0,mt=A.get("text-anchor").evaluate(G,{},g),tt=A.get("text-variable-anchor");if(!tt){const xt=A.get("text-radial-offset").evaluate(G,{},g);De=xt?qA(mt,[xt*ji,Cb]):A.get("text-offset").evaluate(G,{},g).map(Tt=>Tt*ji)}let _t=L?"center":A.get("text-justify").evaluate(G,{},g);const bt=A.get("symbol-placement")==="point",gt=bt?A.get("text-max-width").evaluate(G,{},g)*ji:1/0,zt=xt=>{t.allowVerticalPlacement&&Xe(Ze)&&(me.vertical=Eb(pe,e,r,u,ne,gt,vt,mt,xt,ot,De,$s.vertical,!0,oe,ie))};if(!L&&tt){const xt=_t==="auto"?tt.map(Jt=>Pb(Jt)):[_t];let Tt=!1;for(let Jt=0;Jt<xt.length;Jt++){const Yt=xt[Jt];if(!me.horizontal[Yt])if(Tt)me.horizontal[Yt]=me.horizontal[0];else{const Xt=Eb(pe,e,r,u,ne,gt,vt,"center",Yt,ot,De,$s.horizontal,!1,oe,ie);Xt&&(me.horizontal[Yt]=Xt,Tt=Xt.positionedLines.length===1)}}zt("left")}else{if(_t==="auto"&&(_t=Pb(mt)),bt||A.get("text-writing-mode").indexOf("horizontal")>=0||!Xe(Ze)){const xt=Eb(pe,e,r,u,ne,gt,vt,mt,_t,ot,De,$s.horizontal,!1,oe,ie);xt&&(me.horizontal[_t]=xt)}zt(bt?"left":_t)}}let je=!1;if(G.icon&&G.icon.namePrimary){const Ze=s[G.icon.namePrimary];Ze&&(Ee=yB(u[G.icon.namePrimary],G.icon.nameSecondary?u[G.icon.nameSecondary]:void 0,A.get("icon-offset").evaluate(G,{},g),A.get("icon-anchor").evaluate(G,{},g)),je=Ze.sdf,t.sdfIcons===void 0?t.sdfIcons=Ze.sdf:t.sdfIcons!==Ze.sdf&&zn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ze.pixelRatio!==t.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Qe=ZA(me.horizontal)||me.vertical;t.iconsInText||(t.iconsInText=!!Qe&&Qe.iconsInText),(Qe||Ee)&&EB(t,G,me,Ee,s,k,oe,0,De,je,d,g,T,E,N)}f&&t.generateCollisionDebugBuffers(v,t.collisionBoxArray)},o.dT=d0,o.dU=o0,o.dV=gb,o.dW=Ed,o.dX=c0,o.dY=Ub,o.dZ=a0,o.d_=s0,o.da=pI,o.db=function(t){const e=[0,0,0],r=o.ad.identity(new Float64Array(16));return o.ad.multiply(r,t.pixelMatrix,t.globeMatrix),o._.transformMat4(e,e,r),new Mt(e[0],e[1])},o.dc=q,o.dd=ae,o.de=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(r){if(pl==null){const s=r.navigator?r.navigator.userAgent:null;pl=!!r.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return pl}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.df=Hi,o.dg=class{constructor(t,e,r){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Jp,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!te(t))return t;const r=ks(t);return r.params.push(`sdk=js-${R}`),r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!te(t))return t;const r=ks(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeModelURL(t,e){if(!te(t))return t;const r=ks(t);return r.path=`/models/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(t,e,r,s){if(!te(t))return t;const u=ks(t);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),r&&u.params.push(`language=${r}`),s&&u.params.push(`worldview=${s}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(t,e,r,s){const u=ks(t);return te(t)?(u.path=`/styles/v1${u.path}/sprite${e}${r}`,this._makeAPIURL(u,this._customAccessToken||s)):(u.path+=`${e}${r}`,Kl(u))}normalizeTileURL(t,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!te(t))return t;const s=ks(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&s.authority!=="raster"&&r===512?"@2x":""}${dh.supported?".webp":"$1"}`),s.authority==="raster"?s.path=`/${V.RASTER_URL_PREFIX}${s.path}`:s.authority==="rasterarrays"?s.path=`/${V.RASTERARRAYS_URL_PREFIX}${s.path}`:s.authority==="3dtiles"?s.path=`/${V.TILES3D_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${V.TILE_URL_VERSION}${s.path}`);const u=this._customAccessToken||function(f){for(const d of f){const g=d.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(s.params)||V.ACCESS_TOKEN;return V.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,u)}canonicalizeTileURL(t,e){const r=ks(t);if(!r.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let s="mapbox://";r.path.match(/^\/raster\/v1\//)?s+=`raster/${r.path.replace(`/${V.RASTER_URL_PREFIX}/`,"")}`:r.path.match(/^\/rasterarrays\/v1\//)?s+=`rasterarrays/${r.path.replace(`/${V.RASTERARRAYS_URL_PREFIX}/`,"")}`:s+=`tiles/${r.path.replace(`/${V.TILE_URL_VERSION}/`,"")}`;let u=r.params;return e&&(u=u.filter(f=>!f.match(/^access_token=/))),u.length&&(s+=`?${u.join("&")}`),s}canonicalizeTileset(t,e){const r=!!e&&te(e),s=[];for(const u of t.tiles||[])Z(u)?s.push(this.canonicalizeTileURL(u,r)):s.push(u);return s}_makeAPIURL(t,e){const r="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=ks(V.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,t.protocol==="http"){const u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if(s.path!=="/"&&(t.path=`${s.path}${t.path}`),!V.REQUIRE_ACCESS_TOKEN)return Kl(t);if(e=e||V.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter(u=>u.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Kl(t)}},o.dh=function(t,e){e?Ql.add(t):Ql.delete(t)},o.di=dh,o.dj=Wf,o.dk=iy,o.dl=em,o.dm=u1,o.dn=rm,o.dp=function(t){Ql.delete(t)},o.dq=Vu,o.dr=Gf,o.ds=fn,o.dt=R,o.du=function(t,e){qp=t,Xg=e},o.dv=function(t,e,r=!1){if(it===Pt||it===Lt||it===Ot)throw new Error("setRTLTextPlugin cannot be called multiple times.");jt=Pi.resolveURL(t),it=Pt,It=e,lr(),r||yn()},o.dw=Rr,o.dx=function(){U0().acquire(Zb)},o.dy=function(){const t=x_;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(Zb),x_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.dz=v_,o.e=Pi,o.e0=vA,o.e1=le,o.e2=ml,o.e3=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==LC){const r=new Uint32Array(t,0,7),[,,s,u,f,d]=r;e=r.byteLength+u+f+d+f,(s!==t.byteLength||e>=t.byteLength)&&zn("Invalid b3dm header information.")}return NC(t,e)},o.e4=function(t,e){const r=jC(t);for(const s of r){for(const u of s.meshes)q5(u);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(H5(s.lights,e)))}return r},o.e5=G0,o.e6=OC,o.e7=Pr,o.e8=function(t){fh(),Ba&&Ba.then(e=>{e.keys().then(r=>{for(let s=0;s<r.length-t;s++)e.delete(r[s])})})},o.f=$o,o.g=function(t,e){return mh(Qr(t,{type:"json"}),e)},o.h=Qp,o.i=Vs,o.j=UA,o.k=Ib,o.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>NC(e,0,t))},o.m=class extends B0{},o.n=tu,o.o=sm,o.p=BB,o.q=Nm,o.r=i,o.s=c,o.t=j,o.u=Ji,o.v=Bi,o.w=zn,o.x=Y,o.y=$,o.z=nd}),M(["./shared"],function(o){function R(Ae){const W=Ae?Ae.url.toString():void 0;return W?performance.getEntriesByName(W):[]}function U(Ae){if(typeof Ae=="number"||typeof Ae=="boolean"||typeof Ae=="string"||Ae==null)return JSON.stringify(Ae);if(Array.isArray(Ae)){let J="[";for(const de of Ae)J+=`${U(de)},`;return`${J}]`}let W="{";for(const J of Object.keys(Ae).sort())W+=`${J}:${U(Ae[J])},`;return`${W}}`}function V(Ae){let W="";for(const J of o.cE)W+=`/${U(Ae[J])}`;return W}class Z{constructor(W){this.keyCache={},this._layers={},this._layerConfigs={},W&&this.replace(W)}replace(W,J){this._layerConfigs={},this._layers={},this.update(W,[],J)}update(W,J,de){this._options=de;for(const we of W)this._layerConfigs[we.id]=we,(this._layers[we.id]=o.cY(we,this.scope,null,this._options)).compileFilter(),this.keyCache[we.id]&&delete this.keyCache[we.id];for(const we of J)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const ve=function(we,Ue){const qe={};for(let Ke=0;Ke<we.length;Ke++){const St=Ue&&Ue[we[Ke].id]||V(we[Ke]);Ue&&(Ue[we[Ke].id]=St);let yt=qe[St];yt||(yt=qe[St]=[]),yt.push(we[Ke])}const Le=[];for(const Ke in qe)Le.push(qe[Ke]);return Le}(o.dG(this._layerConfigs),this.keyCache);for(const we of ve){const Ue=we.map(Ht=>this._layers[Ht.id]),qe=Ue[0];if(qe.visibility==="none")continue;const Le=qe.source||"";let Ke=this.familiesBySource[Le];Ke||(Ke=this.familiesBySource[Le]={});const St=qe.sourceLayer||"_geojsonTileLayer";let yt=Ke[St];yt||(yt=Ke[St]=[]),yt.push(Ue)}}}const te=1*o.dJ;class se{constructor(W){const J={},de=[];for(const qe in W){const Le=W[qe],Ke=J[qe]={};for(const St in Le.glyphs){const yt=Le.glyphs[+St];if(!yt||yt.bitmap.width===0||yt.bitmap.height===0)continue;const Ht=yt.metrics.localGlyph?te:1,Qt={x:0,y:0,w:yt.bitmap.width+2*Ht,h:yt.bitmap.height+2*Ht};de.push(Qt),Ke[St]=Qt}}const{w:ve,h:we}=o.j(de),Ue=new o.dI({width:ve||1,height:we||1});for(const qe in W){const Le=W[qe];for(const Ke in Le.glyphs){const St=Le.glyphs[+Ke];if(!St||St.bitmap.width===0||St.bitmap.height===0)continue;const yt=J[qe][Ke],Ht=St.metrics.localGlyph?te:1;o.dI.copy(St.bitmap,Ue,{x:0,y:0},{x:yt.x+Ht,y:yt.y+Ht},St.bitmap)}}this.image=Ue,this.positions=J}}o.dH(se,"GlyphAtlas");class re{constructor(W){this.tileID=new o.aL(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.tileZoom=W.tileZoom,this.uid=W.uid,this.zoom=W.zoom,this.lut=W.lut,this.canonical=W.tileID.canonical,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.scope=W.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.promoteId=W.promoteId,this.isSymbolTile=W.isSymbolTile,this.tileTransform=o.dK(W.tileID.canonical,W.projection),this.projection=W.projection,this.brightness=W.brightness,this.extraShadowCaster=!!W.extraShadowCaster,this.tessellationStep=W.tessellationStep}parse(W,J,de,ve,we){this.status="parsing",this.data=W,this.collisionBoxArray=new o.dL;const Ue=new o.dM(Object.keys(W.layers).sort()),qe=new o.dN(this.tileID,this.promoteId);qe.bucketLayerIDs=[];const Le={},Ke=new o.dO(256,256),St={featureIndex:qe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Ke,availableImages:de,brightness:this.brightness},yt=J.familiesBySource[this.source];for(const $t in yt){const rn=W.layers[$t];if(!rn)continue;let Zr=!1,Dr=!1,on=!1;for(const si of yt[$t])si[0].type==="symbol"?Zr=!0:Dr=!0,si[0].is3D()&&si[0].type!=="model"&&(on=!0);if(this.extraShadowCaster&&!on||this.isSymbolTile===!0&&!Zr||this.isSymbolTile===!1&&!Dr)continue;rn.version===1&&o.w(`Vector tile source "${this.source}" layer "${$t}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const hn=Ue.encode($t),Mn=[];for(let si=0;si<rn.length;si++){const Kn=rn.feature(si),jo=qe.getId(Kn,$t);Mn.push({feature:Kn,id:jo,index:si,sourceLayerIndex:hn})}for(const si of yt[$t]){const Kn=si[0];(!this.extraShadowCaster||Kn.is3D()&&Kn.type!=="model")&&(this.isSymbolTile!==void 0&&Kn.type==="symbol"!==this.isSymbolTile||Kn.minzoom&&this.zoom<Math.floor(Kn.minzoom)||Kn.maxzoom&&this.zoom>=Kn.maxzoom||Kn.visibility!=="none"&&(Te(si,this.zoom,St.brightness,de),(Le[Kn.id]=Kn.createBucket({index:qe.bucketLayerIDs.length,layers:si,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:hn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Mn,St,this.tileID.canonical,this.tileTransform),qe.bucketLayerIDs.push(si.map(jo=>jo.id))))}}let Ht,Qt,br,Sr;Ke.trim();const gr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ir=()=>{if(Ht)return this.status="done",we(Ht);if(this.extraShadowCaster)this.status="done",we(null,{buckets:o.dG(Le).filter($t=>!$t.isEmpty()),featureIndex:qe,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:St.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Qt&&br&&Sr){const $t=new se(Qt),rn=new o.dQ(br,Sr,this.lut);for(const Zr in Le){const Dr=Le[Zr];Dr instanceof o.dR?(Te(Dr.layers,this.zoom,St.brightness,de),o.dS(Dr,Qt,$t.positions,br,rn.iconPositions,this.showCollisionBoxes,de,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Dr.hasPattern&&(Dr instanceof o.dT||Dr instanceof o.dU||Dr instanceof o.b_)&&(Te(Dr.layers,this.zoom,St.brightness,de),Dr.addFeatures(St,this.tileID.canonical,rn.patternPositions,de,this.tileTransform,this.brightness))}this.status="done",we(null,{buckets:o.dG(Le).filter(Zr=>!Zr.isEmpty()),featureIndex:qe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:$t.image,lineAtlas:Ke,imageAtlas:rn,brightness:St.brightness})}};if(!this.extraShadowCaster){const $t=o.dP(St.glyphDependencies,Dr=>Object.keys(Dr).map(Number));Object.keys($t).length?ve.send("getGlyphs",{uid:this.uid,stacks:$t,scope:this.scope},(Dr,on)=>{Ht||(Ht=Dr,Qt=on,Ir())},void 0,!1,gr):Qt={};const rn=Object.keys(St.iconDependencies);rn.length?ve.send("getImages",{icons:rn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Dr,on)=>{Ht||(Ht=Dr,br=on,Ir())},void 0,!1,gr):br={};const Zr=Object.keys(St.patternDependencies);Zr.length?ve.send("getImages",{icons:Zr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Dr,on)=>{Ht||(Ht=Dr,Sr=on,Ir())},void 0,!1,gr):Sr={}}Ir()}}function Te(Ae,W,J,de){const ve=new o.X(W,{brightness:J});for(const we of Ae)we.recalculate(ve,de)}class ae extends o.E{constructor(W,J,de,ve,we,Ue){super(),this.actor=W,this.layerIndex=J,this.availableImages=de,this.loadVectorData=we||o.ap,this.loading={},this.loaded={},this.deduped=new o.ao(W.scheduler),this.isSpriteLoaded=ve,this.scheduler=W.scheduler,this.brightness=Ue}loadTile(W,J){const de=W.uid,ve=W&&W.request,we=ve&&ve.collectResourceTiming,Ue=this.loading[de]=new re(W);Ue.abort=this.loadVectorData(W,(qe,Le)=>{const Ke=!this.loading[de];if(delete this.loading[de],Ke||qe||!Le)return Ue.status="done",Ke||(this.loaded[de]=Ue),J(qe);const St=Le.rawData,yt={};Le.expires&&(yt.expires=Le.expires),Le.cacheControl&&(yt.cacheControl=Le.cacheControl),Ue.vectorTile=Le.vectorTile||new o.dV(new o.dW(St));const Ht=()=>{Ue.parse(Ue.vectorTile,this.layerIndex,this.availableImages,this.actor,(Qt,br)=>{if(Qt||!br)return J(Qt);const Sr={};if(we){const gr=R(ve);gr.length>0&&(Sr.resourceTiming=JSON.parse(JSON.stringify(gr)))}J(null,o.W({rawTileData:St.slice(0)},br,yt,Sr))})};this.isSpriteLoaded?Ht():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Ht,{type:"parseTile",isSymbolTile:W.isSymbolTile,zoom:W.tileZoom}):Ht()}),this.loaded=this.loaded||{},this.loaded[de]=Ue})}reloadTile(W,J){const de=this.loaded,ve=W.uid;if(de&&de[ve]){const we=de[ve];we.showCollisionBoxes=W.showCollisionBoxes,we.projection=W.projection,we.brightness=W.brightness,we.tileTransform=o.dK(W.tileID.canonical,W.projection),we.extraShadowCaster=W.extraShadowCaster,we.lut=W.lut;const Ue=(qe,Le)=>{const Ke=we.reloadCallback;Ke&&(delete we.reloadCallback,we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,Ke)),J(qe,Le)};we.status==="parsing"?we.reloadCallback=Ue:we.status==="done"&&(we.vectorTile?we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor,Ue):Ue())}else J(null,void 0)}abortTile(W,J){const de=W.uid,ve=this.loading[de];ve&&(ve.abort&&ve.abort(),delete this.loading[de]),J()}removeTile(W,J){const de=this.loaded,ve=W.uid;de&&de[ve]&&delete de[ve],J()}}class q{loadTile(W,J){const{uid:de,encoding:ve,rawImageData:we,padding:Ue}=W,qe=ImageBitmap&&we instanceof ImageBitmap?this.getImageData(we,Ue):we;J(null,new o.dX(de,qe,ve,Ue<1))}getImageData(W,J){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(W.width,W.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=W.width,this.offscreenCanvas.height=W.height,this.offscreenCanvasContext.drawImage(W,0,0,W.width,W.height);const de=this.offscreenCanvasContext.getImageData(-J,-J,W.width+2*J,W.height+2*J);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),de}}class Q{decodeRasterArray({task:W,buffer:J},de){o.dY.performDecoding(J,W).then(ve=>{de(null,ve)},ve=>{de(ve)})}}const le=o.dZ.prototype.toGeoJSON;let ye=class{constructor(Ae){this._feature=Ae,this.extent=o.a3,this.type=Ae.type,this.properties=Ae.tags,"id"in Ae&&!isNaN(Ae.id)&&(this.id=parseInt(Ae.id,10))}loadGeometry(){if(this._feature.type===1){const Ae=[];for(const W of this._feature.geometry)Ae.push([new o.P(W[0],W[1])]);return Ae}{const Ae=[];for(const W of this._feature.geometry){const J=[];for(const de of W)J.push(new o.P(de[0],de[1]));Ae.push(J)}return Ae}}toGeoJSON(Ae,W,J){return le.call(this,Ae,W,J)}},ze=class{constructor(Ae){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.a3,this.length=Ae.length,this._features=Ae}feature(Ae){return new ye(this._features[Ae])}};const He=64/4096;class Ne{constructor(){this.features=new Map}clear(){this.features.clear()}load(W=[],J){for(const de of W){const ve=de.id;if(ve==null)continue;let we=this.features.get(ve);we&&this.updateCache(we,J),de.geometry?(we=Me(de),this.updateCache(we,J),this.features.set(ve,we)):this.features.delete(ve),this.updateCache(we,J)}}updateCache(W,J){for(const{canonical:de,uid:ve}of Object.values(J)){const{z:we,x:Ue,y:qe}=de;xe(W,Math.pow(2,we),Ue,qe)&&delete J[ve]}}getTile(W,J,de){const ve=Math.pow(2,W),we=[];for(const Ue of this.features.values())xe(Ue,ve,J,de)&&we.push(Ce(Ue,ve,J,de));return{features:we}}getFeatures(){return[...this.features.values()]}}function xe({minX:Ae,minY:W,maxX:J,maxY:de},ve,we,Ue){return Ae<(we+1+He)/ve&&W<(Ue+1+He)/ve&&J>(we-He)/ve&&de>(Ue-He)/ve}function Me(Ae){const{id:W,geometry:J,properties:de}=Ae;if(!J)return;if(J.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ve,coordinates:we}=J,Ue={id:W,type:1,geometry:[],tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},qe=Ue.geometry;if(ve==="Point")Ie(we,qe,Ue);else if(ve==="MultiPoint")for(const Le of we)Ie(Le,qe,Ue);else if(ve==="LineString")Ue.type=2,Je(we,qe,Ue);else if(ve==="MultiLineString")Ue.type=2,Be(we,qe,Ue);else if(ve==="Polygon")Ue.type=3,Be(we,qe,Ue,!0);else{if(ve!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ue.type=3;for(const Le of we)Be(Le,qe,Ue,!0)}return Ue}function Ie([Ae,W],J,de){const ve=o.aj(Ae);let we=o.ak(W);we=we<0?0:we>1?1:we,J.push(ve,we),de.minX=Math.min(de.minX,ve),de.minY=Math.min(de.minY,we),de.maxX=Math.max(de.maxX,ve),de.maxY=Math.max(de.maxY,we)}function Je(Ae,W,J,de=!1,ve=!1){const we=[];for(const Ue of Ae)Ie(Ue,we,J);W.push(we),de&&function(Ue,qe){let Le=0;for(let Ke=0,St=Ue.length,yt=St-2;Ke<St;yt=Ke,Ke+=2)Le+=(Ue[Ke]-Ue[yt])*(Ue[Ke+1]+Ue[yt+1]);if(Le>0===qe)for(let Ke=0,St=Ue.length;Ke<St/2;Ke+=2){const yt=Ue[Ke],Ht=Ue[Ke+1];Ue[Ke]=Ue[St-2-Ke],Ue[Ke+1]=Ue[St-1-Ke],Ue[St-2-Ke]=yt,Ue[St-1-Ke]=Ht}}(we,ve)}function Be(Ae,W,J,de=!1){for(let ve=0;ve<Ae.length;ve++)Je(Ae[ve],W,J,de,ve===0)}function Ce(Ae,W,J,de){const{id:ve,type:we,geometry:Ue,tags:qe}=Ae,Le=[];if(we===1)Re(Ue,W,J,de,Le);else for(const Ke of Ue)Le.push(Re(Ke,W,J,de));return{id:ve,type:we,geometry:Le,tags:qe}}function Re(Ae,W,J,de,ve=[]){for(let we=0;we<Ae.length;we+=2)ve.push(rt(Ae[we],Ae[we+1],W,J,de));return ve}function rt(Ae,W,J,de,ve){return[Math.round(o.a3*(Ae*J-de)),Math.round(o.a3*(W*J-ve))]}var st={exports:{}},at=o.d$,Ve=o.d_.VectorTileFeature,Dt=Bt;function Bt(Ae,W){this.options=W||{},this.features=Ae,this.length=Ae.length}function Gt(Ae,W){this.id=typeof Ae.id=="number"?Ae.id:void 0,this.type=Ae.type,this.rawGeometry=Ae.type===1?[Ae.geometry]:Ae.geometry,this.properties=Ae.tags,this.extent=W||4096}Bt.prototype.feature=function(Ae){return new Gt(this.features[Ae],this.options.extent)},Gt.prototype.loadGeometry=function(){var Ae=this.rawGeometry;this.geometry=[];for(var W=0;W<Ae.length;W++){for(var J=Ae[W],de=[],ve=0;ve<J.length;ve++)de.push(new at(J[ve][0],J[ve][1]));this.geometry.push(de)}return this.geometry},Gt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ae=this.geometry,W=1/0,J=-1/0,de=1/0,ve=-1/0,we=0;we<Ae.length;we++)for(var Ue=Ae[we],qe=0;qe<Ue.length;qe++){var Le=Ue[qe];W=Math.min(W,Le.x),J=Math.max(J,Le.x),de=Math.min(de,Le.y),ve=Math.max(ve,Le.y)}return[W,de,J,ve]},Gt.prototype.toGeoJSON=Ve.prototype.toGeoJSON;var qt=o.e0,or=Dt;function et(Ae){var W=new qt;return function(J,de){for(var ve in J.layers)de.writeMessage(3,kt,J.layers[ve])}(Ae,W),W.finish()}function kt(Ae,W){var J;W.writeVarintField(15,Ae.version||1),W.writeStringField(1,Ae.name||""),W.writeVarintField(5,Ae.extent||4096);var de={keys:[],values:[],keycache:{},valuecache:{}};for(J=0;J<Ae.length;J++)de.feature=Ae.feature(J),W.writeMessage(2,Vt,de);var ve=de.keys;for(J=0;J<ve.length;J++)W.writeStringField(3,ve[J]);var we=de.values;for(J=0;J<we.length;J++)W.writeMessage(4,$r,we[J])}function Vt(Ae,W){var J=Ae.feature;J.id!==void 0&&W.writeVarintField(1,J.id),W.writeMessage(2,dr,Ae),W.writeVarintField(3,J.type),W.writeMessage(4,ar,J)}function dr(Ae,W){var J=Ae.feature,de=Ae.keys,ve=Ae.values,we=Ae.keycache,Ue=Ae.valuecache;for(var qe in J.properties){var Le=J.properties[qe],Ke=we[qe];if(Le!==null){Ke===void 0&&(de.push(qe),we[qe]=Ke=de.length-1),W.writeVarint(Ke);var St=typeof Le;St!=="string"&&St!=="boolean"&&St!=="number"&&(Le=JSON.stringify(Le));var yt=St+":"+Le,Ht=Ue[yt];Ht===void 0&&(ve.push(Le),Ue[yt]=Ht=ve.length-1),W.writeVarint(Ht)}}}function ht(Ae,W){return(W<<3)+(7&Ae)}function vr(Ae){return Ae<<1^Ae>>31}function ar(Ae,W){for(var J=Ae.loadGeometry(),de=Ae.type,ve=0,we=0,Ue=J.length,qe=0;qe<Ue;qe++){var Le=J[qe],Ke=1;de===1&&(Ke=Le.length),W.writeVarint(ht(1,Ke));for(var St=de===3?Le.length-1:Le.length,yt=0;yt<St;yt++){yt===1&&de!==1&&W.writeVarint(ht(2,St-1));var Ht=Le[yt].x-ve,Qt=Le[yt].y-we;W.writeVarint(vr(Ht)),W.writeVarint(vr(Qt)),ve+=Ht,we+=Qt}de===3&&W.writeVarint(ht(7,1))}}function $r(Ae,W){var J=typeof Ae;J==="string"?W.writeStringField(1,Ae):J==="boolean"?W.writeBooleanField(7,Ae):J==="number"&&(Ae%1!=0?W.writeDoubleField(3,Ae):Ae<0?W.writeSVarintField(6,Ae):W.writeVarintField(5,Ae))}st.exports=et,st.exports.fromVectorTileJs=et,st.exports.fromGeojsonVt=function(Ae,W){W=W||{};var J={};for(var de in Ae)J[de]=new or(Ae[de].features,W),J[de].name=de,J[de].version=W.version,J[de].extent=W.extent;return et({layers:J})},st.exports.GeoJSONWrapper=or;var Lr=o.e1(st.exports);const xn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ae=>Ae},$n=Math.fround||(Ur=new Float32Array(1),Ae=>(Ur[0]=+Ae,Ur[0]));var Ur;const ni=3,ii=5,kn=6;class Wt{constructor(W){this.options=Object.assign(Object.create(xn),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:J,minZoom:de,maxZoom:ve}=this.options;J&&console.time("total time");const we=`prepare ${W.length} points`;J&&console.time(we),this.points=W;const Ue=[];for(let Le=0;Le<W.length;Le++){const Ke=W[Le];if(!Ke.geometry)continue;const[St,yt]=Ke.geometry.coordinates,Ht=$n(bi(St)),Qt=$n(Bo(yt));Ue.push(Ht,Qt,1/0,Le,-1,1),this.options.reduce&&Ue.push(0)}let qe=this.trees[ve+1]=this._createTree(Ue);J&&console.timeEnd(we);for(let Le=ve;Le>=de;Le--){const Ke=+Date.now();qe=this.trees[Le]=this._createTree(this._cluster(qe,Le)),J&&console.log("z%d: %d clusters in %dms",Le,qe.numItems,+Date.now()-Ke)}return J&&console.timeEnd("total time"),this}getClusters(W,J){let de=((W[0]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,W[1]));let we=W[2]===180?180:((W[2]+180)%360+360)%360-180;const Ue=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)de=-180,we=180;else if(de>we){const yt=this.getClusters([de,ve,180,Ue],J),Ht=this.getClusters([-180,ve,we,Ue],J);return yt.concat(Ht)}const qe=this.trees[this._limitZoom(J)],Le=qe.range(bi(de),Bo(Ue),bi(we),Bo(ve)),Ke=qe.data,St=[];for(const yt of Le){const Ht=this.stride*yt;St.push(Ke[Ht+ii]>1?er(Ke,Ht,this.clusterProps):this.points[Ke[Ht+ni]])}return St}getChildren(W){const J=this._getOriginId(W),de=this._getOriginZoom(W),ve="No cluster with the specified id.",we=this.trees[de];if(!we)throw new Error(ve);const Ue=we.data;if(J*this.stride>=Ue.length)throw new Error(ve);const qe=this.options.radius/(this.options.extent*Math.pow(2,de-1)),Le=we.within(Ue[J*this.stride],Ue[J*this.stride+1],qe),Ke=[];for(const St of Le){const yt=St*this.stride;Ue[yt+4]===W&&Ke.push(Ue[yt+ii]>1?er(Ue,yt,this.clusterProps):this.points[Ue[yt+ni]])}if(Ke.length===0)throw new Error(ve);return Ke}getLeaves(W,J,de){const ve=[];return this._appendLeaves(ve,W,J=J||10,de=de||0,0),ve}getTile(W,J,de){const ve=this.trees[this._limitZoom(W)],we=Math.pow(2,W),{extent:Ue,radius:qe}=this.options,Le=qe/Ue,Ke=(de-Le)/we,St=(de+1+Le)/we,yt={features:[]};return this._addTileFeatures(ve.range((J-Le)/we,Ke,(J+1+Le)/we,St),ve.data,J,de,we,yt),J===0&&this._addTileFeatures(ve.range(1-Le/we,Ke,1,St),ve.data,we,de,we,yt),J===we-1&&this._addTileFeatures(ve.range(0,Ke,Le/we,St),ve.data,-1,de,we,yt),yt.features.length?yt:null}getClusterExpansionZoom(W){let J=this._getOriginZoom(W)-1;for(;J<=this.options.maxZoom;){const de=this.getChildren(W);if(J++,de.length!==1)break;W=de[0].properties.cluster_id}return J}_appendLeaves(W,J,de,ve,we){const Ue=this.getChildren(J);for(const qe of Ue){const Le=qe.properties;if(Le&&Le.cluster?we+Le.point_count<=ve?we+=Le.point_count:we=this._appendLeaves(W,Le.cluster_id,de,ve,we):we<ve?we++:W.push(qe),W.length===de)break}return we}_createTree(W){const J=new o.cK(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let de=0;de<W.length;de+=this.stride)J.add(W[de],W[de+1]);return J.finish(),J.data=W,J}_addTileFeatures(W,J,de,ve,we,Ue){for(const qe of W){const Le=qe*this.stride,Ke=J[Le+ii]>1;let St,yt,Ht;if(Ke)St=go(J,Le,this.clusterProps),yt=J[Le],Ht=J[Le+1];else{const Sr=this.points[J[Le+ni]];St=Sr.properties;const[gr,Ir]=Sr.geometry.coordinates;yt=bi(gr),Ht=Bo(Ir)}const Qt={type:1,geometry:[[Math.round(this.options.extent*(yt*we-de)),Math.round(this.options.extent*(Ht*we-ve))]],tags:St};let br;br=Ke||this.options.generateId?J[Le+ni]:this.points[J[Le+ni]].id,br!==void 0&&(Qt.id=br),Ue.features.push(Qt)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,J){const{radius:de,extent:ve,reduce:we,minPoints:Ue}=this.options,qe=de/(ve*Math.pow(2,J)),Le=W.data,Ke=[],St=this.stride;for(let yt=0;yt<Le.length;yt+=St){if(Le[yt+2]<=J)continue;Le[yt+2]=J;const Ht=Le[yt],Qt=Le[yt+1],br=W.within(Le[yt],Le[yt+1],qe),Sr=Le[yt+ii];let gr=Sr;for(const Ir of br){const $t=Ir*St;Le[$t+2]>J&&(gr+=Le[$t+ii])}if(gr>Sr&&gr>=Ue){let Ir,$t=Ht*Sr,rn=Qt*Sr,Zr=-1;const Dr=(yt/St<<5)+(J+1)+this.points.length;for(const on of br){const hn=on*St;if(Le[hn+2]<=J)continue;Le[hn+2]=J;const Mn=Le[hn+ii];$t+=Le[hn]*Mn,rn+=Le[hn+1]*Mn,Le[hn+4]=Dr,we&&(Ir||(Ir=this._map(Le,yt,!0),Zr=this.clusterProps.length,this.clusterProps.push(Ir)),we(Ir,this._map(Le,hn)))}Le[yt+4]=Dr,Ke.push($t/gr,rn/gr,1/0,Dr,-1,gr),we&&Ke.push(Zr)}else{for(let Ir=0;Ir<St;Ir++)Ke.push(Le[yt+Ir]);if(gr>1)for(const Ir of br){const $t=Ir*St;if(!(Le[$t+2]<=J)){Le[$t+2]=J;for(let rn=0;rn<St;rn++)Ke.push(Le[$t+rn])}}}}return Ke}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,J,de){if(W[J+ii]>1){const Ue=this.clusterProps[W[J+kn]];return de?Object.assign({},Ue):Ue}const ve=this.points[W[J+ni]].properties,we=this.options.map(ve);return de&&we===ve?Object.assign({},we):we}}function er(Ae,W,J){return{type:"Feature",id:Ae[W+ni],properties:go(Ae,W,J),geometry:{type:"Point",coordinates:[(de=Ae[W],360*(de-.5)),ws(Ae[W+1])]}};var de}function go(Ae,W,J){const de=Ae[W+ii],ve=de>=1e4?`${Math.round(de/1e3)}k`:de>=1e3?Math.round(de/100)/10+"k":de,we=Ae[W+kn],Ue=we===-1?{}:Object.assign({},J[we]);return Object.assign(Ue,{cluster:!0,cluster_id:Ae[W+ni],point_count:de,point_count_abbreviated:ve})}function bi(Ae){return Ae/360+.5}function Bo(Ae){const W=Math.sin(Ae*Math.PI/180),J=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return J<0?0:J>1?1:J}function ws(Ae){const W=(180-360*Ae)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function Ts(Ae,W,J,de){let ve=de;const we=W+(J-W>>1);let Ue,qe=J-W;const Le=Ae[W],Ke=Ae[W+1],St=Ae[J],yt=Ae[J+1];for(let Ht=W+3;Ht<J;Ht+=3){const Qt=na(Ae[Ht],Ae[Ht+1],Le,Ke,St,yt);if(Qt>ve)Ue=Ht,ve=Qt;else if(Qt===ve){const br=Math.abs(Ht-we);br<qe&&(Ue=Ht,qe=br)}}ve>de&&(Ue-W>3&&Ts(Ae,W,Ue,de),Ae[Ue+2]=ve,J-Ue>3&&Ts(Ae,Ue,J,de))}function na(Ae,W,J,de,ve,we){let Ue=ve-J,qe=we-de;if(Ue!==0||qe!==0){const Le=((Ae-J)*Ue+(W-de)*qe)/(Ue*Ue+qe*qe);Le>1?(J=ve,de=we):Le>0&&(J+=Ue*Le,de+=qe*Le)}return Ue=Ae-J,qe=W-de,Ue*Ue+qe*qe}function No(Ae,W,J,de){const ve={id:Ae??null,type:W,geometry:J,tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(W==="Point"||W==="MultiPoint"||W==="LineString")Ss(ve,J);else if(W==="Polygon")Ss(ve,J[0]);else if(W==="MultiLineString")for(const we of J)Ss(ve,we);else if(W==="MultiPolygon")for(const we of J)Ss(ve,we[0]);return ve}function Ss(Ae,W){for(let J=0;J<W.length;J+=3)Ae.minX=Math.min(Ae.minX,W[J]),Ae.minY=Math.min(Ae.minY,W[J+1]),Ae.maxX=Math.max(Ae.maxX,W[J]),Ae.maxY=Math.max(Ae.maxY,W[J+1])}function Es(Ae,W,J,de){if(!W.geometry)return;const ve=W.geometry.coordinates;if(ve&&ve.length===0)return;const we=W.geometry.type,Ue=Math.pow(J.tolerance/((1<<J.maxZoom)*J.extent),2);let qe=[],Le=W.id;if(J.promoteId?Le=W.properties[J.promoteId]:J.generateId&&(Le=de||0),we==="Point")es(ve,qe);else if(we==="MultiPoint")for(const Ke of ve)es(Ke,qe);else if(we==="LineString")ts(ve,qe,Ue,!1);else if(we==="MultiLineString"){if(J.lineMetrics){for(const Ke of ve)qe=[],ts(Ke,qe,Ue,!1),Ae.push(No(Le,"LineString",qe,W.properties));return}Ms(ve,qe,Ue,!1)}else if(we==="Polygon")Ms(ve,qe,Ue,!0);else{if(we!=="MultiPolygon"){if(we==="GeometryCollection"){for(const Ke of W.geometry.geometries)Es(Ae,{id:Le,geometry:Ke,properties:W.properties},J,de);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ke of ve){const St=[];Ms(Ke,St,Ue,!0),qe.push(St)}}Ae.push(No(Le,we,qe,W.properties))}function es(Ae,W){W.push(Dn(Ae[0]),Da(Ae[1]),0)}function ts(Ae,W,J,de){let ve,we,Ue=0;for(let Le=0;Le<Ae.length;Le++){const Ke=Dn(Ae[Le][0]),St=Da(Ae[Le][1]);W.push(Ke,St,0),Le>0&&(Ue+=de?(ve*St-Ke*we)/2:Math.sqrt(Math.pow(Ke-ve,2)+Math.pow(St-we,2))),ve=Ke,we=St}const qe=W.length-3;W[2]=1,Ts(W,0,qe,J),W[qe+2]=1,W.size=Math.abs(Ue),W.start=0,W.end=W.size}function Ms(Ae,W,J,de){for(let ve=0;ve<Ae.length;ve++){const we=[];ts(Ae[ve],we,J,de),W.push(we)}}function Dn(Ae){return Ae/360+.5}function Da(Ae){const W=Math.sin(Ae*Math.PI/180),J=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return J<0?0:J>1?1:J}function sr(Ae,W,J,de,ve,we,Ue,qe){if(de/=W,we>=(J/=W)&&Ue<de)return Ae;if(Ue<J||we>=de)return null;const Le=[];for(const Ke of Ae){const St=Ke.geometry;let yt=Ke.type;const Ht=ve===0?Ke.minX:Ke.minY,Qt=ve===0?Ke.maxX:Ke.maxY;if(Ht>=J&&Qt<de){Le.push(Ke);continue}if(Qt<J||Ht>=de)continue;let br=[];if(yt==="Point"||yt==="MultiPoint")Is(St,br,J,de,ve);else if(yt==="LineString")ln(St,br,J,de,ve,!1,qe.lineMetrics);else if(yt==="MultiLineString")Uo(St,br,J,de,ve,!1);else if(yt==="Polygon")Uo(St,br,J,de,ve,!0);else if(yt==="MultiPolygon")for(const Sr of St){const gr=[];Uo(Sr,gr,J,de,ve,!0),gr.length&&br.push(gr)}if(br.length){if(qe.lineMetrics&&yt==="LineString"){for(const Sr of br)Le.push(No(Ke.id,yt,Sr,Ke.tags));continue}yt!=="LineString"&&yt!=="MultiLineString"||(br.length===1?(yt="LineString",br=br[0]):yt="MultiLineString"),yt!=="Point"&&yt!=="MultiPoint"||(yt=br.length===3?"Point":"MultiPoint"),Le.push(No(Ke.id,yt,br,Ke.tags))}}return Le.length?Le:null}function Is(Ae,W,J,de,ve){for(let we=0;we<Ae.length;we+=3){const Ue=Ae[we+ve];Ue>=J&&Ue<=de&&Wi(W,Ae[we],Ae[we+1],Ae[we+2])}}function ln(Ae,W,J,de,ve,we,Ue){let qe=Gn(Ae);const Le=ve===0?yo:ao;let Ke,St,yt=Ae.start;for(let gr=0;gr<Ae.length-3;gr+=3){const Ir=Ae[gr],$t=Ae[gr+1],rn=Ae[gr+2],Zr=Ae[gr+3],Dr=Ae[gr+4],on=ve===0?Ir:$t,hn=ve===0?Zr:Dr;let Mn=!1;Ue&&(Ke=Math.sqrt(Math.pow(Ir-Zr,2)+Math.pow($t-Dr,2))),on<J?hn>J&&(St=Le(qe,Ir,$t,Zr,Dr,J),Ue&&(qe.start=yt+Ke*St)):on>de?hn<de&&(St=Le(qe,Ir,$t,Zr,Dr,de),Ue&&(qe.start=yt+Ke*St)):Wi(qe,Ir,$t,rn),hn<J&&on>=J&&(St=Le(qe,Ir,$t,Zr,Dr,J),Mn=!0),hn>de&&on<=de&&(St=Le(qe,Ir,$t,Zr,Dr,de),Mn=!0),!we&&Mn&&(Ue&&(qe.end=yt+Ke*St),W.push(qe),qe=Gn(Ae)),Ue&&(yt+=Ke)}let Ht=Ae.length-3;const Qt=Ae[Ht],br=Ae[Ht+1],Sr=ve===0?Qt:br;Sr>=J&&Sr<=de&&Wi(qe,Qt,br,Ae[Ht+2]),Ht=qe.length-3,we&&Ht>=3&&(qe[Ht]!==qe[0]||qe[Ht+1]!==qe[1])&&Wi(qe,qe[0],qe[1],qe[2]),qe.length&&W.push(qe)}function Gn(Ae){const W=[];return W.size=Ae.size,W.start=Ae.start,W.end=Ae.end,W}function Uo(Ae,W,J,de,ve,we){for(const Ue of Ae)ln(Ue,W,J,de,ve,we,!1)}function Wi(Ae,W,J,de){Ae.push(W,J,de)}function yo(Ae,W,J,de,ve,we){const Ue=(we-W)/(de-W);return Wi(Ae,we,J+(ve-J)*Ue,1),Ue}function ao(Ae,W,J,de,ve,we){const Ue=(we-J)/(ve-J);return Wi(Ae,W+(de-W)*Ue,we,1),Ue}function vo(Ae,W){const J=[];for(let de=0;de<Ae.length;de++){const ve=Ae[de],we=ve.type;let Ue;if(we==="Point"||we==="MultiPoint"||we==="LineString")Ue=lo(ve.geometry,W);else if(we==="MultiLineString"||we==="Polygon"){Ue=[];for(const qe of ve.geometry)Ue.push(lo(qe,W))}else if(we==="MultiPolygon"){Ue=[];for(const qe of ve.geometry){const Le=[];for(const Ke of qe)Le.push(lo(Ke,W));Ue.push(Le)}}J.push(No(ve.id,we,Ue,ve.tags))}return J}function lo(Ae,W){const J=[];J.size=Ae.size,Ae.start!==void 0&&(J.start=Ae.start,J.end=Ae.end);for(let de=0;de<Ae.length;de+=3)J.push(Ae[de]+W,Ae[de+1],Ae[de+2]);return J}function ia(Ae,W){if(Ae.transformed)return Ae;const J=1<<Ae.z,de=Ae.x,ve=Ae.y;for(const we of Ae.features){const Ue=we.geometry,qe=we.type;if(we.geometry=[],qe===1)for(let Le=0;Le<Ue.length;Le+=2)we.geometry.push(rs(Ue[Le],Ue[Le+1],W,J,de,ve));else for(let Le=0;Le<Ue.length;Le++){const Ke=[];for(let St=0;St<Ue[Le].length;St+=2)Ke.push(rs(Ue[Le][St],Ue[Le][St+1],W,J,de,ve));we.geometry.push(Ke)}}return Ae.transformed=!0,Ae}function rs(Ae,W,J,de,ve,we){return[Math.round(J*(Ae*de-ve)),Math.round(J*(W*de-we))]}function Ii(Ae,W,J,de,ve){const we=W===ve.maxZoom?0:ve.tolerance/((1<<W)*ve.extent),Ue={features:[],numPoints:0,numSimplified:0,numFeatures:Ae.length,source:null,x:J,y:de,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const qe of Ae)uo(Ue,qe,we,ve);return Ue}function uo(Ae,W,J,de){const ve=W.geometry,we=W.type,Ue=[];if(Ae.minX=Math.min(Ae.minX,W.minX),Ae.minY=Math.min(Ae.minY,W.minY),Ae.maxX=Math.max(Ae.maxX,W.maxX),Ae.maxY=Math.max(Ae.maxY,W.maxY),we==="Point"||we==="MultiPoint")for(let qe=0;qe<ve.length;qe+=3)Ue.push(ve[qe],ve[qe+1]),Ae.numPoints++,Ae.numSimplified++;else if(we==="LineString")Ai(Ue,ve,Ae,J,!1,!1);else if(we==="MultiLineString"||we==="Polygon")for(let qe=0;qe<ve.length;qe++)Ai(Ue,ve[qe],Ae,J,we==="Polygon",qe===0);else if(we==="MultiPolygon")for(let qe=0;qe<ve.length;qe++){const Le=ve[qe];for(let Ke=0;Ke<Le.length;Ke++)Ai(Ue,Le[Ke],Ae,J,!0,Ke===0)}if(Ue.length){let qe=W.tags||null;if(we==="LineString"&&de.lineMetrics){qe={};for(const Ke in W.tags)qe[Ke]=W.tags[Ke];qe.mapbox_clip_start=ve.start/ve.size,qe.mapbox_clip_end=ve.end/ve.size}const Le={geometry:Ue,type:we==="Polygon"||we==="MultiPolygon"?3:we==="LineString"||we==="MultiLineString"?2:1,tags:qe};W.id!==null&&(Le.id=W.id),Ae.features.push(Le)}}function Ai(Ae,W,J,de,ve,we){const Ue=de*de;if(de>0&&W.size<(ve?Ue:de))return void(J.numPoints+=W.length/3);const qe=[];for(let Le=0;Le<W.length;Le+=3)(de===0||W[Le+2]>Ue)&&(J.numSimplified++,qe.push(W[Le],W[Le+1])),J.numPoints++;ve&&function(Le,Ke){let St=0;for(let yt=0,Ht=Le.length,Qt=Ht-2;yt<Ht;Qt=yt,yt+=2)St+=(Le[yt]-Le[Qt])*(Le[yt+1]+Le[Qt+1]);if(St>0===Ke)for(let yt=0,Ht=Le.length;yt<Ht/2;yt+=2){const Qt=Le[yt],br=Le[yt+1];Le[yt]=Le[Ht-2-yt],Le[yt+1]=Le[Ht-1-yt],Le[Ht-2-yt]=Qt,Le[Ht-1-yt]=br}}(qe,we),Ae.push(qe)}const xo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class oi{constructor(W,J){const de=(J=this.options=function(we,Ue){for(const qe in Ue)we[qe]=Ue[qe];return we}(Object.create(xo),J)).debug;if(de&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");let ve=function(we,Ue){const qe=[];if(we.type==="FeatureCollection")for(let Le=0;Le<we.features.length;Le++)Es(qe,we.features[Le],Ue,Le);else Es(qe,we.type==="Feature"?we:{geometry:we},Ue);return qe}(W,J);this.tiles={},this.tileCoords=[],de&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ve=function(we,Ue){const qe=Ue.buffer/Ue.extent;let Le=we;const Ke=sr(we,1,-1-qe,qe,0,-1,2,Ue),St=sr(we,1,1-qe,2+qe,0,-1,2,Ue);return(Ke||St)&&(Le=sr(we,1,-qe,1+qe,0,-1,2,Ue)||[],Ke&&(Le=vo(Ke,1).concat(Le)),St&&(Le=Le.concat(vo(St,-1)))),Le}(ve,J),ve.length&&this.splitTile(ve,0,0,0),de&&(ve.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(W,J,de,ve,we,Ue,qe){const Le=[W,J,de,ve],Ke=this.options,St=Ke.debug;for(;Le.length;){ve=Le.pop(),de=Le.pop(),J=Le.pop(),W=Le.pop();const yt=1<<J,Ht=Yn(J,de,ve);let Qt=this.tiles[Ht];if(!Qt&&(St>1&&console.time("creation"),Qt=this.tiles[Ht]=Ii(W,J,de,ve,Ke),this.tileCoords.push({z:J,x:de,y:ve}),St)){St>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,de,ve,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));const Mn=`z${J}`;this.stats[Mn]=(this.stats[Mn]||0)+1,this.total++}if(Qt.source=W,we==null){if(J===Ke.indexMaxZoom||Qt.numPoints<=Ke.indexMaxPoints)continue}else{if(J===Ke.maxZoom||J===we)continue;if(we!=null){const Mn=we-J;if(de!==Ue>>Mn||ve!==qe>>Mn)continue}}if(Qt.source=null,W.length===0)continue;St>1&&console.time("clipping");const br=.5*Ke.buffer/Ke.extent,Sr=.5-br,gr=.5+br,Ir=1+br;let $t=null,rn=null,Zr=null,Dr=null,on=sr(W,yt,de-br,de+gr,0,Qt.minX,Qt.maxX,Ke),hn=sr(W,yt,de+Sr,de+Ir,0,Qt.minX,Qt.maxX,Ke);W=null,on&&($t=sr(on,yt,ve-br,ve+gr,1,Qt.minY,Qt.maxY,Ke),rn=sr(on,yt,ve+Sr,ve+Ir,1,Qt.minY,Qt.maxY,Ke),on=null),hn&&(Zr=sr(hn,yt,ve-br,ve+gr,1,Qt.minY,Qt.maxY,Ke),Dr=sr(hn,yt,ve+Sr,ve+Ir,1,Qt.minY,Qt.maxY,Ke),hn=null),St>1&&console.timeEnd("clipping"),Le.push($t||[],J+1,2*de,2*ve),Le.push(rn||[],J+1,2*de,2*ve+1),Le.push(Zr||[],J+1,2*de+1,2*ve),Le.push(Dr||[],J+1,2*de+1,2*ve+1)}}getTile(W,J,de){W=+W,J=+J,de=+de;const ve=this.options,{extent:we,debug:Ue}=ve;if(W<0||W>24)return null;const qe=1<<W,Le=Yn(W,J=J+qe&qe-1,de);if(this.tiles[Le])return ia(this.tiles[Le],we);Ue>1&&console.log("drilling down to z%d-%d-%d",W,J,de);let Ke,St=W,yt=J,Ht=de;for(;!Ke&&St>0;)St--,yt>>=1,Ht>>=1,Ke=this.tiles[Yn(St,yt,Ht)];return Ke&&Ke.source?(Ue>1&&(console.log("found parent tile z%d-%d-%d",St,yt,Ht),console.time("drilling down")),this.splitTile(Ke.source,St,yt,Ht,W,J,de),Ue>1&&console.timeEnd("drilling down"),this.tiles[Le]?ia(this.tiles[Le],we):null):null}}function Yn(Ae,W,J){return 32*((1<<Ae)*J+W)+Ae}function Ra(Ae,W){const J=Ae.tileID.canonical;if(!this._geoJSONIndex)return W(null,null);const de=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!de)return W(null,null);const ve=new ze(de.features);let we=Lr(ve);we.byteOffset===0&&we.byteLength===we.buffer.byteLength||(we=new Uint8Array(we)),W(null,{vectorTile:ve,rawData:we.buffer})}class ns extends ae{constructor(W,J,de,ve,we,Ue){super(W,J,de,ve,Ra,Ue),we&&(this.loadGeoJSON=we),this._dynamicIndex=new Ne}loadData(W,J){const de=W&&W.request,ve=de&&de.collectResourceTiming;this.loadGeoJSON(W,(we,Ue)=>{if(we||!Ue)return J(we);if(typeof Ue!="object")return J(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));{try{if(W.filter){const Le=o.y(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Le.result==="error")throw new Error(Le.value.map(Ke=>`${Ke.key}: ${Ke.message}`).join(", "));Ue.features=Ue.features.filter(Ke=>Le.value.evaluate({zoom:0},Ke))}W.dynamic?(Ue.type==="Feature"&&(Ue={type:"FeatureCollection",features:[Ue]}),W.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ue.features,this.loaded),W.cluster&&(Ue.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=W.cluster?new Wt(function({superclusterOptions:Le,clusterProperties:Ke}){if(!Ke||!Le)return Le;const St={},yt={},Ht={accumulated:null,zoom:0},Qt={properties:null},br=Object.keys(Ke);for(const Sr of br){const[gr,Ir]=Ke[Sr],$t=o.y(Ir),rn=o.y(typeof gr=="string"?[gr,["accumulated"],["get",Sr]]:gr);St[Sr]=$t.value,yt[Sr]=rn.value}return Le.map=Sr=>{Qt.properties=Sr;const gr={};for(const Ir of br)gr[Ir]=St[Ir].evaluate(Ht,Qt);return gr},Le.reduce=(Sr,gr)=>{Qt.properties=gr;for(const Ir of br)Ht.accumulated=Sr[Ir],Sr[Ir]=yt[Ir].evaluate(Ht,Qt)},Le}(W)).load(Ue.features):W.dynamic?this._dynamicIndex:function(Le,Ke){return new oi(Le,Ke)}(Ue,W.geojsonVtOptions)}catch(Le){return J(Le)}const qe={};if(ve){const Le=R(de);Le&&(qe.resourceTiming={},qe.resourceTiming[W.source]=JSON.parse(JSON.stringify(Le)))}J(null,qe)}})}reloadTile(W,J){const de=this.loaded;return de&&de[W.uid]?W.partial?J(null,void 0):super.reloadTile(W,J):this.loadTile(W,J)}loadGeoJSON(W,J){if(W.request)o.g(W.request,J);else{if(typeof W.data!="string")return J(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));try{return J(null,JSON.parse(W.data))}catch{return J(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(W,J){try{J(null,this._geoJSONIndex.getClusterExpansionZoom(W.clusterId))}catch(de){J(de)}}getClusterChildren(W,J){try{J(null,this._geoJSONIndex.getChildren(W.clusterId))}catch(de){J(de)}}getClusterLeaves(W,J){try{J(null,this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset))}catch(de){J(de)}}}class As{constructor(W,J){this.tileID=new o.aL(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.tileZoom=W.tileZoom,this.uid=W.uid,this.zoom=W.zoom,this.canonical=W.tileID.canonical,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=W.projection,this.brightness=J}parse(W,J,de,ve){this.status="parsing";const we=new o.aL(de.tileID.overscaledZ,de.tileID.wrap,de.tileID.canonical.z,de.tileID.canonical.x,de.tileID.canonical.y),Ue={},qe=J.familiesBySource[de.source],Le=new o.dN(we,de.promoteId);return Le.bucketLayerIDs=[],Le.is3DTile=!0,o.e3(W).then(Ke=>{if(!Ke)return ve(new Error("Could not parse tile"));const St=o.e4(Ke,1/o.b5(de.tileID.canonical)),yt=Ke.json.extensionsUsed&&Ke.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ke.json.asset.extras&&Ke.json.asset.extras.MAPBOX_mesh_features,Ht=Ke.json.extensionsUsed&&Ke.json.extensionsUsed.includes("EXT_meshopt_compression"),Qt=new o.X(this.zoom,{brightness:this.brightness});for(const br in qe)for(const Sr of qe[br]){const gr=Sr[0];Le.bucketLayerIDs.push(Sr.map($t=>$t.id)),gr.recalculate(Qt,[]);const Ir=new o.e5(St,we,yt,Ht,this.brightness,Le);yt||(Ir.needsUpload=!0),Ue[gr.fqid]=Ir,Ir.evaluate(gr)}this.status="done",ve(null,{buckets:Ue,featureIndex:Le})}).catch(Ke=>ve(new Error(Ke.message)))}}class ka{constructor(W,J,de,ve,we,Ue){this.actor=W,this.layerIndex=J,this.brightness=Ue,this.loading={},this.loaded={}}loadTile(W,J){const de=W.uid,ve=this.loading[de]=new As(W,this.brightness);o.e2(W.request,(we,Ue)=>{const qe=!this.loading[de];return delete this.loading[de],qe||we?(ve.status="done",qe||(this.loaded[de]=ve),J(we)):Ue&&Ue.byteLength!==0?void ve.parse(Ue,this.layerIndex,W,(Le,Ke)=>{ve.status="done",this.loaded=this.loaded||{},this.loaded[de]=ve,Le||!Ke?J(Le):J(null,Ke)}):(ve.status="done",this.loaded[de]=ve,J())})}reloadTile(W,J){const de=this.loaded,ve=W.uid;if(de&&de[ve]){const we=de[ve];we.projection=W.projection,we.brightness=W.brightness;const Ue=(qe,Le)=>{we.reloadCallback&&(delete we.reloadCallback,this.loadTile(W,J)),J(qe,Le)};we.status==="parsing"?we.reloadCallback=Ue:we.status==="done"&&this.loadTile(W,J)}}abortTile(W,J){const de=W.uid;this.loading[de]&&delete this.loading[de],J()}removeTile(W,J){const de=this.loaded,ve=W.uid;de&&de[ve]&&delete de[ve],J()}}class is{constructor(W){this.self=W,this.actor=new o.e6(W,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.aJ({name:"mercator"}),this.workerSourceTypes={vector:ae,geojson:ns,"batched-model":ka},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(J,de)=>{if(this.workerSourceTypes[J])throw new Error(`Worker source with name "${J}" already registered.`);this.workerSourceTypes[J]=de},this.self.registerRTLTextPlugin=J=>{if(o.e7.isParsed())throw new Error("RTL text plugin already registered.");o.e7.applyArabicShaping=J.applyArabicShaping,o.e7.processBidirectionalText=J.processBidirectionalText,o.e7.processStyledBidirectionalText=J.processStyledBidirectionalText}}clearCaches(W,J,de){delete this.layerIndexes[W],delete this.availableImages[W],delete this.workerSources[W],delete this.demWorkerSources[W],delete this.rasterArrayWorkerSource,de()}checkIfReady(W,J,de){de()}setReferrer(W,J){this.referrer=J}spriteLoaded(W,{scope:J,isLoaded:de}){if(this.isSpriteLoaded[W]||(this.isSpriteLoaded[W]={}),this.isSpriteLoaded[W][J]=de,this.workerSources[W]&&this.workerSources[W][J])for(const ve in this.workerSources[W][J]){const we=this.workerSources[W][J][ve];for(const Ue in we){const qe=we[Ue];qe instanceof ae&&(qe.isSpriteLoaded=de,qe.fire(new o.f("isSpriteLoaded")))}}}setImages(W,{scope:J,images:de},ve){if(this.availableImages[W]||(this.availableImages[W]={}),this.availableImages[W][J]=de,this.workerSources[W]&&this.workerSources[W][J]){for(const we in this.workerSources[W][J]){const Ue=this.workerSources[W][J][we];for(const qe in Ue)Ue[qe].availableImages=de}ve()}else ve()}setProjection(W,J){this.projections[W]=o.aJ(J)}setBrightness(W,J,de){this.brightness=J,de()}setLayers(W,J,de){this.getLayerIndex(W,J.scope).replace(J.layers,J.options),de()}updateLayers(W,J,de){this.getLayerIndex(W,J.scope).update(J.layers,J.removedIds,J.options),de()}loadTile(W,J,de){J.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,J.type,J.source,J.scope).loadTile(J,de)}loadDEMTile(W,J,de){this.getDEMWorkerSource(W,J.source,J.scope).loadTile(J,de)}decodeRasterArray(W,J,de){this.getRasterArrayWorkerSource().decodeRasterArray(J,de)}reloadTile(W,J,de){J.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,J.type,J.source,J.scope).reloadTile(J,de)}abortTile(W,J,de){this.getWorkerSource(W,J.type,J.source,J.scope).abortTile(J,de)}removeTile(W,J,de){this.getWorkerSource(W,J.type,J.source,J.scope).removeTile(J,de)}removeSource(W,J,de){if(!(this.workerSources[W]&&this.workerSources[W][J.scope]&&this.workerSources[W][J.scope][J.type]&&this.workerSources[W][J.scope][J.type][J.source]))return;const ve=this.workerSources[W][J.scope][J.type][J.source];delete this.workerSources[W][J.scope][J.type][J.source],ve.removeSource!==void 0?ve.removeSource(J,de):de()}loadWorkerSource(W,J,de){try{this.self.importScripts(J.url),de()}catch(ve){de(ve.toString())}}syncRTLPluginState(W,J,de){try{o.e7.setState(J);const ve=o.e7.getPluginURL();if(o.e7.isLoaded()&&!o.e7.isParsed()&&ve!=null){this.self.importScripts(ve);const we=o.e7.isParsed();de(we?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ve}`),we)}}catch(ve){de(ve.toString())}}setDracoUrl(W,J){this.dracoUrl=J}getAvailableImages(W,J){this.availableImages[W]||(this.availableImages[W]={});let de=this.availableImages[W][J];return de||(de=[]),de}getLayerIndex(W,J){this.layerIndexes[W]||(this.layerIndexes[W]={});let de=this.layerIndexes[W][J];return de||(de=this.layerIndexes[W][J]=new Z,de.scope=J),de}getWorkerSource(W,J,de,ve){return this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][ve]||(this.workerSources[W][ve]={}),this.workerSources[W][ve][J]||(this.workerSources[W][ve][J]={}),this.isSpriteLoaded[W]||(this.isSpriteLoaded[W]={}),this.workerSources[W][ve][J][de]||(this.workerSources[W][ve][J][de]=new this.workerSourceTypes[J]({send:(we,Ue,qe,Le,Ke,St)=>{this.actor.send(we,Ue,qe,W,Ke,St)},scheduler:this.actor.scheduler},this.getLayerIndex(W,ve),this.getAvailableImages(W,ve),this.isSpriteLoaded[W][ve],void 0,this.brightness)),this.workerSources[W][ve][J][de]}getDEMWorkerSource(W,J,de){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][de]||(this.demWorkerSources[W][de]={}),this.demWorkerSources[W][de][J]||(this.demWorkerSources[W][de][J]=new q),this.demWorkerSources[W][de][J]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Q),this.rasterArrayWorkerSource}enforceCacheSizeLimit(W,J){o.e8(J)}getWorkerPerformanceMetrics(W,J,de){de(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new is(self)),is}),M(["./shared"],function(o){function R(p,i){if(Array.isArray(p)){if(!Array.isArray(i)||p.length!==i.length)return!1;for(let c=0;c<p.length;c++)if(!R(p[c],i[c]))return!1;return!0}if(typeof p=="object"&&p!==null&&i!==null){if(typeof i!="object"||Object.keys(p).length!==Object.keys(i).length)return!1;for(const c in p)if(!R(p[c],i[c]))return!1;return!0}return p===i}var U=V;function V(p){return!function(i){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,x,w=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(w);try{x=new Worker(S),_=!0}catch{_=!1}return x&&x.terminate(),URL.revokeObjectURL(S),_}()?function(){var _=document.createElement("canvas");_.width=_.height=1;var x=_.getContext("2d");if(!x)return!1;var w=x.getImageData(0,0,1,1);return w&&w.width===_.width}()?(Z[c=i&&i.failIfMajorPerformanceCaveat]===void 0&&(Z[c]=function(_){var x,w=function(S){var I=document.createElement("canvas"),O=Object.create(V.webGLContextAttributes);return O.failIfMajorPerformanceCaveat=S,I.getContext("webgl2",O)}(_);if(!w)return!1;try{x=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!x||w.isContextLost())&&(w.shaderSource(x,"void main() {}"),w.compileShader(x),w.getShaderParameter(x,w.COMPILE_STATUS)===!0)}(c)),Z[c]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var c}(p)}var Z={};function te(p,i,c){const _=document.createElement(p);return i!=null&&(_.className=i),c&&c.appendChild(_),_}function se(p,i,c){const _=document.createElementNS("http://www.w3.org/2000/svg",p);for(const x of Object.keys(i))_.setAttributeNS(null,x,String(i[x]));return c&&c.appendChild(_),_}V.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const re=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Te=re&&re.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ae;function q(){re&&Te&&(ae=re[Te],re[Te]="none")}function Q(){re&&Te&&(re[Te]=ae)}function le(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",le,!0)}function ye(){window.addEventListener("click",le,!0),window.setTimeout(()=>{window.removeEventListener("click",le,!0)},0)}function ze(p,i){const c=p.getBoundingClientRect();return xe(p,c,i)}function He(p,i){const c=p.getBoundingClientRect(),_=[];for(let x=0;x<i.length;x++)_.push(xe(p,c,i[x]));return _}function Ne(p){return window.InstallTrigger!==void 0&&p.button===2&&p.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function xe(p,i,c){const _=p.offsetWidth===i.width?1:p.offsetWidth/i.width;return new o.P((c.clientX-i.left)*_,(c.clientY-i.top)*_)}class Me{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,c){this._updatedSourceCaches[i]=c,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const c=i.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(i.id),this.setDirty()}removeLayer(i){const c=i.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][i.id]=i,this._updatedLayers[c].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const c in this._updatedLayers)i[c]=i[c]||{},i[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)i[c]=i[c]||{},i[c].removedIds=Object.keys(this._removedLayers[c]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(i){this._updatedImages.add(i),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const Ie={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Je{constructor(i,c,_,x,w,S){this.length=c.length,this.attributes=_,this.itemSize=c.bytesPerElement,this.dynamicDraw=x,this.instanceCount=S,this.context=i;const I=i.gl;this.buffer=I.createBuffer(),i.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||w||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,c){for(let _=0;_<this.attributes.length;_++){const x=c.attributes[this.attributes[_].name];x!==void 0&&i.enableVertexAttribArray(x)}}setVertexAttribPointers(i,c,_){for(let x=0;x<this.attributes.length;x++){const w=this.attributes[x],S=c.attributes[w.name];S!==void 0&&i.vertexAttribPointer(S,w.components,i[Ie[w.type]],!1,this.itemSize,w.offset+this.itemSize*(_||0))}}setVertexAttribDivisor(i,c,_){for(let x=0;x<this.attributes.length;x++){const w=c.attributes[this.attributes[x].name];w!==void 0&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(w,_)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Be{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ce extends Be{getDefault(){return o.C.transparent}set(i){const c=this.current;(i.r!==c.r||i.g!==c.g||i.b!==c.b||i.a!==c.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Re extends Be{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class rt extends Be{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class st extends Be{getDefault(){return[!0,!0,!0,!0]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class at extends Be{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Ve extends Be{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Dt extends Be{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const c=this.current;(i.func!==c.func||i.ref!==c.ref||i.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Bt extends Be{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Gt extends Be{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=i,this.dirty=!1}}class qt extends Be{getDefault(){return[0,1]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class or extends Be{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=i,this.dirty=!1}}class et extends Be{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class kt extends Be{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.BLEND):c.disable(c.BLEND),this.current=i,this.dirty=!1}}class Vt extends Be{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class dr extends Be{getDefault(){return o.C.transparent}set(i){const c=this.current;(i.r!==c.r||i.g!==c.g||i.b!==c.b||i.a!==c.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class ht extends Be{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class vr extends Be{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=i,this.dirty=!1}}class ar extends Be{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class $r extends Be{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let Lr=class extends Be{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class xn extends Be{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class $n extends Be{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ur extends Be{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class ni extends Be{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class ii extends Be{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class kn extends Be{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Wt extends Be{getDefault(){return null}set(i){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class er extends Be{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class go extends Be{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class bi extends Be{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Bo extends Be{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class ws extends Be{constructor(i,c){super(i),this.context=i,this.parent=c}getDefault(){return null}}class Ts extends ws{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class na extends ws{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class No extends ws{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Ss extends na{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Es{constructor(i,c,_,x,w){this.context=i,this.width=c,this.height=_;const S=this.framebuffer=i.gl.createFramebuffer();x&&(this.colorAttachment=new Ts(i,S)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new na(i,S):new No(i,S))}destroy(){const i=this.context.gl;if(this.colorAttachment){const c=this.colorAttachment.get();c&&i.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&i.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&i.deleteTexture(c)}i.deleteFramebuffer(this.framebuffer)}}class es{constructor(i,c){this.gl=i,this.clearColor=new Ce(this),this.clearDepth=new Re(this),this.clearStencil=new rt(this),this.colorMask=new st(this),this.depthMask=new at(this),this.stencilMask=new Ve(this),this.stencilFunc=new Dt(this),this.stencilOp=new Bt(this),this.stencilTest=new Gt(this),this.depthRange=new qt(this),this.depthTest=new or(this),this.depthFunc=new et(this),this.blend=new kt(this),this.blendFunc=new Vt(this),this.blendColor=new dr(this),this.blendEquation=new ht(this),this.cullFace=new vr(this),this.cullFaceSide=new ar(this),this.frontFace=new $r(this),this.program=new Lr(this),this.activeTexture=new xn(this),this.viewport=new $n(this),this.bindFramebuffer=new Ur(this),this.bindRenderbuffer=new ni(this),this.bindTexture=new ii(this),this.bindVertexBuffer=new kn(this),this.bindElementBuffer=new Wt(this),this.bindVertexArrayOES=new er(this),this.pixelStoreUnpack=new go(this),this.pixelStoreUnpackPremultiplyAlpha=new bi(this),this.pixelStoreUnpackFlipY=new Bo(this),this.options=c?{...c}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,c,_){return new o.I(this,i,c,_)}createVertexBuffer(i,c,_,x,w){return new Je(this,i,c,_,x,w)}createRenderbuffer(i,c,_){const x=this.gl,w=x.createRenderbuffer();return this.bindRenderbuffer.set(w),x.renderbufferStorage(x.RENDERBUFFER,i,c,_),this.bindRenderbuffer.set(null),w}createFramebuffer(i,c,_,x){return new Es(this,i,c,_,x)}clear({color:i,depth:c,stencil:_,colorMask:x}){const w=this.gl;let S=0;i&&(S|=w.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set(x||[!0,!0,!0,!0])),c!==void 0&&(S|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),_!==void 0&&(S|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),w.clear(S)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){R(i.blendFunction,o.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class ts{constructor(i){this._gl=i.gl,this._query=this._gl.createQuery(),this._isFree=!0}begin(){this._gl.beginQuery(this._gl.ANY_SAMPLES_PASSED,this._query),this._isFree=!1}end(){this._gl.endQuery(this._gl.ANY_SAMPLES_PASSED)}isResultAvailable(){return this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT_AVAILABLE)}consumeResult(){const i=this._gl.getQueryParameter(this._query,this._gl.QUERY_RESULT);return this._isFree=!0,i}isFree(){return this._isFree}destroy(){this._gl.deleteQuery(this._query)}}class Ms{constructor(i){this.useOcclusionQueries=!0,this.visualizeOcclusions="none",this.occlusionQueryFrameWindow=5,this.occluderSize=32,this.fadeSpeed=7,this.depthOffset=-1e-4,i.registerParameter(this,["Symbols"],"useOcclusionQueries"),i.registerParameter(this,["Symbols"],"visualizeOcclusions",{options:{none:"none",zPass:"zPass",zTest:"zTest"}}),i.registerParameter(this,["Symbols"],"occlusionQueryFrameWindow",{min:1,max:30,step:1}),i.registerParameter(this,["Symbols"],"occluderSize",{min:1,max:100,step:1}),i.registerParameter(this,["Symbols"],"fadeSpeed",{min:.1,max:50,step:.1}),i.registerParameter(this,["Symbols"],"depthOffset",{min:-.001,max:0,step:1e-4})}}class Dn{constructor(i,c,_,x){const w={width:_[0],height:_[1],data:null},S=i.gl;this.targetColorTexture=new o.T(i,w,S.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new o.T(i,w,S.RGBA,{useMipmap:!1}),this.context=i,this.updateParticleTexture(c,x),this.lastInvalidatedAt=0}updateParticleTexture(i,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const _=this.context.gl,x=c.width*c.height;this.particleTexture0=new o.T(this.context,c,_.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,c,_.RGBA,{premultiply:!1,useMipmap:!1});const w=new o.S;w.reserve(x);for(let S=0;S<x;S++)w.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(w,o.p.members,!0),this.particleSegment=o.b.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=o.e.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}class Da extends o.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.numModelsLoading={}}loadModel(i,c){return o.l(this.requestManager.transformRequest(c,o.R.Model).url).then(_=>{if(!_)return;const x=o.c(_),w=new o.M(i,void 0,void 0,x);return w.computeBoundsAndApplyParent(),w}).catch(_=>{if(_&&_.status===404)return null;this.fire(new o.d(new Error(`Could not load model ${i} from ${c}: ${_.message}`)))})}load(i,c){this.models[c]||(this.models[c]={});const _=Object.keys(i);this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+_.length;const x=[];for(const w of _)x.push(this.loadModel(w,i[w]));Promise.allSettled(x).then(w=>{for(let S=0;S<w.length;S++){const{status:I,value:O}=w[S];I==="fulfilled"&&O&&(this.models[c][_[S]]={model:O,numReferences:1})}this.numModelsLoading[c]-=_.length,this.fire(new o.f("data",{dataType:"style"}))}).catch(w=>{this.fire(new o.d(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,c){return!!this.getModel(i,c)}getModel(i,c){return this.models[c]||(this.models[c]={}),this.models[c][i]?this.models[c][i].model:void 0}addModel(i,c,_){this.models[_]||(this.models[_]={}),this.hasModel(i,_)&&this.models[_][i].numReferences++,this.load({[i]:this.requestManager.normalizeModelURL(c)},_)}addModels(i,c){this.models[c]||(this.models[c]={});const _={};for(const x in i)this.models[c][x]={},_[x]=this.requestManager.normalizeModelURL(i[x]);this.load(_,c)}addModelsFromBucket(i,c){this.models[c]||(this.models[c]={});const _={};for(const x of i)this.hasModel(x,c)?this.models[c][x].numReferences++:_[x]=this.requestManager.normalizeModelURL(x);this.load(_,c)}removeModel(i,c){if(this.models[c]&&this.models[c][i]&&(this.models[c][i].numReferences--,this.models[c][i].numReferences===0)){const _=this.models[c][i].model;delete this.models[c][i],_.destroy()}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,c){this.models[c]||(this.models[c]={});for(const _ in this.models[c])this.models[c][_].model&&this.models[c][_].model.upload(i.context)}}function sr(p){const{userImage:i}=p;return!!(i&&i.render&&i.render())&&(p.data.replace(new Uint8Array(i.data.buffer)),!0)}class Is extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(i){this.images[i]={},this.loaded[i]=!1,this.updatedImages[i]={},this.patterns[i]={},this.callbackDispatchedThisFrame[i]={},this.atlasImage[i]=new o.i({width:1,height:1})}isLoaded(){for(const i in this.loaded)if(!this.loaded[i])return!1;return!0}setLoaded(i,c){if(this.loaded[c]!==i&&(this.loaded[c]=i,i)){for(const{ids:_,callback:x}of this.requestors)this._notify(_,c,x);this.requestors=[]}}hasImage(i,c){return!!this.getImage(i,c)}getImage(i,c){return this.images[c][i]}addImage(i,c,_){this._validate(i,_)&&(this.images[c][i]=_)}_validate(i,c){let _=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new o.d(new Error(`Image "${i}" has invalid "stretchX" value`))),_=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new o.d(new Error(`Image "${i}" has invalid "stretchY" value`))),_=!1),this._validateContent(c.content,c)||(this.fire(new o.d(new Error(`Image "${i}" has invalid "content" value`))),_=!1),_}_validateStretch(i,c){if(!i)return!0;let _=0;for(const x of i){if(x[0]<_||x[1]<x[0]||c<x[1])return!1;_=x[1]}return!0}_validateContent(i,c){return!(i&&(i.length!==4||i[0]<0||c.data.width<i[0]||i[1]<0||c.data.height<i[1]||i[2]<0||c.data.width<i[2]||i[3]<0||c.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,c,_){_.version=this.images[c][i].version+1,this.images[c][i]=_,this.updatedImages[c][i]=!0}removeImage(i,c){const _=this.images[c][i];delete this.images[c][i],delete this.patterns[c][i],_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(i){return Object.keys(this.images[i])}getImages(i,c,_){let x=!0;const w=!!this.loaded[c];if(!w)for(const S of i)this.images[c][S]||(x=!1);w||x?this._notify(i,c,_):this.requestors.push({ids:i,scope:c,callback:_})}getUpdatedImages(i){return this.updatedImages[i]}_notify(i,c,_){const x={};for(const w of i){this.images[c][w]||this.fire(new o.f("styleimagemissing",{id:w}));const S=this.images[c][w];S?x[w]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:o.w(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}_(null,x)}getPixelSize(i){const{width:c,height:_}=this.atlasImage[i];return{width:c,height:_}}getPattern(i,c,_){const x=this.patterns[c][i],w=this.getImage(i,c);if(!w)return null;if(x&&x.position.version===w.version)return x.position;if(x)x.position.version=w.version;else{const S={w:w.data.width+2,h:w.data.height+2,x:0,y:0},I=new o.k(S,w);this.patterns[c][i]={bin:S,position:I}}return this._updatePatternAtlas(c,_),this.patterns[c][i].position}bind(i,c){const _=i.gl;let x=this.atlasTexture[c];x?this.dirty&&(x.update(this.atlasImage[c]),this.dirty=!1):(x=new o.T(i,this.atlasImage[c],_.RGBA),this.atlasTexture[c]=x),x.bind(_.LINEAR,_.CLAMP_TO_EDGE)}_updatePatternAtlas(i,c){const _=[];for(const I in this.patterns[i])_.push(this.patterns[i][I].bin);const{w:x,h:w}=o.j(_),S=this.atlasImage[i];S.resize({width:x||1,height:w||1});for(const I in this.patterns[i]){const{bin:O}=this.patterns[i][I],D=O.x+1,z=O.y+1,B=this.images[i][I].data,j=B.width,$=B.height;o.i.copy(B,S,{x:0,y:0},{x:D,y:z},{width:j,height:$},c),o.i.copy(B,S,{x:0,y:$-1},{x:D,y:z-1},{width:j,height:1},c),o.i.copy(B,S,{x:0,y:0},{x:D,y:z+$},{width:j,height:1},c),o.i.copy(B,S,{x:j-1,y:0},{x:D-1,y:z},{width:1,height:$},c),o.i.copy(B,S,{x:0,y:0},{x:D+j,y:z},{width:1,height:$},c)}this.dirty=!0}beginFrame(){for(const i in this.images)this.callbackDispatchedThisFrame[i]={}}dispatchRenderCallbacks(i,c){for(const _ of i){if(this.callbackDispatchedThisFrame[c][_])continue;this.callbackDispatchedThisFrame[c][_]=!0;const x=this.images[c][_];sr(x)&&this.updateImage(_,c,x)}}}function ln(p){const i=p.key,c=p.value,_=p.valueSpec||{},x=p.objectElementValidators||{},w=p.style,S=p.styleSpec;let I=[];const O=o.n(c);if(O!=="object")return[new o.V(i,c,`object expected, ${O} found`)];for(const D in c){const z=D.split(".")[0];let B;x[z]?B=x[z]:_[z]?B=W:x["*"]?B=x["*"]:_["*"]&&(B=W),B?I=I.concat(B({key:(i&&`${i}.`)+D,value:c[D],valueSpec:_[z]||_["*"],style:w,styleSpec:S,object:c,objectKey:D},c)):I.push(new o.m(i,c[D],`unknown property "${D}"`))}for(const D in _)x[D]||_[D].required&&_[D].default===void 0&&c[D]===void 0&&I.push(new o.V(i,c,`missing required property "${D}"`));return I}function Gn(p){const i=p.value,c=p.valueSpec,_=p.style,x=p.styleSpec,w=p.key,S=p.arrayElementValidator||W;if(o.n(i)!=="array")return[new o.V(w,i,`array expected, ${o.n(i)} found`)];if(c.length&&i.length!==c.length)return[new o.V(w,i,`array length ${c.length} expected, length ${i.length} found`)];if(c["min-length"]&&i.length<c["min-length"])return[new o.V(w,i,`array length at least ${c["min-length"]} expected, length ${i.length} found`)];let I={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};x.$version<7&&(I.function=c.function),o.n(c.value)==="object"&&(I=c.value);let O=[];for(let D=0;D<i.length;D++)O=O.concat(S({array:i,arrayIndex:D,value:i[D],valueSpec:I,style:_,styleSpec:x,key:`${w}[${D}]`},!0));return O}function Uo(p){const i=p.key,c=p.value,_=p.valueSpec;let x=o.n(c);if(x==="number"&&c!=c&&(x="NaN"),x!=="number")return[new o.V(i,c,`number expected, ${x} found`)];if("minimum"in _){let w=_.minimum;if(o.n(_.minimum)==="array"&&(w=_.minimum[p.arrayIndex]),c<w)return[new o.V(i,c,`${c} is less than the minimum value ${w}`)]}if("maximum"in _){let w=_.maximum;if(o.n(_.maximum)==="array"&&(w=_.maximum[p.arrayIndex]),c>w)return[new o.V(i,c,`${c} is greater than the maximum value ${w}`)]}return[]}function Wi(p){const i=p.valueSpec,c=o.u(p.value.type);let _,x,w,S={};const I=c!=="categorical"&&p.value.property===void 0,O=!I,D=o.n(p.value.stops)==="array"&&o.n(p.value.stops[0])==="array"&&o.n(p.value.stops[0][0])==="object",z=ln({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function($){if(c==="identity")return[new o.V($.key,$.value,'identity function may not have a "stops" property')];let H=[];const X=$.value;return H=H.concat(Gn({key:$.key,value:X,valueSpec:$.valueSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:B})),o.n(X)==="array"&&X.length===0&&H.push(new o.V($.key,X,"array must have at least one stop")),H},default:function($){return W({key:$.key,value:$.value,valueSpec:i,style:$.style,styleSpec:$.styleSpec})}}});return c==="identity"&&I&&z.push(new o.V(p.key,p.value,'missing required property "property"')),c==="identity"||p.value.stops||z.push(new o.V(p.key,p.value,'missing required property "stops"')),c==="exponential"&&p.valueSpec.expression&&!o.s(p.valueSpec)&&z.push(new o.V(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(O&&!o.q(p.valueSpec)?z.push(new o.V(p.key,p.value,"property functions not supported")):I&&!o.r(p.valueSpec)&&z.push(new o.V(p.key,p.value,"zoom functions not supported"))),c!=="categorical"&&!D||p.value.property!==void 0||z.push(new o.V(p.key,p.value,'"property" property is required')),z;function B($){let H=[];const X=$.value,Y=$.key;if(o.n(X)!=="array")return[new o.V(Y,X,`array expected, ${o.n(X)} found`)];if(X.length!==2)return[new o.V(Y,X,`array length 2 expected, length ${X.length} found`)];if(D){if(o.n(X[0])!=="object")return[new o.V(Y,X,`object expected, ${o.n(X[0])} found`)];if(X[0].zoom===void 0)return[new o.V(Y,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new o.V(Y,X,"object stop key must have value")];const K=o.u(X[0].zoom);if(typeof K!="number")return[new o.V(Y,X[0].zoom,"stop zoom values must be numbers")];if(w&&w>K)return[new o.V(Y,X[0].zoom,"stop zoom values must appear in ascending order")];K!==w&&(w=K,x=void 0,S={}),H=H.concat(ln({key:`${Y}[0]`,value:X[0],valueSpec:{zoom:{}},style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:Uo,value:j}}))}else H=H.concat(j({key:`${Y}[0]`,value:X[0],valueSpec:{},style:$.style,styleSpec:$.styleSpec},X));return o.t(o.v(X[1]))?H.concat([new o.V(`${Y}[1]`,X[1],"expressions are not allowed in function stops.")]):H.concat(W({key:`${Y}[1]`,value:X[1],valueSpec:i,style:$.style,styleSpec:$.styleSpec}))}function j($,H){const X=o.n($.value),Y=o.u($.value),K=$.value!==null?$.value:H;if(_){if(X!==_)return[new o.V($.key,K,`${X} stop domain type must match previous stop domain type ${_}`)]}else _=X;if(X!=="number"&&X!=="string"&&X!=="boolean"&&typeof Y!="number"&&typeof Y!="string"&&typeof Y!="boolean")return[new o.V($.key,K,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&c!=="categorical"){let ue=`number expected, ${X} found`;return o.q(i)&&c===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V($.key,K,ue)]}return c!=="categorical"||X!=="number"||typeof Y=="number"&&isFinite(Y)&&Math.floor(Y)===Y?c!=="categorical"&&X==="number"&&typeof Y=="number"&&typeof x=="number"&&x!==void 0&&Y<x?[new o.V($.key,K,"stop domain values must appear in ascending order")]:(x=Y,c==="categorical"&&Y in S?[new o.V($.key,K,"stop domain values must be unique")]:(S[Y]=!0,[])):[new o.V($.key,K,`integer expected, found ${String(Y)}`)]}}function yo(p){const i=(p.expressionContext==="property"?o.x:o.y)(o.v(p.value),p.valueSpec);if(i.result==="error")return i.value.map(_=>new o.V(`${p.key}${_.key}`,p.value,_.message));const c=i.value.expression||i.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!c.outputDefined())return[new o.V(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!o.z(c))return[new o.V(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter")return ao(c,p);if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!o.A(c,["zoom","feature-state"]))return[new o.V(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!o.B(c))return[new o.V(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ao(p,i){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const x of i.valueSpec.expression.parameters)c.delete(x);if(c.size===0)return[];const _=[];return p instanceof o.D&&c.has(p.name)?[new o.V(i.key,i.value,`["${p.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(p.eachChild(x=>{_.push(...ao(x,i))}),_)}function vo(p){const i=p.key,c=p.value,_=p.valueSpec,x=[];return Array.isArray(_.values)?_.values.indexOf(o.u(c))===-1&&x.push(new o.V(i,c,`expected one of [${_.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(_.values).indexOf(o.u(c))===-1&&x.push(new o.V(i,c,`expected one of [${Object.keys(_.values).join(", ")}], ${JSON.stringify(c)} found`)),x}function lo(p){return o.G(o.v(p.value))?yo(o.o({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):ia(p)}function ia(p){const i=p.value,c=p.key;if(o.n(i)!=="array")return[new o.V(c,i,`array expected, ${o.n(i)} found`)];const _=p.styleSpec;let x,w=[];if(i.length<1)return[new o.V(c,i,"filter array must have at least 1 element")];switch(w=w.concat(vo({key:`${c}[0]`,value:i[0],valueSpec:_.filter_operator,style:p.style,styleSpec:p.styleSpec})),o.u(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&o.u(i[1])==="$type"&&w.push(new o.V(c,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&w.push(new o.V(c,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(x=o.n(i[1]),x!=="string"&&w.push(new o.V(`${c}[1]`,i[1],`string expected, ${x} found`)));for(let S=2;S<i.length;S++)x=o.n(i[S]),o.u(i[1])==="$type"?w=w.concat(vo({key:`${c}[${S}]`,value:i[S],valueSpec:_.geometry_type,style:p.style,styleSpec:p.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&w.push(new o.V(`${c}[${S}]`,i[S],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let S=1;S<i.length;S++)w=w.concat(ia({key:`${c}[${S}]`,value:i[S],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":x=o.n(i[1]),i.length!==2?w.push(new o.V(c,i,`filter array for "${i[0]}" operator must have 2 elements`)):x!=="string"&&w.push(new o.V(`${c}[1]`,i[1],`string expected, ${x} found`))}return w}function rs(p,i){const c=p.key,_=p.style,x=p.layer,w=p.styleSpec,S=p.value,I=p.objectKey,O=w[`${i}_${p.layerType}`];if(!O)return[];const D=I.match(/^(.*)-transition$/);if(i==="paint"&&D&&O[D[1]]&&O[D[1]].transition)return W({key:c,value:S,valueSpec:w.transition,style:_,styleSpec:w});const z=p.valueSpec||O[I];if(!z)return[new o.m(c,S,`unknown property "${I}"`)];let B;if(o.n(S)==="string"&&o.q(z)&&!z.tokens&&(B=/^{([^}]+)}$/.exec(S))){const $=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new o.V(c,S,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${$}.`)]}const j=[];if(p.layerType==="symbol")I!=="text-field"||!_||_.glyphs||_.imports||j.push(new o.V(c,S,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&o.H(o.v(S))&&o.u(S.type)==="identity"&&j.push(new o.V(c,S,'"text-font" does not support identity functions'));else if(p.layerType==="model"&&i==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&o.q(z)&&(o.J(z)||o.r(z))){const $=o.x(o.v(S),z),H=$.value.expression||$.value._styleExpression.expression;H&&!o.A(H,["measure-light"])&&(I==="model-emissive-strength"&&o.B(H)&&o.z(H)||j.push(new o.V(c,S,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return j.concat(W({key:p.key,value:S,valueSpec:z,style:_,styleSpec:w,expressionContext:"property",propertyType:i,propertyKey:I}))}function Ii(p){return rs(p,"paint")}function uo(p){return rs(p,"layout")}function Ai(p){let i=[];const c=p.value,_=p.key,x=p.style,w=p.styleSpec;c.type||c.ref||i.push(new o.V(_,c,'either "type" or "ref" is required'));let S=o.u(c.type);const I=o.u(c.ref);if(c.id){const O=o.u(c.id);for(let D=0;D<p.arrayIndex;D++){const z=x.layers[D];o.u(z.id)===O&&i.push(new o.V(_,c.id,`duplicate layer id "${c.id}", previously used at line ${z.id.__line__}`))}}if("ref"in c){let O;["type","source","source-layer","filter","layout"].forEach(D=>{D in c&&i.push(new o.V(_,c[D],`"${D}" is prohibited for ref layers`))}),x.layers.forEach(D=>{o.u(D.id)===I&&(O=D)}),O?O.ref?i.push(new o.V(_,c.ref,"ref cannot reference another ref layer")):S=o.u(O.type):typeof I=="string"&&i.push(new o.V(_,c.ref,`ref layer "${I}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(c.source){const O=x.sources&&x.sources[c.source],D=O&&o.u(O.type);O?D==="vector"&&S==="raster"?i.push(new o.V(_,c.source,`layer "${c.id}" requires a raster source`)):D==="raster"&&S!=="raster"?i.push(new o.V(_,c.source,`layer "${c.id}" requires a vector source`)):D!=="vector"||c["source-layer"]?D==="raster-dem"&&S!=="hillshade"?i.push(new o.V(_,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="raster-array"||["raster","raster-particle"].includes(S)?S!=="line"||!c.paint||!c.paint["line-gradient"]&&!c.paint["line-trim-offset"]||D==="geojson"&&O.lineMetrics?S==="raster-particle"&&D!=="raster-array"&&i.push(new o.V(_,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):i.push(new o.V(_,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new o.V(_,c.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new o.V(_,c,`layer "${c.id}" must specify a "source-layer"`)):i.push(new o.V(_,c.source,`source "${c.source}" not found`))}else i.push(new o.V(_,c,'missing required property "source"'));return i=i.concat(ln({key:_,value:c,valueSpec:w.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>W({key:`${_}.type`,value:c.type,valueSpec:w.layer.type,style:p.style,styleSpec:p.styleSpec,object:c,objectKey:"type"}),filter:O=>lo(o.o({layerType:S},O)),layout:O=>ln({layer:c,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":D=>uo(o.o({layerType:S},D))}}),paint:O=>ln({layer:c,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":D=>Ii(o.o({layerType:S,layer:c},D))}})}})),i}function xo(p){const i=p.value,c=p.key,_=o.n(i);return _!=="string"?[new o.V(c,i,`string expected, ${_} found`)]:[]}const oi={promoteId:function({key:p,value:i}){if(o.n(i)==="string")return xo({key:p,value:i});{const c=[];for(const _ in i)c.push(...xo({key:`${p}.${_}`,value:i[_]}));return c}}};function Yn(p){const i=p.value,c=p.key,_=p.styleSpec,x=p.style;if(!i.type)return[new o.V(c,i,'"type" is required')];const w=o.u(i.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&(i.url||i.tiles||S.push(new o.m(c,i,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(ln({key:c,value:i,valueSpec:_[`source_${w.replace("-","_")}`],style:p.style,styleSpec:_,objectElementValidators:oi})),S;case"geojson":if(S=ln({key:c,value:i,valueSpec:_.source_geojson,style:x,styleSpec:_,objectElementValidators:oi}),i.cluster)for(const I in i.clusterProperties){const[O,D]=i.clusterProperties[I],z=typeof O=="string"?[O,["accumulated"],["get",I]]:O;S.push(...yo({key:`${c}.${I}.map`,value:D,expressionContext:"cluster-map"})),S.push(...yo({key:`${c}.${I}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return S;case"video":return ln({key:c,value:i,valueSpec:_.source_video,style:x,styleSpec:_});case"image":return ln({key:c,value:i,valueSpec:_.source_image,style:x,styleSpec:_});case"canvas":return[new o.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return vo({key:`${c}.type`,value:i.type,valueSpec:{values:Ra(_)},style:x,styleSpec:_})}}function Ra(p){return p.source.reduce((i,c)=>{const _=p[c];return _.type.type==="enum"&&(i=i.concat(Object.keys(_.type.values))),i},[])}function ns(p){const i=p.value,c=p.styleSpec,_=c.light,x=p.style;let w=[];const S=o.n(i);if(i===void 0)return w;if(S!=="object")return w=w.concat([new o.V("light",i,`object expected, ${S} found`)]),w;for(const I in i){const O=I.match(/^(.*)-transition$/);w=w.concat(O&&_[O[1]]&&_[O[1]].transition?W({key:I,value:i[I],valueSpec:c.transition,style:x,styleSpec:c}):_[I]?W({key:I,value:i[I],valueSpec:_[I],style:x,styleSpec:c}):[new o.V(I,i[I],`unknown property "${I}"`)])}return w}function As(p){const i=p.value;let c=[];if(!i)return c;const _=o.n(i);if(_!=="object")return c=c.concat([new o.V("light-3d",i,`object expected, ${_} found`)]),c;const x=p.styleSpec,w=x["light-3d"],S=p.key,I=p.style,O=p.style.lights;for(const B of["type","id"])if(!(B in i))return c=c.concat([new o.V("light-3d",i,`missing property ${B} on light`)]),c;if(i.type&&O)for(let B=0;B<p.arrayIndex;B++){const j=o.u(i.type),$=O[B];o.u($.type)===j&&c.push(new o.V(S,i.id,`duplicate light type "${i.type}", previously defined at line ${$.id.__line__}`))}const D=`properties_light_${i.type}`;if(!(D in x))return c=c.concat([new o.V("light-3d",i,`Invalid light type ${i.type}`)]),c;const z=x[D];for(const B in i)if(B==="properties"){const j=i[B],$=o.n(j);if($!=="object")return c=c.concat([new o.V("properties",j,`object expected, ${$} found`)]),c;for(const H in j)c=c.concat(z[H]?W({key:H,value:j[H],valueSpec:z[H],style:I,styleSpec:x}):[new o.m(p.key,j[H],`unknown property "${H}"`)])}else{const j=B.match(/^(.*)-transition$/);c=c.concat(j&&w[j[1]]&&w[j[1]].transition?W({key:B,value:i[B],valueSpec:x.transition,style:I,styleSpec:x}):w[B]?W({key:B,value:i[B],valueSpec:w[B],style:I,styleSpec:x}):[new o.m(B,i[B],`unknown property "${B}"`)])}return c}function ka(p){const i=p.value,c=p.key,_=p.style,x=p.styleSpec,w=x.terrain;let S=[];const I=o.n(i);if(i===void 0||I==="null")return S;if(I!=="object")return S=S.concat([new o.V("terrain",i,`object expected, ${I} found`)]),S;for(const O in i){const D=O.match(/^(.*)-transition$/);S=S.concat(D&&w[D[1]]&&w[D[1]].transition?W({key:O,value:i[O],valueSpec:x.transition,style:_,styleSpec:x}):w[O]?W({key:O,value:i[O],valueSpec:w[O],style:_,styleSpec:x}):[new o.m(O,i[O],`unknown property "${O}"`)])}if(i.source){const O=_.sources&&_.sources[i.source],D=O&&o.u(O.type);O?D!=="raster-dem"&&S.push(new o.V(c,i.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):S.push(new o.V(c,i.source,`source "${i.source}" not found`))}else S.push(new o.V(c,i,'terrain is missing required property "source"'));return S}function is(p){const i=p.value,c=p.style,_=p.styleSpec,x=_.fog;let w=[];const S=o.n(i);if(i===void 0)return w;if(S!=="object")return w=w.concat([new o.V("fog",i,`object expected, ${S} found`)]),w;for(const I in i){const O=I.match(/^(.*)-transition$/);w=w.concat(O&&x[O[1]]&&x[O[1]].transition?W({key:I,value:i[I],valueSpec:_.transition,style:c,styleSpec:_}):x[I]?W({key:I,value:i[I],valueSpec:x[I],style:c,styleSpec:_}):[new o.m(I,i[I],`unknown property "${I}"`)])}return w}const Ae={"*":()=>[],array:Gn,boolean:function(p){const i=p.value,c=p.key,_=o.n(i);return _!=="boolean"?[new o.V(c,i,`boolean expected, ${_} found`)]:[]},number:Uo,color:function(p){const i=p.key,c=p.value,_=o.n(c);return _!=="string"?[new o.V(i,c,`color expected, ${_} found`)]:o.F(c)===null?[new o.V(i,c,`color expected, "${c}" found`)]:[]},enum:vo,filter:lo,function:Wi,layer:Ai,object:ln,source:Yn,model:o.K,light:ns,"light-3d":As,terrain:ka,fog:is,string:xo,formatted:function(p){return xo(p).length===0?[]:yo(p)},resolvedImage:function(p){return xo(p).length===0?[]:yo(p)},projection:function(p){const i=p.value,c=p.styleSpec,_=c.projection,x=p.style;let w=[];const S=o.n(i);if(S==="object")for(const I in i)w=w.concat(W({key:I,value:i[I],valueSpec:_[I],style:x,styleSpec:c}));else S!=="string"&&(w=w.concat([new o.V("projection",i,`object or string expected, ${S} found`)]));return w},import:function(p){const{value:i,styleSpec:c}=p,{data:_,...x}=i;Object.defineProperty(x,"__line__",{value:i.__line__,enumerable:!1});let w=ln(o.o({},p,{value:x,valueSpec:c.import}));return o.u(x.id)===""&&w.push(new o.V(`${p.key}.id`,x,"import id can't be an empty string")),_&&(w=w.concat(de(_,c,{key:`${p.key}.data`}))),w}};function W(p,i=!1){const c=p.value,_=p.valueSpec,x=p.styleSpec;if(_.expression&&o.H(o.u(c)))return Wi(p);if(_.expression&&o.t(o.v(c)))return yo(p);if(_.type&&Ae[_.type]){const w=Ae[_.type](p);return i===!0&&w.length>0&&o.n(p.value)==="array"?yo(p):w}return ln(o.o({},p,{valueSpec:_.type?x[_.type]:_}))}function J(p){const i=p.value,c=p.key,_=xo(p);return _.length||(i.indexOf("{fontstack}")===-1&&_.push(new o.V(c,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&_.push(new o.V(c,i,'"glyphs" url must include a "{range}" token'))),_}function de(p,i=o.L,c={}){return W({key:c.key||"",value:p,valueSpec:i.$root,styleSpec:i,style:p,objectElementValidators:{glyphs:J,"*":()=>[]}})}function ve(p,i=o.L){return Sr(de(p,i))}const we=p=>Sr(Yn(p)),Ue=p=>Sr(ns(p)),qe=p=>Sr(As(p)),Le=p=>Sr(ka(p)),Ke=p=>Sr(is(p)),St=p=>Sr(Ai(p)),yt=p=>Sr(lo(p)),Ht=p=>Sr(Ii(p)),Qt=p=>Sr(uo(p)),br=p=>Sr(o.K(p));function Sr(p){return p.slice().sort((i,c)=>i.line&&c.line?i.line-c.line:0)}function gr(p,i){let c=!1;if(i&&i.length)for(const _ of i)_ instanceof o.m?o.w(_.message):(p.fire(new o.d(new Error(_.message))),c=!0);return c}const Ir=new o.N({anchor:new o.O(o.L.light.anchor),position:new o.Q(o.L.light.position),color:new o.O(o.L.light.color),intensity:new o.O(o.L.light.intensity)});class $t extends o.E{constructor(i,c="flat"){super(),this._transitionable=new o.U(Ir),this.setLight(i,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,c,_={}){this._validate(Ue,i,_)||(this._transitionable.setTransitionOrValue(i),this.id=c)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,c,_){return(!_||_.validate!==!1)&&gr(this,i.call(ve,o.W({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.L})))}}const rn=new o.N({source:new o.O(o.L.terrain.source),exaggeration:new o.O(o.L.terrain.exaggeration)});let Zr=class extends o.E{constructor(p,i,c,_){super(),this.scope=c,this._transitionable=new o.U(rn,c,_),this._transitionable.setTransitionOrValue(p,_),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(p,i){this._transitionable.setTransitionOrValue(p,i)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new o.X(p)).get("exaggeration")}isZoomDependent(){const p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof o.Z}};const Dr=45,on=65,hn=.05;function Mn(p,i,c,_){const x=o.$(Dr,on,c),[w,S]=si(p,_);let I=1-Math.min(1,Math.exp((i-w)/(S-w)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*x*p.alpha}function si(p,i){const c=.5/Math.tan(.5*i);return[p.range[0]+c,p.range[1]+c]}function Kn(p,i,c,_,x){const w=o._.transformMat4([],[i,c,_],x.mercatorFogMatrix);return Mn(p,o._.length(w),x.pitch,x._fov)}function jo(p,i,c,_,x,w,S){const I=[[c,_,0],[x,_,0],[x,w,0],[c,w,0]];let O=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(const z of I){const B=o._.transformMat4([],z,i),j=o._.length(B);O=Math.min(O,j),D=Math.max(D,j)}return[Mn(p,O,S.pitch,S._fov),Mn(p,D,S.pitch,S._fov)]}const jl=new o.N({range:new o.O(o.L.fog.range),color:new o.O(o.L.fog.color),"high-color":new o.O(o.L.fog["high-color"]),"space-color":new o.O(o.L.fog["space-color"]),"horizon-blend":new o.O(o.L.fog["horizon-blend"]),"star-intensity":new o.O(o.L.fog["star-intensity"]),"vertical-range":new o.O(o.L.fog["vertical-range"])});class oa extends o.E{constructor(i,c,_,x){super(),this._transitionable=new o.U(jl,_,new Map(x)),this.set(i,x),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new o.a0(jl),this.scope=_}get state(){const i=this._transform,c=i.projection.name==="globe",_=o.a1(i.zoom),x=this.properties.get("range"),w=[.5,3];return{range:c?[o.a2(w[0],x[0],_),o.a2(w[1],x[1],_)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,c,_={}){if(this._validate(Ke,i,_))return;const x=o.W({},i);for(const w of Object.keys(o.L.fog))x[w]===void 0&&(x[w]=o.L.fog[w].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.$(Dr,on,i))*c.a}getOpacityAtLatLng(i,c){return this._transform.projection.supportsFog?function(_,x,w){const S=o.Y.fromLngLat(x),I=w.elevation?w.elevation.getAtPointOrZero(S):0;return Kn(_,S.x,S.y,I,w)}(this.state,i,c):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(i.toUnwrapped());return jo(this.state,c,0,0,o.a3,o.a3,this._transform)}getOpacityForBounds(i,c,_,x,w){return this._transform.projection.supportsFog?jo(this.state,i,c,_,x,w,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?si(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const _ of c){const x=i.points[_];let w;if(x[2]>=0)w=x;else{const S=i.points[_-4];w=o.a4(S,x,S[2]/(S[2]-x[2]))}if(Kn(this.state,w[0],w[1],0,this._transform)>=hn)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,c,_){return(!_||_.validate!==!1)&&gr(this,i.call(ve,o.W({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.L})))}}class sa extends o.E{constructor(i,c,_,x){super(),this.scope=_,this._options=i,this.properties=new o.a0(c),this._transitionable=new o.U(c,_,new Map(x)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,c){this._options=i,this._transitionable.setTransitionOrValue(i.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const mr=new o.N({color:new o.O(o.L.properties_light_ambient.color),intensity:new o.O(o.L.properties_light_ambient.intensity)}),Cs=new o.N({direction:new o.a5(o.L.properties_light_directional.direction),color:new o.O(o.L.properties_light_directional.color),intensity:new o.O(o.L.properties_light_directional.intensity),"cast-shadows":new o.O(o.L.properties_light_directional["cast-shadows"]),"shadow-intensity":new o.O(o.L.properties_light_directional["shadow-intensity"])});var Ci=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Vl=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,$l=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Gl="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Wl=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform highp sampler2D u_depth;uniform vec2 u_depth_size_inv;uniform vec2 u_depth_range_unpack;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
#ifdef TERRAIN_DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef TERRAIN_DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;
#ifdef TERRAIN_DEPTH_D24
vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,La=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ql=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Hl=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,hl=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,aa=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Ps=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Os=[];Kr(Ci,Os),Kr($l,Os),Kr(Vl,Os);const fl={"_prelude_fog.vertex.glsl":La,"_prelude_terrain.vertex.glsl":Wl,"_prelude_shadow.vertex.glsl":aa,"_prelude_fog.fragment.glsl":ql,"_prelude_shadow.fragment.glsl":Ps,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Hl,"_prelude_raster_particle.glsl":hl},Ge={};cr("",Wl),cr(ql,La),cr(Ps,aa),cr(Hl,""),cr(hl,"");const Et=cr(Vl,$l),Nt=Ci;var Br={background:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:cr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:cr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:cr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:cr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:cr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:cr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:cr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:cr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:cr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:cr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform lowp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/clamp(u_trim_fade_range[0],1e-4,1.0)));float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/clamp(u_trim_fade_range[1],1e-4,1.0)));float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#if defined(ELEVATED)
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);
#else
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:cr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:cr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:cr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:cr(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);v_fade_opacity*=occludedFadeMultiplier;
#endif
}`),symbolSDF:cr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:cr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=globe_occlusion_fade;
#ifdef SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH
occlusion_fade*=occlusionFade(projected_point);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+ xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:cr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:cr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Gl),skyboxGradient:cr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Gl),skyboxCapture:cr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:cr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:cr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;uniform vec2 u_depth_range_unpack;
#ifdef TERRAIN_DEPTH_D24
float unpack_depth(float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef TERRAIN_DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:cr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:cr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:cr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Kr(p,i){const c=p.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of c)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=_.split(" ");for(const w of x)i.includes(w)||i.push(w)}}function cr(p,i){const c=/#include\s+"([^"]+)"/g,_=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let x=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);x&&(x=x.map(D=>{const z=D.split(" ");return z[z.length-1]}),x=[...new Set(x)]);const w={},S=[],I=[];if(p=p.replace(c,(D,z)=>(I.push(z),"")),(i=i.replace(c,(D,z)=>(S.push(z),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let O=[...Os];Kr(p,O),Kr(i,O);for(const D of[...S,...I])fl[D]||console.error(`Undefined include: ${D}`),Ge[D]||(Ge[D]=[],Kr(fl[D],Ge[D])),O=[...O,...Ge[D]];return{fragmentSource:p=p.replace(_,(D,z,B,j,$)=>(w[$]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${$}
in ${B} ${j} ${$};
#else
uniform ${B} ${j} u_${$};
#endif
`:z==="initialize"?`
#ifdef HAS_UNIFORM_u_${$}
    ${B} ${j} ${$} = u_${$};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    in ${B} ${j} ${$};
#endif
`:z==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(_,(D,z,B,j,$)=>{const H=j==="float"?"vec2":j,X=$.match(/color/)?"color":H;return z==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${$}
in ${B} ${j} a_${$};
#endif
`:w[$]?z==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
in ${B} ${H} a_${$};
out ${B} ${j} ${$};
#else
uniform ${B} ${j} u_${$};
#endif
`:z==="initialize"?X==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = a_${$};
#else
    ${B} ${j} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${$} = unpack_mix_${X}(a_${$}, u_${$}_t);
#else
    ${B} ${j} ${$} = u_${$};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    in ${B} ${j} a_${$};
    out ${B} ${j} ${$};
#endif
`:z==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    ${$} = a_${$};
#endif
`:void 0:z==="define"?`
#ifndef HAS_UNIFORM_u_${$}
uniform lowp float u_${$}_t;
in ${B} ${H} a_${$};
#else
uniform ${B} ${j} u_${$};
#endif
`:z==="define-instanced"?X==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${$}0;
in vec4 a_${$}1;
in vec4 a_${$}2;
in vec4 a_${$}3;
#else
uniform ${B} ${j} u_${$};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${B} ${H} a_${$};
#else
uniform ${B} ${j} u_${$};
#endif
`:z==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${$}
    ${B} ${j} ${$} = a_${$};
#endif
`:X==="vec4"?`
#ifndef HAS_UNIFORM_u_${$}
    ${B} ${j} ${$} = a_${$};
#else
    ${B} ${j} ${$} = u_${$};
#endif
`:`
#ifndef HAS_UNIFORM_u_${$}
    ${B} ${j} ${$} = unpack_mix_${X}(a_${$}, u_${$}_t);
#else
    ${B} ${j} ${$} = u_${$};
#endif
`}),staticAttributes:x,usedDefines:O,vertexIncludes:S,fragmentIncludes:I}}class Qn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,c,_,x,w,S,I,O){this.context=i;let D=this.boundPaintVertexBuffers.length!==x.length;for(let B=0;!D&&B<x.length;B++)this.boundPaintVertexBuffers[B]!==x[B]&&(D=!0);let z=this.boundDynamicVertexBuffers.length!==I.length;for(let B=0;!z&&B<I.length;B++)this.boundDynamicVertexBuffers[B]!==I[B]&&(z=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==_||D||z||this.boundIndexBuffer!==w||this.boundVertexOffset!==S)this.freshBind(c,_,x,w,S,I,O);else{i.bindVertexArrayOES.set(this.vao);for(const B of I)B&&(B.bind(),O&&B.instanceCount&&B.setVertexAttribDivisor(i.gl,c,O));w&&w.dynamicDraw&&w.bind()}}freshBind(i,c,_,x,w,S,I){const O=i.numAttributes,D=this.context,z=D.gl;this.vao&&this.destroy(),this.vao=D.gl.createVertexArray(),D.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=x,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=S,c.enableAttributes(z,i),c.bind(),c.setVertexAttribPointers(z,i,w);for(const B of _)B.enableAttributes(z,i),B.bind(),B.setVertexAttribPointers(z,i,w);for(const B of S)B&&(B.enableAttributes(z,i),B.bind(),B.setVertexAttribPointers(z,i,w),I&&B.instanceCount&&B.setVertexAttribDivisor(z,i,I));x&&x.bind(),D.currentNumAttributes=O}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Ln(p,i){const c=Math.pow(2,i.canonical.z),_=i.canonical.y;return[new o.Y(0,_/c).toLngLat().lat,new o.Y(0,(_+1)/c).toLngLat().lat]}function bo(p,i,c,_,x,w,S){const I=p.context,O=I.gl,D=c.hillshadeFBO;if(!D)return;p.prepareDrawTile();const z=p.isTileAffectedByFog(i),B=p.getOrCreateProgram("hillshade",{overrideFog:z});I.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,D.colorAttachment.get());const j=((Y,K,ue,ce)=>{const he=ue.paint.get("hillshade-shadow-color"),ge=ue.paint.get("hillshade-highlight-color"),_e=ue.paint.get("hillshade-accent-color"),Se=ue.paint.get("hillshade-emissive-strength");let ee=o.ab(ue.paint.get("hillshade-illumination-direction"));if(ue.paint.get("hillshade-illumination-anchor")==="viewport")ee-=Y.transform.angle;else if(Y.style&&Y.style.enable3dLights()&&Y.style.directionalLight){const Pe=Y.style.directionalLight.properties.get("direction"),We=o.ac(Pe.x,Pe.y,Pe.z);ee=o.ab(We[1])}const fe=!Y.options.moving;return{u_matrix:ce||Y.transform.calculateProjMatrix(K.tileID.toUnwrapped(),fe),u_image:0,u_latrange:Ln(0,K.tileID),u_light:[ue.paint.get("hillshade-exaggeration"),ee],u_shadow:he.toRenderColor(ue.lut),u_highlight:ge.toRenderColor(ue.lut),u_emissive_strength:Se,u_accent:_e.toRenderColor(ue.lut)}})(p,c,_,p.terrain?i.projMatrix:null);p.uploadCommonUniforms(I,B,i.toUnwrapped());const{tileBoundsBuffer:$,tileBoundsIndexBuffer:H,tileBoundsSegments:X}=p.getTileBoundsBuffers(c);B.draw(p,O.TRIANGLES,x,w,S,o.af.disabled,j,_.id,$,H,X)}function ai(p,i,c){if(!i.needsDEMTextureUpload)return;const _=p.context,x=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||p.getTileTexture(c.stride);const w=c.getPixels();i.demTexture?i.demTexture.update(w,{premultiply:!1}):i.demTexture=new o.T(_,w,x.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function co(p,i,c){const _=p.context,x=_.gl;if(!i.dem)return;const w=i.dem;if(_.activeTexture.set(x.TEXTURE1),ai(p,i,w),!i.demTexture)return;i.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const S=w.dim;_.activeTexture.set(x.TEXTURE0);let I=i.hillshadeFBO;if(!I){const j=new o.T(_,{width:S,height:S,data:null},x.RGBA);j.bind(x.LINEAR,x.CLAMP_TO_EDGE),I=i.hillshadeFBO=_.createFramebuffer(S,S,!0,"renderbuffer"),I.colorAttachment.set(j.texture)}_.bindFramebuffer.set(I.framebuffer),_.viewport.set([0,0,S,S]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:D,tileBoundsSegments:z}=p.getMercatorTileBoundsBuffers(),B=[];p.linearFloatFilteringSupported()&&B.push("TERRAIN_DEM_FLOAT_FORMAT"),p.getOrCreateProgram("hillshadePrepare",{defines:B}).draw(p,x.TRIANGLES,o.ae.disabled,o.ag.disabled,o.a.unblended,o.af.disabled,((j,$)=>{const H=$.stride,X=o.ad.create();return o.ad.ortho(X,0,o.a3,-o.a3,0,0,1),o.ad.translate(X,X,[0,-o.a3,0]),{u_matrix:X,u_image:1,u_dimension:[H,H],u_zoom:j.overscaledZ}})(i.tileID,w),c.id,O,D,z),i.needsHillshadePrepare=!1}function Jn(p,i,c,_,x){const w=function(S,I){if(S)return x(S);if(I){if(p.url&&I.tiles&&p.tiles&&delete p.tiles,I.variants){if(!Array.isArray(I.variants))return x(new Error("variants must be an array"));for(const D of I.variants){if(D==null||typeof D!="object"||D.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(D.capabilities))return x(new Error("capabilities must be an array"));if(D.capabilities.length===1&&D.capabilities[0]==="meshopt"){I=o.W(I,D);break}}}const O=o.ah(o.W(I,p),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(O.vectorLayers=I.vector_layers,O.vectorLayerIds=O.vectorLayers.map(D=>D.id)),I.raster_layers&&(O.rasterLayers=I.raster_layers,O.rasterLayerIds=O.rasterLayers.map(D=>D.id)),O.tiles=i.canonicalizeTileset(O,p.url),x(null,O)}};return p.url?o.g(i.transformRequest(i.normalizeSourceURL(p.url,null,c,_),o.R.Source),w):o.e.frame(()=>w(null,p))}class za{constructor(i,c,_){this.bounds=o.ai.convert(this.validateBounds(i)),this.minzoom=c||0,this.maxzoom=_||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const c=Math.pow(2,i.z),_=Math.floor(o.aj(this.bounds.getWest())*c),x=Math.floor(o.ak(this.bounds.getNorth())*c),w=Math.ceil(o.aj(this.bounds.getEast())*c),S=Math.ceil(o.ak(this.bounds.getSouth())*c);return i.x>=_&&i.x<w&&i.y>=x&&i.y<S}}class la extends o.E{constructor(i,c,_,x){super(),this.id=i,this.dispatcher=_,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.W({type:"raster"},c),o.W(this,o.ah(c,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new o.f("dataloading",{dataType:"source"})),this._tileJSONRequest=Jn(this._options,this.map._requestManager,null,null,(c,_)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new o.d(c)):_&&(o.W(this,_),_.bounds&&(this.tileBounds=new za(_.bounds,this.minzoom,this.maxzoom)),o.an(_.tiles),this.fire(new o.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.f("data",{dataType:"source",sourceDataType:"content"}))),i&&i(c)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=o.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return o.W({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,c){const _=o.e.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);i.request=o.h(this.map._requestManager.transformRequest(x,o.R.Tile),(w,S,I,O)=>(delete i.request,i.aborted?(i.state="unloaded",c(null)):w?(i.state="errored",c(w)):S?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:I,expires:O}),i.setTexture(S,this.map.painter),i.state="loaded",o.am(this.dispatcher),void c(null)):c(null)))}abortTile(i,c){i.request&&(i.request.cancel(),delete i.request),c&&c()}unloadTile(i,c){i.texture&&i.texture instanceof o.T?(i.destroy(!0),i.texture&&i.texture instanceof o.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ds extends o.E{constructor(i,c,_,x){if(super(),this.id=i,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.W(this,o.ah(c,["url","scheme","tileSize","promoteId"])),this._options=o.W({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new o.ao}load(i){this._loaded=!1,this.fire(new o.f("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=Jn(this._options,this.map._requestManager,c,_,(x,w)=>{this._tileJSONRequest=null,this._loaded=!0,x?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),_&&_.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new o.d(x))):w&&(o.W(this,w),w.bounds&&(this.tileBounds=new za(w.bounds,this.minzoom,this.maxzoom)),o.an(w.tiles,this.map._requestManager._customAccessToken),this.fire(new o.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.f("data",{dataType:"source",sourceDataType:"content"}))),i&&i(x)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=o.al(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return o.W({},this._options)}loadTile(i,c){const _=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),x=this.map._requestManager.transformRequest(_,o.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,S={request:x,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,lut:w?{image:w.image.clone()}:null,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(S.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=c:i.request=i.actor.send("reloadTile",S,I.bind(this));else if(i.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",S,I.bind(this),void 0,!0);else{const O=o.ap.call({deduped:this._deduped},S,(D,z)=>{D||!z?I.call(this,D):(S.data={cacheControl:z.cacheControl,expires:z.expires,rawData:z.rawData.slice(0)},i.actor&&i.actor.send("loadTile",S,I.bind(this),void 0,!0))},!0);i.request={cancel:O}}function I(O,D){return delete i.request,i.aborted?c(null):O&&O.status!==404?c(O):(D&&D.resourceTiming&&(i.resourceTiming=D.resourceTiming),this.map._refreshExpiredTiles&&D&&i.setExpiryData(D),i.loadVectorData(D,this.map.painter),o.am(this.dispatcher),c(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,c){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const wo=(p,i,c)=>({u_matrix:p,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:c}),Mt=(p,i,c,_,x,w,S,I,O,D,z,B,j,$,H,X)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:c,u_zoom_transition:x,u_merc_center:w,u_image0:0,u_frustum_tl:S,u_frustum_tr:I,u_frustum_br:O,u_frustum_bl:D,u_globe_pos:z,u_globe_radius:B,u_viewport:j,u_grid_matrix:X?Float32Array.from(X):new Float32Array(9),u_skirt_height:$,u_far_z_cutoff:H});class Fa{constructor(i=0,c=0,_=0,x=0){if(isNaN(i)||i<0||isNaN(c)||c<0||isNaN(_)||_<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=c,this.left=_,this.right=x}interpolate(i,c,_){return c.top!=null&&i.top!=null&&(this.top=o.a2(i.top,c.top,_)),c.bottom!=null&&i.bottom!=null&&(this.bottom=o.a2(i.bottom,c.bottom,_)),c.left!=null&&i.left!=null&&(this.left=o.a2(i.left,c.left,_)),c.right!=null&&i.right!=null&&(this.right=o.a2(i.right,c.right,_)),this}getCenter(i,c){const _=o.at((this.left+i-this.right)/2,0,i),x=o.at((this.top+c-this.bottom)/2,0,c);return new o.P(_,x)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Fa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Rs(p,i){const c=o.aw(p,3);o.ad.fromQuat(p,i),o.az(p,3,c)}function Ar(p,i){const c=o.av.identity([]);return o.av.rotateZ(c,c,-i),o.av.rotateX(c,c,-p),c}function li(p,i){const c=[p[0],p[1],0],_=[i[0],i[1],0];if(o._.length(c)>=1e-15){const S=o._.normalize([],c);o._.scale(_,S,o._.dot(_,S)),i[0]=_[0],i[1]=_[1]}const x=o._.cross([],i,p);if(o._.len(x)<1e-15)return null;const w=Math.atan2(-x[1],x[0]);return Ar(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),w)}class Oe{constructor(i,c){this.position=i,this.orientation=c}get position(){return this._position}set position(i){if(i){const c=i instanceof o.Y?i:new o.Y(i[0],i[1],i[2]);this._renderWorldCopies&&(c.x=o.au(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(i,c){if(this.orientation=null,!this.position)return;const _=this.position,x=this._elevation?this._elevation.getAtPointOrZero(o.Y.fromLngLat(i)):0,w=o.Y.fromLngLat(i,x),S=[w.x-_.x,w.y-_.y,w.z-_.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=li(S,c)}setPitchBearing(i,c){this.orientation=Ar(o.ab(i),o.ab(-c))}}class nt{constructor(i,c){this._transform=o.ad.identity([]),this.orientation=c,this.position=i}get mercatorPosition(){const i=this.position;return new o.Y(i[0],i[1],i[2])}get position(){const i=o.aw(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var c;i&&o.az(this._transform,3,[(c=i)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||o.av.identity([]),i&&Rs(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,c){this._orientation=Ar(i,c),Rs(this._transform,this._orientation)}forward(){const i=o.aw(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=o.aw(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=o.aw(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,c){const _=new Float64Array(16);return o.ad.invert(_,this.getWorldToCamera(i,c)),_}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,c,_){const x=this.position;o._.scale(x,x,-i);const w=new Float64Array(16);return o.ad.fromScaling(w,[_,_,_]),o.ad.translate(w,w,x),w[10]*=c,w}getWorldToCamera(i,c){const _=new Float64Array(16),x=new Float64Array(4),w=this.position;return o.av.conjugate(x,this._orientation),o._.scale(w,w,-i),o.ad.fromQuat(_,x),o.ad.translate(_,_,w),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=c,_[9]*=c,_[10]*=c,_[11]*=c,_}getCameraToClipPerspective(i,c,_,x){const w=new Float64Array(16);return o.ad.perspective(w,i,c,_,x),w}getCameraToClipOrthographic(i,c,_,x,w,S){const I=new Float64Array(16);return o.ad.ortho(I,i,c,_,x,w,S),I}getDistanceToElevation(i,c=!1){const _=i===0?0:o.ax(i,c?o.ay(this.position[1]):this.position[1]),x=this.forward();return(_-this.position[2])/x[2]}clone(){return new nt([...this.position],[...this.orientation])}}const Rt={unknown:0,flipRequired:1,flipNotRequired:2},hr=Math.tan(85*Math.PI/180);function Kt(p,i,c,_,x,w,S){const I=o.ad.create();if(c)if(w.name==="globe"){const O=o.aB(x,i);o.ad.multiply(I,I,O)}else{const O=o.aC.invert([],S);I[0]=O[0],I[1]=O[1],I[4]=O[2],I[5]=O[3],_||o.ad.rotateZ(I,I,x.angle)}else o.ad.multiply(I,x.labelPlaneMatrix,p);return I}function zr(p,i,c,_,x,w,S){const I=Kt(p,i,c,_,x,w,S);return w.name==="globe"&&c||(I[2]=I[6]=I[10]=I[14]=0),I}function bn(p,i,c,_,x,w,S){if(c){if(w.name==="globe"){const I=Kt(p,i,c,_,x,w,S);return o.ad.invert(I,I),o.ad.multiply(I,p,I),I}{const I=o.ad.clone(p),O=o.ad.identity([]);return O[0]=S[0],O[1]=S[1],O[4]=S[2],O[5]=S[3],o.ad.multiply(I,I,O),_||o.ad.rotateZ(I,I,-x.angle),I}}return x.glCoordMatrix}function fn(p,i,c,_){const x=[p,i,c,1];c?o.aA.transformMat4(x,x,_):Fu(x,x,_);const w=x[3];return x[0]/=w,x[1]/=w,x[2]/=w,x}function ui(p,i){return Math.min(.5+p/i*.5,1.5)}function Qr(p,i){const c=p[0]/p[3],_=p[1]/p[3];return c>=-i[0]&&c<=i[0]&&_>=-i[1]&&_<=i[1]}function qi(p,i,c,_,x,w,S,I,O,D){const z=c.transform,B=_?p.textSizeData:p.iconSizeData,j=o.aD(B,c.transform.zoom),$=z.projection.name==="globe",H=[256/c.width*2+1,256/c.height*2+1],X=_?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;X.clear();let Y=null;$&&(Y=_?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const K=p.lineVertexArray,ue=_?p.text.placedSymbolArray:p.icon.placedSymbolArray,ce=c.transform.width/c.transform.height;let he,ge=!1;for(let _e=0;_e<ue.length;_e++){const Se=ue.get(_e),{numGlyphs:ee,writingMode:fe}=Se;if(fe!==o.aE.vertical||ge||he===o.aE.horizontal||(ge=!0),he=fe,(Se.hidden||fe===o.aE.vertical)&&!ge){Yi(ee,X);continue}ge=!1;const Pe=new o.P(Se.tileAnchorX,Se.tileAnchorY);let{x:We,y:ke,z:be}=z.projection.projectTilePoint(Pe.x,Pe.y,D.canonical);if(O){const[Lt,Ot,It]=O(Pe);We+=Lt,ke+=Ot,be+=It}const Xe=[We,ke,be,1];if(o.aA.transformMat4(Xe,Xe,i),!Qr(Xe,H)){Yi(ee,X);continue}const dt=Xe[3],pt=ui(c.transform.getCameraToCenterDistance(z.projection),dt),ft=o.aF(B,j,Se),Fe=S?ft/pt:ft*pt,Ye=fn(We,ke,be,x);if(Ye[3]<=0){Yi(ee,X);continue}let lt={};const Ct=S?null:O,Pt=Zi(Se,Fe,!1,I,i,x,w,p.glyphOffsetArray,K,X,Y,Ye,Pe,lt,ce,Ct,z.projection,D,S);ge=Pt.useVertical,Ct&&Pt.needsFlipping&&(lt={}),(Pt.notEnoughRoom||ge||Pt.needsFlipping&&Zi(Se,Fe,!0,I,i,x,w,p.glyphOffsetArray,K,X,Y,Ye,Pe,lt,ce,Ct,z.projection,D,S).notEnoughRoom)&&Yi(ee,X)}_?(p.text.dynamicLayoutVertexBuffer.updateData(X),Y&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(Y)):(p.icon.dynamicLayoutVertexBuffer.updateData(X),Y&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(Y))}function Hi(p,i,c,_,x,w,S,I,O,D,z,B,j,$,H,X){const{lineStartIndex:Y,glyphStartIndex:K,segment:ue}=I,ce=K+I.numGlyphs,he=Y+I.lineLength,ge=i.getoffsetX(K),_e=i.getoffsetX(ce-1),Se=Fi(p*ge,c,_,x,w,S,ue,Y,he,O,D,z,B,j,!0,$,H,X);if(!Se)return null;const ee=Fi(p*_e,c,_,x,w,S,ue,Y,he,O,D,z,B,j,!0,$,H,X);return ee?{first:Se,last:ee}:null}function ci(p,i,c,_){return p===o.aE.horizontal&&Math.abs(_)>Math.abs(c)?{useVertical:!0}:p===o.aE.vertical?_>0?{needsFlipping:!0}:null:i!==Rt.unknown&&function(x,w){return x===0||Math.abs(w/x)>hr}(c,_)?i===Rt.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function Zi(p,i,c,_,x,w,S,I,O,D,z,B,j,$,H,X,Y,K,ue){const ce=i/24,he=p.lineOffsetX*ce,ge=p.lineOffsetY*ce,{lineStartIndex:_e,glyphStartIndex:Se,numGlyphs:ee,segment:fe,writingMode:Pe,flipState:We}=p,ke=_e+p.lineLength,be=Xe=>{if(z){const[Fe,Ye,lt]=Xe.up,Ct=D.length;o.aG(z,Ct+0,Fe,Ye,lt),o.aG(z,Ct+1,Fe,Ye,lt),o.aG(z,Ct+2,Fe,Ye,lt),o.aG(z,Ct+3,Fe,Ye,lt)}const[dt,pt,ft]=Xe.point;o.aH(D,dt,pt,ft,Xe.angle)};if(ee>1){const Xe=Hi(ce,I,he,ge,c,B,j,p,O,w,$,X,!1,Y,K,ue);if(!Xe)return{notEnoughRoom:!0};if(_&&!c){let[dt,pt,ft]=Xe.first.point,[Fe,Ye,lt]=Xe.last.point;[dt,pt]=fn(dt,pt,ft,S),[Fe,Ye]=fn(Fe,Ye,lt,S);const Ct=ci(Pe,We,(Fe-dt)*H,Ye-pt);if(p.flipState=Ct&&Ct.needsFlipping?Rt.flipRequired:Rt.flipNotRequired,Ct)return Ct}be(Xe.first);for(let dt=Se+1;dt<Se+ee-1;dt++){const pt=Fi(ce*I.getoffsetX(dt),he,ge,c,B,j,fe,_e,ke,O,w,$,X,!1,!1,Y,K,ue);if(!pt)return D.length-=4*(dt-Se),{notEnoughRoom:!0};be(pt)}be(Xe.last)}else{if(_&&!c){const dt=fn(j.x,j.y,0,x),pt=_e+fe+1,ft=new o.P(O.getx(pt),O.gety(pt)),Fe=fn(ft.x,ft.y,0,x),Ye=Fe[3]>0?Fe:Vo(j,ft,dt,1,x,void 0,Y,K.canonical),lt=ci(Pe,We,(Ye[0]-dt[0])*H,Ye[1]-dt[1]);if(p.flipState=lt&&lt.needsFlipping?Rt.flipRequired:Rt.flipNotRequired,lt)return lt}const Xe=Fi(ce*I.getoffsetX(Se),he,ge,c,B,j,fe,_e,ke,O,w,$,X,!1,!1,Y,K,ue);if(!Xe)return{notEnoughRoom:!0};be(Xe)}return{}}function Xi(p,i,c,_,x){const{x:w,y:S,z:I}=_.projectTilePoint(p.x,p.y,i);if(!x)return fn(w,S,I,c);const[O,D,z]=x(p);return fn(w+O,S+D,I+z,c)}function Vo(p,i,c,_,x,w,S,I){const O=Xi(p.sub(i)._unit()._add(p),I,x,S,w);return o._.sub(O,c,O),o._.normalize(O,O),o._.scaleAndAdd(O,c,O,_)}function Fi(p,i,c,_,x,w,S,I,O,D,z,B,j,$,H,X,Y,K){const ue=_?p-i:p+i;let ce=ue>0?1:-1,he=0;_&&(ce*=-1,he=Math.PI),ce<0&&(he+=Math.PI);let ge=I+S+(ce>0?0:1)|0,_e=x,Se=x,ee=0,fe=0;const Pe=Math.abs(ue),We=[],ke=[];let be=w,Xe=be;const dt=()=>Vo(Xe,be,Se,Pe-ee+1,z,j,X,Y.canonical);for(;ee+fe<=Pe;){if(ge+=ce,ge<I||ge>=O)return null;if(Se=_e,Xe=be,We.push(Se),$&&ke.push(Xe),be=new o.P(D.getx(ge),D.gety(ge)),_e=B[ge],!_e){const Ot=Xi(be,Y.canonical,z,X,j);_e=Ot[3]>0?B[ge]=Ot:dt()}ee+=fe,fe=o._.distance(Se,_e)}H&&j&&(B[ge]&&(_e=dt(),fe=o._.distance(Se,_e)),B[ge]=_e);const pt=(Pe-ee)/fe,ft=be.sub(Xe)._mult(pt)._add(Xe),Fe=o._.sub([],_e,Se),Ye=o._.scaleAndAdd([],Se,Fe,pt);let lt=[0,0,1],Ct=Fe[0],Pt=Fe[1];if(K&&(lt=X.upVector(Y.canonical,ft.x,ft.y),lt[0]!==0||lt[1]!==0||lt[2]!==1)){const Ot=[lt[2],0,-lt[0]],It=o._.cross([],lt,Ot);o._.normalize(Ot,Ot),o._.normalize(It,It),Ct=o._.dot(Fe,Ot),Pt=o._.dot(Fe,It)}if(c){const Ot=o._.cross([],lt,Fe);o._.normalize(Ot,Ot),o._.scaleAndAdd(Ye,Ye,Ot,c*ce)}const Lt=he+Math.atan2(Pt,Ct);return We.push(Ye),$&&ke.push(ft),{point:Ye,angle:Lt,path:We,tilePath:ke,up:lt}}function Yi(p,i){const c=i.length,_=c+4*p;i.resize(_),i.float32.fill(-1/0,4*c,4*_)}function Fu(p,i,c){const _=i[0],x=i[1];return p[0]=c[0]*_+c[4]*x+c[12],p[1]=c[1]*_+c[5]*x+c[13],p[3]=c[3]*_+c[7]*x+c[15],p}const ho=(p,i,c)=>(1-c)*p+c*i,dl=p=>p*p*p*p*p;class zn{constructor(i,c,_,x,w,S,I){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=i||0,this._maxZoom=c||22,this._minPitch=_??0,this._maxPitch=x??60,this.setProjection(S),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new o.aI(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Fa,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new nt,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const i=new zn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,c=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(i||_)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return o.ah(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=o.aJ(this.projectionOptions);const _=!R(c,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.aJ({name:"mercator"});const c=i!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.ax(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.au(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const c=-i*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=o.aC.create(),o.aC.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const c=o.at(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=o.ab(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const c=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const _=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&_.exaggeration()&&this._centerAltitudeValidForExaggeration!==_.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*_.exaggeration(),this._centerAltitudeValidForExaggeration=_.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=_.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let x=0,w=0;for(let S=0;S<c.length;S++){const I=new o.P(c[S][0]*this.width,_+c[S][1]*(this.height-_)),O=i.pointCoordinate(I);if(!O)continue;const D=1/Math.hypot(O[0]-this._camera.position[0],O[1]-this._camera.position[1]);x+=O[3]*D,w+=D}return w===0?NaN:x/w}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*c,x=this._mercatorZfromZoom(i),w=this._mercatorZfromZoom(this._maxZoom),S=Math.max(x-_,w);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let _;_=i.z<this._camera.position[2]?[c.x,c.y,c.z]:[i.x,i.y,i.z];const x=o._.length(o._.sub([],this._camera.position,_));return o.at(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let c=!1;if(i.orientation&&!o.av.exactEquals(i.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(i.orientation)),i.position){const _=[i.position.x,i.position.y,i.position.z];o._.exactEquals(_,this._camera.position)||(this._setCameraPosition(_),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,c=new Oe;return c.position=new o.Y(i[0],i[1],i[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(i){if(!o.av.length(i))return!1;o.av.normalize(i,i);const c=o._.transformQuat([],[0,0,-1],i),_=o._.transformQuat([],[0,-1,0],i);if(_[2]<0)return!1;const x=li(c,_);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(i){const c=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;i[2]=o.at(i[2],x/_,x/c),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,c,_){this._unmodified=!1,this._edgeInsets.interpolate(i,c,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const c=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(i){const c=[new o.aK(0,i)];if(this.renderWorldCopies){const _=this.pointCoordinate(new o.P(0,0)),x=this.pointCoordinate(new o.P(this.width,0)),w=this.pointCoordinate(new o.P(this.width,this.height)),S=this.pointCoordinate(new o.P(0,this.height)),I=Math.floor(Math.min(_.x,x.x,w.x,S.x)),O=Math.floor(Math.max(_.x,x.x,w.x,S.x)),D=1;for(let z=I-D;z<=O+D;z++)z!==0&&c.push(new o.aK(z,i))}return c}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(i,c,_){let x=[];if(c[0]===0&&c[1]===0)return x;for(const S of i){const I=S.canonical,O=S.overscaledZ,D=S.wrap,z=1<<I.z,B=I.x+1<z,j=I.x>0,$=I.y+1<z,H=I.y>0,X=S.wrap-(j?0:1),Y=S.wrap+(B?0:1),K=j?I.x-1:z-1,ue=B?I.x+1:0;c[0]<0?(x.push(new o.aL(O,Y,I.z,ue,I.y)),c[1]<0&&$&&(x.push(new o.aL(O,D,I.z,I.x,I.y+1)),x.push(new o.aL(O,Y,I.z,ue,I.y+1))),c[1]>0&&H&&(x.push(new o.aL(O,D,I.z,I.x,I.y-1)),x.push(new o.aL(O,Y,I.z,ue,I.y-1)))):c[0]>0?(x.push(new o.aL(O,X,I.z,K,I.y)),c[1]<0&&$&&(x.push(new o.aL(O,D,I.z,I.x,I.y+1)),x.push(new o.aL(O,X,I.z,K,I.y+1))),c[1]>0&&H&&(x.push(new o.aL(O,D,I.z,I.x,I.y-1)),x.push(new o.aL(O,X,I.z,K,I.y-1)))):c[1]<0&&$?x.push(new o.aL(O,D,I.z,I.x,I.y+1)):H&&x.push(new o.aL(O,D,I.z,I.x,I.y-1))}if(x.length>1){x.sort((O,D)=>O.overscaledZ-D.overscaledZ||O.wrap-D.wrap||O.canonical.z-D.canonical.z||O.canonical.x-D.canonical.x||O.canonical.y-D.canonical.y);let S=0,I=0;for(;I<x.length;)x[I].equals(x[S])?++I:x[++S]=x[I++];x.length=S+1}const w=[];for(const S of x)x.some(I=>S.isChildOf(I))||w.push(S);return x=w.filter(S=>!i.some(I=>!!(S.overscaledZ<_&&I.isChildOf(S))||S.equals(I)||S.isChildOf(I))),x}coveringTiles(i){let c=this.coveringZoomLevel(i);const _=c,x=this.elevation&&this.elevation.exaggeration(),w=x&&!i.isTerrainDEM,S=this.projection.name==="mercator";if(i.minzoom!==void 0&&c<i.minzoom)return[];i.maxzoom!==void 0&&c>i.maxzoom&&(c=i.maxzoom);const I=this.locationCoordinate(this.center),O=this.center.lat,D=1<<c,z=[D*I.x,D*I.y,0],B=this.projection.name==="globe",j=!B,$=o.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,j),H=B?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=D*o.ax(1,this.center.lat),Y=this._camera.position[2]/o.ax(1,this.center.lat),K=[D*H.x,D*H.y,Y*(j?1:X)],ue=B||x,ce=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),he=this.isLODDisabled(!0)?c:0;let ge;if(this._elevation&&i.isTerrainDEM)ge=1e4*this._elevation.exaggeration();else if(this._elevation){const Fe=this._elevation.getMinMaxForVisibleTiles();ge=Fe?Fe.max:this._centerAltitude}else ge=this._centerAltitude;const _e=i.isTerrainDEM?-ge:this._elevation?this._elevation.getMinElevationBelowMSL():0,Se=this.projection.isReprojectedInTileSpace?o.aN(this):1,ee=Fe=>{const lt=new o.Y(Fe.x+25e-6,Fe.y,Fe.z),Ct=new o.Y(Fe.x,Fe.y+25e-6,Fe.z),Pt=Fe.toLngLat(),Lt=lt.toLngLat(),Ot=Ct.toLngLat(),It=this.locationCoordinate(Pt),it=this.locationCoordinate(Lt),jt=this.locationCoordinate(Ot),Er=Math.hypot(it.x-It.x,it.y-It.y),lr=Math.hypot(jt.x-It.x,jt.y-It.y);return Math.sqrt(Er*lr)*Se/25e-6},fe=Fe=>{const Ye=ge,lt=_e;return{aabb:o.aQ(this,D,0,0,0,Fe,lt,Ye,this.projection),zoom:0,x:0,y:0,minZ:lt,maxZ:Ye,wrap:Fe,fullyVisible:!1}},Pe=[];let We=[];const ke=c,be=i.reparseOverscaled?_:c,Xe=(Y-this._centerAltitude)*X,dt=Fe=>{if(!this._elevation||!Fe.tileID||!S)return;const Ye=this._elevation.getMinMaxForTile(Fe.tileID),lt=Fe.aabb;Ye?(lt.min[2]=Ye.min,lt.max[2]=Ye.max,lt.center[2]=(lt.min[2]+lt.max[2])/2):(Fe.shouldSplit=ft(Fe),Fe.shouldSplit||(lt.min[2]=lt.max[2]=lt.center[2]=this._centerAltitude))},pt=(Fe,Ye)=>{if(.707*Ye<Fe)return 1;const lt=Ye/Fe;return lt/(1.4144271570014144+(Math.pow(1.1,lt-1.4144271570014144+1)-1)/(1.1-1)-1)},ft=Fe=>{if(Fe.zoom<he)return!0;if(Fe.zoom===ke)return!1;if(Fe.shouldSplit!=null)return Fe.shouldSplit;const Ye=Fe.aabb.distanceX(K),lt=Fe.aabb.distanceY(K);let Ct=Xe,Pt=1;if(B){Ct=Fe.aabb.distanceZ(K);const lr=Math.pow(2,Fe.zoom),yr=o.ay((Fe.y+1)/lr),Rr=o.ay(Fe.y/lr),yn=Math.min(Math.max(O,yr),Rr),Pr=o.b4(yn)/o.b4(O);if(Pt=yn===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Pr/this._mercatorScaleRatio),this.zoom<=o.b1&&Fe.zoom===ke-1&&Pr>=.9)return!0}else if(w&&(Ct=Fe.aabb.distanceZ(K)*X),this.projection.isReprojectedInTileSpace&&_<=5){const lr=Math.pow(2,Fe.zoom),yr=ee(new o.Y((Fe.x+.5)/lr,(Fe.y+.5)/lr));Pt=yr>.85?1:yr}if(!S){const lr=Math.sqrt(Ye*Ye+lt*lt+Ct*Ct);let yr=(1<<ke-Fe.zoom)*ce*Pt;return yr*=pt(Math.max(Ct,Xe),lr),lr<yr}let Lt=Number.MAX_VALUE,Ot=0;const It=Fe.aabb.getCorners(),it=[];for(const lr of It){o._.sub(it,lr,K),B||(w?it[2]*=X:it[2]=Xe);const yr=o._.dot(it,this._camera.forward());yr<Lt&&(Lt=yr,Ot=Math.abs(it[2]))}let jt=(1<<ke-Fe.zoom)*ce*Pt;if(jt*=pt(Math.max(Ot,Xe),Lt),Lt<jt)return!0;const Er=Fe.aabb.closestPoint(z);return Er[0]===z[0]&&Er[1]===z[1]};if(this.renderWorldCopies)for(let Fe=1;Fe<=3;Fe++)Pe.push(fe(-Fe)),Pe.push(fe(Fe));for(Pe.push(fe(0));Pe.length>0;){const Fe=Pe.pop(),Ye=Fe.x,lt=Fe.y;let Ct=Fe.fullyVisible;const Pt=()=>this.projection.name==="globe"&&(Fe.y===0||Fe.y===(1<<Fe.zoom)-1);if(!Ct){let Lt=ue?Fe.aabb.intersects($):Fe.aabb.intersectsFlat($);if(Lt===0&&Pt()){const Ot=new o.aO(Fe.zoom,Ye,lt);Lt=o.aP(this,D,Ot,!0).intersects($)}if(Lt===0)continue;Ct=Lt===2}if(Fe.zoom!==ke&&ft(Fe))for(let Lt=0;Lt<4;Lt++){const Ot=(Ye<<1)+Lt%2,It=(lt<<1)+(Lt>>1),it={aabb:S?Fe.aabb.quadrant(Lt):o.aQ(this,D,Fe.zoom+1,Ot,It,Fe.wrap,Fe.minZ,Fe.maxZ,this.projection),zoom:Fe.zoom+1,x:Ot,y:It,wrap:Fe.wrap,fullyVisible:Ct,tileID:void 0,shouldSplit:void 0,minZ:Fe.minZ,maxZ:Fe.maxZ};w&&!B&&(it.tileID=new o.aL(Fe.zoom+1===ke?be:Fe.zoom+1,Fe.wrap,Fe.zoom+1,Ot,It),dt(it)),Pe.push(it)}else{const Lt=Fe.zoom===ke?be:Fe.zoom;if(i.minzoom&&i.minzoom>Lt)continue;if(!Ct){let jt=ue?Fe.aabb.intersectsPrecise($):Fe.aabb.intersectsPreciseFlat($);if(jt===0&&Pt()){const Er=new o.aO(Fe.zoom,Ye,lt);jt=o.aP(this,D,Er,!0).intersectsPrecise($)}if(jt===0)continue}const Ot=z[0]-(.5+Ye+(Fe.wrap<<Fe.zoom))*(1<<c-Fe.zoom),It=z[1]-.5-lt,it=Fe.tileID?Fe.tileID:new o.aL(Lt,Fe.wrap,Fe.zoom,Ye,lt);We.push({tileID:it,distanceSq:Ot*Ot+It*It})}}if(this.fogCullDistSq){const Fe=this.fogCullDistSq,Ye=this.horizonLineFromTop();We=We.filter(lt=>{const Ct=[0,0,0,1],Pt=[o.a3,o.a3,0,1],Lt=this.calculateFogTileMatrix(lt.tileID.toUnwrapped());o.aA.transformMat4(Ct,Ct,Lt),o.aA.transformMat4(Pt,Pt,Lt);const Ot=o.aA.min([],Ct,Pt),It=o.aA.max([],Ct,Pt),it=o.aR(Ot,It);if(it===0)return!0;let jt=!1;const Er=this._elevation;if(Er&&it>Fe&&Ye!==0){const lr=this.calculateProjMatrix(lt.tileID.toUnwrapped());let yr;i.isTerrainDEM||(yr=Er.getMinMaxForTile(lt.tileID)),yr||(yr={min:_e,max:ge});const Rr=o.b2(this.rotation),yn=[Rr[0]*o.a3,Rr[1]*o.a3,yr.max];o._.transformMat4(yn,yn,lr),jt=(1-yn[1])*this.height*.5<Ye}return it<Fe||jt})}return We.sort((Fe,Ye)=>Fe.distanceSq-Ye.distanceSq).map(Fe=>Fe.tileID)}resize(i,c){this.width=i,this.height=c,this.pixelsToGLUnits=[2/i,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const c=o.at(i.lat,-o.aS,o.aS),_=this.projection.project(i.lng,c);return new o.P(_.x*this.worldSize,_.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.ax(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,c){let _,x;const w=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;_=(c.x-w.x)/I,x=(c.y-w.y)/I}else{const I=this.pointCoordinate(c),O=this.pointCoordinate(w);_=I.x-O.x,x=I.y-O.y}const S=this.locationCoordinate(i);this.setLocation(new o.Y(S.x-_,S.y-x))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,c){const _=c?o.ax(c,i.lat):void 0,x=this.projection.project(i.lng,i.lat);return new o.Y(x.x,x.y,_)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,c){const _=c??this._centerAltitude,x=[i.x,i.y,0,1],w=[i.x,i.y,1,1];o.aA.transformMat4(x,x,this.pixelMatrixInverse),o.aA.transformMat4(w,w,this.pixelMatrixInverse);const S=w[3];o.aA.scale(x,x,1/x[3]),o.aA.scale(w,w,1/S);const I=x[2],O=w[2];return{p0:x,p1:w,t:I===O?0:(_-I)/(O-I)}}screenPointToMercatorRay(i){const c=[i.x,i.y,0,1],_=[i.x,i.y,1,1];return o.aA.transformMat4(c,c,this.pixelMatrixInverse),o.aA.transformMat4(_,_,this.pixelMatrixInverse),o.aA.scale(c,c,1/c[3]),o.aA.scale(_,_,1/_[3]),c[2]=o.ax(c[2],this._center.lat)*this.worldSize,_[2]=o.ax(_[2],this._center.lat)*this.worldSize,o.aA.scale(c,c,1/this.worldSize),o.aA.scale(_,_,1/this.worldSize),new o.aT([c[0],c[1],c[2]],o._.normalize([],o._.sub([],_,c)))}rayIntersectionCoordinate(i){const{p0:c,p1:_,t:x}=i,w=o.ax(c[2],this._center.lat),S=o.ax(_[2],this._center.lat);return new o.Y(o.a2(c[0],_[0],x)/this.worldSize,o.a2(c[1],_[1],x)/this.worldSize,o.a2(w,S,x))}pointCoordinate(i,c=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,c)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let c=this.projection.pointCoordinate3D(this,i.x,i.y);if(c)return new o.Y(c[0],c[1],c[2]);let _=0,x=this.horizonLineFromTop();if(i.y>x)return this.pointCoordinate(i);const w=.02*x,S=i.clone();for(let I=0;I<10&&x-_>w;I++){S.y=o.a2(_,x,.66);const O=this.projection.pointCoordinate3D(this,S.x,S.y);O?(x=S.y,c=O):_=S.y}return c?new o.Y(c[0],c[1],c[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=o.aU)return!this.isPointAboveHorizon(i);const c=this.pointCoordinate(i);return c.y>=0&&c.y<=1}_coordinatePoint(i,c){const _=c&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,x=[i.x*this.worldSize,i.y*this.worldSize,_+i.toAltitude(),1];return o.aA.transformMat4(x,x,this.pixelMatrix),x[3]>0?new o.P(x[0]/x[3],x[1]/x[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:c}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,w=this.pointLocation3D(new o.P(c,i)),S=this.pointLocation3D(new o.P(x,i)),I=this.pointLocation3D(new o.P(x,_)),O=this.pointLocation3D(new o.P(c,_));let D=Math.min(w.lng,S.lng,I.lng,O.lng),z=Math.max(w.lng,S.lng,I.lng,O.lng),B=Math.min(w.lat,S.lat,I.lat,O.lat),j=Math.max(w.lat,S.lat,I.lat,O.lat);const $=Math.pow(2,-this.zoom)/16*270,H=this.projection.name==="globe"?1:4,X=(Y,K,ue,ce,he)=>{const ge=(Y+ue)/2,_e=(K+ce)/2,Se=new o.P(ge,_e),{lng:ee,lat:fe}=this.pointLocation3D(Se),Pe=Math.max(0,D-ee,B-fe,ee-z,fe-j);D=Math.min(D,ee),z=Math.max(z,ee),B=Math.min(B,fe),j=Math.max(j,fe),(he<H||Pe>$)&&(X(Y,K,ge,_e,he+1),X(ge,_e,ue,ce,he+1))};if(X(c,i,x,i,1),X(x,i,x,_,1),X(x,_,c,_,1),X(c,_,c,i,1),this.projection.name==="globe"){const[Y,K]=o.aV(this);Y?(j=90,z=180,D=-180):K&&(B=-90,z=180,D=-180)}return new o.ai(new o.aI(D,B),new o.aI(z,j))}_getBoundsRectangular(i,c){const{top:_,left:x}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,I=new o.P(x,_),O=new o.P(S,_),D=new o.P(S,w),z=new o.P(x,w);let B=this.pointCoordinate(I,i),j=this.pointCoordinate(O,i);const $=this.pointCoordinate(D,c),H=this.pointCoordinate(z,c),X=(Y,K)=>(K.y-Y.y)/(K.x-Y.x);return B.y>1&&j.y>=0?B=new o.Y((1-H.y)/X(H,B)+H.x,1):B.y<0&&j.y<=1&&(B=new o.Y(-H.y/X(H,B)+H.x,0)),j.y>1&&B.y>=0?j=new o.Y((1-$.y)/X($,j)+$.x,1):j.y<0&&B.y<=1&&(j=new o.Y(-$.y/X($,j)+$.x,0)),new o.ai().extend(this.coordinateLocation(B)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation($))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=i.visibleDemTiles.reduce((_,x)=>{if(x.dem){const w=x.dem.tree;_.min=Math.min(_.min,w.minimums[0]),_.max=Math.max(_.max,w.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*i.exaggeration(),c.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,_=this.height/2-c*(1-this._horizonShift);return i?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-o.aS,this.maxLat=o.aS,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aj(this.minLng)*this.tileSize,this.worldMaxX=o.aj(this.maxLng)*this.tileSize,this.worldMinY=o.ak(this.maxLat)*this.tileSize,this.worldMaxY=o.ak(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,c){return this.projection.createTileMatrix(this,c,i)}calculateDistanceTileData(i){const c=i.key,_=this._distanceTileDataCache;if(_[c])return _[c];const x=i.canonical,w=1/this.height,S=this.cameraWorldSize,I=S/this.zoomScale(x.z),O=(x.x+Math.pow(2,x.z)*i.wrap)*I,D=x.y*I,z=this.point;z.x*=S/this.worldSize,z.y*=S/this.worldSize;const B=this.angle,j=Math.sin(-B),$=-Math.cos(-B);return _[c]={bearing:[j,$],center:[(z.x-O)*w,(z.y-D)*w],scale:I/o.a3*w},_[c]}calculateFogTileMatrix(i){const c=i.key,_=this._fogTileMatrixCache;if(_[c])return _[c];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return o.ad.multiply(x,this.worldToFogMatrix,x),_[c]=new Float32Array(x),_[c]}calculateProjMatrix(i,c=!1,_=!1){const x=i.key;let w;if(w=_?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,w[x])return w[x];const S=this.calculatePosMatrix(i,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:_?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,o.ad.multiply(S,I,S),w[x]=new Float32Array(S),w[x]}calculatePixelsToTileUnitsMatrix(i){const c=i.tileID.key,_=this._pixelsToTileUnitsCache;if(_[c])return _[c];const x=o.aW(i,this);return _[c]=x,_[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,c=o.ad.fromScaling([],[i,i,i]);return o.ad.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const c=o.ax(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(c),x=this._camera.forward(),w=o.ax(1,this._center.lat);_[2]/=w,x[2]/=w,o._.normalize(x,x);const S=i.raycast(_,x,i.exaggeration());if(S){const I=o._.scaleAndAdd([],_,x,S),O=new o.Y(I[0],I[1],o.ax(I[2],o.ay(I[1]))),D=(O.z+o._.length([O.x-_[0],O.y-_[1],O.z-_[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=O.toAltitude(),this._center=this.coordinateLocation(O),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const c=this._elevation,_=o.ax(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(_),w=c.getAtPointOrZero(new o.Y(...x)),S=this.pixelsPerMeter/this.worldSize*w,I=this._minimumHeightOverTerrain(),O=x[2]-S;if(O<=I)if(O<0||i){const D=this.locationCoordinate(this._center,this._centerAltitude),z=[x[0],x[1],D.z-x[2]],B=o._.length(z);z[2]-=(I-O)/this._pixelsPerMercatorPixel;const j=o._.length(z);if(j===0)return;o._.scale(z,z,B/j*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],D.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const j=this.center;return j.lat=o.at(j.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(j.lng=o.at(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}const c=this._unmodified,{x:_,y:x}=this.point;let w=0,S=_,I=x;const O=this.width/2,D=this.height/2,z=this.worldMinY*this.scale,B=this.worldMaxY*this.scale;if(x-D<z&&(I=z+D),x+D>B&&(I=B-D),B-z<this.height&&(w=Math.max(w,this.height/(B-z)),I=(B+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const j=this.worldMinX*this.scale,$=this.worldMaxX*this.scale,H=this.worldSize/2-(j+$)/2;S=(_+H+this.worldSize)%this.worldSize-H,S-O<j&&(S=j+O),S+O>$&&(S=$-O),$-j<this.width&&(w=Math.max(w,this.width/($-j)),S=($+j)/2)}S===_&&I===x||(this.center=this.unproject(new o.P(S,I))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,c=this.projection.name==="globe",_=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.ax(1,this.center.lat)/o.ax(1,o.b3));const x=o.aX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?_:1,S=this._camera.getWorldToCamera(this.worldSize,w);let I;const O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(O[8]=2*-i.x/this.width,O[9]=2*i.y/this.height,this.isOrthographic){let fe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Pe=fe*this.aspect,We=-Pe,ke=-fe;Pe-=i.x,We-=i.x,fe+=i.y,ke+=i.y,I=this._camera.getCameraToClipOrthographic(We,Pe,ke,fe,this._nearZ,this._farZ),((be,Xe,dt,pt)=>{for(let ft=0;ft<16;ft++)be[ft]=ho(Xe[ft],dt[ft],pt)})(I,I,O,dl(this.pitch>=15?1:this.pitch/15))}else I=O;const D=o.ad.mul([],O,S);let z=o.ad.mul([],I,S);if(this.projection.isReprojectedInTileSpace){const fe=this.locationCoordinate(this.center),Pe=o.ad.identity([]);o.ad.translate(Pe,Pe,[fe.x*this.worldSize,fe.y*this.worldSize,0]),o.ad.multiply(Pe,Pe,o.aY(this)),o.ad.translate(Pe,Pe,[-fe.x*this.worldSize,-fe.y*this.worldSize,0]),o.ad.multiply(z,z,Pe),o.ad.multiply(D,D,Pe),this.inverseAdjustmentMatrix=o.aZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.ad.scale([],z,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=z,this.invProjMatrix=o.ad.invert(new Float64Array(16),this.projMatrix),c){const fe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);fe[8]=2*-i.x/this.width,fe[9]=2*i.y/this.height,this.expandedFarZProjMatrix=o.ad.mul([],fe,S)}else this.expandedFarZProjMatrix=this.projMatrix;const B=o.ad.invert([],I);this.frustumCorners=o.a_.fromInvProjectionMatrix(B,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const j=new Float32Array(16);o.ad.identity(j),o.ad.scale(j,j,[1,-1,1]),o.ad.rotateX(j,j,this._pitch),o.ad.rotateZ(j,j,this.angle);const $=o.ad.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.ad.clone($);const H=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;$[8]=2*-i.x/this.width,$[9]=2*(i.y+H)/this.height,this.skyboxMatrix=o.ad.multiply(j,$,j);const X=this.point,Y=X.x,K=X.y,ue=this.width%2/2,ce=this.height%2/2,he=Math.cos(this.angle),ge=Math.sin(this.angle),_e=Y-Math.round(Y)+he*ue+ge*ce,Se=K-Math.round(K)+he*ce+ge*ue,ee=new Float64Array(z);if(o.ad.translate(ee,ee,[_e>.5?_e-1:_e,Se>.5?Se-1:Se,0]),this.alignedProjMatrix=ee,z=o.ad.create(),o.ad.scale(z,z,[this.width/2,-this.height/2,1]),o.ad.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=o.ad.create(),o.ad.scale(z,z,[1,-1,1]),o.ad.translate(z,z,[-1,-1,0]),o.ad.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=o.ad.multiply(new Float64Array(16),this.labelPlaneMatrix,D),this._calcFogMatrices(),this._distanceTileDataCache={},z=o.ad.invert(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.a$(this);const fe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o._.transformMat4(fe,fe,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,_=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,w=[i,i,c];o._.scale(w,w,x),o._.scale(_,_,-1),o._.multiply(_,_,w);const S=o.ad.create();o.ad.translate(S,S,_),o.ad.scale(S,S,w),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,c,x)}_computeCameraPosition(i){const c=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),x=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-i/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-_[0]*w,x.y/this.worldSize-_[1]*w,i/this.worldSize*this._centerAltitude-_[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],x=i[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(w=Math.min((c-_)/x,1)),this._camera.position=o._.scaleAndAdd([],this._camera.position,i,w),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,c=this._camera.forward(),{pitch:_,bearing:x}=this._camera.getPitchBearing(),w=o.ax(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.ab(this._maxPitch)),I=Math.max((i[2]-w)/Math.cos(_),S),O=this._zoomFromMercatorZ(I);o._.scaleAndAdd(i,i,c,I),this._pitch=o.at(_,o.ab(this.minPitch),o.ab(this.maxPitch)),this.angle=o.au(x,-Math.PI,Math.PI),this._setZoom(o.at(O,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.Y(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let c=0,_=o.aU,x=0,w=1/0;for(;_-c>1e-6&&_>c;){const S=c+.5*(_-c),I=this.tileSize*Math.pow(2,S),O=this.getCameraToCenterDistance(this.projection,S,I),D=this.scaleZoom(O/(i*this.tileSize)),z=Math.abs(S-D);z<w&&(w=z,x=S),S<D?c=S:_=S}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,c){const _=Math.min(i.x,c.x),x=Math.max(i.x,c.x),w=Math.min(i.y,c.y),S=Math.max(i.y,c.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new o.P(_,w),new o.P(x,S),new o.P(_,S),new o.P(x,w)],O=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const z of I){const B=this.pointRayIntersection(z);if(B.t<0)return!0;const j=this.rayIntersectionCoordinate(B);if(j.x<O||j.y<0||j.x>D||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.b0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(i,c){const _=o._.length(o._.sub([],this._camera.position,i)),x=this._zoomFromMercatorZ(_)+c;return _-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([c,_,x],w){const S=[c,_,x,1];o.aA.transformMat4(S,S,w);const I=S[3]=Math.max(S[3],1e-6);return S[0]/=I,S[1]/=I,S[2]/=I,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,i))}}getCameraToCenterDistance(i,c=this.zoom,_=this.worldSize){const x=o.aX(i,c,this.width,this.height,1024),w=i.pixelSpaceConversion(this.center.lat,_,x);let S=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(S=ho(1,S,dl(this.pitch>=15?1:this.pitch/15))),S}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.ad.multiply(i,i,this.globeMatrix),i}getFrustum(i){return o.aM.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}const Wn={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11},Zl=(p,i)=>{if(i>0&&p.terrain&&o.w("Cutoff is currently disabled on terrain"),i<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=p.transform,_=Math.max(Math.abs(c._zoom-(p.minCutoffZoom-1)),1),x=c.isLODDisabled(!1)?o.$(60,45,c.pitch):o.$(30,15,c.pitch),w=c._farZ-c._nearZ,S=i*c.height,I=((1-(O=x))*c.cameraToCenterDistance+O*(c._farZ+S))*_;var O;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(I-c._nearZ)/w,(I-S-c._nearZ)/w]}}},Ki={cascadeCount:2,shadowMapResolution:2048};class ch{constructor(i,c){this.aabb=i,this.lastCascade=c}}class jp{add(i,c){const _=this.receivers[i.key];_!==void 0?(_.aabb.min[0]=Math.min(_.aabb.min[0],c.min[0]),_.aabb.min[1]=Math.min(_.aabb.min[1],c.min[1]),_.aabb.min[2]=Math.min(_.aabb.min[2],c.min[2]),_.aabb.max[0]=Math.max(_.aabb.max[0],c.max[0]),_.aabb.max[1]=Math.max(_.aabb.max[1],c.max[1]),_.aabb.max[2]=Math.max(_.aabb.max[2],c.max[2])):this.receivers[i.key]=new ch(c,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,c,_){const x=o.b6.fromPoints(i.points);let w=0;for(const S in this.receivers){const I=this.receivers[S];if(!I||!x.intersectsAabb(I.aabb))continue;I.aabb.min=x.closestPoint(I.aabb.min),I.aabb.max=x.closestPoint(I.aabb.max);const O=I.aabb.getCorners();for(let D=0;D<_.length;D++){let z=!0;for(const B of O){const j=[B[0]*c,B[1]*c,B[2]];if(o._.transformMat4(j,j,_[D].matrix),j[0]<-1||j[0]>1||j[1]<-1||j[1]>1){z=!1;break}}if(I.lastCascade=D,w=Math.max(w,D),z)break}}return w+1}}class Vp{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new jp,this._depthMode=new o.ae(i.context.gl.LEQUAL,o.ae.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),i.tp.registerParameter(Ki,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(Ki,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,c){const _=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const x=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||x<=0||(this._shadowLayerCount=_.style.order.reduce((H,X)=>{const Y=_.style._mergedLayers[X];return H+(Y.hasShadowPass()&&!Y.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=_.context,S=Ki.shadowMapResolution,I=Ki.shadowMapResolution;if(this._cascades.length===0||Ki.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let H=0;H<Ki.cascadeCount;++H){const X=_._shadowMapDebug,Y=w.gl,K=w.createFramebuffer(S,I,X,"texture"),ue=new o.T(w,{width:S,height:I,data:null},Y.DEPTH_COMPONENT);if(K.depthAttachment.set(ue.texture),X){const ce=new o.T(w,{width:S,height:I,data:null},Y.RGBA);K.colorAttachment.set(ce.texture)}this._cascades.push({framebuffer:K,texture:ue,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.aM,scale:0})}}this.shadowDirection=kf(c);let O=0;if(i.elevation){const H=i.elevation,X=[1e4,-1e4];H.visibleDemTiles.filter(Y=>Y.dem).forEach(Y=>{const K=Y.dem.tree;X[0]=Math.min(X[0],K.minimums[0]),X[1]=Math.max(X[1],K.maximums[0])}),X[0]!==1e4&&(O=(X[1]-X[0])*H.exaggeration())}const D=1.5*i.cameraToCenterDistance,z=3*D,B=new Float64Array(16);for(let H=0;H<this._cascades.length;++H){const X=this._cascades[H];let Y=i.height/50,K=1;Ki.cascadeCount===1?K=z:H===0?K=D:(Y=D,K=z);const[ue,ce]=Yl(i,this.shadowDirection,Y,K,Ki.shadowMapResolution,O);X.scale=i.scale,X.matrix=ue,X.boundingSphereRadius=ce,o.ad.invert(B,X.matrix),X.frustum=o.aM.fromInvProjectionMatrix(B,1,0,!0),X.far=K}const j=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[j].far,this._cascades[j].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Ki.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Ki.shadowMapResolution,this._uniformValues.u_shadowmap_0=Wn.ShadowMap0,this._uniformValues.u_shadowmap_1=Wn.ShadowMap0+1,this._groundShadowTiles=_.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const $=_.transform.elevation;for(const H of this._groundShadowTiles){let X={min:0,max:0};if($){const Y=$.getMinMaxForTile(H);Y&&(X=Y)}this.addShadowReceiver(H.toUnwrapped(),X.min,X.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,c){if(!this.enabled)return;const _=this.painter,x=_.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(_.transform.getFrustum(0),_.transform.worldSize,this._cascades),x.viewport.set([0,0,Ki.shadowMapResolution,Ki.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){_.currentShadowCascade=w,x.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),x.clear({color:o.C.white,depth:1});for(const S of i.order){const I=i._mergedLayers[S];if(!I.hasShadowPass()||I.isHidden(_.transform.zoom))continue;const O=i.getLayerSourceCache(I),D=O?c[O.id]:void 0;(I.type==="model"||D&&D.length)&&_.renderLayer(_,O,I,D)}}_.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const i=this.painter,c=i.style,_=i.context,x=c.directionalLight,w=c.ambientLight;if(!x||!w)return;const S=[],I=Zl(i,i.longestCutoffRange);I.shouldRenderCutoff&&S.push("RENDER_CUTOFF");const O=Bu(c,x,w),D=new o.ae(_.gl.LEQUAL,o.ae.ReadOnly,i.depthRangeFor3D);for(const z of this._groundShadowTiles){const B=z.toUnwrapped(),j=i.isTileAffectedByFog(z),$=i.getOrCreateProgram("groundShadow",{defines:S,overrideFog:j});this.setupShadows(B,$),i.uploadCommonUniforms(_,$,B,null,I);const H={u_matrix:i.transform.calculateProjMatrix(B),u_ground_shadow_factor:O};$.draw(i,_.gl.TRIANGLES,D,o.ag.disabled,o.a.multiply,o.af.disabled,H,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,{},i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?o.a.unblended:o.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){const c=this.painter.transform,_=c.calculatePosMatrix(i,c.worldSize);return o.ad.multiply(_,this._cascades[this.painter.currentShadowCascade].matrix,_),Float32Array.from(_)}calculateShadowPassMatrixFromMatrix(i){return o.ad.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,c,_,x=0){if(!this.enabled)return;const w=this.painter.transform,S=this.painter.context,I=S.gl,O=this._uniformValues,D=new Float64Array(16),z=w.calculatePosMatrix(i,w.worldSize);for(let B=0;B<this._cascades.length;B++)o.ad.multiply(D,this._cascades[B].matrix,z),O[B===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),S.activeTexture.set(I.TEXTURE0+Wn.ShadowMap0+B),this._cascades[B].texture.bind(I.NEAREST,I.CLAMP_TO_EDGE);if(this.useNormalOffset=!!_,this.useNormalOffset){const B=o.b5(i.canonical),j=2/w.tileSize*o.a3/Ki.shadowMapResolution,$=j*this._cascades[0].boundingSphereRadius,H=j*this._cascades[this._cascades.length-1].boundingSphereRadius,X=(_==="vector-tile"?1:3)/Math.pow(2,x-i.canonical.z-(1-w.zoom+Math.floor(w.zoom)));O.u_shadow_normal_offset=[B,$*X,H*X],O.u_shadow_bias=[6e-5,.0012,.012]}else O.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(S,O)}setupShadowsFromMatrix(i,c,_=!1){if(!this.enabled)return;const x=this.painter.context,w=x.gl,S=this._uniformValues,I=new Float64Array(16);for(let O=0;O<Ki.cascadeCount;O++)o.ad.multiply(I,this._cascades[O].matrix,i),S[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),x.activeTexture.set(w.TEXTURE0+Wn.ShadowMap0+O),this._cascades[O].texture.bind(w.NEAREST,w.CLAMP_TO_EDGE);this.useNormalOffset=_,_?(S.u_shadow_normal_offset=[1,5,5],S.u_shadow_bias=[6e-5,.0012,.012]):S.u_shadow_bias=[36e-5,.0012,.012],c.setShadowUniformValues(x,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,c,_,x){if(x[2]>=0)return{};const w=function(O,D,z){const B=z/(1<<O.canonical.z);return new o.b6([O.canonical.x*B+O.wrap*z,O.canonical.y*B+O.wrap*z,0],[(O.canonical.x+1)*B+O.wrap*z,(O.canonical.y+1)*B+O.wrap*z,D])}(i,c,_).getCorners(),S=c/-x[2];x[0]<0?(o._.add(w[0],w[0],[x[0]*S,0,0]),o._.add(w[3],w[3],[x[0]*S,0,0])):x[0]>0&&(o._.add(w[1],w[1],[x[0]*S,0,0]),o._.add(w[2],w[2],[x[0]*S,0,0])),x[1]<0?(o._.add(w[0],w[0],[0,x[1]*S,0]),o._.add(w[1],w[1],[0,x[1]*S,0])):x[1]>0&&(o._.add(w[2],w[2],[0,x[1]*S,0]),o._.add(w[3],w[3],[0,x[1]*S,0]));const I={};return I.vertices=w,I.planes=[Xl(w[1],w[0],w[4]),Xl(w[2],w[1],w[5]),Xl(w[3],w[2],w[6]),Xl(w[0],w[3],w[7])],I}addShadowReceiver(i,c,_){this._receivers.add(i,o.b6.fromTileIdAndHeight(i,c,_))}getMaxCascadeForTile(i){const c=this._receivers.get(i);return c&&c.lastCascade?c.lastCascade:0}}function Xl(p,i,c){const _=o._.sub([],c,i),x=o._.sub([],p,i),w=o._.cross([],_,x),S=o._.length(w);return S===0?[0,0,1,0]:(o._.scale(w,w,1/S),[w[0],w[1],w[2],-o._.dot(w,i)])}function kf(p){const i=p.properties.get("direction"),c=o.ac(i.x,i.y,i.z);c[2]=o.at(c[2],0,75);const _=o.b7([c[0],c[1],c[2]]);return o._.fromValues(_.x,_.y,_.z)}function Bu(p,i,c){const _=i.properties.get("color"),x=i.properties.get("intensity"),w=i.properties.get("direction"),S=[w.x,w.y,w.z],I=c.properties.get("color"),O=c.properties.get("intensity"),D=Math.max(o._.dot([0,0,1],S),0),z=[0,0,0];o._.scale(z,I.toRenderColor(p.getLut(i.scope)).toArray01Linear().slice(0,3),O);const B=[0,0,0];return o._.scale(B,_.toRenderColor(p.getLut(c.scope)).toArray01Linear().slice(0,3),D*x),o.b8([z[0]>0?z[0]/(z[0]+B[0]):0,z[1]>0?z[1]/(z[1]+B[1]):0,z[2]>0?z[2]/(z[2]+B[2]):0])}function Yl(p,i,c,_,x,w){const S=p.zoom,I=p.scale,O=p.worldSize,D=1/O,z=p.aspect,B=Math.sqrt(1+z*z)*Math.tan(.5*p.fovX),j=B*B,$=_-c,H=_+c;let X,Y;j>$/H?(X=_,Y=_*B):(X=.5*H*(1+j),Y=.5*Math.sqrt($*$+2*(_*_+c*c)*j+H*H*j*j));const K=p.projection.pixelsPerMeter(p.center.lat,O),ue=p._camera.getCameraToWorldMercator(),ce=[0,0,-X*D];o._.transformMat4(ce,ce,ue);let he=Y*D;const ge=p._edgeInsets;if(!(ge.left===0&&ge.top===0&&ge.right===0&&ge.bottom===0||ge.left===ge.right&&ge.top===ge.bottom)){const Ct=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?K:1),Pt=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,c,_);Pt[8]=2*-p.centerOffset.x/p.width,Pt[9]=2*p.centerOffset.y/p.height;const Lt=new Float64Array(16);o.ad.mul(Lt,Pt,Ct);const Ot=new Float64Array(16);o.ad.invert(Ot,Lt);const It=o.aM.fromInvProjectionMatrix(Ot,O,S,!0);for(const it of It.points){const jt=((_e=it)[0]/=I,_e[1]/=I,_e[2]=o.ax(_e[2],p._center.lat),_e);he=Math.max(he,o._.len(o._.subtract([],ce,jt)))}}var _e;he*=x/(x-1);const Se=Math.acos(i[2]),ee=Math.atan2(-i[0],-i[1]),fe=new nt;fe.position=ce,fe.setPitchBearing(Se,ee);const Pe=fe.getWorldToCamera(O,K),We=he*O,ke=Math.min(p._mercatorZfromZoom(17)*O*-2,-2*We),be=fe.getCameraToClipOrthographic(-We,We,-We,We,ke,(We+w*K)/i[2]),Xe=new Float64Array(16);o.ad.multiply(Xe,be,Pe);const dt=o._.fromValues(Math.floor(1e6*ce[0])/1e6*O,Math.floor(1e6*ce[1])/1e6*O,0),pt=.5*x,ft=[0,0,0];o._.transformMat4(ft,dt,Xe),o._.scale(ft,ft,pt);const Fe=[Math.floor(ft[0]),Math.floor(ft[1]),Math.floor(ft[2])],Ye=[0,0,0];o._.sub(Ye,ft,Fe),o._.scale(Ye,Ye,-1/pt);const lt=new Float64Array(16);return o.ad.identity(lt),o.ad.translate(lt,lt,Ye),o.ad.multiply(Xe,lt,Xe),[Xe,We]}function Nu(p,i){return p!=null&&i!=null&&!(!p.hasData()||!i.hasData())&&p.demTexture!=null&&i.demTexture!=null&&p.tileID.key!==i.tileID.key}const pl=new class{constructor(){this.operations={}}newMorphing(p,i,c,_,x){if(p in this.operations){const w=this.operations[p];w.to.tileID.key!==c.tileID.key&&(w.queued=c)}else this.operations[p]={startTime:_,phase:0,duration:x,from:i,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const i=this.operations[p];return{from:i.from,to:i.to,phase:i.phase}}update(p){for(const i in this.operations){const c=this.operations[i];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[i];break}}}_nextOp(p,i){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=i,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},$p={0:null,1:"TERRAIN_VERTEX_MORPHING"};function hh(p,i,c){if(i===0)return 0;const _=i<1&&c===514?.25/i:1;return 6*Math.pow(1.5,22-p)*Math.max(i,1)*_}function Hg(p,i){const c=1<<p.z;return!i&&(p.x===0||p.x===c-1)||p.y===0||p.y===c-1}const Lf=p=>({u_matrix:p});function zf(p,i,c,_,x){if(x>0){const w=o.e.now(),S=(w-p.timeAdded)/x,I=i?(w-i.timeAdded)/x:-1,O=c.getSource(),D=_.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),z=!i||Math.abs(i.tileID.overscaledZ-D)>Math.abs(p.tileID.overscaledZ-D),B=z&&p.refreshedUponExpiration?1:o.at(z?S:1-I,0,1);return p.refreshedUponExpiration&&S>=1&&(p.refreshedUponExpiration=!1),i?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class Uu extends la{constructor(i,c,_,x){super(i,c,_,x),this.type="raster-array",this.maxzoom=22,this._options=o.W({type:"raster-array"},c)}triggerRepaint(i){const c=this.map.painter._terrain,_=this.map.style.getSourceCache(this.id);c&&c.enabled&&_&&c._clearRenderCacheForTile(_.id,i.tileID),this.map.triggerRepaint()}loadTile(i,c){const _=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(_,o.R.Tile);i.requestParams=x,i.actor||(i.actor=this.dispatcher.getActor()),i.request=i.fetchHeader(void 0,(w,S,I,O)=>{if(delete i.request,i.aborted)return i.state="unloaded",c(null);if(w)return w.code===20?void 0:(i.state="errored",c(w));this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:I,expires:O}),i.state="empty",c(null)})}unloadTile(i,c){const _=i.texture;_&&_ instanceof o.T?(i.destroy(!0),this.map.painter.saveTileTexture(_)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,c,_){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBand(c,_,(x,w)=>{if(x)return i.state="errored",this.fire(new o.d(x)),void this.triggerRepaint(i);w&&(i.setTexture(w,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:w})=>w===i),_=c&&c.fields,x=_&&_.bands&&_.bands;return x?x[0]:0}getTextureDescriptor(i,c,_){if(!i)return;const x=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let w=null;c instanceof o.bk?w=c.paint.get("raster-array-band"):c instanceof o.bl&&(w=c.paint.get("raster-particle-array-band"));const S=w||this.getInitialBand(x);if(S!=null)if(i.textureDescriptor){if(!i.updateNeeded(x,S)||_)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,x,S)}}const Ff={vector:Ds,raster:la,"raster-dem":class extends la{constructor(p,i,c,_){super(p,i,c,_),this.type="raster-dem",this.maxzoom=22,this._options=o.W({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(p,i){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(x,w){x&&(p.state="errored",i(x)),w&&(p.dem=w,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",i(null))}p.request=o.h(this.map._requestManager.transformRequest(c,o.R.Tile),(function(x,w,S,I){if(delete p.request,p.aborted)p.state="unloaded",i(null);else if(x)p.state="errored",i(x);else if(w){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:S,expires:I});const O=ImageBitmap&&w instanceof ImageBitmap&&o.bi(),D=1-(w.width-o.bj(w.width))/2;D<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const z=O?w:o.e.getImageData(w,D),B={uid:p.uid,coord:p.tileID,source:this.id,scope:this.scope,rawImageData:z,encoding:this.encoding,padding:D};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",B,_.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){const i=p.canonical,c=Math.pow(2,i.z),_=(i.x-1+c)%c,x=i.x===0?p.wrap-1:p.wrap,w=(i.x+1+c)%c,S=i.x+1===c?p.wrap+1:p.wrap,I={};return I[new o.aL(p.overscaledZ,x,i.z,_,i.y).key]={backfilled:!1},I[new o.aL(p.overscaledZ,S,i.z,w,i.y).key]={backfilled:!1},i.y>0&&(I[new o.aL(p.overscaledZ,x,i.z,_,i.y-1).key]={backfilled:!1},I[new o.aL(p.overscaledZ,p.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},I[new o.aL(p.overscaledZ,S,i.z,w,i.y-1).key]={backfilled:!1}),i.y+1<c&&(I[new o.aL(p.overscaledZ,x,i.z,_,i.y+1).key]={backfilled:!1},I[new o.aL(p.overscaledZ,p.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},I[new o.aL(p.overscaledZ,S,i.z,w,i.y+1).key]={backfilled:!1}),I}},"raster-array":Uu,geojson:class extends o.E{constructor(p,i,c,_){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(_),this._data=i.data,this._options=o.W({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const x=o.a3/this.tileSize;this.workerOptions=o.W({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*x,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*x,extent:o.a3,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:o.a3,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*x,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}updateData(p){return this._options.dynamic?typeof p!="string"&&(p.type==="Feature"&&(p={type:"FeatureCollection",features:[p]}),p.type!=="FeatureCollection")?this.fire(new o.d(new Error("Data to update should be a feature or a feature collection."))):(this._coalesce&&typeof p!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"?this._data.features.push(...p.features):this._data=p,this._updateWorkerData(!0),this):this.fire(new o.d(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(p,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},i),this}getClusterChildren(p,i){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},i),this}getClusterLeaves(p,i,c,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:i,offset:c},_),this}_updateWorkerData(p=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.f("dataloading",{dataType:"source"})),this._loaded=!1;const i=o.W({append:p},this.workerOptions);i.scope=this.scope;const c=this._data;typeof c=="string"?(i.request=this.map._requestManager.transformRequest(o.e.resolveURL(c),o.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(_,x)=>{if(this._loaded=!0,this._pendingLoad=null,_)this.fire(new o.d(_));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(w.resourceTiming=x.resourceTiming[this.id]),p&&(this._partialReload=!0),this.fire(new o.f("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(p),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,i){const c=p.actor?"reloadTile":"loadTile";p.actor=this.actor;const _=this.map.style?this.map.style.getLut(this.scope):null,x=this._partialReload,w={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_?{image:_.image.clone()}:null,scope:this.scope,pixelRatio:o.e.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:x};p.request=this.actor.send(c,w,(S,I)=>x&&!I?(p.state="loaded",i(null)):(delete p.request,p.destroy(),p.aborted?i(null):S?i(S):(p.loadVectorData(I,this.map.painter,c==="reloadTile"),i(null))),void 0,c==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p,i){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(p){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.W({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.bm{constructor(p,i,c,_){super(p,i,c,_),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const i of p.urls)this.urls.push(this.map._requestManager.transformRequest(i,o.R.Source).url);o.bn(this.urls,(i,c)=>{this._loaded=!0,i?this.fire(new o.d(i)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const i=this.video.seekable;p<i.start(0)||p>i.end(0)?this.fire(new o.d(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,i=p.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(p,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.bm,model:class extends o.E{constructor(p,i,c,_){super(),this.id=p,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){const p=[];for(const i in this._options.models){const c=this._options.models[i],_=o.l(this.map._requestManager.transformRequest(c.uri,o.R.Model).url).then(x=>{if(!x)return;const w=o.c(x),S=new o.M(i,c.position,c.orientation,w);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(x=>{this.fire(new o.d(new Error(`Could not load model ${i} from ${c.uri}: ${x.message}`)))});p.push(_)}return Promise.allSettled(p).then(()=>{this._loaded=!0,this.fire(new o.f("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this.fire(new o.d(new Error(`Could not load models: ${i.message}`)))})}onAdd(p){this.map=p,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(p,i){}serialize(){return{type:"model"}}},"batched-model":class extends o.E{constructor(p,i,c,_){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(_)}onAdd(p){this.map=p,this.load()}load(p){this._loaded=!1,this.fire(new o.f("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map._worldview;this._tileJSONRequest=Jn(this._options,this.map._requestManager,i,c,(_,x)=>{this._tileJSONRequest=null,this._loaded=!0,_?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new o.d(_))):x&&(o.W(this,x),x.bounds&&(this.tileBounds=new za(x.bounds,this.minzoom,this.maxzoom)),o.an(x.tiles,this.map._requestManager._customAccessToken),this.fire(new o.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.f("data",{dataType:"source",sourceDataType:"content"}))),p&&p(_)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,i){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(c,o.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=i;else{if(p.buckets){const w=Object.values(p.buckets);for(const S of w)S.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",_,x.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",_,x.bind(this),void 0,!0);function x(w,S){return p.aborted?i(null):w&&w.status!==404?i(w):(S&&(S.resourceTiming&&(p.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&p.setExpiryData(S),p.buckets={...p.buckets,...S.buckets},S.featureIndex&&(p.latestFeatureIndex=S.featureIndex)),p.state="loaded",void i(null))}}serialize(){return o.W({},this._options)}},canvas:class extends o.bm{constructor(p,i,c,_){super(p,i,c,_),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(w=>typeof w!="number"))||this.fire(new o.d(new o.V(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.d(new o.V(`sources.${p}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new o.d(new o.V(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new o.d(new o.V(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.d(new o.V(`sources.${p}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.d(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(p){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof o.bo||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends o.E{constructor(p,i,c,_){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=i,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.d(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.d(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new za(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),o.W(this,o.ah(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.ah(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.f("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.f("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this.map=p,this._loaded=!1,this.fire(new o.f("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:i,y:c,z:_}=p.canonical;return this._implementation.hasTile({x:i,y:c,z:_})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,i){const{x:c,y:_,z:x}=p.tileID.canonical,w=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:c,y:_,z:x},{signal:w.signal})).then((function(S){return delete p.request,p.aborted?(p.state="unloaded",i(null)):S===void 0?(p.state="errored",i(null)):S===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",i(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(S)?(this.loadTileData(p,S),p.state="loaded",void i(null)):(p.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.code!==20&&(p.state="errored",i(S))}),p.request.cancel=()=>w.abort()}loadTileData(p,i){p.setTexture(i,this.map.painter)}unloadTile(p,i){if(p.texture&&p.texture instanceof o.T?(p.destroy(!0),p.texture&&p.texture instanceof o.T&&this.map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){const{x:c,y:_,z:x}=p.tileID.canonical;this._implementation.unloadTile({x:c,y:_,z:x})}i&&i()}abortTile(p,i){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){const p=o.al(this.id,this.scope);this.map.style.clearSource(p)}_update(){this.fire(new o.f("data",{dataType:"source",sourceDataType:"content"}))}}},Pi=function(p,i,c,_){const x=new Ff[i.type](p,i,c,_);if(x.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${x.id}`);return o.bp(["load","abort","unload","serialize","prepare"],x),x};class Zg extends o.bv{constructor(i){const c={type:"raster-dem",maxzoom:i.transform.maxZoom},_=new o.bw(o.bx(),null),x=Pi("mock-dem",c,_,i.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,c){i.state="loaded",c(null)}}class Gp extends o.bv{constructor(i){const c=Pi("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new o.bw(o.bx(),null),i.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,c,_){if(i.freezeTileCoverage)return;this.transform=i;const x=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,S)=>{if(w[S.key]="",!this._tiles[S.key]){const I=new o.by(S,this._source.tileSize*S.overscaleFactor(),i.tileZoom);I.state="loaded",this._tiles[S.key]=I}return w},{});for(const w in this._tiles)w in x||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(i){const c=this.proxyCachedFBO[i];if(c!==void 0){const _=Object.values(c);this.renderCachePool.push(..._),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Wp extends o.aL{constructor(i,c,_){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=c,this.projMatrix=_}}class qp extends o.bq{constructor(i,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,x,w]=function(O){const D=new o.bt,z=new o.bu,B=131;D.reserve(17161),z.reserve(33800);const j=o.a3/128,$=o.a3+j/2,H=$+j;for(let Y=-j;Y<H;Y+=j)for(let K=-j;K<H;K+=j){const ue=K<0||K>$||Y<0||Y>$?24575:0,ce=o.at(Math.round(K),0,o.a3),he=o.at(Math.round(Y),0,o.a3);D.emplaceBack(ce+ue,he)}const X=(Y,K)=>{const ue=K*B+Y;z.emplaceBack(ue+1,ue,ue+B),z.emplaceBack(ue+B,ue+B+1,ue+1)};for(let Y=1;Y<129;Y++)for(let K=1;K<129;K++)X(K,Y);return[0,129].forEach(Y=>{for(let K=0;K<130;K++)X(K,Y),X(Y,K)}),[D,z,32768]}(),S=i.context;this.gridBuffer=S.createVertexBuffer(_,o.br.members),this.gridIndexBuffer=S.createIndexBuffer(x),this.gridSegments=o.b.simpleSegment(0,0,_.length,x.length),this.gridNoSkirtSegments=o.b.simpleSegment(0,0,_.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Gp(c.map),this.orthoMatrix=o.ad.create(),o.ad.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.a3,0,o.a3,0,1);const I=S.gl;this._overlapStencilMode=new o.ag({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Zg(c.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,c,_){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const x=i.terrain.properties,w=i.terrain.drapeRenderMode===0,S=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.e.now();const I=i.terrain&&i.terrain.scope,O=x.get("source"),D=w?this._mockSourceCache:i.getSourceCache(O,I);if(!D)return void o.w(`Couldn't find terrain source "${O}".`);if(this.sourceCache=D,this._exaggeration=S?this.calculateExaggeration(c):x.get("exaggeration"),!c.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const z=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const B=this.getScaledDemTileSize();this.sourceCache.update(c,B,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,z(),this._initializing=!0),z(),c.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(i){const c=this._previousCameraAltitude,_=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=_;const x=c!=null?_-c:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const w=i.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(w);let I=w-this._previousZoom;const O=this._previousUpdateTimestamp;let D=w;this._evaluationZoom!=null&&(D=this._evaluationZoom,Math.abs(w-D)>.5&&(I=.5*(w-D+I)),I*x<0&&(D+=I)),this._evaluationZoom=D;const z=S.getExaggeration(D),B=z===S.getExaggeration(Math.max(0,D-.1));if(B&&Math.abs(z-this._exaggeration)<.01)return z;let j=Math.min(.1,.00375*(this._updateTimestamp-O));return(B||z<.1||Math.abs(I)<1e-4)&&(j=Math.min(.2,4*j)),o.a2(this._exaggeration,z,j)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(o.Y.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=c.getIds().map(O=>{const D=c.getTileByID(O).tileID;return D.projMatrix=_.calculateProjMatrix(D.toUnwrapped()),D});(function(O,D){const z=D.transform.pointCoordinate(D.transform.getCameraPoint()),B=new o.P(z.x,z.y);O.sort((j,$)=>{if($.overscaledZ-j.overscaledZ)return $.overscaledZ-j.overscaledZ;const H=new o.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),X=new o.P($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),Y=B.mult(1<<j.canonical.z);return Y.x-=.5,Y.y-=.5,Y.distSqr(H)-Y.distSqr(X)})})(x,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},x.forEach(O=>{this.proxyToSource[O.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const O in S){const D=S[O];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,i[O],w),D.usedForTerrain))continue;const z=i[O];D.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[c.id]=x.map(O=>new Wp(O,O.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const O of this.proxyCoords){const D=this.terrainTileForTile[O.key];if(!D)continue;const z=D.tileID.key;z in I||(this._visibleDemTiles.push(D),I[z]=z)}}_assignTerrainTiles(i){this._initializing||i.forEach(c=>{if(this.terrainTileForTile[c.key])return;const _=this._findTileCoveringTileID(c,this.sourceCache);_&&(this.terrainTileForTile[c.key]=_)})}_prepareDEMTextures(){const i=this.painter.context,c=i.gl;for(const _ in this.terrainTileForTile){const x=this.terrainTileForTile[_],w=x.dem;!w||x.demTexture&&!x.needsDEMTextureUpload||(i.activeTexture.set(c.TEXTURE1),ai(this.painter,x,w))}}_prepareDemTileUniforms(i,c,_,x){if(!c||c.demTexture==null)return!1;const w=i.tileID.canonical,S=Math.pow(2,c.tileID.canonical.z-w.z),I=x||"";return _[`u_dem_tl${I}`]=[w.x*S%1,w.y*S%1],_[`u_dem_scale${I}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,c=i.gl;if(!this._emptyDepthBufferTexture){const _=new o.i({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.T(i,_,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let i=0;const c=this._visibleDemTiles.reduce((_,x)=>{if(!x.dem)return _;const w=x.dem.tree.minimums[0];return w>0&&i++,_+w},0);return i?c/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,c=i.gl;i.activeTexture.set(c.TEXTURE2);const _=this._getLoadedAreaMinimum(),[x,w]=(()=>{const I=new o.bz({width:1,height:1},new Float32Array([_]));return[c.R32F,I]})();this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(w,{premultiply:!1}):S=this._emptyDEMTexture=new o.T(i,w,x,{premultiply:!1}),S}setupElevationDraw(i,c,_){const x=this.painter.context,w=x.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[2,0],u_exaggeration:0};S.u_exaggeration=this.exaggeration();let I=null,O=null,D=1;if(_&&_.morphing&&this._useVertexMorphing){const H=_.morphing.srcDemTile,X=_.morphing.dstDemTile;D=_.morphing.phase,H&&X&&(this._prepareDemTileUniforms(i,H,S,"_prev")&&(O=H),this._prepareDemTileUniforms(i,X,S)&&(I=X))}const z=H=>H&&H.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let B=null;var j,$;if(this.enabled?O&&I?(B=I.demTexture,x.activeTexture.set(w.TEXTURE4),O.demTexture.bind(z(O),w.CLAMP_TO_EDGE),S.u_dem_lerp=D):(I=this.terrainTileForTile[i.tileID.key],B=this._prepareDemTileUniforms(i,I,S)?I.demTexture:this.emptyDEMTexture):B=this.emptyDEMTexture,x.activeTexture.set(w.TEXTURE2),B&&(S.u_dem_size=(j=B).size[0]===1?1:j.size[0]-2,B.bind(z(I),w.CLAMP_TO_EDGE)),x.activeTexture.set(w.TEXTURE3),_&&_.useDepthForOcclusion&&this.painter.terrainDepthTexture&&this.painter.terrainDepthFBO?(this.painter.terrainDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),S.u_depth_size_inv=[1/this.painter.terrainDepthFBO.width,1/this.painter.terrainDepthFBO.height],S.u_depth_range_unpack=[2/(($=this.painter.depthRangeFor3D)[1]-$[0]),-1-2*$[0]/($[1]-$[0])]):(this.emptyDepthBufferTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),S.u_depth_range_unpack=[2,0]),x.activeTexture.set(w.TEXTURE0),_&&_.useMeterToDem&&I){const H=(1<<I.tileID.canonical.z)*o.ax(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=H}if(_&&_.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),c.setTerrainUniformValues(x,S),this.painter.transform.projection.name==="globe"){const H=this.globeUniformValues(this.painter.transform,i.tileID.canonical,_&&_.useDenormalizedUpVectorScale);c.setGlobeUniformValues(x,H)}}globeUniformValues(i,c,_){const x=i.projection;return{u_tile_tl_up:x.upVector(c,0,0),u_tile_tr_up:x.upVector(c,o.a3,0),u_tile_br_up:x.upVector(c,o.a3,o.a3),u_tile_bl_up:x.upVector(c,0,o.a3),u_tile_up_scale:_?o.bs(1):x.upVectorScale(c,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const c=this.painter,_=this.painter.context;i.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,w,S,I,O){if(x.transform.projection.name==="globe")(function(D,z,B,j,$){const H=D.context,X=H.gl;let Y,K;const ue=D.transform,ce=o.ba(D,H,ue),he=(be,Xe)=>{if(K===Xe)return;const dt=[$p[Xe],"PROJECTION_GLOBE_VIEW"];ce&&dt.push("CUSTOM_ANTIALIASING");const pt=D.isTileAffectedByFog(be);Y=D.getOrCreateProgram("globeRaster",{defines:dt,overrideFog:pt}),K=Xe},ge=D.colorModeForRenderPass(),_e=new o.ae(X.LEQUAL,o.ae.ReadWrite,D.depthRangeFor3D);pl.update($);const Se=o.bb(ue),ee=[o.aj(ue.center.lng),o.ak(ue.center.lat)],fe=D.globeSharedBuffers,Pe=[ue.width*o.e.devicePixelRatio,ue.height*o.e.devicePixelRatio],We=Float32Array.from(ue.globeMatrix),ke={useDenormalizedUpVectorScale:!0};{const be=D.transform,Xe=hh(be.zoom,z.exaggeration(),z.sourceCache._source.tileSize);K=-1;const dt=X.TRIANGLES;for(const pt of j){const ft=B.getTile(pt),Fe=o.ag.disabled,Ye=z.prevTerrainTileForTile[pt.key],lt=z.terrainTileForTile[pt.key];Nu(Ye,lt)&&pl.newMorphing(pt.key,Ye,lt,$,250),H.activeTexture.set(X.TEXTURE0),ft.texture&&ft.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const Ct=pl.getMorphValuesForProxy(pt.key),Pt=Ct?1:0;Ct&&o.o(ke,{morphing:{srcDemTile:Ct.from,dstDemTile:Ct.to,phase:o.b9(Ct.phase)}});const Lt=o.bc(pt.canonical),Ot=o.bd(Lt.getCenter().lat),It=o.be(pt.canonical,Lt,Ot,be.worldSize/be._pixelsPerMercatorPixel),it=o.bf(o.bg(pt.canonical)),jt=Mt(be.expandedFarZProjMatrix,We,Se,it,o.a1(be.zoom),ee,be.frustumCorners.TL,be.frustumCorners.TR,be.frustumCorners.BR,be.frustumCorners.BL,be.globeCenterInViewSpace,be.globeRadius,Pe,Xe,be._farZ,It);if(he(pt,Pt),Y&&(z.setupElevationDraw(ft,Y,ke),D.uploadCommonUniforms(H,Y,pt.toUnwrapped()),fe)){const[Er,lr,yr]=fe.getGridBuffers(Ot,Xe!==0);Y.draw(D,dt,_e,Fe,ge,o.af.backCCW,jt,"globe_raster",Er,lr,yr)}}}if(fe&&(D.renderDefaultNorthPole||D.renderDefaultSouthPole)){const be=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ce&&be.push("CUSTOM_ANTIALIASING"),Y=D.getOrCreateProgram("globeRaster",{defines:be});for(const Xe of j){const{x:dt,y:pt,z:ft}=Xe.canonical,Fe=pt===0,Ye=pt===(1<<ft)-1,[lt,Ct,Pt,Lt]=fe.getPoleBuffers(ft,!1);if(Lt&&(Fe||Ye)){const Ot=B.getTile(Xe);H.activeTexture.set(X.TEXTURE0),Ot.texture&&Ot.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);let It=o.bh(ft,dt,ue);const it=o.bf(o.bg(Xe.canonical)),jt=(Er,lr)=>Er.draw(D,X.TRIANGLES,_e,o.ag.disabled,ge,o.af.disabled,Mt(ue.expandedFarZProjMatrix,It,It,it,0,ee,ue.frustumCorners.TL,ue.frustumCorners.TR,ue.frustumCorners.BR,ue.frustumCorners.BL,ue.globeCenterInViewSpace,ue.globeRadius,Pe,0,ue._farZ),"globe_pole_raster",lr,Pt,Lt);z.setupElevationDraw(Ot,Y,ke),D.uploadCommonUniforms(H,Y,Xe.toUnwrapped()),Fe&&D.renderDefaultNorthPole&&jt(Y,lt),Ye&&D.renderDefaultSouthPole&&(It=o.ad.scale(o.ad.create(),It,[1,-1,1]),jt(Y,Ct))}}}})(x,w,S,I,O);else{const D=x.context,z=D.gl;let B,j;const $=x.shadowRenderer,H=Zl(x,x.longestCutoffRange),X=ge=>{if(j===ge)return;const _e=[];_e.push($p[ge]),H.shouldRenderCutoff&&_e.push("RENDER_CUTOFF"),B=x.getOrCreateProgram("terrainRaster",{defines:_e}),j=ge},Y=x.colorModeForRenderPass(),K=new o.ae(z.LEQUAL,o.ae.ReadWrite,x.depthRangeFor3D);pl.update(O);const ue=x.transform,ce=hh(ue.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let he=[0,0,0];if($){const ge=x.style.directionalLight,_e=x.style.ambientLight;ge&&_e&&(he=Bu(x.style,ge,_e))}{j=-1;const ge=z.TRIANGLES,[_e,Se]=[w.gridIndexBuffer,w.gridSegments];for(const ee of I){const fe=S.getTile(ee),Pe=o.ag.disabled,We=w.prevTerrainTileForTile[ee.key],ke=w.terrainTileForTile[ee.key];Nu(We,ke)&&pl.newMorphing(ee.key,We,ke,O,250),D.activeTexture.set(z.TEXTURE0),fe.texture&&fe.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const be=pl.getMorphValuesForProxy(ee.key),Xe=be?1:0;let dt;be&&(dt={morphing:{srcDemTile:be.from,dstDemTile:be.to,phase:o.b9(be.phase)}});const pt=wo(ee.projMatrix,Hg(ee.canonical,ue.renderWorldCopies)?ce/10:ce,he);if(X(Xe),!B)continue;w.setupElevationDraw(fe,B,dt);const ft=ee.toUnwrapped();$&&$.setupShadows(ft,B),x.uploadCommonUniforms(D,B,ft,null,H),B.draw(x,ge,K,Pe,Y,o.af.backCCW,pt,"terrain_raster",w.gridBuffer,_e,Se)}}}}(c,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const c=this.painter,_=this.painter.context,x=this.proxySourceCache,w=this.proxiedCoords[x.id],S=this._drapedRenderBatches.shift(),I=c.style.order,O=[];let D=0;for(const z of w){const B=x.getTileByID(z.proxyTileKey),j=x.proxyCachedFBO[z.key]?x.proxyCachedFBO[z.key][i]:void 0,$=j!==void 0?x.renderCache[j]:this.pool[D++],H=j!==void 0;if(B.texture=$.tex,H&&!$.dirty){O.push(B.tileID);continue}let X;_.bindFramebuffer.set($.fb.framebuffer),this.renderedToTile=!1,$.dirty&&(_.clear({color:o.C.transparent,stencil:0}),$.dirty=!1);for(let Y=S.start;Y<=S.end;++Y){const K=c.style._mergedLayers[I[Y]];if(K.isHidden(c.transform.zoom))continue;const ue=c.style.getLayerSourceCache(K),ce=ue?this.proxyToSource[z.key][ue.id]:[z];if(!ce)continue;const he=ce;_.viewport.set([0,0,$.fb.width,$.fb.height]),X!==(ue?ue.id:null)&&(this._setupStencil($,ce,K,ue),X=ue?ue.id:null),c.renderLayer(c,ue,K,he)}if(this._drapedRenderBatches.length===0)for(const Y of this._pendingGroundEffectLayers){const K=c.style._mergedLayers[I[Y]];if(K.isHidden(c.transform.zoom))continue;const ue=c.style.getLayerSourceCache(K),ce=ue?this.proxyToSource[z.key][ue.id]:[z];if(!ce)continue;const he=ce;_.viewport.set([0,0,$.fb.width,$.fb.height]),X!==(ue?ue.id:null)&&(this._setupStencil($,ce,K,ue),X=ue?ue.id:null),c.renderLayer(c,ue,K,he)}this.renderedToTile?($.dirty=!0,O.push(B.tileID)):H||--D,D===5&&(D=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,c.width,c.height]),S.end+1}postRender(){}isLayerOrderingCorrect(i){const c=i.order.length;let _=-1,x=c;for(let w=0;w<c;++w)this._style.isLayerDraped(i._mergedLayers[i.order[w]])?_=Math.max(_,w):x=Math.min(x,w);return x>_}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{i=Math.min(i,c.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,c,_){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const S=w.tileID,I=1<<S.overscaledZ,{x:O,y:D}=S.canonical,z=O/I,B=(O+1)/I,j=D/I,$=(D+1)/I;return{minx:z,miny:j,maxx:B,maxy:$,t:w.dem.tree.raycastRoot(z,j,B,$,i,c,_),tile:w}});x.sort((w,S)=>(w.t!==null?w.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const w of x){if(w.t==null)return null;const S=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,i,c,_);if(S!=null)return S}return null}_createFBO(){const i=this.painter.context,c=i.gl,_=this.drapeBufferSize;i.activeTexture.set(c.TEXTURE0);const x=new o.T(i,{width:_[0],height:_[1],data:null},c.RGBA);x.bind(c.LINEAR,c.CLAMP_TO_EDGE);const w=i.createFramebuffer(_[0],_[1],!0,null);return w.colorAttachment.set(x.texture),w.depthAttachment=new Ss(i,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:w,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const c=this._style._mergedLayers[i],_=c.isHidden(this.painter.transform.zoom);return c.type==="custom"?!_&&c.shouldRedrape():!_&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const _ of this._style.getSources())if(_ instanceof Ds){i=!0;break}if(!i)return;const c={};for(let _=0;_<this._style.order.length;++_){const x=this._style._mergedLayers[this._style.order[_]],w=this._style.getLayerSourceCache(x);if(w&&!c[w.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof o.Z){c[w.id]=!0;for(const S of this.proxyCoords){const I=this.proxyToSource[S.key][w.id];if(I)for(const O of I)this._clearRenderCacheForTile(w.id,O)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const _ in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[_]._source instanceof la){i=!0;break}if(!i)return;const c={};for(let _=0;_<this._style.order.length;++_){const x=this._style._mergedLayers[this._style.order[_]],w=this._style.getLayerSourceCache(x);if(!w||c[w.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const S=x.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const O=this.proxyToSource[I.key][w.id];if(O)for(const D of O){const z=zf(w.getTile(D),w.findLoadedParent(D,0),w,this.painter.transform,S);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(w.id,D)}}}}_setupDrapedRenderBatches(){const i=this._style.order,c=i.length;if(c===0)return;const _=[];this._pendingGroundEffectLayers=[];let x,w=0,S=this._style._mergedLayers[i[w]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++w<c;)S=this._style._mergedLayers[i[w]];for(;w<c;++w){const I=this._style._mergedLayers[i[w]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?x===void 0&&(x=w):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),x!==void 0&&(_.push({start:x,end:w-1}),x=void 0)))}if(x!==void 0&&_.push({start:x,end:w-1}),_.length!==0){const I=_[_.length-1];this._pendingGroundEffectLayers.every(O=>O>I.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=_}_setupRenderCache(i){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const S=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let I=0;I<S.length;++I){const O=Object.values(S[I]);c.renderCachePool.push(...O)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,x=this._tilesDirty;for(let S=_.length-1;S>=0;S--){const I=_[S];if(c.getTileByID(I.key),c.proxyCachedFBO[I.key]!==void 0){const O=i[I.key],D=this.proxyToSource[I.key];let z=0;for(const B in D){const j=D[B],$=O[B];if(!$||$.length!==j.length||j.some((H,X)=>H!==$[X]||x[B]&&x[B].hasOwnProperty(H.key))){z=-1;break}++z}for(const B in c.proxyCachedFBO[I.key])c.renderCache[c.proxyCachedFBO[I.key][B]].dirty=z<0||z!==Object.values(O).length}}const w=[...this._drapedRenderBatches];w.sort((S,I)=>I.end-I.start-(S.end-S.start));for(const S of w)for(const I of _){if(c.proxyCachedFBO[I.key])continue;let O=c.renderCachePool.pop();O===void 0&&c.renderCache.length<50&&(O=c.renderCache.length,c.renderCache.push(this._createFBO())),O!==void 0&&(c.proxyCachedFBO[I.key]={},c.proxyCachedFBO[I.key][S.start]=O,c.renderCache[O].dirty=!0)}this._tilesDirty={}}_setupStencil(i,c,_,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,S=w.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let I;if(_.isTileClipped())I=c.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):o.ag.disabled}_renderTileClippingMasks(i,c){const _=this.painter,x=this.painter.context,w=x.gl;_._tileClippingMaskIDs={},x.setColorMode(o.a.disabled),x.setDepthMode(o.ae.disabled);const S=_.getOrCreateProgram("clippingMask");for(const I of i){const O=_._tileClippingMaskIDs[I.key]=--c;S.draw(_,w.TRIANGLES,o.ae.disabled,new o.ag({func:w.ALWAYS,mask:0},O,255,w.KEEP,w.KEEP,w.REPLACE),o.a.disabled,o.af.disabled,Lf(I.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(i){const c=this.painter.transform;if(i.x<0||i.x>c.width||i.y<0||i.y>c.height)return null;const _=[i.x,i.y,1,1];o.aA.transformMat4(_,_,c.pixelMatrixInverse),o.aA.scale(_,_,1/_[3]),_[0]/=c.worldSize,_[1]/=c.worldSize;const x=c._camera.position,w=o.ax(1,c.center.lat),S=[x[0],x[1],x[2]/w,0],I=o._.subtract([],_.slice(0,3),S);o._.normalize(I,I);const O=this.raycast(S,I,this._exaggeration);return O!==null&&O?(o._.scaleAndAdd(S,S,I,O),S[3]=S[2],S[2]*=w,S):null}_setupProxiedCoordsForOrtho(i,c,_){if(i.getSource()instanceof o.bm)return this._setupProxiedCoordsForImageSource(i,c,_);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const x=this.proxiedCoords[i.id]=[],w=this.proxyCoords;for(let O=0;O<w.length;O++){const D=w[O],z=this._findTileCoveringTileID(D,i);if(z){const B=this._createProxiedId(D,z,_[D.key]&&_[D.key][i.id]);x.push(B),this.proxyToSource[D.key][i.id]=[B]}}let S=!1;const I=new Set;for(let O=0;O<c.length;O++){const D=i.getTile(c[O]);if(!D||!D.hasData())continue;const z=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==D.tileID.canonical.z){const B=this.proxyToSource[z.tileID.key][i.id],j=this._createProxiedId(z.tileID,D,_[z.tileID.key]&&_[z.tileID.key][i.id]);B?B.splice(B.length-1,0,j):this.proxyToSource[z.tileID.key][i.id]=[j];const $=this.proxyToSource[z.tileID.key][i.id];I.has($)||I.add($),x.push(j),S=!0}}if(this._sourceTilesOverlap[i.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const O of I)O.sort((D,z)=>z.overscaledZ-D.overscaledZ)}_setupProxiedCoordsForImageSource(i,c,_){if(!i.getSource().loaded())return;const x=this.proxiedCoords[i.id]=[],w=this.proxyCoords,S=i.getSource(),I=S.tileID;if(!I)return;const O=new o.P(I.x,I.y)._div(1<<I.z),D=S.coordinates.map(o.Y.fromLngLat).reduce((B,j)=>(B.min.x=Math.min(B.min.x,j.x-O.x),B.min.y=Math.min(B.min.y,j.y-O.y),B.max.x=Math.max(B.max.x,j.x-O.x),B.max.y=Math.max(B.max.y,j.y-O.y),B),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(B,j)=>{const $=B.wrap+B.canonical.x/(1<<B.canonical.z),H=B.canonical.y/(1<<B.canonical.z),X=o.a3/(1<<B.canonical.z),Y=j.wrap+j.canonical.x/(1<<j.canonical.z),K=j.canonical.y/(1<<j.canonical.z);return $+X<Y+D.min.x||$>Y+D.max.x||H+X<K+D.min.y||H>K+D.max.y};for(let B=0;B<w.length;B++){const j=w[B];for(let $=0;$<c.length;$++){const H=i.getTile(c[$]);if(!H||!H.hasData()||z(j,H.tileID))continue;const X=this._createProxiedId(j,H,_[j.key]&&_[j.key][i.id]),Y=this.proxyToSource[j.key][i.id];Y?Y.push(X):this.proxyToSource[j.key][i.id]=[X],x.push(X)}}}_createProxiedId(i,c,_){let x=this.orthoMatrix;if(_){const w=_.find(S=>S.key===c.tileID.key);if(w)return w}if(c.tileID.key!==i.key){const w=i.canonical.z-c.tileID.canonical.z;let S,I,O;x=o.ad.create();const D=c.tileID.wrap-i.wrap<<i.overscaledZ;w>0?(S=o.a3>>w,I=S*((c.tileID.canonical.x<<w)-i.canonical.x+D),O=S*((c.tileID.canonical.y<<w)-i.canonical.y)):(S=o.a3<<-w,I=o.a3*(c.tileID.canonical.x-(i.canonical.x+D<<-w)),O=o.a3*(c.tileID.canonical.y-(i.canonical.y<<-w))),o.ad.ortho(x,0,S,0,S,0,1),o.ad.translate(x,x,[I,O,0])}return new Wp(c.tileID,i.key,x)}_findTileCoveringTileID(i,c){let _=c.getTile(i);if(_&&_.hasData())return _;const x=this._findCoveringTileCache[c.id],w=x[i.key];if(_=w?c.getTileByID(w):null,_&&_.hasData()||w===null)return _;let S=_?_.tileID:i,I=S.overscaledZ;const O=c.getSource().minzoom,D=[];if(!w){const B=c.getSource().maxzoom;if(i.canonical.z>=B){const j=i.canonical.z-B;c.getSource().reparseOverscaled?(I=Math.max(i.canonical.z+2,c.transform.tileZoom),S=new o.aL(I,i.wrap,B,i.canonical.x>>j,i.canonical.y>>j)):j!==0&&(I=B,S=new o.aL(I,i.wrap,B,i.canonical.x>>j,i.canonical.y>>j))}S.key!==i.key&&(D.push(S.key),_=c.getTile(S))}const z=B=>{D.forEach(j=>{x[j]=B}),D.length=0};for(I-=1;I>=O&&(!_||!_.hasData());I--){_&&z(_.tileID.key);const B=S.calculateScaledKey(I);if(_=c.getTileByID(B),_&&_.hasData())break;const j=x[B];if(j===null)break;j===void 0?D.push(B):_=c.getTileByID(j)}return z(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,c){let _=this._tilesDirty[i];_||(_=this._tilesDirty[i]={}),_[c.key]=!0}}function Xg(p,i,c){const _=function(I,O,D){const z=o._.dot(O,I),B=o._.dot(D,[.2126,.7152,.0722]),j=(H,X,Y)=>(1-Y)*H+Y*X,$=j(1-.3*Math.min(B,1),1,Math.min(z+1,1));return j(.92,1,Math.asin(o.at(O[2],-1,1))/Math.PI+.5)*$}(p,[0,0,1],i),x=[0,0,0];o._.scale(x,c.slice(0,3),_);const w=[0,0,0];o._.scale(w,i.slice(0,3),p[2]);const S=[0,0,0];return o._.add(S,x,w),o.b8(S)}const Ba=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Bf=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Hp{static cacheKey(i,c,_,x){let w=`${c}${x?x.cacheKey:""}`;for(const S of _)i.usedDefines.includes(S)&&(w+=`/${S}`);return w}constructor(i,c,_,x,w,S){const I=i.gl;this.program=I.createProgram(),this.configuration=x,this.name=c,this.fixedDefines=[...S];const O=x?x.getBinderAttributes():[],D=(_.staticAttributes||[]).concat(O);let z=x?x.defines():[];z=z.concat(S.map(Y=>`#define ${Y}`));const B=`#version 300 es
`;let j=B+z.concat("precision mediump float;",Nt,Et.fragmentSource).join(`
`);for(const Y of _.fragmentIncludes)j+=`
${fl[Y]}`;j+=`
${_.fragmentSource}`;let $=B+z.concat("precision highp float;",Nt,Et.vertexSource).join(`
`);for(const Y of _.vertexIncludes)$+=`
${fl[Y]}`;$+=`
${_.vertexSource}`;const H=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(H,j),I.compileShader(H),I.attachShader(this.program,H);const X=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(X,$),I.compileShader(X),I.attachShader(this.program,X),this.attributes={},this.numAttributes=D.length;for(let Y=0;Y<this.numAttributes;Y++)if(D[Y]){const K=D[Y].startsWith("a_")?D[Y]:`a_${D[Y]}`;I.bindAttribLocation(this.program,Y,K),this.attributes[K]=Y}I.linkProgram(this.program),I.deleteShader(X),I.deleteShader(H),this.fixedUniforms=w(i),this.binderUniforms=x?x.getUniforms(i):[],S.includes("TERRAIN")&&(this.terrainUniforms=(Y=>({u_dem:new o.a7(Y),u_dem_prev:new o.a7(Y),u_dem_tl:new o.a8(Y),u_dem_scale:new o.aa(Y),u_dem_tl_prev:new o.a8(Y),u_dem_scale_prev:new o.aa(Y),u_dem_size:new o.aa(Y),u_dem_lerp:new o.aa(Y),u_exaggeration:new o.aa(Y),u_depth:new o.a7(Y),u_depth_size_inv:new o.a8(Y),u_depth_range_unpack:new o.a8(Y),u_meter_to_dem:new o.aa(Y),u_label_plane_matrix_inv:new o.a6(Y)}))(i)),S.includes("GLOBE")&&(this.globeUniforms=(Y=>({u_tile_tl_up:new o.aq(Y),u_tile_tr_up:new o.aq(Y),u_tile_br_up:new o.aq(Y),u_tile_bl_up:new o.aq(Y),u_tile_up_scale:new o.aa(Y)}))(i)),S.includes("FOG")&&(this.fogUniforms=(Y=>({u_fog_matrix:new o.a6(Y),u_fog_range:new o.a8(Y),u_fog_color:new o.as(Y),u_fog_horizon_blend:new o.aa(Y),u_fog_vertical_limit:new o.a8(Y),u_fog_temporal_offset:new o.aa(Y),u_frustum_tl:new o.aq(Y),u_frustum_tr:new o.aq(Y),u_frustum_br:new o.aq(Y),u_frustum_bl:new o.aq(Y),u_globe_pos:new o.aq(Y),u_globe_radius:new o.aa(Y),u_globe_transition:new o.aa(Y),u_is_globe:new o.a7(Y),u_viewport:new o.a8(Y)}))(i)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Y=>({u_cutoff_params:new o.as(Y)}))(i)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Y=>({u_lighting_ambient_color:new o.aq(Y),u_lighting_directional_dir:new o.aq(Y),u_lighting_directional_color:new o.aq(Y),u_ground_radiance:new o.aq(Y)}))(i)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Y=>({u_light_matrix_0:new o.a6(Y),u_light_matrix_1:new o.a6(Y),u_fade_range:new o.a8(Y),u_shadow_normal_offset:new o.aq(Y),u_shadow_intensity:new o.aa(Y),u_shadow_texel_size:new o.aa(Y),u_shadow_map_resolution:new o.aa(Y),u_shadow_direction:new o.aq(Y),u_shadow_bias:new o.aq(Y),u_shadowmap_0:new o.a7(Y),u_shadowmap_1:new o.a7(Y)}))(i))}}setTerrainUniformValues(i,c){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in c)_[x]&&_[x].set(this.program,x,c[x])}}setGlobeUniformValues(i,c){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in c)_[x]&&_[x].set(this.program,x,c[x])}}setFogUniformValues(i,c){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in c)_[x].set(this.program,x,c[x])}}setCutoffUniformValues(i,c){if(!this.cutoffUniforms)return;const _=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in c)_[x].set(this.program,x,c[x])}}setLightsUniformValues(i,c){if(!this.lightsUniforms)return;const _=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in c)_[x].set(this.program,x,c[x])}}setShadowUniformValues(i,c){if(this.failedToCreate||!this.shadowUniforms)return;const _=this.shadowUniforms;i.program.set(this.program);for(const x in c)_[x].set(this.program,x,c[x])}_drawDebugWireframe(i,c,_,x,w,S,I,O,D,z){const B=i.options.wireframe;if(B.terrain===!1&&B.layers2D===!1&&B.layers3D===!1)return;const j=i.context;if(!(!(!B.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!B.layers2D||i._terrain&&i._terrain.renderingToTexture||!Ba.includes(this.name))||!(!B.layers3D||!Bf.includes(this.name))))return;const $=j.gl,H=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,w,j);if(!H)return;const X=[...this.fixedDefines];X.push("DEBUG_WIREFRAME");const Y=i.getOrCreateProgram(this.name,{config:this.configuration,defines:X});j.program.set(Y.program);const K=(he,ge,_e)=>{if(ge[he]&&_e[he])for(const Se in ge[he])_e[he][Se]&&_e[he][Se].set(_e.program,Se,ge[he][Se].current)};D&&D.setUniforms(Y.program,j,Y.binderUniforms,I,{zoom:O}),K("fixedUniforms",this,Y),K("terrainUniforms",this,Y),K("globeUniforms",this,Y),K("fogUniforms",this,Y),K("lightsUniforms",this,Y),K("shadowUniforms",this,Y),H.bind(),j.setColorMode(new o.a([$.ONE,$.ONE_MINUS_SRC_ALPHA,$.ZERO,$.ONE],o.C.transparent,[!0,!0,!0,!1])),j.setDepthMode(new o.ae(c.func===$.LESS?$.LEQUAL:c.func,o.ae.ReadOnly,c.range)),j.setStencilMode(o.ag.disabled);const ue=3*S.primitiveLength*2,ce=3*S.primitiveOffset*2*2;z&&z>1?$.drawElementsInstanced($.LINES,ue,$.UNSIGNED_SHORT,ce,z):$.drawElements($.LINES,ue,$.UNSIGNED_SHORT,ce),w.bind(),j.program.set(this.program),j.setDepthMode(c),j.setStencilMode(_),j.setColorMode(x)}draw(i,c,_,x,w,S,I,O,D,z,B,j,$,H,X,Y){const K=i.context,ue=K.gl;if(this.failedToCreate)return;K.program.set(this.program),K.setDepthMode(_),K.setStencilMode(x),K.setColorMode(w),K.setCullFace(S);for(const ge of Object.keys(this.fixedUniforms))this.fixedUniforms[ge].set(this.program,ge,I[ge]);H&&H.setUniforms(this.program,K,this.binderUniforms,j,{zoom:$});const ce={[ue.POINTS]:1,[ue.LINES]:2,[ue.TRIANGLES]:3,[ue.LINE_STRIP]:1}[c],he=Y&&Y>0?1:void 0;for(const ge of B.get()){const _e=ge.vaos||(ge.vaos={});(_e[O]||(_e[O]=new Qn)).bind(K,this,D,H?H.getPaintVertexBuffers():[],z,ge.vertexOffset,X||[],he),Y&&Y>1?ue.drawElementsInstanced(c,ge.primitiveLength*ce,ue.UNSIGNED_SHORT,ge.primitiveOffset*ce*2,Y):z?ue.drawElements(c,ge.primitiveLength*ce,ue.UNSIGNED_SHORT,ge.primitiveOffset*ce*2):ue.drawArrays(c,ge.vertexOffset,ge.vertexLength),c===ue.TRIANGLES&&z&&this._drawDebugWireframe(i,_,x,w,z,ge,j,$,H,Y)}}}function fh(p,i){const c=Math.pow(2,i.tileID.overscaledZ),_=i.tileSize*Math.pow(2,p.transform.tileZoom)/c,x=_*(i.tileID.canonical.x+i.tileID.wrap*c),w=_*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.bB(i,1,p.transform.tileZoom),u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const Zp=o.ad.create(),dh=(p,i,c,_,x,w,S,I,O,D,z,B,j,$,H,X)=>{const Y=i.style.light,K=Y.properties.get("position"),ue=[K.x,K.y,K.z],ce=o.bC.create();Y.properties.get("anchor")==="viewport"&&(o.bC.fromRotation(ce,-i.transform.angle),o._.transformMat3(ue,ue,ce));const he=Y.properties.get("color"),ge=i.transform,_e={u_matrix:p,u_lightpos:ue,u_lightintensity:Y.properties.get("intensity"),u_lightcolor:[he.r,he.g,he.b],u_vertical_gradient:+c,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Zp,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:w,u_flood_light_color:B,u_vertical_scale:j,u_flood_light_intensity:$,u_ground_shadow_factor:H,u_emissive_strength:X};return ge.projection.name==="globe"&&(_e.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],_e.u_zoom_transition=O,_e.u_inv_rot_matrix=z,_e.u_merc_center=D,_e.u_up_dir=ge.projection.upVector(new o.aO(0,0,0),D[0]*o.a3,D[1]*o.a3),_e.u_height_lift=I),_e},ph=(p,i,c)=>({u_matrix:p,u_edge_radius:i,u_vertical_scale:c}),ju=(p,i,c,_,x,w,S,I,O,D,z,B,j,$)=>{const H=dh(p,i,c,_,x,w,S,O,D,z,B,j,$,1,[0,0,0],0),X={u_height_factor:-Math.pow(2,S.overscaledZ)/I.tileSize/8};return o.W(H,fh(i,I),X)},Nf=(p,i)=>({u_matrix:p,u_emissive_strength:i}),Xp=(p,i,c,_)=>o.W(Nf(p,i),fh(c,_)),Yg=(p,i,c)=>({u_matrix:p,u_world:c,u_emissive_strength:i}),Kg=(p,i,c,_,x)=>o.W(Xp(p,i,c,_),{u_world:x}),Uf=(p,i,c,_)=>{const x=o.a3/c.tileSize;return{u_matrix:p,u_camera_to_center_distance:i.getCameraToCenterDistance(_),u_extrude_scale:[i.pixelsToGLUnits[0]/x,i.pixelsToGLUnits[1]/x]}},jf=(p,i,c=1)=>({u_matrix:p,u_color:i.toRenderColor(null),u_overlay:0,u_overlay_scale:c}),Yp=o.ad.create(),mh=(p,i,c,_,x,w,S)=>{const I=p.transform,O=I.projection.name==="globe",D=O?o.bD(I.zoom,i.canonical)*I._pixelsPerMercatorPixel:o.bB(c,1,w),z={u_matrix:i.projMatrix,u_extrude_scale:D,u_intensity:S,u_inv_rot_matrix:Yp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){z.u_inv_rot_matrix=_,z.u_merc_center=x,z.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],z.u_zoom_transition=o.a1(I.zoom);const B=x[0]*o.a3,j=x[1]*o.a3;z.u_up_dir=I.projection.upVector(new o.aO(0,0,0),B,j)}return z};function ml(p,[i,c,_,x],[w,S]){if(w===S)return[0,0,0,0];const I=255*(p-1)/(p*(S-w));return[i*I,c*I,_*I,x*I]}function Qg(p,i,[c,_]){return c===_?0:.5/p+(i-c)*(p-1)/(p*(_-c))}const Kp=(p,i,c,_,x,w,S,I,O,D,z,B,j,$,H,X,Y,K,ue,ce,he)=>({u_matrix:p,u_normalize_matrix:i,u_globe_matrix:c,u_merc_matrix:_,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:D,u_fade_t:z.mix,u_opacity:z.opacity*B.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:B.paint.get("raster-brightness-min"),u_brightness_high:B.paint.get("raster-brightness-max"),u_saturation_factor:o.bE(B.paint.get("raster-saturation")),u_contrast_factor:o.bF(B.paint.get("raster-contrast")),u_spin_weights:Vf(B.paint.get("raster-hue-rotate")),u_perspective_transform:j,u_raster_elevation:$,u_zoom_transition:S,u_merc_center:I,u_cutoff_params:O,u_colorization_mix:ml(o.bG,X,K),u_colorization_offset:Qg(o.bG,Y,K),u_color_ramp:H,u_texture_offset:[ce/(ue+2*ce),ue/(ue+2*ce)],u_texture_res:[ue+2*ce,ue+2*ce],u_emissive_strength:he});function Vf(p){p*=Math.PI/180;const i=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*i-c+1)/3,(Math.sqrt(3)*i-c+1)/3]}const ua=.05,Qp=(p,i,c,_,x,w,S,I,O,D,z,B)=>({u_matrix:p,u_normalize_matrix:i,u_globe_matrix:c,u_merc_matrix:_,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:D,u_fade_t:z.mix,u_opacity:z.opacity,u_image0:0,u_image1:1,u_raster_elevation:B,u_zoom_transition:S,u_merc_center:I,u_cutoff_params:O}),Jp=(p,i,c,_,x,w,S,I,O,D)=>({u_particle_texture:p,u_particle_texture_side_len:i,u_tile_offset:c,u_velocity:_,u_color_ramp:w,u_velocity_res:x,u_max_speed:S,u_uv_offset:I,u_data_scale:[255*O[0],255*O[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[ua,ua]}),em=(p,i,c,_,x,w,S,I,O,D)=>({u_particle_texture:p,u_particle_texture_side_len:i,u_velocity:c,u_velocity_res:_,u_max_speed:x,u_speed_factor:w,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*O[0],255*O[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[ua,ua]}),Jg=o.ad.create(),ks=(p,i,c,_,x,w,S,I,O,D,z,B,j,$,H,X,Y,K)=>{const ue=x.transform,ce={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:ue.getCameraToCenterDistance(X),u_rotate_symbol:+c,u_aspect_ratio:ue.width/ue.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:S,u_coord_matrix:I,u_is_text:+O,u_pitch_with_map:+_,u_texsize:D,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Jg,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Jg,u_up_vector:[0,-1,0],u_color_adj_mat:Y,u_icon_transition:K||0};return X.name==="globe"&&(ce.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],ce.u_zoom_transition=B,ce.u_inv_rot_matrix=$,ce.u_merc_center=j,ce.u_camera_forward=ue._camera.forward(),ce.u_ecef_origin=o.bH(ue.globeMatrix,z.toUnwrapped()),ce.u_tile_matrix=Float32Array.from(ue.globeMatrix),ce.u_up_vector=H),ce},Kl=(p,i,c,_,x,w,S,I,O,D,z,B,j,$,H,X,Y)=>o.W(ks(p,i,c,_,x,w,S,I,O,D,B,j,$,H,X,Y),{u_gamma_scale:_?x.transform.getCameraToCenterDistance(Y)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:o.e.devicePixelRatio,u_is_halo:+z,undefined:void 0}),ey=(p,i,c,_,x,w,S,I,O,D,z,B,j,$,H,X)=>o.W(Kl(p,i,c,_,x,w,S,I,!0,O,!0,z,B,j,$,H,X),{u_texsize_icon:D,u_texture_icon:1}),ty=(p,i,c,_)=>({u_matrix:p,u_emissive_strength:i,u_opacity:c,u_color:_}),_h=(p,i,c,_,x,w,S,I)=>o.W(function(O,D,z,B,j){const{width:$,height:H}=B.imageManager.getPixelSize(D),X=Math.pow(2,j.tileID.overscaledZ),Y=j.tileSize*Math.pow(2,B.transform.tileZoom)/X,K=Y*(j.tileID.canonical.x+j.tileID.wrap*X),ue=Y*j.tileID.canonical.y;return{u_image:0,u_pattern_tl:z.tl,u_pattern_br:z.br,u_texsize:[$,H],u_pattern_size:z.displaySize,u_tile_units_to_pixels:1/o.bB(j,1,B.transform.tileZoom),u_pixel_coord_upper:[K>>16,ue>>16],u_pixel_coord_lower:[65535&K,65535&ue]}}(0,w,S,_,I),{u_matrix:p,u_emissive_strength:i,u_opacity:c}),$f=new Float32Array(o.ad.identity([])),tm=(p,i,c,_,x,w,S,I,O,D,z,B,j,$=[0,0,0],H)=>{const X=x.style.light,Y=X.properties.get("position"),K=[-Y.x,-Y.y,Y.z],ue=o.bC.create();X.properties.get("anchor")==="viewport"&&(o.bC.fromRotation(ue,-x.transform.angle),o._.transformMat3(K,K,ue));const ce=z.alphaMode==="MASK",he=X.properties.get("color").toRenderColor(null),ge=j.paint.get("model-ambient-occlusion-intensity"),_e=j.paint.get("model-color").constantOr(o.C.white).toRenderColor(null),Se=j.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:p,u_lighting_matrix:i,u_normal_matrix:c,u_node_matrix:_||$f,u_lightpos:K,u_lightintensity:X.properties.get("intensity"),u_lightcolor:[he.r,he.g,he.b],u_camera_pos:$,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+ce,u_alphaCutoff:z.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[I[0],I[1],I[2],1],u_metallicFactor:O,u_roughnessFactor:D,u_baseColorTexture:Wn.BaseColor,u_metallicRoughnessTexture:Wn.MetallicRoughness,u_normalTexture:Wn.Normal,u_occlusionTexture:Wn.Occlusion,u_emissionTexture:Wn.Emission,u_lutTexture:Wn.LUT,u_color_mix:[_e.r,_e.g,_e.b,Se],u_aoIntensity:ge,u_emissive_strength:B,u_occlusionTextureTransform:H||[0,0,0,0]}},Gf=(p,i=$f,c=$f)=>({u_matrix:p,u_instance:i,u_node_matrix:c}),u1=(p,i,c,_,x)=>({u_matrix:Float32Array.from(p),u_anchorPos:i,u_screenSizePx:c,u_occluderSizePx:_,u_color:x}),ry={fillExtrusion:p=>({u_matrix:new o.a6(p),u_lightpos:new o.aq(p),u_lightintensity:new o.aa(p),u_lightcolor:new o.aq(p),u_vertical_gradient:new o.aa(p),u_opacity:new o.aa(p),u_edge_radius:new o.aa(p),u_ao:new o.a8(p),u_tile_id:new o.aq(p),u_zoom_transition:new o.aa(p),u_inv_rot_matrix:new o.a6(p),u_merc_center:new o.a8(p),u_up_dir:new o.aq(p),u_height_lift:new o.aa(p),u_flood_light_color:new o.aq(p),u_vertical_scale:new o.aa(p),u_flood_light_intensity:new o.aa(p),u_ground_shadow_factor:new o.aq(p),u_emissive_strength:new o.aa(p)}),fillExtrusionDepth:p=>({u_matrix:new o.a6(p),u_edge_radius:new o.aa(p),u_vertical_scale:new o.aa(p)}),fillExtrusionPattern:p=>({u_matrix:new o.a6(p),u_lightpos:new o.aq(p),u_lightintensity:new o.aa(p),u_lightcolor:new o.aq(p),u_vertical_gradient:new o.aa(p),u_height_factor:new o.aa(p),u_edge_radius:new o.aa(p),u_ao:new o.a8(p),u_tile_id:new o.aq(p),u_zoom_transition:new o.aa(p),u_inv_rot_matrix:new o.a6(p),u_merc_center:new o.a8(p),u_up_dir:new o.aq(p),u_height_lift:new o.aa(p),u_image:new o.a7(p),u_texsize:new o.a8(p),u_pixel_coord_upper:new o.a8(p),u_pixel_coord_lower:new o.a8(p),u_tile_units_to_pixels:new o.aa(p),u_opacity:new o.aa(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new o.a6(p),u_opacity:new o.aa(p),u_ao_pass:new o.aa(p),u_meter_to_tile:new o.aa(p),u_ao:new o.a8(p),u_flood_light_intensity:new o.aa(p),u_flood_light_color:new o.aq(p),u_attenuation:new o.aa(p),u_edge_radius:new o.aa(p),u_fb:new o.a7(p),u_fb_size:new o.aa(p)}),fill:p=>({u_matrix:new o.a6(p),u_emissive_strength:new o.aa(p)}),fillPattern:p=>({u_matrix:new o.a6(p),u_emissive_strength:new o.aa(p),u_image:new o.a7(p),u_texsize:new o.a8(p),u_pixel_coord_upper:new o.a8(p),u_pixel_coord_lower:new o.a8(p),u_tile_units_to_pixels:new o.aa(p)}),fillOutline:p=>({u_matrix:new o.a6(p),u_emissive_strength:new o.aa(p),u_world:new o.a8(p)}),fillOutlinePattern:p=>({u_matrix:new o.a6(p),u_emissive_strength:new o.aa(p),u_world:new o.a8(p),u_image:new o.a7(p),u_texsize:new o.a8(p),u_pixel_coord_upper:new o.a8(p),u_pixel_coord_lower:new o.a8(p),u_tile_units_to_pixels:new o.aa(p)}),circle:o.bI,collisionBox:p=>({u_matrix:new o.a6(p),u_camera_to_center_distance:new o.aa(p),u_extrude_scale:new o.a8(p)}),collisionCircle:p=>({u_matrix:new o.a6(p),u_inv_matrix:new o.a6(p),u_camera_to_center_distance:new o.aa(p),u_viewport_size:new o.a8(p)}),debug:p=>({u_color:new o.a9(p),u_matrix:new o.a6(p),u_overlay:new o.a7(p),u_overlay_scale:new o.aa(p)}),clippingMask:p=>({u_matrix:new o.a6(p)}),heatmap:p=>({u_extrude_scale:new o.aa(p),u_intensity:new o.aa(p),u_matrix:new o.a6(p),u_inv_rot_matrix:new o.a6(p),u_merc_center:new o.a8(p),u_tile_id:new o.aq(p),u_zoom_transition:new o.aa(p),u_up_dir:new o.aq(p)}),heatmapTexture:p=>({u_image:new o.a7(p),u_color_ramp:new o.a7(p),u_opacity:new o.aa(p)}),hillshade:p=>({u_matrix:new o.a6(p),u_image:new o.a7(p),u_latrange:new o.a8(p),u_light:new o.a8(p),u_shadow:new o.a9(p),u_highlight:new o.a9(p),u_emissive_strength:new o.aa(p),u_accent:new o.a9(p)}),hillshadePrepare:p=>({u_matrix:new o.a6(p),u_image:new o.a7(p),u_dimension:new o.a8(p),u_zoom:new o.aa(p)}),line:o.bJ,linePattern:o.bK,raster:p=>({u_matrix:new o.a6(p),u_normalize_matrix:new o.a6(p),u_globe_matrix:new o.a6(p),u_merc_matrix:new o.a6(p),u_grid_matrix:new o.ar(p),u_tl_parent:new o.a8(p),u_scale_parent:new o.aa(p),u_fade_t:new o.aa(p),u_opacity:new o.aa(p),u_image0:new o.a7(p),u_image1:new o.a7(p),u_brightness_low:new o.aa(p),u_brightness_high:new o.aa(p),u_saturation_factor:new o.aa(p),u_contrast_factor:new o.aa(p),u_spin_weights:new o.aq(p),u_perspective_transform:new o.a8(p),u_raster_elevation:new o.aa(p),u_zoom_transition:new o.aa(p),u_merc_center:new o.a8(p),u_cutoff_params:new o.as(p),u_colorization_mix:new o.as(p),u_colorization_offset:new o.aa(p),u_color_ramp:new o.a7(p),u_texture_offset:new o.a8(p),u_texture_res:new o.a8(p),u_emissive_strength:new o.aa(p)}),rasterParticle:p=>({u_matrix:new o.a6(p),u_normalize_matrix:new o.a6(p),u_globe_matrix:new o.a6(p),u_merc_matrix:new o.a6(p),u_grid_matrix:new o.ar(p),u_tl_parent:new o.a8(p),u_scale_parent:new o.aa(p),u_fade_t:new o.aa(p),u_opacity:new o.aa(p),u_image0:new o.a7(p),u_image1:new o.a7(p),u_raster_elevation:new o.aa(p),u_zoom_transition:new o.aa(p),u_merc_center:new o.a8(p),u_cutoff_params:new o.as(p)}),rasterParticleTexture:p=>({u_texture:new o.a7(p),u_opacity:new o.aa(p)}),rasterParticleDraw:p=>({u_particle_texture:new o.a7(p),u_particle_texture_side_len:new o.aa(p),u_tile_offset:new o.a8(p),u_velocity:new o.a7(p),u_color_ramp:new o.a7(p),u_velocity_res:new o.a8(p),u_max_speed:new o.aa(p),u_uv_offset:new o.a8(p),u_data_scale:new o.a8(p),u_data_offset:new o.aa(p),u_particle_pos_scale:new o.aa(p),u_particle_pos_offset:new o.a8(p)}),rasterParticleUpdate:p=>({u_particle_texture:new o.a7(p),u_particle_texture_side_len:new o.aa(p),u_velocity:new o.a7(p),u_velocity_res:new o.a8(p),u_max_speed:new o.aa(p),u_speed_factor:new o.aa(p),u_reset_rate:new o.aa(p),u_rand_seed:new o.aa(p),u_uv_offset:new o.a8(p),u_data_scale:new o.a8(p),u_data_offset:new o.aa(p),u_particle_pos_scale:new o.aa(p),u_particle_pos_offset:new o.a8(p)}),symbolIcon:p=>({u_is_size_zoom_constant:new o.a7(p),u_is_size_feature_constant:new o.a7(p),u_size_t:new o.aa(p),u_size:new o.aa(p),u_camera_to_center_distance:new o.aa(p),u_rotate_symbol:new o.a7(p),u_aspect_ratio:new o.aa(p),u_fade_change:new o.aa(p),u_matrix:new o.a6(p),u_label_plane_matrix:new o.a6(p),u_coord_matrix:new o.a6(p),u_is_text:new o.a7(p),u_pitch_with_map:new o.a7(p),u_texsize:new o.a8(p),u_tile_id:new o.aq(p),u_zoom_transition:new o.aa(p),u_inv_rot_matrix:new o.a6(p),u_merc_center:new o.a8(p),u_camera_forward:new o.aq(p),u_tile_matrix:new o.a6(p),u_up_vector:new o.aq(p),u_ecef_origin:new o.aq(p),u_texture:new o.a7(p),u_icon_transition:new o.aa(p),u_color_adj_mat:new o.a6(p)}),symbolSDF:p=>({u_is_size_zoom_constant:new o.a7(p),u_is_size_feature_constant:new o.a7(p),u_size_t:new o.aa(p),u_size:new o.aa(p),u_camera_to_center_distance:new o.aa(p),u_rotate_symbol:new o.a7(p),u_aspect_ratio:new o.aa(p),u_fade_change:new o.aa(p),u_matrix:new o.a6(p),u_label_plane_matrix:new o.a6(p),u_coord_matrix:new o.a6(p),u_is_text:new o.a7(p),u_pitch_with_map:new o.a7(p),u_texsize:new o.a8(p),u_texture:new o.a7(p),u_gamma_scale:new o.aa(p),u_device_pixel_ratio:new o.aa(p),u_tile_id:new o.aq(p),u_zoom_transition:new o.aa(p),u_inv_rot_matrix:new o.a6(p),u_merc_center:new o.a8(p),u_camera_forward:new o.aq(p),u_tile_matrix:new o.a6(p),u_up_vector:new o.aq(p),u_ecef_origin:new o.aq(p),u_is_halo:new o.a7(p)}),symbolTextAndIcon:p=>({u_is_size_zoom_constant:new o.a7(p),u_is_size_feature_constant:new o.a7(p),u_size_t:new o.aa(p),u_size:new o.aa(p),u_camera_to_center_distance:new o.aa(p),u_rotate_symbol:new o.a7(p),u_aspect_ratio:new o.aa(p),u_fade_change:new o.aa(p),u_matrix:new o.a6(p),u_label_plane_matrix:new o.a6(p),u_coord_matrix:new o.a6(p),u_is_text:new o.a7(p),u_pitch_with_map:new o.a7(p),u_texsize:new o.a8(p),u_texsize_icon:new o.a8(p),u_texture:new o.a7(p),u_texture_icon:new o.a7(p),u_gamma_scale:new o.aa(p),u_device_pixel_ratio:new o.aa(p),u_is_halo:new o.a7(p)}),background:p=>({u_matrix:new o.a6(p),u_emissive_strength:new o.aa(p),u_opacity:new o.aa(p),u_color:new o.a9(p)}),backgroundPattern:p=>({u_matrix:new o.a6(p),u_emissive_strength:new o.aa(p),u_opacity:new o.aa(p),u_image:new o.a7(p),u_pattern_tl:new o.a8(p),u_pattern_br:new o.a8(p),u_texsize:new o.a8(p),u_pattern_size:new o.a8(p),u_pixel_coord_upper:new o.a8(p),u_pixel_coord_lower:new o.a8(p),u_tile_units_to_pixels:new o.aa(p)}),terrainRaster:p=>({u_matrix:new o.a6(p),u_image0:new o.a7(p),u_skirt_height:new o.aa(p),u_ground_shadow_factor:new o.aq(p)}),skybox:p=>({u_matrix:new o.a6(p),u_sun_direction:new o.aq(p),u_cubemap:new o.a7(p),u_opacity:new o.aa(p),u_temporal_offset:new o.aa(p)}),skyboxGradient:p=>({u_matrix:new o.a6(p),u_color_ramp:new o.a7(p),u_center_direction:new o.aq(p),u_radius:new o.aa(p),u_opacity:new o.aa(p),u_temporal_offset:new o.aa(p)}),skyboxCapture:p=>({u_matrix_3f:new o.ar(p),u_sun_direction:new o.aq(p),u_sun_intensity:new o.aa(p),u_color_tint_r:new o.as(p),u_color_tint_m:new o.as(p),u_luminance:new o.aa(p)}),globeRaster:p=>({u_proj_matrix:new o.a6(p),u_globe_matrix:new o.a6(p),u_normalize_matrix:new o.a6(p),u_merc_matrix:new o.a6(p),u_zoom_transition:new o.aa(p),u_merc_center:new o.a8(p),u_image0:new o.a7(p),u_grid_matrix:new o.ar(p),u_skirt_height:new o.aa(p),u_far_z_cutoff:new o.aa(p),u_frustum_tl:new o.aq(p),u_frustum_tr:new o.aq(p),u_frustum_br:new o.aq(p),u_frustum_bl:new o.aq(p),u_globe_pos:new o.aq(p),u_globe_radius:new o.aa(p),u_viewport:new o.a8(p)}),globeAtmosphere:p=>({u_frustum_tl:new o.aq(p),u_frustum_tr:new o.aq(p),u_frustum_br:new o.aq(p),u_frustum_bl:new o.aq(p),u_horizon:new o.aa(p),u_transition:new o.aa(p),u_fadeout_range:new o.aa(p),u_color:new o.as(p),u_high_color:new o.as(p),u_space_color:new o.as(p),u_temporal_offset:new o.aa(p),u_horizon_angle:new o.aa(p)}),model:p=>({u_matrix:new o.a6(p),u_lighting_matrix:new o.a6(p),u_normal_matrix:new o.a6(p),u_node_matrix:new o.a6(p),u_lightpos:new o.aq(p),u_lightintensity:new o.aa(p),u_lightcolor:new o.aq(p),u_camera_pos:new o.aq(p),u_opacity:new o.aa(p),u_baseColorFactor:new o.as(p),u_emissiveFactor:new o.as(p),u_metallicFactor:new o.aa(p),u_roughnessFactor:new o.aa(p),u_baseTextureIsAlpha:new o.a7(p),u_alphaMask:new o.a7(p),u_alphaCutoff:new o.aa(p),u_baseColorTexture:new o.a7(p),u_metallicRoughnessTexture:new o.a7(p),u_normalTexture:new o.a7(p),u_occlusionTexture:new o.a7(p),u_emissionTexture:new o.a7(p),u_lutTexture:new o.a7(p),u_color_mix:new o.as(p),u_aoIntensity:new o.aa(p),u_emissive_strength:new o.aa(p),u_occlusionTextureTransform:new o.as(p)}),modelDepth:p=>({u_matrix:new o.a6(p),u_instance:new o.a6(p),u_node_matrix:new o.a6(p)}),groundShadow:p=>({u_matrix:new o.a6(p),u_ground_shadow_factor:new o.aq(p)}),stars:p=>({u_matrix:new o.a6(p),u_up:new o.aq(p),u_right:new o.aq(p),u_intensity_multiplier:new o.aa(p)}),occlusion:p=>({u_matrix:new o.a6(p),u_anchorPos:new o.aq(p),u_screenSizePx:new o.a8(p),u_occluderSizePx:new o.a8(p),u_color:new o.as(p)})};function rm(p,i,c){const _=i.createTileMatrix(p,p.worldSize,c.toUnwrapped());return o.ad.multiply(new Float32Array(16),p.projMatrix,_)}function ny(p,i,c){if(i.projection.name===c.projection.name)return p.projMatrix;const _=c.clone();return _.setProjection(i.projection),rm(_,i.getProjection(),p)}function Wf(p,i,c){return i.name===c.projection.name?p.projMatrix:rm(c,i,p)}let Vu;function iy(p,i,c,_,x,w,S){const I=p.context,O=I.gl,D=p.transform,z=p.getOrCreateProgram("collisionBox"),B=[];let j=0,$=0;for(let he=0;he<_.length;he++){const ge=_[he],_e=i.getTile(ge),Se=_e.getBucket(c);if(!Se)continue;const ee=ny(ge,Se,D);let fe=ee;x[0]===0&&x[1]===0||(fe=p.translatePosMatrix(ee,_e,x,w));const Pe=S?Se.textCollisionBox:Se.iconCollisionBox,We=Se.collisionCircleArray;if(We.length>0){const ke=o.ad.create(),be=fe;o.ad.mul(ke,Se.placementInvProjMatrix,D.glCoordMatrix),o.ad.mul(ke,ke,Se.placementViewportMatrix),B.push({circleArray:We,circleOffset:$,transform:be,invTransform:ke,projection:Se.getProjection()}),j+=We.length/4,$=j}Pe&&(p.terrain&&p.terrain.setupElevationDraw(_e,z),z.draw(p,O.LINES,o.ae.disabled,o.ag.disabled,p.colorModeForRenderPass(),o.af.disabled,Uf(fe,D,_e,Se.getProjection()),c.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,null,D.zoom,null,[Pe.collisionVertexBuffer,Pe.collisionVertexBufferExt]))}if(!S||!B.length)return;const H=p.getOrCreateProgram("collisionCircle"),X=new o.bL;X.resize(4*j),X._trim();let Y=0;for(const he of B)for(let ge=0;ge<he.circleArray.length/4;ge++){const _e=4*ge,Se=he.circleArray[_e+0],ee=he.circleArray[_e+1],fe=he.circleArray[_e+2],Pe=he.circleArray[_e+3];X.emplace(Y++,Se,ee,fe,Pe,0),X.emplace(Y++,Se,ee,fe,Pe,1),X.emplace(Y++,Se,ee,fe,Pe,2),X.emplace(Y++,Se,ee,fe,Pe,3)}(!Vu||Vu.length<2*j)&&(Vu=function(he){const ge=2*he,_e=new o.bu;_e.resize(ge),_e._trim();for(let Se=0;Se<ge;Se++){const ee=6*Se;_e.uint16[ee+0]=4*Se+0,_e.uint16[ee+1]=4*Se+1,_e.uint16[ee+2]=4*Se+2,_e.uint16[ee+3]=4*Se+2,_e.uint16[ee+4]=4*Se+3,_e.uint16[ee+5]=4*Se+0}return _e}(j));const K=I.createIndexBuffer(Vu,!0),ue=I.createVertexBuffer(X,o.bM.members,!0);for(const he of B){const ge={u_matrix:he.transform,u_inv_matrix:he.invTransform,u_camera_to_center_distance:(ce=D).getCameraToCenterDistance(he.projection),u_viewport_size:[ce.width,ce.height]};H.draw(p,O.TRIANGLES,o.ae.disabled,o.ag.disabled,p.colorModeForRenderPass(),o.af.disabled,ge,c.id,ue,K,o.b.simpleSegment(0,2*he.circleOffset,he.circleArray.length,he.circleArray.length/2),null,D.zoom)}var ce;ue.destroy(),K.destroy()}const Ql=o.ad.create();function gh(p){const i=p._camera.getWorldToCamera(p.worldSize,1),c=o.ad.multiply([],i,p.globeMatrix);o.ad.invert(c,c);const _=[0,0,0],x=[0,1,0,0];return o.aA.transformMat4(x,x,c),_[0]=x[0],_[1]=x[1],_[2]=x[2],o._.normalize(_,_),_}function c1({width:p,height:i,anchor:c,textOffset:_,textScale:x},w){const{horizontalAlign:S,verticalAlign:I}=o.bQ(c),O=-(S-.5)*p,D=-(I-.5)*i,z=o.bP(c,_);return new o.P((O/x+z[0])*w,(D/x+z[1])*w)}function h1(p,i,c,_,x,w,S,I,O,D,z){const B=p.text.placedSymbolArray,j=p.text.dynamicLayoutVertexArray,$=p.icon.dynamicLayoutVertexArray,H={},X=p.getProjection(),Y=Wf(I,X,w),K=w.elevation,ue=X.upVectorScale(I.canonical,w.center.lat,w.worldSize).metersToTile;j.clear();for(let ce=0;ce<B.length;ce++){const he=B.get(ce),{tileAnchorX:ge,tileAnchorY:_e,numGlyphs:Se}=he,ee=he.hidden||!he.crossTileID||p.allowVerticalPlacement&&!he.placedOrientation?null:_[he.crossTileID];if(ee){let fe=0,Pe=0,We=0;if(K){const lt=K?K.getAtTileOffset(I,ge,_e):0,[Ct,Pt,Lt]=X.upVector(I.canonical,ge,_e);fe=lt*Ct*ue,Pe=lt*Pt*ue,We=lt*Lt*ue}let[ke,be,Xe,dt]=fn(he.projectedAnchorX+fe,he.projectedAnchorY+Pe,he.projectedAnchorZ+We,c?Y:S);const pt=ui(w.getCameraToCenterDistance(X),dt);let ft=x.evaluateSizeForFeature(p.textSizeData,D,he)*pt/o.bN;c&&(ft*=p.tilePixelRatio/O);const Fe=c1(ee,ft);c?({x:ke,y:be,z:Xe}=X.projectTilePoint(ge+Fe.x,_e+Fe.y,I.canonical),[ke,be,Xe]=fn(ke+fe,be+Pe,Xe+We,S)):(i&&Fe._rotate(-w.angle),ke+=Fe.x,be+=Fe.y,Xe=0);const Ye=p.allowVerticalPlacement&&he.placedOrientation===o.aE.vertical?Math.PI/2:0;for(let lt=0;lt<Se;lt++)o.aH(j,ke,be,Xe,Ye);z&&he.associatedIconIndex>=0&&(H[he.associatedIconIndex]={x:ke,y:be,z:Xe,angle:Ye})}else Yi(Se,j)}if(z){$.clear();const ce=p.icon.placedSymbolArray;for(let he=0;he<ce.length;he++){const ge=ce.get(he),{numGlyphs:_e}=ge,Se=H[he];if(ge.hidden||!Se)Yi(_e,$);else{const{x:ee,y:fe,z:Pe,angle:We}=Se;for(let ke=0;ke<_e;ke++)o.aH($,ee,fe,Pe,We)}}p.icon.dynamicLayoutVertexBuffer.updateData($)}p.text.dynamicLayoutVertexBuffer.updateData(j)}function qf(p,i,c,_,x,w,S={}){const I=c.paint.get("icon-translate"),O=c.paint.get("text-translate"),D=c.paint.get("icon-translate-anchor"),z=c.paint.get("text-translate-anchor"),B=c.layout.get("icon-rotation-alignment"),j=c.layout.get("text-rotation-alignment"),$=c.layout.get("icon-pitch-alignment"),H=c.layout.get("text-pitch-alignment"),X=c.layout.get("icon-keep-upright"),Y=c.layout.get("text-keep-upright"),K=c.paint.get("icon-color-saturation"),ue=c.paint.get("icon-color-contrast"),ce=c.paint.get("icon-color-brightness-min"),he=c.paint.get("icon-color-brightness-max"),ge=c.paint.get("icon-occlusion-opacity").constantOr(0),_e=c.paint.get("text-occlusion-opacity").constantOr(0),Se=p.context,ee=Se.gl,fe=p.transform,Pe=B==="map",We=j==="map",ke=$==="map",be=H==="map",Xe=ge!==1,dt=_e!==1,pt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ft=!1;const Fe=p.depthModeForSublayer(0,o.ae.ReadOnly),Ye=[o.aj(fe.center.lng),o.ak(fe.center.lat)],lt=c.layout.get("text-variable-anchor"),Ct=fe.projection.name==="globe",Pt=[],Lt=[0,-1,0];for(const Ot of _){const It=i.getTile(Ot),it=It.getBucket(c);if(!it||it.projection.name==="mercator"&&Ct||it.fullyClipped)continue;const jt=it.projection.name==="globe",Er=jt?o.a1(fe.zoom):0,lr=Wf(Ot,it.getProjection(),fe),yr=fe.calculatePixelsToTileUnitsMatrix(It),Rr=lt&&it.hasTextData(),yn=it.hasIconTextFit()&&Rr&&it.hasIconData(),Pr=it.getProjection().createInversionMatrix(fe,Ot.canonical),pr=()=>{const pn=Pe&&c.layout.get("symbol-placement")!=="point",ct=[];c.hasInitialOcclusionOpacityProperties&&Xe&&p.symbolParams.useOcclusionQueries&&!jt&&!Ct&&ct.push("OCCLUSION_QUERIES"),c.hasInitialOcclusionOpacityProperties||ct.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH");const Ft=pn||yn,wi=c.paint.get("icon-image-cross-fade").constantOr(0);p.terrainRenderModeElevated()&&ke&&ct.push("PITCH_WITH_MAP_TERRAIN"),jt&&(ct.push("PROJECTION_GLOBE_VIEW"),Ft&&ct.push("PROJECTED_POS_ON_VIEWPORT")),wi>0&&ct.push("ICON_TRANSITION"),it.icon.zOffsetVertexBuffer&&ct.push("Z_OFFSET"),ct.push("TERRAIN_DEPTH_D24"),K===0&&ue===0&&ce===0&&he===1||ct.push("COLOR_ADJUSTMENT");const Xr=it.icon.programConfigurations.get(c.id),$e=p.getOrCreateProgram(it.sdfIcons?"symbolSDF":"symbolIcon",{config:Xr,defines:ct});let Ji;const Bi=It.imageAtlasTexture?It.imageAtlasTexture.size:[0,0],Ti=it.iconSizeData,Ni=o.aD(Ti,fe.zoom),js=ke||fe.pitch!==0,$a=Kt(lr,It.tileID.canonical,ke,Pe,fe,it.getProjection(),yr),qo=bn(lr,It.tileID.canonical,ke,Pe,fe,it.getProjection(),yr),yl=p.translatePosMatrix(qo,It,I,D,!0),vl=p.translatePosMatrix(lr,It,I,D),xl=Ft?Ql:$a,pa=Pe&&!ke&&!pn;let cu=Lt;!Ct&&!fe.mercatorFromTransition||Pe||(cu=gh(fe));const ic=jt?cu:Lt;if(it.sdfIcons&&!it.iconsInText)Ji=Kl(Ti.kind,Ni,pa,ke,p,vl,xl,yl,!1,Bi,!0,Ot,Er,Ye,Pr,ic,it.getProjection());else{const hu=c.getColorAdjustmentMatrix(K,ue,ce,he);Ji=ks(Ti.kind,Ni,pa,ke,p,vl,xl,yl,!1,Bi,Ot,Er,Ye,Pr,ic,it.getProjection(),hu,wi)}const Fh=It.imageAtlasTexture?It.imageAtlasTexture:null,oc=c.layout.get("icon-size").constantOr(0)!==1||it.iconsNeedLinear,sc=it.sdfIcons||p.options.rotating||p.options.zooming||oc||js?ee.LINEAR:ee.NEAREST,hd=it.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,fd=p.terrain&&ke&&pn?o.ad.invert(o.ad.create(),$a):Ql;if(pn&&it.icon){const hu=fe.elevation,Ui=hu?hu.getAtTileOffsetFunc(Ot,fe.center.lat,fe.worldSize,it.getProjection()):null,Um=zr(lr,It.tileID.canonical,ke,Pe,fe,it.getProjection(),yr);qi(it,lr,p,!1,Um,qo,ke,X,Ui,Ot)}return{program:$e,buffers:it.icon,uniformValues:Ji,atlasTexture:Fh,atlasTextureIcon:null,atlasInterpolation:sc,atlasInterpolationIcon:null,isSDF:it.sdfIcons,hasHalo:hd,tile:It,labelPlaneMatrixInv:fd}},sn=()=>{const pn=We&&c.layout.get("symbol-placement")!=="point",ct=[],Ft=pn||lt||yn;c.hasInitialOcclusionOpacityProperties&&dt&&p.symbolParams.useOcclusionQueries&&!jt&&!Ct&&ct.push("OCCLUSION_QUERIES"),c.hasInitialOcclusionOpacityProperties||ct.push("SYMBOL_OCCLUSION_BY_TERRAIN_DEPTH"),p.terrainRenderModeElevated()&&be&&ct.push("PITCH_WITH_MAP_TERRAIN"),jt&&(ct.push("PROJECTION_GLOBE_VIEW"),Ft&&ct.push("PROJECTED_POS_ON_VIEWPORT")),it.text.zOffsetVertexBuffer&&ct.push("Z_OFFSET"),ct.push("TERRAIN_DEPTH_D24");const wi=it.text.programConfigurations.get(c.id),Xr=p.getOrCreateProgram(it.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:wi,defines:ct});let $e,Ji=[0,0],Bi=null;const Ti=it.textSizeData;it.iconsInText&&(Ji=It.imageAtlasTexture?It.imageAtlasTexture.size:[0,0],Bi=It.imageAtlasTexture?It.imageAtlasTexture:null,$e=be||fe.pitch!==0||p.options.rotating||p.options.zooming||Ti.kind==="composite"||Ti.kind==="camera"?ee.LINEAR:ee.NEAREST);const Ni=It.glyphAtlasTexture?It.glyphAtlasTexture.size:[0,0],js=o.aD(Ti,fe.zoom),$a=Kt(lr,It.tileID.canonical,be,We,fe,it.getProjection(),yr),qo=bn(lr,It.tileID.canonical,be,We,fe,it.getProjection(),yr),yl=p.translatePosMatrix(qo,It,O,z,!0),vl=p.translatePosMatrix(lr,It,O,z),xl=Ft?Ql:$a,pa=We&&!be&&!pn;let cu=Lt;!Ct&&!fe.mercatorFromTransition||We||(cu=gh(fe));const ic=jt?cu:Lt;let Fh;Fh=it.iconsInText?ey(Ti.kind,js,pa,be,p,vl,xl,yl,Ni,Ji,Ot,Er,Ye,Pr,ic,it.getProjection()):Kl(Ti.kind,js,pa,be,p,vl,xl,yl,!0,Ni,!0,Ot,Er,Ye,Pr,ic,it.getProjection());const oc=It.glyphAtlasTexture?It.glyphAtlasTexture:null,sc=ee.LINEAR,hd=c.paint.get("text-halo-width").constantOr(1)!==0,fd=p.terrain&&be&&pn?o.ad.invert(o.ad.create(),$a):Ql;if(pn&&it.text){const hu=fe.elevation,Ui=hu?hu.getAtTileOffsetFunc(Ot,fe.center.lat,fe.worldSize,it.getProjection()):null,Um=zr(lr,It.tileID.canonical,be,We,fe,it.getProjection(),yr);qi(it,lr,p,!0,Um,qo,be,Y,Ui,Ot)}return{program:Xr,buffers:it.text,uniformValues:Fh,atlasTexture:oc,atlasTextureIcon:Bi,atlasInterpolation:sc,atlasInterpolationIcon:$e,isSDF:!0,hasHalo:hd,tile:It,labelPlaneMatrixInv:fd}},Jr=it.icon.segments.get().length,kr=it.text.segments.get().length,xr=Jr&&!S.onlyText?pr():null,dn=kr&&!S.onlyIcons?sn():null,Rn=c.paint.get("icon-opacity").constantOr(1),en=c.paint.get("text-opacity").constantOr(1);if(pt&&it.canOverlap){ft=!0;const pn=Rn&&!S.onlyText?it.icon.segments.get():[],ct=en&&!S.onlyIcons?it.text.segments.get():[];for(const Ft of pn)Pt.push({segments:new o.b([Ft]),sortKey:Ft.sortKey,state:xr});for(const Ft of ct)Pt.push({segments:new o.b([Ft]),sortKey:Ft.sortKey,state:dn})}else S.onlyText||Pt.push({segments:Rn?it.icon.segments:new o.b([]),sortKey:0,state:xr}),S.onlyIcons||Pt.push({segments:en?it.text.segments:new o.b([]),sortKey:0,state:dn})}ft&&Pt.sort((Ot,It)=>Ot.sortKey-It.sortKey);for(const Ot of Pt){const It=Ot.state;if(It)if(p.terrain&&p.terrain.setupElevationDraw(It.tile,It.program,{useDepthForOcclusion:!c.hasInitialOcclusionOpacityProperties&&fe.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:It.labelPlaneMatrixInv}),Se.activeTexture.set(ee.TEXTURE0),It.atlasTexture&&It.atlasTexture.bind(It.atlasInterpolation,ee.CLAMP_TO_EDGE,!0),It.atlasTextureIcon&&(Se.activeTexture.set(ee.TEXTURE1),It.atlasTextureIcon&&It.atlasTextureIcon.bind(It.atlasInterpolationIcon,ee.CLAMP_TO_EDGE,!0)),p.uploadCommonLightUniforms(p.context,It.program),It.hasHalo){const it=It.uniformValues;it.u_is_halo=1,nm(It.buffers,Ot.segments,c,p,It.program,Fe,x,w,it,2),it.u_is_halo=0}else{if(It.isSDF){const it=It.uniformValues;It.hasHalo&&(it.u_is_halo=1,nm(It.buffers,Ot.segments,c,p,It.program,Fe,x,w,it,1)),it.u_is_halo=0}nm(It.buffers,Ot.segments,c,p,It.program,Fe,x,w,It.uniformValues,1)}}}function nm(p,i,c,_,x,w,S,I,O,D){const z=_.context.gl,B=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer];p.occlusionQueryOpacityVertexBuffer.length>0&&B.push(p.occlusionQueryOpacityVertexBuffer),x.draw(_,z.TRIANGLES,w,S,I,o.af.disabled,O,c.id,p.layoutVertexBuffer,p.indexBuffer,i,c.paint,_.transform.zoom,p.programConfigurations.get(c.id),B,D)}function yh(p,i,c,_,x,w,S){const I=p.context.gl,O=c.paint.get("fill-pattern"),D=O&&O.constantOr(1);let z,B,j,$,H;S?(B=D&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=I.LINES):(B=D?"fillPattern":"fill",z=I.TRIANGLES);for(const X of _){const Y=i.getTile(X);if(D&&!Y.patternsLoaded())continue;const K=Y.getBucket(c);if(!K)continue;p.prepareDrawTile();const ue=K.programConfigurations.get(c.id),ce=p.isTileAffectedByFog(X),he=p.getOrCreateProgram(B,{config:ue,overrideFog:ce});D&&(p.context.activeTexture.set(I.TEXTURE0),Y.imageAtlasTexture&&Y.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ue.updatePaintBuffers());const ge=O.constantOr(null);if(ge&&Y.imageAtlas){const ee=Y.imageAtlas.patternPositions[ge.toString()];ee&&ue.setConstantPatternPositions(ee)}const _e=p.translatePosMatrix(X.projMatrix,Y,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),Se=c.paint.get("fill-emissive-strength");if(S){$=K.indexBuffer2,H=K.segments2;const ee=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];j=B==="fillOutlinePattern"&&D?Kg(_e,Se,p,Y,ee):Yg(_e,Se,ee)}else $=K.indexBuffer,H=K.segments,j=D?Xp(_e,Se,p,Y):Nf(_e,Se);p.uploadCommonUniforms(p.context,he,X.toUnwrapped()),he.draw(p,z,x,p.stencilModeForClipping(X),w,o.af.disabled,j,c.id,K.layoutVertexBuffer,$,H,c.paint,p.transform.zoom,ue,void 0)}}function $o(p,i,c,_,x,w,S,I){c.resetLayerRenderingStats(p);const O=p.context,D=O.gl,z=p.transform,B=c.paint.get("fill-extrusion-pattern"),j=B.constantOr(1),$=c.paint.get("fill-extrusion-opacity"),H=p.style.enable3dLights(),X=c.paint.get(H&&!j?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Y=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),X],K=c.layout.get("fill-extrusion-edge-radius"),ue=K>0&&!c.paint.get("fill-extrusion-rounded-roof"),ce=ue?0:K,he=z.projection.name==="globe"?o.bY():0,ge=z.projection.name==="globe",_e=ge?o.a1(z.zoom):0,Se=[o.aj(z.center.lng),o.ak(z.center.lat)],ee=c.paint.get("fill-extrusion-flood-light-color").toRenderColor(c.lut).toArray01().slice(0,3),fe=c.paint.get("fill-extrusion-flood-light-intensity"),Pe=c.paint.get("fill-extrusion-vertical-scale"),We=Zl(p,c.paint.get("fill-extrusion-cutoff-fade-range")),ke=c.paint.get("fill-extrusion-emissive-strength"),be=[];let Xe;ge&&be.push("PROJECTION_GLOBE_VIEW"),Y[0]>0&&be.push("FAUX_AO"),ue&&be.push("ZERO_ROOF_RADIUS"),I&&be.push("HAS_CENTROID"),fe>0&&be.push("FLOOD_LIGHT"),We.shouldRenderCutoff&&be.push("RENDER_CUTOFF");const dt=p.renderPass==="shadow",pt=p.shadowRenderer,ft=dt&&!!pt;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let Fe=[0,0,0];if(pt){const Ct=p.style.directionalLight,Pt=p.style.ambientLight;Ct&&Pt&&(Fe=Bu(p.style,Ct,Pt)),Xe=be.concat(["SHADOWS_SINGLE_CASCADE"])}const Ye=ft?"fillExtrusionDepth":j?"fillExtrusionPattern":"fillExtrusion",lt=c.getLayerRenderingStats();for(const Ct of _){const Pt=i.getTile(Ct),Lt=Pt.getBucket(c);if(!Lt||Lt.projection.name!==z.projection.name)continue;let Ot=!1;pt&&(Ot=pt.getMaxCascadeForTile(Ct.toUnwrapped())===0);const It=p.isTileAffectedByFog(Ct),it=Lt.programConfigurations.get(c.id),jt=p.getOrCreateProgram(Ye,{config:it,defines:Ot?Xe:be,overrideFog:It});if(p.terrain&&p.terrain.setupElevationDraw(Pt,jt,{useMeterToDem:!0}),!Lt.centroidVertexBuffer){const Pr=jt.attributes.a_centroid_pos;Pr!==void 0&&D.vertexAttrib2f(Pr,0,0)}!dt&&pt&&pt.setupShadows(Pt.tileID.toUnwrapped(),jt,"vector-tile",Pt.tileID.overscaledZ),j&&(p.context.activeTexture.set(D.TEXTURE0),Pt.imageAtlasTexture&&Pt.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),it.updatePaintBuffers());const Er=B.constantOr(null);if(Er&&Pt.imageAtlas){const Pr=Pt.imageAtlas.patternPositions[Er.toString()];Pr&&it.setConstantPatternPositions(Pr)}const lr=c.paint.get("fill-extrusion-vertical-gradient");let yr;if(dt&&pt){if(Hf(Pt.tileID,Lt,p))continue;const Pr=pt.calculateShadowPassMatrixFromTile(Pt.tileID.toUnwrapped());yr=ph(Pr,ce,Pe)}else{const Pr=p.translatePosMatrix(Ct.expandedProjMatrix,Pt,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),pr=z.projection.createInversionMatrix(z,Ct.canonical);yr=j?ju(Pr,p,lr,$,Y,ce,Ct,Pt,he,_e,Se,pr,ee,Pe):dh(Pr,p,lr,$,Y,ce,Ct,he,_e,Se,pr,ee,Pe,fe,Fe,ke)}p.uploadCommonUniforms(O,jt,Ct.toUnwrapped(),null,We);let Rr=Lt.segments;if(z.projection.name==="mercator"&&!dt&&(Rr=Lt.getVisibleSegments(Pt.tileID,p.terrain,p.transform.getFrustum(0)),!Rr.get().length))continue;if(lt)if(dt)for(const Pr of Rr.get())lt.numRenderedVerticesInShadowPass+=Pr.primitiveLength;else for(const Pr of Rr.get())lt.numRenderedVerticesInTransparentPass+=Pr.primitiveLength;const yn=[];(p.terrain||I)&&yn.push(Lt.centroidVertexBuffer),ge&&yn.push(Lt.layoutVertexExtBuffer),jt.draw(p,O.gl.TRIANGLES,x,w,S,o.af.backCCW,yr,c.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Rr,c.paint,p.transform.zoom,it,yn)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}function Na(p,i,c,_,x,w,S,I,O,D,z,B,j,$,H,X,Y,K,ue){const ce=p.context,he=ce.gl,ge=p.transform,_e=p.transform.zoom,Se=[],ee=Zl(p,c.paint.get("fill-extrusion-cutoff-fade-range"));D==="clear"?(Se.push("CLEAR_SUBPASS"),ue&&(Se.push("CLEAR_FROM_TEXTURE"),ce.activeTexture.set(he.TEXTURE0),ue.bind(he.LINEAR,he.CLAMP_TO_EDGE))):D==="sdf"&&Se.push("SDF_SUBPASS"),Y&&Se.push("HAS_CENTROID"),ee.shouldRenderCutoff&&Se.push("RENDER_CUTOFF");const fe=c.layout.get("fill-extrusion-edge-radius"),Pe=(We,ke,be,Xe,dt)=>{const pt=ke.programConfigurations.get(c.id),ft=p.isTileAffectedByFog(We),Fe=p.getOrCreateProgram("fillExtrusionGroundEffect",{config:pt,defines:Se,overrideFog:ft}),Ye=((Ct,Pt,Lt,Ot,It,it,jt,Er,lr,yr,Rr)=>({u_matrix:Pt,u_opacity:Lt,u_ao_pass:Ot?1:0,u_meter_to_tile:It,u_ao:it,u_flood_light_intensity:jt,u_flood_light_color:Er,u_attenuation:lr,u_edge_radius:yr,u_fb:0,u_fb_size:Rr}))(0,Xe,z,O,dt,[B,j*dt],$,H,X,_e>=17?0:fe*dt,ue?ue.size[0]:0),lt=[];Y&&lt.push(ke.hiddenByLandmarkVertexBuffer),p.uploadCommonUniforms(ce,Fe,We.toUnwrapped(),null,ee),Fe.draw(p,ce.gl.TRIANGLES,x,w,S,I,Ye,c.id,ke.vertexBuffer,ke.indexBuffer,be,c.paint,_e,pt,lt)};for(const We of _){const ke=i.getTile(We),be=ke.getBucket(c);if(!be||be.projection.name!==ge.projection.name||!be.groundEffect||be.groundEffect&&!be.groundEffect.hasData())continue;const Xe=be.groundEffect,dt=1/be.tileToMeter;{const pt=p.translatePosMatrix(We.projMatrix,ke,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),ft=Xe.getDefaultSegment();Pe(We,Xe,ft,pt,dt)}if(K)for(let pt=0;pt<4;pt++){const ft=o.bZ[pt](We),Fe=i.getTile(ft);if(!Fe)continue;const Ye=Fe.getBucket(c);if(!Ye||Ye.projection.name!==ge.projection.name||!Ye.groundEffect||Ye.groundEffect&&!Ye.groundEffect.hasData())continue;const lt=Ye.groundEffect;let Ct,Pt;pt===0?(Ct=[-o.a3,0,0],Pt=1):pt===1?(Ct=[o.a3,0,0],Pt=0):pt===2?(Ct=[0,-o.a3,0],Pt=3):(Ct=[0,o.a3,0],Pt=2);const Lt=lt.regionSegments[Pt];if(!Lt)continue;const Ot=new Float32Array(16);o.ad.translate(Ot,We.projMatrix,Ct),Pe(We,lt,Lt,p.translatePosMatrix(Ot,ke,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),dt)}}}function oy(p,i,c,_,x,w,S){_.centroidVertexArray.length===0&&_.createCentroidsBuffer();const I=w?w.findDEMTileFor(c):null;if(!(I&&I.dem||S))return;const O=K=>new o.P(Math.ceil((K+o.c0)*o.c1),0),D=K=>{const ue=i.getSource().minzoom,ce=ge=>{const _e=i.getTileByID(ge);if(_e&&_e.hasData())return _e.getBucket(x)},he=[0,-1,1];for(const ge of he){if(K.overscaledZ+ge<ue)continue;const _e=ce(K.calculateScaledKey(K.overscaledZ+ge));if(_e)return _e}},z=[0,0,0],B=(K,ue)=>(z[0]=Math.min(K.min.y,ue.min.y),z[1]=Math.max(K.max.y,ue.max.y),z[2]=o.a3-ue.min.x>K.max.x?ue.min.x-o.a3:K.max.x,z),j=(K,ue)=>(z[0]=Math.min(K.min.x,ue.min.x),z[1]=Math.max(K.max.x,ue.max.x),z[2]=o.a3-ue.min.y>K.max.y?ue.min.y-o.a3:K.max.y,z),$=[(K,ue)=>B(K,ue),(K,ue)=>B(ue,K),(K,ue)=>j(K,ue),(K,ue)=>j(ue,K)],H=(K,ue,ce,he,ge,_e,Se)=>{if(!w)return 0;const ee=[[_e?ce:K,_e?K:ce,0],[_e?ce:ue,_e?ue:ce,0]],fe=Se<0?o.a3+Se:Se,Pe=[_e?fe:(K+ue)/2,_e?(K+ue)/2:fe,0];return ce===0&&Se<0||ce!==0&&Se>0?w.getForTilePoints(ge,[Pe],!0,he):ee.push(Pe),w.getForTilePoints(c,ee,!0,I),Math.max(ee[0][2],ee[1][2],Pe[2])/w.exaggeration()};for(let K=0;K<4;K++){const ue=_.borderFeatureIndices[K];if(ue.length===0)continue;const ce=o.bZ[K](c),he=D(ce);if(!(he&&he instanceof o.b_)||_.borderDoneWithNeighborZ[K]===he.canonical.z)continue;he.centroidVertexArray.length===0&&he.createCentroidsBuffer();const ge=w?w.findDEMTileFor(ce):null;if(!(ge&&ge.dem||S))continue;const _e=(K<2?1:5)-K,Se=he.borderDoneWithNeighborZ[_e]!==_.canonical.z,ee=he.borderFeatureIndices[_e];let fe=0;if(_.canonical.z!==he.canonical.z){for(const Pe of ue)_.showCentroid(_.featuresOnBorder[Pe]);if(Se)for(const Pe of ee)he.showCentroid(he.featuresOnBorder[Pe]);_.borderDoneWithNeighborZ[K]=he.canonical.z,he.borderDoneWithNeighborZ[_e]=_.canonical.z}for(const Pe of ue){const We=_.featuresOnBorder[Pe],ke=_.centroidData[We.centroidDataIndex],be=We.borders[K];let Xe;for(;fe<ee.length;){Xe=he.featuresOnBorder[ee[fe]];const dt=Xe.borders[_e];if(dt[1]>be[0]+3||dt[0]>be[0]-3)break;he.showCentroid(Xe),fe++}if(Xe&&fe<ee.length){const dt=fe;let pt=0;for(;!(Xe.borders[_e][0]>be[1]-3)&&(pt++,++fe!==ee.length);)Xe=he.featuresOnBorder[ee[fe]];if(Xe=he.featuresOnBorder[ee[dt]],pt>1){const Ye=Xe.borders[_e];Math.abs(be[0]-Ye[0])<3&&Math.abs(be[1]-Ye[1])<3&&(pt=1,fe=dt+1)}else if(pt===0){_.showCentroid(We);continue}const ft=he.centroidData[Xe.centroidDataIndex];S&&pt===1&&(((X=ke).flags|(Y=ft).flags)&o.b$?(X.flags|=o.b$,Y.flags|=o.b$):(X.flags&=~o.b$,Y.flags&=~o.b$));const Fe=We.intersectsCount()>1||Xe.intersectsCount()>1;if(pt>1)fe=dt,ke.centroidXY=ft.centroidXY=new o.P(0,0);else if(ge&&ge.dem&&!Fe){const Ye=$[K](ke,ft),lt=K%2?o.a3-1:0,Ct=H(Ye[0],Math.min(o.a3-1,Ye[1]),lt,ge,ce,K<2,Ye[2]);ke.centroidXY=ft.centroidXY=O(Ct)}else Fe?ke.centroidXY=ft.centroidXY=new o.P(0,0):(ke.centroidXY=_.encodeBorderCentroid(We),ft.centroidXY=he.encodeBorderCentroid(Xe));_.writeCentroidToBuffer(ke),he.writeCentroidToBuffer(ft)}else _.showCentroid(We)}_.borderDoneWithNeighborZ[K]=he.canonical.z,he.borderDoneWithNeighborZ[_e]=_.canonical.z}var X,Y;(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(p)}const im=[1,0,0],Jl=[0,1,0],sy=[0,0,1];function Hf(p,i,c){const _=c.transform,x=c.shadowRenderer;if(!x)return!0;const w=p.toUnwrapped(),S=_.tileSize*x._cascades[c.currentShadowCascade].scale;let I=i.maxHeight;if(_.elevation){const X=_.elevation.getMinMaxForTile(p);X&&(I+=X.max)}const O=[...x.shadowDirection];O[2]=-O[2];const D=x.computeSimplifiedTileShadowVolume(w,I,S,O);if(!D)return!1;const z=[im,Jl,sy,O,[O[0],0,O[2]],[0,O[1],O[2]]],B=_.projection.name==="globe",j=_.scaleZoom(S),$=o.aM.fromInvProjectionMatrix(_.invProjMatrix,_.worldSize,j,!B),H=x.getCurrentCascadeFrustum();return $.intersectsPrecise(D.vertices,D.planes,z)===0||H.intersectsPrecise(D.vertices,D.planes,z)===0}function Zf(p){return[p[0]*o.c2,p[1]*o.c2,p[2]*o.c2,0]}function $u(p,i,c,_,x,w,S,I,O){const D=_.getSource(),z=c.globeSharedBuffers;if(!z)return;let B,j,$;if(i&&(B=_.getTile(i)),D instanceof o.bm?(j=D.texture,$=o.bh(0,0,c.transform)):B&&i&&(j=B.texture,$=o.bh(i.canonical.z,i.canonical.x,c.transform)),!j||!$)return;p||($=o.ad.scale(o.ad.create(),$,[1,-1,1]));const H=c.context,X=H.gl,Y=x.paint.get("raster-resampling")==="nearest"?X.NEAREST:X.LINEAR,K=c.colorModeForDrapableLayerRenderPass(w),ue=S.defines;ue.push("GLOBE_POLES");const ce=new o.ae(X.LEQUAL,o.ae.ReadWrite,c.depthRangeFor3D),he=Float32Array.from(c.transform.expandedFarZProjMatrix),ge=Float32Array.from(o.bf(o.bg(new o.aO(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),H.activeTexture.set(X.TEXTURE0),j.bind(Y,X.CLAMP_TO_EDGE),H.activeTexture.set(X.TEXTURE1),j.bind(Y,X.CLAMP_TO_EDGE),j.useMipmap&&H.extTextureFilterAnisotropic&&c.transform.pitch>20&&X.texParameterf(X.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax);const[_e,Se,ee,fe]=i?z.getPoleBuffers(i.canonical.z,!1):z.getPoleBuffers(0,!0),Pe=x.paint.get("raster-elevation");let We;p?(We=_e,c.renderDefaultNorthPole=Pe!==0):(We=Se,c.renderDefaultSouthPole=Pe!==0);const ke=Zf(S.mix),be=((dt,pt,ft,Fe,Ye,lt,Ct,Pt,Lt,Ot,It,it,jt)=>Kp(dt,pt,ft,new Float32Array(16),new Float32Array(9),[0,0],Fe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},lt,[0,0],Pt,2,Ot,It,it,1,0,jt))(he,ge,$,o.a1(c.transform.zoom),0,x,0,Pe,0,ke,S.offset,S.range,w),Xe=c.getOrCreateProgram("raster",{defines:ue});c.uploadCommonUniforms(H,Xe,null),Xe.draw(c,X.TRIANGLES,ce,O,K,I,be,x.id,We,ee,fe)}function om(p){const i=p._nearZ,c=p.projection.farthestPixelDistance(p),_=c-i,x=.2*p.height,w=i+x;return[i,c,(w-x-i)/_,(w-i)/_]}function Gr(p,i,c,_){if(p)return i instanceof Uu&&p instanceof o.c3?i.getTextureDescriptor(p,c,!0):{texture:p.texture,mix:Zf(_.mix),offset:_.offset,buffer:0,tileSize:1}}function f1(p,i,c){if(!p)return null;const _=i.getTextureDescriptor(p,c,!0);if(!_)return null;let{texture:x,mix:w,offset:S,tileSize:I,buffer:O,format:D}=_;if(!x||!D)return null;let z=!1;return D==="uint32"&&(z=!0,w[3]=0,w=ml(o.c4,w,[0,c.paint.get("raster-particle-max-speed")]),S=Qg(o.c4,S,[0,c.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[O/(I+2*O),I/(I+2*O)],tileSize:I,scalarData:z,scale:w,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[D]]}}function nr(p){const i=p._nearZ,c=p.projection.farthestPixelDistance(p),_=c-i,x=.2*p.height,w=i+x;return[i,c,(w-x-i)/_,(w-i)/_]}const ay=new o.C(1,0,0,1),Xf=new o.C(0,1,0,1),sm=new o.C(0,0,1,1),ca=new o.C(1,0,1,1),am=new o.C(0,1,1,1);function Ls(p,i,c,_,x,w,S){const I=p.context,O=p.transform,D=I.gl,z=O.projection.name==="globe",B=z?["PROJECTION_GLOBE_VIEW"]:[];let j=o.ad.clone(c.projMatrix);if(z&&o.a1(O.zoom)>0){const ke=o.c5(c.canonical,O),be=o.c6(ke);j=o.ad.multiply(new Float32Array(16),O.globeMatrix,be),o.ad.multiply(j,O.projMatrix,j)}const $=o.ad.create();$[12]+=2*x/(o.e.devicePixelRatio*O.width),$[13]+=2*w/(o.e.devicePixelRatio*O.height),o.ad.multiply(j,$,j);const H=p.getOrCreateProgram("debug",{defines:B}),X=i.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(X,H);const Y=o.ae.disabled,K=o.ag.disabled,ue=p.colorModeForRenderPass(),ce="$debug";I.activeTexture.set(D.TEXTURE0),p.emptyTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),z?X._makeGlobeTileDebugBuffers(p.context,O):X._makeDebugTileBoundsBuffers(p.context,O.projection);const he=X._tileDebugBuffer||p.debugBuffer,ge=X._tileDebugIndexBuffer||p.debugIndexBuffer,_e=X._tileDebugSegments||p.debugSegments;if(H.draw(p,D.LINE_STRIP,Y,K,ue,o.af.disabled,jf(j,_),ce,he,ge,_e,null,null,null,[X._globeTileDebugBorderBuffer]),S){const ke=X.latestRawTileData,be=Math.floor((ke&&ke.byteLength||0)/1024);let Xe=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Xe+=` => ${c.overscaledZ}`),Xe+=` ${X.state}`,Xe+=` ${be}kb`,function(dt,pt){dt.initDebugOverlayCanvas();const ft=dt.debugOverlayCanvas,Fe=dt.context.gl,Ye=dt.debugOverlayCanvas.getContext("2d");Ye.clearRect(0,0,ft.width,ft.height),Ye.shadowColor="white",Ye.shadowBlur=2,Ye.lineWidth=1.5,Ye.strokeStyle="white",Ye.textBaseline="top",Ye.font="bold 36px Open Sans, sans-serif",Ye.fillText(pt,5,5),Ye.strokeText(pt,5,5),dt.debugOverlayTexture.update(ft),dt.debugOverlayTexture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE)}(p,Xe)}const Se=i.getTile(c).tileSize,ee=512/Math.min(Se,512)*(c.overscaledZ/O.zoom)*.5,fe=X._tileDebugTextBuffer||p.debugBuffer,Pe=X._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,We=X._tileDebugTextSegments||p.debugSegments;H.draw(p,D.TRIANGLES,Y,K,o.a.alphaBlended,o.af.disabled,jf(j,o.C.transparent,ee),ce,fe,Pe,We,null,null,null,[X._globeTileDebugTextBuffer])}function Ut(p,i,c,_){jr(p,0,i+c/2,p.transform.width,c,_)}function Wr(p,i,c,_){jr(p,i-c/2,0,c,p.transform.height,_)}function jr(p,i,c,_,x,w){const S=p.context,I=S.gl;I.enable(I.SCISSOR_TEST),I.scissor(i*o.e.devicePixelRatio,c*o.e.devicePixelRatio,_*o.e.devicePixelRatio,x*o.e.devicePixelRatio),S.clear({color:w}),I.disable(I.SCISSOR_TEST)}const os=o.c7([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Gu}=os;function Cr(p,i,c,_){p.emplaceBack(i,c,_)}class vh{constructor(i){this.vertexArray=new o.c8,this.indices=new o.bu,Cr(this.vertexArray,-1,-1,1),Cr(this.vertexArray,1,-1,1),Cr(this.vertexArray,-1,1,1),Cr(this.vertexArray,1,1,1),Cr(this.vertexArray,-1,-1,-1),Cr(this.vertexArray,1,-1,-1),Cr(this.vertexArray,-1,1,-1),Cr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Gu),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=o.b.simpleSegment(0,0,36,12)}}function ha(p,i,c,_,x,w){const S=p.context.gl,I=i.paint.get("sky-atmosphere-color"),O=i.paint.get("sky-atmosphere-halo-color"),D=i.paint.get("sky-atmosphere-sun-intensity"),z=((B,j,$,H,X)=>({u_matrix_3f:B,u_sun_direction:j,u_sun_intensity:$,u_color_tint_r:[H.r,H.g,H.b,H.a],u_color_tint_m:[X.r,X.g,X.b,X.a],u_luminance:5e-5}))(o.bC.fromMat4(o.bC.create(),_),x,D,I,O);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+w,i.skyboxTexture,0),c.draw(p,S.TRIANGLES,o.ae.disabled,o.ag.disabled,o.a.unblended,o.af.frontCW,z,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const xh=o.c7([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class To{constructor(i){const c=new o.c9;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const _=new o.bu;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(c,xh.members),this.indexBuffer=i.createIndexBuffer(_),this.segments=o.b.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Nn=o.c7([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class d1{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class bh{constructor(i){this.colorModeAlphaBlendedWriteRGB=new o.a([o.ca,o.cb,o.ca,o.cb],o.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new o.a([o.ca,o.cc,o.ca,o.cc],o.C.transparent,[!1,!1,!1,!0]),this.params=new d1,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){const c=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new To(c);const _=this.params.sizeRange,x=this.params.intensityRange,w=function(z){const B=o.cf(30),j=[];for(let $=0;$<z;++$){const H=2*Math.PI*B(),X=Math.acos(1-2*B())-.5*Math.PI;j.push(o._.fromValues(Math.cos(X)*Math.cos(H),Math.cos(X)*Math.sin(H),Math.sin(X)))}return j}(this.params.starsCount),S=o.cf(300),I=new o.cd,O=new o.bu;let D=0;for(let z=0;z<w.length;++z){const B=o._.scale([],w[z],200),j=Math.max(0,1+.01*_*(1*S()-.5)),$=Math.max(0,1+.01*x*(1*S()-.5));I.emplaceBack(B[0],B[1],B[2],-1,-1,j,$),I.emplaceBack(B[0],B[1],B[2],1,-1,j,$),I.emplaceBack(B[0],B[1],B[2],1,1,j,$),I.emplaceBack(B[0],B[1],B[2],-1,1,j,$),O.emplaceBack(D+0,D+1,D+2),O.emplaceBack(D+0,D+2,D+3),D+=4}this.starsVx=c.createVertexBuffer(I,Nn.members),this.starsIdx=c.createIndexBuffer(O),this.starsSegments=o.b.simpleSegment(0,0,I.length,O.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,c){const _=i.context,x=_.gl,w=i.transform,S=new o.ae(x.LEQUAL,o.ae.ReadOnly,[0,1]),I=o.a1(w.zoom),O=i.style.getLut(c.scope),D=c.properties.get("color").toRenderColor(O).toArray01(),z=c.properties.get("high-color").toRenderColor(O).toArray01(),B=c.properties.get("space-color").toRenderColor(O).toArray01PremultipliedAlpha(),j=5e-4,$=o.ce(c.properties.get("horizon-blend"),0,1,j,.25),H=o.ba(i,_,w)&&$===j?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,X=i.frameCounter/1e3%1,Y=o._.length(w.globeCenterInViewSpace),K=Math.sqrt(Math.pow(Y,2)-Math.pow(H,2)),ue=Math.acos(K/Y),ce=he=>{const ge=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];he&&ge.push("ALPHA_PASS");const _e=i.getOrCreateProgram("globeAtmosphere",{defines:ge}),Se=((fe,Pe,We,ke,be,Xe,dt,pt,ft,Fe,Ye,lt)=>({u_frustum_tl:fe,u_frustum_tr:Pe,u_frustum_br:We,u_frustum_bl:ke,u_horizon:be,u_transition:Xe,u_fadeout_range:dt,u_color:pt,u_high_color:ft,u_space_color:Fe,u_temporal_offset:Ye,u_horizon_angle:lt}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,I,$,D,z,B,X,ue);i.uploadCommonUniforms(_,_e);const ee=this.atmosphereBuffer;ee&&_e.draw(i,x.TRIANGLES,S,o.ag.disabled,he?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,o.af.backCW,Se,he?"atmosphere_glow_alpha":"atmosphere_glow",ee.vertexBuffer,ee.indexBuffer,ee.segments)};ce(!1),ce(!0)}drawStars(i,c){const _=o.at(c.properties.get("star-intensity"),0,1);if(_===0)return;const x=i.context,w=x.gl,S=i.transform,I=i.getOrCreateProgram("stars"),O=o.av.identity([]);o.av.rotateX(O,O,-S._pitch),o.av.rotateZ(O,O,-S.angle),o.av.rotateX(O,O,o.ab(S._center.lat)),o.av.rotateY(O,O,-o.ab(S._center.lng));const D=o.ad.fromQuat(new Float32Array(16),O),z=o.ad.multiply([],S.starsProjMatrix,D),B=o.bC.fromMat4([],D),j=o.bC.invert([],B),$=[0,1,0];o._.transformMat3($,$,j),o._.scale($,$,this.params.sizeMultiplier);const H=[1,0,0];o._.transformMat3(H,H,j),o._.scale(H,H,this.params.sizeMultiplier);const X=(Y=$,K=H,ue=_,{u_matrix:Float32Array.from(z),u_up:Y,u_right:K,u_intensity_multiplier:ue});var Y,K,ue;i.uploadCommonUniforms(x,I),this.starsVx&&this.starsIdx&&I.draw(i,w.TRIANGLES,o.ae.disabled,o.ag.disabled,this.colorModeAlphaBlendedWriteRGB,o.af.disabled,X,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Yf(p,i){const c=[...p],_=i.cameraWorldSizeForFog/i.worldSize,x=o.ad.identity([]);return o.ad.scale(x,x,[_,_,1]),o.ad.multiply(c,x,c),o.ad.multiply(c,i.worldToFogMatrix,c),c}function eu(p,i,c,_,x){const w=c.material,S=_.context,{baseColorTexture:I,metallicRoughnessTexture:O}=w.pbrMetallicRoughness,{normalTexture:D,occlusionTexture:z,emissionTexture:B}=w;function j($,H,X){if($&&(p.push(H),S.activeTexture.set(S.gl.TEXTURE0+X),$.gfxTexture)){const{minFilter:Y,magFilter:K,wrapS:ue,wrapT:ce}=$.sampler;$.gfxTexture.bindExtraParam(Y,K,ue,ce)}}j(I,"HAS_TEXTURE_u_baseColorTexture",Wn.BaseColor),j(O,"HAS_TEXTURE_u_metallicRoughnessTexture",Wn.MetallicRoughness),j(D,"HAS_TEXTURE_u_normalTexture",Wn.Normal),j(z,"HAS_TEXTURE_u_occlusionTexture",Wn.Occlusion),j(B,"HAS_TEXTURE_u_emissionTexture",Wn.Emission),x&&(x.texture||(x.texture=new o.ch(_.context,x.image,[x.image.height,x.image.height,x.image.height],S.gl.RGBA)),S.activeTexture.set(S.gl.TEXTURE0+Wn.LUT),x.texture&&x.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),p.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(c.texcoordBuffer)),c.colorBuffer&&(p.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(c.colorBuffer)),c.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(c.normalBuffer)),c.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(c.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||p.push("DIFFUSE_SHADED"),p.push("USE_STANDARD_DERIVATIVES")}function Wu(p,i,c,_,x,w){const S=c.paint.get("model-opacity"),I=i.context,O=new o.ae(i.context.gl.LEQUAL,o.ae.ReadWrite,i.depthRangeFor3D),D=i.transform,z=p.mesh,B=z.material,j=B.pbrMetallicRoughness,$=i.style.fog;let H;H=i.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:o.ad.multiply([],_.zScaleMatrix,p.nodeModelMatrix),o.ad.multiply(H,_.negCameraPosMatrix,H);const X=o.ad.invert([],H);o.ad.transpose(X,X);const Y=c.paint.get("model-emissive-strength").constantOr(0),K=tm(new Float32Array(p.worldViewProjection),new Float32Array(H),new Float32Array(X),null,i,S,j.baseColorFactor.toRenderColor(null),B.emissiveFactor,j.metallicFactor,j.roughnessFactor,B,Y,c),ue={defines:[]},ce=[];eu(ue.defines,ce,z,i,c.lut);const he=i.shadowRenderer;he&&(he.useNormalOffset=!1);let ge=null;if($){const ee=Yf(p.nodeModelMatrix,i.transform);if(ge=new Float32Array(ee),D.projection.name!=="globe"){const fe=z.aabb.min,Pe=z.aabb.max,[We,ke]=$.getOpacityForBounds(ee,fe[0],fe[1],Pe[0],Pe[1]);ue.overrideFog=We>=hn||ke>=hn}}const _e=Zl(i,c.paint.get("model-cutoff-fade-range"));_e.shouldRenderCutoff&&ue.defines.push("RENDER_CUTOFF");const Se=i.getOrCreateProgram("model",ue);i.uploadCommonUniforms(I,Se,null,ge,_e),i.renderPass!=="shadow"&&he&&he.setupShadowsFromMatrix(p.nodeModelMatrix,Se),Se.draw(i,I.gl.TRIANGLES,O,x,w,z.material.doubleSided?o.af.disabled:o.af.backCCW,K,c.id,z.vertexBuffer,z.indexBuffer,z.segments,c.paint,i.transform.zoom,void 0,ce)}function wh(p,i,c,_,x,w,S){let I;I=p.projection.name==="globe"?o.ci(c,p):[...c],o.ad.multiply(I,I,i.matrix);const O=o.ad.multiply([],_,I);if(i.meshes)for(const D of i.meshes){if(D.material.alphaMode!=="BLEND"){S.push({mesh:D,depth:0,modelIndex:x,worldViewProjection:O,nodeModelMatrix:I});continue}const z=o._.transformMat4([],D.centroid,O);z[2]>0&&w.push({mesh:D,depth:z[2],modelIndex:x,worldViewProjection:O,nodeModelMatrix:I})}if(i.children)for(const D of i.children)wh(p,D,c,_,x,w,S)}function Oi(p,i,c,_){const x=c.shadowRenderer;if(!x)return;const w=x.getShadowPassDepthMode(),S=x.getShadowPassColorMode(),I=x.calculateShadowPassMatrixFromMatrix(i),O=Gf(I);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,w,o.ag.disabled,S,o.af.backCCW,O,_.id,p.vertexBuffer,p.indexBuffer,p.segments,_.paint,c.transform.zoom,void 0,void 0)}function Go(p,i,c){const _=i.updateZoomBasedPaintProperties(),x=function(w,S,I){let O,D,z,B=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&B>0){const j=w.terrain,$=j.findDEMTileFor(I);$&&$.dem?O=o.ck.create(j,I,$):B=0}if(B===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),B===S.validForExaggeration&&(B===0||O&&O._demTile&&O._demTile.tileID===S.validForDEMTile.id&&O._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const j in S.instancesPerModel){const $=S.instancesPerModel[j];for(let H=0;H<$.instancedDataArray.length;++H){const X=(O?B*O.getElevationAt(0|$.instancedDataArray.float32[16*H],0|$.instancedDataArray.float32[16*H+1],!0,!0):0)+$.instancesEvaluatedElevation[H];$.instancedDataArray.float32[16*H+6]=X,D=D?Math.min(S.terrainElevationMin,X):X,z=z?Math.max(S.terrainElevationMax,X):X}}return S.terrainElevationMin=D||0,S.terrainElevationMax=z||0,S.validForExaggeration=B,S.validForDEMTile=O&&O._demTile?{id:O._demTile.tileID,timestamp:O._dem._timestamp}:{id:void 0,timestamp:0},!0}(p,i,c);(_||x)&&(i.uploaded=!1,i.upload(p.context))}const zs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.b6([0,0,0],[o.a3,o.a3,0])};function qu(p,i){const c=1<<p.canonical.z,_=i.getFreeCameraOptions().position,x=i.elevation,w=p.canonical.x/c,S=(p.canonical.x+1)/c,I=p.canonical.y/c,O=(p.canonical.y+1)/c;let D=i._centerAltitude;if(x){const $=x.getMinMaxForTile(p);$&&$.max>D&&(D=$.max)}const z=o.at(_.x,w,S)-_.x,B=o.at(_.y,I,O)-_.y,j=o.ax(D,i.center.lat)-_.z;return i._zoomFromMercatorZ(Math.sqrt(z*z+B*B+j*j))}function qn(p,i,c,_,x,w,S){const I=p.context,O=p.renderPass==="shadow",D=p.shadowRenderer,z=O&&D?D.getShadowPassDepthMode():new o.ae(I.gl.LEQUAL,o.ae.ReadWrite,p.depthRangeFor3D),B=p.isTileAffectedByFog(w);if(c.meshes)for(const j of c.meshes){const $=["MODEL_POSITION_ON_GPU"],H=[];let X,Y,K;_.instancedDataArray.length>20&&$.push("INSTANCED_ARRAYS");const ue=Zl(p,i.paint.get("model-cutoff-fade-range"));if(ue.shouldRenderCutoff&&$.push("RENDER_CUTOFF"),O&&D)X=p.getOrCreateProgram("modelDepth",{defines:$}),Y=Gf(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(c.matrix)),K=D.getShadowPassColorMode();else{eu($,H,j,p,i.lut),X=p.getOrCreateProgram("model",{defines:$,overrideFog:B});const he=j.material,ge=he.pbrMetallicRoughness,_e=i.paint.get("model-opacity"),Se=i.paint.get("model-emissive-strength").constantOr(0);Y=tm(w.expandedProjMatrix,Float32Array.from(c.matrix),new Float32Array(16),null,p,_e,ge.baseColorFactor.toRenderColor(null),he.emissiveFactor,ge.metallicFactor,ge.roughnessFactor,he,Se,i,x),D&&(S.shadowUniformsInitialized?X.setShadowUniformValues(I,D.getShadowUniformValues()):(D.setupShadows(w.toUnwrapped(),X,"model-tile",w.overscaledZ),S.shadowUniformsInitialized=!0)),K=ue.shouldRenderCutoff||_e<1||he.alphaMode!=="OPAQUE"?o.a.alphaBlended:o.a.unblended}p.uploadCommonUniforms(I,X,w.toUnwrapped(),null,ue);const ce=j.material.doubleSided?o.af.disabled:o.af.backCCW;if(_.instancedDataArray.length>20)H.push(_.instancedDataBuffer),X.draw(p,I.gl.TRIANGLES,z,o.ag.disabled,K,ce,Y,i.id,j.vertexBuffer,j.indexBuffer,j.segments,i.paint,p.transform.zoom,void 0,H,_.instancedDataArray.length);else{const he=O?"u_instance":"u_normal_matrix";for(let ge=0;ge<_.instancedDataArray.length;++ge)Y[he]=new Float32Array(_.instancedDataArray.arrayBuffer,64*ge,16),X.draw(p,I.gl.TRIANGLES,z,o.ag.disabled,K,ce,Y,i.id,j.vertexBuffer,j.indexBuffer,j.segments,i.paint,p.transform.zoom,void 0,H)}}if(c.children)for(const j of c.children)qn(p,i,j,_,x,w,S)}const Fs=[1,-1,1];function Ua(p,i,c,_){if(!c.modelManager)return!0;const x=c.modelManager;if(!c.shadowRenderer)return!0;const w=c.shadowRenderer,S=i.aabb;let I=!0,O=p.maxHeight;if(O===0){let z=0;for(const B in p.instancesPerModel){const j=x.getModel(B,_);j?z=Math.max(z,Math.max(Math.max(j.aabb.max[0],j.aabb.max[1]),j.aabb.max[2])):I=!1}O=p.maxScale*z*1.41+p.maxVerticalOffset,I&&(p.maxHeight=O)}S.max[2]=O,S.min[2]+=p.terrainElevationMin,S.max[2]+=p.terrainElevationMax,o._.transformMat4(S.min,S.min,i.tileMatrix),o._.transformMat4(S.max,S.max,i.tileMatrix);const D=S.intersects(w.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=D===2),D===0}function yi(p,i){const c=p.uniformValues.u_cutoff_params[0],_=p.uniformValues.u_cutoff_params[1],x=p.uniformValues.u_cutoff_params[2],w=p.uniformValues.u_cutoff_params[3];return _===c||w===x?1:o.at(((i-c)/(_-c)-x)/(w-x),0,1)}function lm(p,i,c,_){if(i.pitch<20)return 1;const x=i.getWorldToCameraMatrix(),w=o.ad.multiply([],x,p),S=[...c.min,1];let I=o.aA.transformMat4([],S,w),O=I,D=I;S[1]=c.max[1],I=o.aA.transformMat4([],S,w),O=I[1]<O[1]?I:O,D=I[1]>D[1]?I:D,S[0]=c.max[0],I=o.aA.transformMat4([],S,w),O=I[1]<O[1]?I:O,D=I[1]>D[1]?I:D,S[1]=c.min[1],I=o.aA.transformMat4([],S,w),O=I[1]<O[1]?I:O,D=I[1]>D[1]?I:D;const z=o.at(_[0],0,1),B=100*i.pixelsPerMeter*o.at(_[1],0,1),j=o.at(_[2],0,1),$=o._.lerp([],O,D,z),H=Math.tan(.5*i.fovX),X=-$[2]*H;if(B===0)return $[1]<-Math.abs(X)?j:1;const Y=(-Math.abs(X)-$[1])/B,K=(ce,he,ge)=>(1-ge)*ce+ge*he,ue=o.at(K(1,j,Y),j,1);return K(1,ue,o.at((i.pitch-20)/20,0,1))}class Bs{}class Th{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,c,_){{const B=this._storage.get(c.id);if(B)return B.lastUsedFrameIdx=i,B.buf}const x=_.gl,w=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),S=new ArrayBuffer(w),I=new Int16Array(S);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const O=new o.cm;for(let B=0;B<w/2;B+=3){const j=I[B],$=I[B+1],H=I[B+2];O.emplaceBack(j,$),O.emplaceBack($,H),O.emplaceBack(H,j)}const D=_.bindVertexArrayOES.current,z=new Bs;return z.buf=new o.I(_,O),z.lastUsedFrameIdx=i,this._storage.set(c.id,z),_.bindVertexArrayOES.set(D),z.buf}update(i){for(const[c,_]of this._storage)i-_.lastUsedFrameIdx>30&&(_.buf.destroy(),this._storage.delete(c))}destroy(){for(const[i,c]of this._storage)c.buf.destroy(),this._storage.delete(i)}}const Sh=o.c7([{type:"Float32",name:"a_offset_xy",components:2}]);class tu{constructor(i){const c=new o.cn,_=new o.bu;c.emplaceBack(-1,-1),c.emplaceBack(1,-1),c.emplaceBack(1,1),c.emplaceBack(-1,1),_.emplaceBack(0,1,2),_.emplaceBack(0,2,3),this.segments=o.b.simpleSegment(0,0,c.length,_.length),this.vx=i.createVertexBuffer(c,Sh.members),this.idx=i.createIndexBuffer(_)}destroy(){this.vx.destroy(),this.idx.destroy()}}const um={symbol:function(p,i,c,_,x){if(p.renderPass!=="translucent")return;const w=o.ag.disabled,S=p.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(D,z,B,j,$,H,X){const Y=z.transform,K=$==="map",ue=H==="map";for(const ce of D){const he=j.getTile(ce),ge=he.getBucket(B);if(!ge||!ge.text||!ge.text.segments.get().length)continue;const _e=o.aD(ge.textSizeData,Y.zoom),Se=Wf(ce,ge.getProjection(),Y),ee=Y.calculatePixelsToTileUnitsMatrix(he),fe=Kt(Se,he.tileID.canonical,ue,K,Y,ge.getProjection(),ee),Pe=ge.hasIconTextFit()&&ge.hasIconData();if(_e){const We=Math.pow(2,Y.zoom-he.tileID.overscaledZ);h1(ge,K,ue,X,o.bO,Y,fe,ce,We,_e,Pe)}}}(_,p,c,i,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),x);const I=c.paint.get("icon-opacity").constantOr(1)!==0,O=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(I||O)?qf(p,i,c,_,w,S):(I&&qf(p,i,c,_,w,S,{onlyIcons:!0}),O&&qf(p,i,c,_,w,S,{onlyText:!0}),function(D,z,B,j){if(!D.symbolParams.useOcclusionQueries)return;const $=D.context.gl,H=D.transform,X=B.paint,Y=X.get("icon-occlusion-opacity").constantOr(0),K=X.get("text-occlusion-opacity").constantOr(0);if(!B.hasInitialOcclusionOpacityProperties||Y===1&&K===1)return;const ue=H.projection.name==="globe";for(const ce of j){const he=z.getTile(ce),ge=he.getBucket(B);if(!ge||ge.projection.name==="mercator"&&ue||ge.fullyClipped)continue;if(ge.projection.name==="globe"){o.w(`Occlusion not supported for globe mode. Layer: ${B.type}`);continue}const _e=Wf(ce,ge.getProjection(),H),Se=o.ad.fromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,D.symbolParams.depthOffset,1),ee=o.ad.multiply([],Se,_e),fe=D.symbolParams.visualizeOcclusions!=="none"?1:D.symbolParams.occlusionQueryFrameWindow;for(let Pe=0;Pe<ge.symbolInstances.length;Pe++){const We=ge.symbolInstances.get(Pe),ke=D.style.placement.opacities[We.crossTileID];if(ke&&ke.isHidden()||(D.frameCounter+Pe)%fe!=0)continue;const be=We.tileAnchorX,Xe=We.tileAnchorY,dt=We.zOffset;let pt;if(D.symbolParams.visualizeOcclusions==="none"){const Ct=ge.queries.get(Pe);if(Ct){if(!Ct.isFree()){if(!Ct.isResultAvailable())continue;const Pt=Ct.consumeResult();We.occlusionState=Pt===0?0:1;continue}pt=Ct}else pt=new ts(D.context),ge.queries.set(Pe,pt)}const ft=D.getOrCreateProgram("occlusion"),Fe=D.symbolParams.occluderSize,Ye=u1(ee,[be,Xe,dt],[H.width,H.height],[Fe,Fe],D.symbolParams.visualizeOcclusions==="zPass"?[1,0,0,.8]:[1,.4,.2,.9]);D.terrain&&D.terrain.setupElevationDraw(he,ft,{useDepthForOcclusion:!1,labelPlaneMatrixInv:void 0}),D.symbolParams.visualizeOcclusions==="none"&&pt&&pt.begin();const lt=new o.ae(D.symbolParams.visualizeOcclusions==="zPass"?D.context.gl.ALWAYS:D.context.gl.LEQUAL,o.ae.ReadOnly,D.depthRangeFor3D);ft.draw(D,$.TRIANGLES,lt,o.ag.disabled,D.symbolParams.visualizeOcclusions!=="none"?o.a.alphaBlendedNonPremultiplied:o.a.disabled,o.af.disabled,Ye,"occlusion",D.occlusionBuffers.vx,D.occlusionBuffers.idx,D.occlusionBuffers.segments),D.symbolParams.visualizeOcclusions==="none"&&pt&&pt.end()}}}(p,i,c,_)),i.map.showCollisionBoxes&&(iy(p,i,c,_,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),iy(p,i,c,_,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,i,c,_){if(p.renderPass!=="translucent")return;const x=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),S=c.paint.get("circle-stroke-opacity"),I=c.layout.get("circle-sort-key").constantOr(1)!==void 0,O=c.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(w.constantOr(1)===0||S.constantOr(1)===0))return;const D=p.context,z=D.gl,B=p.transform,j=p.depthModeForSublayer(0,o.ae.ReadOnly),$=o.ag.disabled,H=p.colorModeForDrapableLayerRenderPass(O),X=B.projection.name==="globe",Y=[o.aj(B.center.lng),o.ak(B.center.lat)],K=[];for(let ce=0;ce<_.length;ce++){const he=_[ce],ge=i.getTile(he),_e=ge.getBucket(c);if(!_e||_e.projection.name!==B.projection.name)continue;const Se=_e.programConfigurations.get(c.id),ee=o.bR(c),fe=p.isTileAffectedByFog(he);X&&ee.push("PROJECTION_GLOBE_VIEW"),ee.push("TERRAIN_DEPTH_D24");const Pe=p.getOrCreateProgram("circle",{config:Se,defines:ee,overrideFog:fe}),We=_e.layoutVertexBuffer,ke=_e.globeExtVertexBuffer,be=_e.indexBuffer,Xe=B.projection.createInversionMatrix(B,he.canonical),dt={programConfiguration:Se,program:Pe,layoutVertexBuffer:We,globeExtVertexBuffer:ke,indexBuffer:be,uniformValues:o.bS(p,he,ge,Xe,Y,c),tile:ge};if(I){const pt=_e.segments.get();for(const ft of pt)K.push({segments:new o.b([ft]),sortKey:ft.sortKey,state:dt})}else K.push({segments:_e.segments,sortKey:0,state:dt})}I&&K.sort((ce,he)=>ce.sortKey-he.sortKey);const ue={useDepthForOcclusion:B.depthOcclusionForSymbolsAndCircles};for(const ce of K){const{programConfiguration:he,program:ge,layoutVertexBuffer:_e,globeExtVertexBuffer:Se,indexBuffer:ee,uniformValues:fe,tile:Pe}=ce.state,We=ce.segments;p.terrain&&p.terrain.setupElevationDraw(Pe,ge,ue),p.uploadCommonUniforms(D,ge,Pe.tileID.toUnwrapped()),ge.draw(p,z.TRIANGLES,j,$,H,o.af.disabled,fe,c.id,_e,ee,We,c.paint,B.zoom,he,[Se])}},heatmap:function(p,i,c,_){if(c.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const x=p.context,w=x.gl,S=o.ag.disabled,I=new o.a([w.ONE,w.ONE,w.ONE,w.ONE],o.C.transparent,[!0,!0,!0,!0]);(function($,H,X,Y){const K=$.gl,ue=H.width*Y,ce=H.height*Y;$.activeTexture.set(K.TEXTURE1),$.viewport.set([0,0,ue,ce]);let he=X.heatmapFbo;if(!he||he&&(he.width!==ue||he.height!==ce)){he&&he.destroy();const ge=K.createTexture();K.bindTexture(K.TEXTURE_2D,ge),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),he=X.heatmapFbo=$.createFramebuffer(ue,ce,!0,null),function(_e,Se,ee,fe,Pe,We){const ke=_e.gl;ke.texImage2D(ke.TEXTURE_2D,0,_e.extRenderToTextureHalfFloat?ke.RGBA16F:ke.RGBA,Pe,We,0,ke.RGBA,_e.extRenderToTextureHalfFloat?ke.HALF_FLOAT:ke.UNSIGNED_BYTE,null),fe.colorAttachment.set(ee)}($,0,ge,he,ue,ce)}else K.bindTexture(K.TEXTURE_2D,he.colorAttachment.get()),$.bindFramebuffer.set(he.framebuffer)})(x,p,c,p.transform.projection.name==="globe"?.5:.25),x.clear({color:o.C.transparent});const O=p.transform,D=O.projection.name==="globe",z=D?["PROJECTION_GLOBE_VIEW"]:[],B=D?o.af.frontCCW:o.af.disabled,j=[o.aj(O.center.lng),o.ak(O.center.lat)];for(let $=0;$<_.length;$++){const H=_[$];if(i.hasRenderableParent(H))continue;const X=i.getTile(H),Y=X.getBucket(c);if(!Y||Y.projection.name!==O.projection.name)continue;const K=p.isTileAffectedByFog(H),ue=Y.programConfigurations.get(c.id),ce=p.getOrCreateProgram("heatmap",{config:ue,defines:z,overrideFog:K}),{zoom:he}=p.transform;p.terrain&&p.terrain.setupElevationDraw(X,ce),p.uploadCommonUniforms(x,ce,H.toUnwrapped());const ge=O.projection.createInversionMatrix(O,H.canonical);ce.draw(p,w.TRIANGLES,o.ae.disabled,S,I,B,mh(p,H,X,ge,j,he,c.paint.get("heatmap-intensity")),c.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,c.paint,p.transform.zoom,ue,D?[Y.globeExtVertexBuffer]:null)}x.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(x,w){const S=x.context,I=S.gl,O=w.heatmapFbo;if(!O)return;S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,O.colorAttachment.get()),S.activeTexture.set(I.TEXTURE1);let D=w.colorRampTexture;D||(D=w.colorRampTexture=new o.T(S,w.colorRamp,I.RGBA)),D.bind(I.LINEAR,I.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,I.TRIANGLES,o.ae.disabled,o.ag.disabled,x.colorModeForRenderPass(),o.af.disabled,((z,B,j,$)=>({u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}))(0,w),w.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,w.paint,x.transform.zoom)}(p,c))},line:function(p,i,c,_){if(p.renderPass!=="translucent")return;const x=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(x.constantOr(1)===0||w.constantOr(1)===0)return;const S=c.paint.get("line-emissive-strength"),I=c.paint.get("line-occlusion-opacity"),O=p.context,D=O.gl,z=c.layout.get("line-z-offset"),B=!z.isConstant()||!!z.constantOr(0),j=B?new o.ae(p.depthOcclusion?D.GREATER:D.LEQUAL,o.ae.ReadOnly,p.depthRangeFor3D):p.depthModeForSublayer(0,o.ae.ReadOnly),$=p.colorModeForDrapableLayerRenderPass(S),H=p.terrain&&p.terrain.renderingToTexture,X=H?1:o.e.devicePixelRatio,Y=c.paint.get("line-dasharray"),K=Y.constantOr(1),ue=c.layout.get("line-cap"),ce=Y.constantOr(null),he=ue.constantOr(null),ge=c.paint.get("line-pattern"),_e=ge.constantOr(1),Se=ge.constantOr(null),ee=c.paint.get("line-opacity").constantOr(1);let fe=!_e&&ee!==1||p.depthOcclusion&&I>0&&I<1;const Pe=c.paint.get("line-gradient"),We=_e?"linePattern":"line",ke=o.bT(c);let be;if(H&&p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(fe=!1),I!==0&&p.depthOcclusion){const dt=c.paint._values["line-opacity"];dt&&dt.value&&dt.value.kind==="constant"?be=dt.value:o.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}if(B&&(p.forceTerrainMode=!0),!B&&I!==0&&p.terrain&&!H)return void o.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const Xe=fe&&B?p.stencilModeFor3D():o.ag.disabled;for(const dt of _){const pt=i.getTile(dt);if(_e&&!pt.patternsLoaded())continue;const ft=pt.getBucket(c);if(!ft)continue;p.prepareDrawTile();const Fe=ft.programConfigurations.get(c.id),Ye=p.isTileAffectedByFog(dt),lt=p.getOrCreateProgram(We,{config:Fe,defines:B?[...ke,"ELEVATED"]:ke,overrideFog:Ye});if(Se&&pt.imageAtlas){const it=pt.imageAtlas.patternPositions[Se.toString()];it&&Fe.setConstantPatternPositions(it)}if(!_e&&ce&&he&&pt.lineAtlas){const it=pt.lineAtlas.getDash(ce,he);it&&Fe.setConstantPatternPositions(it)}let[Ct,Pt]=c.paint.get("line-trim-offset");(he==="round"||he==="square")&&Ct!==Pt&&(Ct===0&&(Ct-=1),Pt===1&&(Pt+=1));const Lt=H?dt.projMatrix:null,Ot=_e?o.bU(p,pt,c,Lt,X,[Ct,Pt]):o.bV(p,pt,c,Lt,ft.lineClipsArray.length,X,[Ct,Pt]);if(Pe){const it=ft.gradients[c.id];let jt=it.texture;if(c.gradientVersion!==it.version){let Er=256;if(c.stepInterpolant){const lr=i.getSource().maxzoom,yr=dt.canonical.z===lr?Math.ceil(1<<p.transform.maxZoom-dt.canonical.z):1;Er=o.at(o.bW(ft.maxLineLength/o.a3*1024*yr),256,O.maxTextureSize)}it.gradient=o.bX({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Er,image:it.gradient||void 0,clips:ft.lineClipsArray}),it.texture?it.texture.update(it.gradient):it.texture=new o.T(O,it.gradient,D.RGBA),it.version=c.gradientVersion,jt=it.texture}O.activeTexture.set(D.TEXTURE1),jt.bind(c.stepInterpolant?D.NEAREST:D.LINEAR,D.CLAMP_TO_EDGE)}K&&(O.activeTexture.set(D.TEXTURE0),pt.lineAtlasTexture&&pt.lineAtlasTexture.bind(D.LINEAR,D.REPEAT),Fe.updatePaintBuffers()),_e&&(O.activeTexture.set(D.TEXTURE0),pt.imageAtlasTexture&&pt.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Fe.updatePaintBuffers()),B&&p.terrain.setupElevationDraw(pt,lt),p.uploadCommonUniforms(O,lt,dt.toUnwrapped());const It=it=>{be!=null&&(be.value=ee*I),lt.draw(p,D.TRIANGLES,j,it,$,o.af.disabled,Ot,c.id,ft.layoutVertexBuffer,ft.indexBuffer,ft.segments,c.paint,p.transform.zoom,Fe,[ft.layoutVertexBuffer2,ft.patternVertexBuffer,ft.zOffsetVertexBuffer]),be!=null&&(be.value=ee)};if(fe&&!B){const it=p.stencilModeForClipping(dt).ref;it===0&&H&&O.clear({stencil:0});const jt={func:D.EQUAL,mask:255};Ot.u_alpha_discard_threshold=.8,It(new o.ag(jt,it,255,D.KEEP,D.KEEP,D.INVERT)),Ot.u_alpha_discard_threshold=0,It(new o.ag(jt,it,255,D.KEEP,D.KEEP,D.KEEP))}else fe&&B&&(Ot.u_alpha_discard_threshold=.001),It(B?Xe:p.stencilModeForClipping(dt))}fe&&(p.resetStencilClippingMasks(),H&&O.clear({stencil:0})),I===0||p.depthOcclusion||H||p.layersWithOcclusionOpacity.push(p.currentLayer),B&&(p.forceTerrainMode=!1)},fill:function(p,i,c,_){const x=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const S=c.paint.get("fill-emissive-strength"),I=p.colorModeForDrapableLayerRenderPass(S),O=c.paint.get("fill-pattern"),D=p.opaquePassEnabledForLayer()&&!O.constantOr(1)&&x.constantOr(o.C.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===D){const z=p.depthModeForSublayer(1,p.renderPass==="opaque"?o.ae.ReadWrite:o.ae.ReadOnly);yh(p,i,c,_,z,I,!1)}if(p.renderPass==="translucent"&&c.paint.get("fill-antialias")){const z=p.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,o.ae.ReadOnly);yh(p,i,c,_,z,I,!0)}},"fill-extrusion":function(p,i,c,_){const x=c.paint.get("fill-extrusion-opacity"),w=p.context,S=w.gl,I=p.terrain,O=I&&I.renderingToTexture;if(x===0)return;const D=p.conflationActive&&p.style.isLayerClipped(c,i.getSource()),z=p.style.order.indexOf(c.fqid);if(D&&function(B,j,$,H,X){for(const Y of H){const K=j.getTile(Y).getBucket($);K&&(K.updateReplacement(Y,B.replacementSource,X),K.uploadCentroid(B.context))}}(p,i,c,_,z),I||D)for(const B of _){const j=i.getTile(B).getBucket(c);j&&oy(p.context,i,B,j,c,I,D)}if(p.renderPass==="shadow"&&p.shadowRenderer){const B=p.shadowRenderer;if(I&&x<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.Z)return;const j=B.getShadowPassDepthMode(),$=B.getShadowPassColorMode();$o(p,i,c,_,j,o.ag.disabled,$,D)}else if(p.renderPass==="translucent"){const B=!c.paint.get("fill-extrusion-pattern").constantOr(1),j=c.paint.get("fill-extrusion-color").constantOr(o.C.white);if(!O&&j.a!==0){const $=new o.ae(p.context.gl.LEQUAL,o.ae.ReadWrite,p.depthRangeFor3D);x===1&&B?$o(p,i,c,_,$,o.ag.disabled,o.a.unblended,D):($o(p,i,c,_,$,o.ag.disabled,o.a.disabled,D),$o(p,i,c,_,$,p.stencilModeFor3D(),p.colorModeForRenderPass(),D),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&B&&(!I&&p.transform.projection.name!=="globe"||O)){const $=c.paint.get("fill-extrusion-opacity"),H=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),X=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Y=c.paint.get("fill-extrusion-flood-light-intensity"),K=c.paint.get("fill-extrusion-flood-light-color").toRenderColor(c.lut).toArray01().slice(0,3),ue=H>0&&X>0,ce=Y>0,he=(_e,Se,ee)=>(1-ee)*_e+ee*Se,ge=_e=>{const Se=p.depthModeForSublayer(1,o.ae.ReadOnly,S.LEQUAL,!0),ee=c.paint.get(_e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),fe=he(.1,3,ee),Pe=p._showOverdrawInspector;if(!Pe){const We=new o.ag({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),ke=new o.a([S.ONE,S.ONE,S.ONE,S.ONE],o.C.transparent,[!1,!1,!1,!0],S.MIN);Na(p,i,c,_,Se,We,ke,o.af.disabled,_e,"sdf",$,H,X,Y,K,fe,D,!1)}{const We=Pe?o.ag.disabled:new o.ag({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),ke=Pe?p.colorModeForRenderPass():new o.a([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],o.C.transparent,[!0,!0,!0,!0]);Na(p,i,c,_,Se,We,ke,o.af.disabled,_e,"color",$,H,X,Y,K,fe,D,!1)}};if(O){const _e=(Se,ee,fe)=>{const Pe=p.depthModeForSublayer(1,o.ae.ReadOnly,S.LEQUAL,!1),We=c.paint.get(Se?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ke=he(.1,3,We);{const be=new o.a([S.ONE,S.ONE,S.ONE,S.ONE],o.C.transparent,[!1,!1,!1,!0]);Na(p,i,c,_,Pe,o.ag.disabled,be,o.af.disabled,Se,"clear",$,H,X,Y,K,ke,D,ee)}{const be=new o.ag({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Xe=new o.a([S.ONE,S.ONE,S.ONE,S.ONE],o.C.transparent,[!1,!1,!1,!0],S.MIN);Na(p,i,c,_,Pe,be,Xe,o.af.disabled,Se,"sdf",$,H,X,Y,K,ke,D,ee)}{const be=Se?S.ZERO:S.ONE_MINUS_DST_ALPHA,Xe=new o.ag({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),dt=new o.a([be,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],o.C.transparent,[!0,!0,!0,!0]);Na(p,i,c,_,Pe,Xe,dt,o.af.disabled,Se,"color",$,H,X,Y,K,ke,D,ee)}{const be=new o.a([S.ONE,S.ONE,S.ONE,Se?S.ZERO:S.ONE],o.C.transparent,[!1,!1,!1,!0],Se?S.FUNC_ADD:S.MAX);Na(p,i,c,_,Pe,o.ag.disabled,be,o.af.disabled,Se,"clear",$,H,X,Y,K,ke,D,ee,fe)}};if(ue||ce){let Se;if(p.prepareDrawTile(),I){const ee=I.drapeBufferSize[0],fe=I.drapeBufferSize[1];Se=I.framebufferCopyTexture,Se&&(!Se||Se.size[0]===ee&&Se.size[1]===fe)||(Se&&Se.destroy(),Se=I.framebufferCopyTexture=new o.T(w,new o.i({width:ee,height:fe}),S.RGBA)),Se.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexImage2D(S.TEXTURE_2D,0,S.RGBA,0,0,ee,fe,0)}ue&&_e(!0,!1,Se),ce&&_e(!1,!0,Se)}}else ue&&ge(!0),ce&&ge(!1)}}},hillshade:function(p,i,c,_){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;const x=p.context,w=p.terrain&&p.terrain.renderingToTexture,[S,I]=p.renderPass!=="translucent"||w?[{},_]:p.stencilConfigForOverlap(_);for(const O of I){const D=i.getTile(O);if(D.needsHillshadePrepare&&p.renderPass==="offscreen")co(p,D,c);else if(p.renderPass==="translucent"){const z=p.depthModeForSublayer(0,o.ae.ReadOnly),B=c.paint.get("hillshade-emissive-strength"),j=p.colorModeForDrapableLayerRenderPass(B),$=w&&p.terrain?p.terrain.stencilModeForRTTOverlap(O):S[O.overscaledZ];bo(p,O,D,c,z,$,j)}}x.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,i,c,_,x,w){if(p.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const S=p.transform.projection.name==="globe",I=c.paint.get("raster-elevation")!==0,O=I&&S;if(p.renderElevatedRasterBackface&&!O)return;const D=p.context,z=D.gl,B=i.getSource(),j=function(_e,Se,ee,fe){const Pe=Se.paint.get("raster-color"),We=_e.type==="raster-array",ke=[],be=Se.paint.get("raster-resampling"),Xe=Se.paint.get("raster-color-mix");let dt=Se.paint.get("raster-color-range");const pt=[Xe[0],Xe[1],Xe[2],0],ft=Xe[3];let Fe=be==="nearest"?fe.NEAREST:fe.LINEAR;if(We&&(ke.push("RASTER_ARRAY"),Pe||ke.push("RASTER_COLOR"),be==="linear"&&ke.push("RASTER_ARRAY_LINEAR"),Fe=fe.NEAREST,!dt&&_e.rasterLayers)){const Ye=_e.rasterLayers.find(({id:lt})=>lt===Se.sourceLayer);Ye&&Ye.fields&&Ye.fields.range&&(dt=Ye.fields.range)}if(dt=dt||[0,1],Pe){ke.push("RASTER_COLOR"),ee.activeTexture.set(fe.TEXTURE2),Se.updateColorRamp(dt);let Ye=Se.colorRampTexture;Ye||(Ye=Se.colorRampTexture=new o.T(ee,Se.colorRamp,fe.RGBA)),Ye.bind(fe.LINEAR,fe.CLAMP_TO_EDGE)}return{mix:pt,range:dt,offset:ft,defines:ke,resampling:Fe}}(B,c,D,z);if(B instanceof o.bm&&!_.length&&!S)return;const $=c.paint.get("raster-emissive-strength"),H=p.colorModeForDrapableLayerRenderPass($),X=p.terrain&&p.terrain.renderingToTexture,Y=!p.options.moving,K=c.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;if(B instanceof o.bm&&!_.length&&(B.onNorthPole||B.onSouthPole)){const _e=I?p.stencilModeFor3D():o.ag.disabled;return void $u(!!B.onNorthPole,null,p,i,c,$,j,o.af.disabled,_e)}if(!_.length)return;const[ue,ce]=B instanceof o.bm||X?[{},_]:p.stencilConfigForOverlap(_),he=ce[ce.length-1].overscaledZ;O&&j.defines.push("PROJECTION_GLOBE_VIEW"),I&&j.defines.push("RENDER_CUTOFF");const ge=(_e,Se,ee)=>{for(const fe of _e){const Pe=fe.toUnwrapped(),We=i.getTile(fe);if(X&&(!We||!We.hasData()))continue;D.activeTexture.set(z.TEXTURE0);const ke=Gr(We,B,c,j);if(!ke||!ke.texture)continue;const{texture:be,mix:Xe,offset:dt,tileSize:pt,buffer:ft}=ke;let Fe,Ye;X?(Fe=o.ae.disabled,Ye=fe.projMatrix):I?(Fe=new o.ae(z.LEQUAL,o.ae.ReadWrite,p.depthRangeFor3D),Ye=S?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(Pe,Y)):(Fe=p.depthModeForSublayer(fe.overscaledZ-he,c.paint.get("raster-opacity")===1?o.ae.ReadWrite:o.ae.ReadOnly,z.LESS),Ye=p.transform.calculateProjMatrix(Pe,Y));const lt=p.terrain&&X?p.terrain.stencilModeForRTTOverlap(fe):ue[fe.overscaledZ],Ct=w?0:c.paint.get("raster-fade-duration");We.registerFadeDuration(Ct);const Pt=i.findLoadedParent(fe,0),Lt=zf(We,Pt,i,p.transform,Ct);let Ot,It;p.terrain&&p.terrain.prepareDrawTile(),D.activeTexture.set(z.TEXTURE0),be.bind(K,z.CLAMP_TO_EDGE),D.activeTexture.set(z.TEXTURE1),Pt?(Pt.texture&&Pt.texture.bind(K,z.CLAMP_TO_EDGE),Ot=Math.pow(2,Pt.tileID.overscaledZ-We.tileID.overscaledZ),It=[We.tileID.canonical.x*Ot%1,We.tileID.canonical.y*Ot%1]):be.bind(K,z.CLAMP_TO_EDGE),be.useMipmap&&D.extTextureFilterAnisotropic&&p.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const it=p.transform;let jt;const Er=I?om(it):[0,0,0,0];let lr,yr,Rr,yn,Pr,pr=0;if(O&&B instanceof o.bm&&B.coordinates.length>3)lr=Float32Array.from(o.bf(o.bg(new o.aO(0,0,0)))),yr=Float32Array.from(it.globeMatrix),Rr=Float32Array.from(o.bb(it)),yn=[o.aj(it.center.lng),o.ak(it.center.lat)],jt=B.elevatedGlobePerspectiveTransform,Pr=B.elevatedGlobeGridMatrix||new Float32Array(9);else if(O){const xr=o.bc(fe.canonical);pr=o.bd(xr.getCenter().lat),lr=Float32Array.from(o.bf(o.bg(fe.canonical))),yr=Float32Array.from(it.globeMatrix),Rr=Float32Array.from(o.bb(it)),yn=[o.aj(it.center.lng),o.ak(it.center.lat)],jt=[0,0],Pr=Float32Array.from(o.be(fe.canonical,xr,pr,it.worldSize/it._pixelsPerMercatorPixel))}else jt=B instanceof o.bm?B.perspectiveTransform:[0,0],lr=new Float32Array(16),yr=new Float32Array(9),Rr=new Float32Array(16),yn=[0,0],Pr=new Float32Array(9);const sn=Kp(Ye,lr,yr,Rr,Pr,It||[0,0],o.a1(p.transform.zoom),yn,Er,Ot||1,Lt,c,jt,I?c.paint.get("raster-elevation"):0,2,Xe,dt,j.range,pt,ft,$),Jr=p.isTileAffectedByFog(fe),kr=p.getOrCreateProgram("raster",{defines:j.defines,overrideFog:Jr});if(p.uploadCommonUniforms(D,kr,Pe),B instanceof o.bm){const xr=B.elevatedGlobeVertexBuffer,dn=B.elevatedGlobeIndexBuffer;if(X||!S)B.boundsBuffer&&B.boundsSegments&&kr.draw(p,z.TRIANGLES,Fe,o.ag.disabled,H,o.af.disabled,sn,c.id,B.boundsBuffer,p.quadTriangleIndexBuffer,B.boundsSegments);else if(xr&&dn){const Rn=it.zoom<=o.b1?B.elevatedGlobeSegments:B.getSegmentsForLongitude(it.center.lng);Rn&&kr.draw(p,z.TRIANGLES,Fe,o.ag.disabled,H,Se,sn,c.id,xr,dn,Rn)}}else if(O){Fe=new o.ae(z.LEQUAL,o.ae.ReadOnly,p.depthRangeFor3D);const xr=p.globeSharedBuffers;if(xr){const[dn,Rn,en]=xr.getGridBuffers(pr,!1);kr.draw(p,z.TRIANGLES,Fe,ee||lt,p.colorModeForRenderPass(),Se,sn,c.id,dn,Rn,en)}}else{const{tileBoundsBuffer:xr,tileBoundsIndexBuffer:dn,tileBoundsSegments:Rn}=p.getTileBoundsBuffers(We);kr.draw(p,z.TRIANGLES,Fe,lt,H,o.af.disabled,sn,c.id,xr,dn,Rn)}}if(!(B instanceof o.bm)&&O)for(const fe of _e){const Pe=fe.canonical.y===(1<<fe.canonical.z)-1;fe.canonical.y===0&&$u(!0,fe,p,i,c,$,j,Se,ee||o.ag.disabled),Pe&&$u(!1,fe,p,i,c,$,j,Se===o.af.frontCW?o.af.backCW:o.af.frontCW,ee||o.ag.disabled)}};O?ge(ce,p.renderElevatedRasterBackface?o.af.backCW:o.af.frontCW,p.stencilModeFor3D()):ge(ce,o.af.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,i,c,_,x,w){p.renderPass==="offscreen"&&function(S,I,O,D){if(!D.length)return;const z=S.context,B=z.gl,j=I.getSource();if(!(j instanceof Uu))return;const $=Math.ceil(Math.sqrt(O.paint.get("raster-particle-count")));let H=O.particlePositionRGBAImage;if(!H||H.width!==$){const ce=function(he){const ge=he*he,_e=new Uint8Array(4*ge),Se=function(fe){return fe|=0,fe=Math.imul(2747636419^fe,2654435769),fe=Math.imul(fe^fe>>>16,2654435769),((fe=Math.imul(fe^fe>>>16,2654435769))>>>0)/4294967296},ee=1/1.1;for(let fe=0;fe<ge;fe++){const Pe=ee*(Se(2*fe+0)+ua),We=ee*(Se(2*fe+1)+ua),ke=255*Pe%1,be=255*We%1,Xe=ke,dt=We-be/255,pt=be;_e[4*fe+0]=255*(Pe-ke/255),_e[4*fe+1]=255*Xe,_e[4*fe+2]=255*dt,_e[4*fe+3]=255*pt}return _e}($);H=O.particlePositionRGBAImage=new o.i({width:$,height:$},ce)}let X=O.particleFramebuffer;X?X.width!==$&&(X.destroy(),X=O.particleFramebuffer=z.createFramebuffer($,$,!0,null)):X=O.particleFramebuffer=z.createFramebuffer($,$,!0,null);const Y=[];for(const ce of D){const he=I.getTile(ce);if(!(he instanceof o.c3))continue;const ge=f1(he,j,O);if(!ge)continue;const _e=[he.tileSize,he.tileSize];let Se=O.tileFramebuffer;Se||(Se=O.tileFramebuffer=z.createFramebuffer(_e[0],_e[1],!0,null));let ee=he.rasterParticleState;ee||(ee=he.rasterParticleState=new Dn(z,ce,_e,H));const fe=ee.update(O.lastInvalidatedAt);ee.particleTextureDimension!==$&&ee.updateParticleTexture(ce,H);const Pe=ee.targetColorTexture;ee.targetColorTexture=ee.backgroundColorTexture,ee.backgroundColorTexture=Pe;const We=ee.particleTexture0;ee.particleTexture0=ee.particleTexture1,ee.particleTexture1=We,Y.push([ce,ge,ee,fe])}if(Y.length===0)return;const K=o.e.now(),ue=O.previousDrawTimestamp?.001*(K-O.previousDrawTimestamp):.0167;if(O.previousDrawTimestamp=K,O.hasColorMap()){z.activeTexture.set(B.TEXTURE0+2);let ce=O.colorRampTexture;ce||(ce=O.colorRampTexture=new o.T(z,O.colorRamp,B.RGBA)),ce.bind(B.LINEAR,B.CLAMP_TO_EDGE)}z.bindFramebuffer.set(O.tileFramebuffer.framebuffer),function(ce,he,ge){const _e=ce.context,Se=_e.gl,ee=he.tileFramebuffer;_e.activeTexture.set(Se.TEXTURE0);const fe={u_texture:0,u_opacity:1.05*(We=he.paint.get("raster-particle-fade-opacity-factor"))/(We+.05)},Pe=ce.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var We;for(const ke of ge){const[,,be,Xe]=ke;ee.colorAttachment.set(be.targetColorTexture.texture),_e.viewport.set([0,0,ee.width,ee.height]),_e.clear({color:o.C.transparent}),Xe&&(be.backgroundColorTexture.bind(Se.NEAREST,Se.CLAMP_TO_EDGE),Pe.draw(ce,Se.TRIANGLES,o.ae.disabled,o.ag.disabled,o.a.alphaBlended,o.af.disabled,fe,he.id,ce.viewportBuffer,ce.quadTriangleIndexBuffer,ce.viewportSegments))}}(S,O,Y),function(ce,he,ge,_e){const Se=ce.context,ee=Se.gl,fe=ge.tileFramebuffer,Pe=ce.transform.projection.name==="globe",We=ge.paint.get("raster-particle-max-speed");for(const ke of _e){const[be,Xe,dt]=ke;Se.activeTexture.set(ee.TEXTURE0+0),Xe.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),fe.colorAttachment.set(dt.targetColorTexture.texture);const pt=ce.getOrCreateProgram("rasterParticleDraw",{defines:Xe.defines,overrideFog:!1});Se.activeTexture.set(ee.TEXTURE0+1);const ft=Xe.scalarData?[]:[0,1,2,3].map(lt=>o.bZ[lt](be));ft.push(be);const Fe=be.canonical.x,Ye=be.canonical.y;for(const lt of ft){const Ct=he.getTile(Pe?lt.wrapped():lt);if(!Ct)continue;const Pt=Ct.rasterParticleState;if(!Pt)continue;const Lt=lt.canonical.x+(1<<lt.canonical.z)*(lt.wrap-be.wrap),Ot=lt.canonical.y;Pt.particleTexture0.bind(ee.NEAREST,ee.CLAMP_TO_EDGE);const It=Jp(1,Pt.particleTexture0.size[0],[Lt-Fe,Ot-Ye],0,Xe.texture.size,2,We,Xe.textureOffset,Xe.scale,Xe.offset);pt.draw(ce,ee.POINTS,o.ae.disabled,o.ag.disabled,o.a.alphaBlended,o.af.disabled,It,ge.id,Pt.particleIndexBuffer,void 0,Pt.particleSegment)}}}(S,I,O,Y),z.bindFramebuffer.set(O.particleFramebuffer.framebuffer),function(ce,he,ge,_e){const Se=ce.context,ee=Se.gl,fe=he.paint.get("raster-particle-max-speed"),Pe=_e*he.paint.get("raster-particle-speed-factor")*.15,We=function(be){return Math.pow(be,6)}(.01+1*he.paint.get("raster-particle-reset-rate-factor")),ke=he.particleFramebuffer;Se.viewport.set([0,0,ke.width,ke.height]);for(const be of ge){const[,Xe,dt]=be;Se.activeTexture.set(ee.TEXTURE0+0),Xe.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),Se.activeTexture.set(ee.TEXTURE0+1);const pt=dt.particleTexture0;pt.bind(ee.NEAREST,ee.CLAMP_TO_EDGE);const ft=em(1,pt.size[0],0,Xe.texture.size,fe,Pe,We,Xe.textureOffset,Xe.scale,Xe.offset);ke.colorAttachment.set(dt.particleTexture1.texture),Se.clear({color:o.C.transparent}),ce.getOrCreateProgram("rasterParticleUpdate",{defines:Xe.defines}).draw(ce,ee.TRIANGLES,o.ae.disabled,o.ag.disabled,o.a.unblended,o.af.disabled,ft,he.id,ce.viewportBuffer,ce.quadTriangleIndexBuffer,ce.viewportSegments)}}(S,O,Y,ue)}(p,i,c,_),p.renderPass==="translucent"&&(function(S,I,O,D,z){const B=S.context,j=B.gl,$=!S.options.moving,H=S.transform.projection.name==="globe";if(!D.length)return;const[X,Y]=S.stencilConfigForOverlap(D),K=[];H&&K.push("PROJECTION_GLOBE_VIEW");const ue=S.stencilModeFor3D();for(const ce of Y){const he=ce.toUnwrapped(),ge=I.getTile(ce);if(!ge.rasterParticleState)continue;const _e=ge.rasterParticleState,Se=100;ge.registerFadeDuration(Se);const ee=I.findLoadedParent(ce,0),fe=zf(ge,ee,I,S.transform,Se);let Pe,We;S.terrain&&S.terrain.prepareDrawTile(),B.activeTexture.set(j.TEXTURE0),_e.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),B.activeTexture.set(j.TEXTURE1),ee&&ee.rasterParticleState?(ee.rasterParticleState.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Pe=Math.pow(2,ee.tileID.overscaledZ-ge.tileID.overscaledZ),We=[ge.tileID.canonical.x*Pe%1,ge.tileID.canonical.y*Pe%1]):_e.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const ke=H?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(he,$),be=S.transform,Xe=nr(be),dt=o.bc(ce.canonical),pt=o.bd(dt.getCenter().lat);let ft,Fe,Ye,lt,Ct;H?(ft=Float32Array.from(o.bf(o.bg(ce.canonical))),Fe=Float32Array.from(be.globeMatrix),Ye=Float32Array.from(o.bb(be)),lt=[o.aj(be.center.lng),o.ak(be.center.lat)],Ct=Float32Array.from(o.be(ce.canonical,dt,pt,be.worldSize/be._pixelsPerMercatorPixel))):(ft=new Float32Array(16),Fe=new Float32Array(9),Ye=new Float32Array(16),lt=[0,0],Ct=new Float32Array(9));const Pt=Qp(ke,ft,Fe,Ye,Ct,We||[0,0],o.a1(S.transform.zoom),lt,Xe,Pe||1,fe,250),Lt=S.isTileAffectedByFog(ce),Ot=S.getOrCreateProgram("rasterParticle",{defines:K,overrideFog:Lt});if(S.uploadCommonUniforms(B,Ot,he),H){const It=new o.ae(j.LEQUAL,o.ae.ReadWrite,S.depthRangeFor3D),it=0,jt=S.globeSharedBuffers;if(jt){const[Er,lr,yr]=jt.getGridBuffers(pt,it!==0);Ot.draw(S,j.TRIANGLES,It,ue,o.a.alphaBlended,o.af.backCCW,Pt,O.id,Er,lr,yr)}}else{const It=S.depthModeForSublayer(0,o.ae.ReadOnly),it=X[ce.overscaledZ],{tileBoundsBuffer:jt,tileBoundsIndexBuffer:Er,tileBoundsSegments:lr}=S.getTileBoundsBuffers(ge);Ot.draw(S,j.TRIANGLES,It,it,o.a.alphaBlended,o.af.disabled,Pt,O.id,jt,Er,lr)}}S.resetStencilClippingMasks()}(p,i,c,_),p.style.map.triggerRepaint())},background:function(p,i,c,_){const x=c.paint.get("background-color"),w=c.paint.get("background-opacity"),S=c.paint.get("background-emissive-strength");if(w===0)return;const I=p.context,O=I.gl,D=p.transform,z=D.tileSize,B=c.paint.get("background-pattern");let j;if(B!==void 0&&(B===null||(j=p.imageManager.getPattern(B.toString(),c.scope,p.style.getLut(c.scope)),!j)))return;const $=!B&&x.a===1&&w===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==$)return;const H=o.ag.disabled,X=p.depthModeForSublayer(0,$==="opaque"?o.ae.ReadWrite:o.ae.ReadOnly),Y=p.colorModeForDrapableLayerRenderPass(S),K=B?"backgroundPattern":"background";let ue,ce=_;ce||(ue=p.getBackgroundTiles(),ce=Object.values(ue).map(he=>he.tileID)),B&&(I.activeTexture.set(O.TEXTURE0),p.imageManager.bind(p.context,c.scope));for(const he of ce){const ge=p.isTileAffectedByFog(he),_e=p.getOrCreateProgram(K,{overrideFog:ge}),Se=he.toUnwrapped(),ee=_?he.projMatrix:p.transform.calculateProjMatrix(Se);p.prepareDrawTile();const fe=i?i.getTile(he):ue?ue[he.key]:new o.by(he,z,D.zoom,p),Pe=B?_h(ee,S,w,p,0,c.scope,j,{tileID:he,tileSize:z}):ty(ee,S,w,x.toRenderColor(c.lut));p.uploadCommonUniforms(I,_e,Se);const{tileBoundsBuffer:We,tileBoundsIndexBuffer:ke,tileBoundsSegments:be}=p.getTileBoundsBuffers(fe);_e.draw(p,O.TRIANGLES,X,H,Y,o.af.disabled,Pe,c.id,We,ke,be)}},sky:function(p,i,c){const _=p._atmosphere?o.a1(p.transform.zoom):1,x=c.paint.get("sky-opacity")*_;if(x===0)return;const w=p.context,S=c.paint.get("sky-type"),I=new o.ae(w.gl.LEQUAL,o.ae.ReadOnly,[0,1]),O=p.frameCounter/1e3%1;S==="atmosphere"?p.renderPass==="offscreen"?c.needsSkyboxCapture(p)&&(function(D,z,B,j){const $=D.context,H=$.gl;let X=z.skyboxFbo;if(!X){X=z.skyboxFbo=$.createFramebuffer(32,32,!0,null),z.skyboxGeometry=new vh($),z.skyboxTexture=$.gl.createTexture(),H.bindTexture(H.TEXTURE_CUBE_MAP,z.skyboxTexture),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR);for(let ce=0;ce<6;++ce)H.texImage2D(H.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,H.RGBA,32,32,0,H.RGBA,H.UNSIGNED_BYTE,null)}$.bindFramebuffer.set(X.framebuffer),$.viewport.set([0,0,32,32]);const Y=z.getCenter(D,!0),K=D.getOrCreateProgram("skyboxCapture"),ue=new Float64Array(16);o.ad.identity(ue),o.ad.rotateY(ue,ue,.5*-Math.PI),ha(D,z,K,ue,Y,0),o.ad.identity(ue),o.ad.rotateY(ue,ue,.5*Math.PI),ha(D,z,K,ue,Y,1),o.ad.identity(ue),o.ad.rotateX(ue,ue,.5*-Math.PI),ha(D,z,K,ue,Y,2),o.ad.identity(ue),o.ad.rotateX(ue,ue,.5*Math.PI),ha(D,z,K,ue,Y,3),o.ad.identity(ue),ha(D,z,K,ue,Y,4),o.ad.identity(ue),o.ad.rotateY(ue,ue,Math.PI),ha(D,z,K,ue,Y,5),$.viewport.set([0,0,D.width,D.height])}(p,c),c.markSkyboxValid(p)):p.renderPass==="sky"&&function(D,z,B,j,$){const H=D.context,X=H.gl,Y=D.transform,K=D.getOrCreateProgram("skybox");H.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_CUBE_MAP,z.skyboxTexture);const ue=((ce,he,ge,_e,Se)=>({u_matrix:ce,u_sun_direction:he,u_cubemap:0,u_opacity:_e,u_temporal_offset:Se}))(Y.skyboxMatrix,z.getCenter(D,!1),0,j,$);D.uploadCommonUniforms(H,K),K.draw(D,X.TRIANGLES,B,o.ag.disabled,D.colorModeForRenderPass(),o.af.backCW,ue,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(p,c,I,x,O):S==="gradient"&&p.renderPass==="sky"&&function(D,z,B,j,$){const H=D.context,X=H.gl,Y=D.transform,K=D.getOrCreateProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new vh(H)),H.activeTexture.set(X.TEXTURE0);let ue=z.colorRampTexture;ue||(ue=z.colorRampTexture=new o.T(H,z.colorRamp,X.RGBA)),ue.bind(X.LINEAR,X.CLAMP_TO_EDGE);const ce=((he,ge,_e,Se,ee)=>({u_matrix:he,u_color_ramp:0,u_center_direction:ge,u_radius:o.ab(_e),u_opacity:Se,u_temporal_offset:ee}))(Y.skyboxMatrix,z.getCenter(D,!1),z.paint.get("sky-gradient-radius"),j,$);D.uploadCommonUniforms(H,K),K.draw(D,X.TRIANGLES,B,o.ag.disabled,D.colorModeForRenderPass(),o.af.backCW,ce,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(p,c,I,x,O)},debug:function(p,i,c,_,x,w){for(let S=0;S<c.length;S++)if(x){const D=new o.C(_.r*.8,_.g*.8,_.b*.8,1);Ls(p,i,c[S],_,-1,-1,w),Ls(p,i,c[S],_,-1,1,w),Ls(p,i,c[S],_,1,1,w),Ls(p,i,c[S],_,1,-1,w),Ls(p,i,c[S],D,0,0,w)}else Ls(p,i,c[S],_,0,0,w)},custom:function(p,i,c,_){const x=p.context,w=c.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&c.isDraped(i)){if(p.renderPass==="offscreen"){const S=w.prerender;if(S){if(p.setCustomLayerDefaults(),x.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){const I=p.transform.pointMerc;S.call(w,x.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),o.a1(p.transform.zoom),[I.x,I.y],p.transform.pixelsPerMeterRatio)}else S.call(w,x.gl,p.transform.customLayerMatrix());x.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){const I=w.renderToTile;if(I){const O=_[0].canonical,D=new o.Y(O.x+_[0].wrap*(1<<O.z),O.y,O.z);x.setDepthMode(o.ae.disabled),x.setStencilMode(o.ag.disabled),x.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),I.call(w,x.gl,D),x.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),x.setColorMode(p.colorModeForRenderPass()),x.setStencilMode(o.ag.disabled);const S=w.renderingMode==="3d"?new o.ae(p.context.gl.LEQUAL,o.ae.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,o.ae.ReadOnly);if(x.setDepthMode(S),p.transform.projection.name==="globe"){const I=p.transform.pointMerc;w.render(x.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),o.a1(p.transform.zoom),[I.x,I.y],p.transform.pixelsPerMeterRatio)}else w.render(x.gl,p.transform.customLayerMatrix());x.setDirty(),p.setBaseState(),x.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,i,c,_){if(p.renderPass==="opaque")return;const x=c.paint.get("model-opacity");if(x===0)return;const w=c.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!w||p.terrain&&x<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof o.Z))return;const S=p.shadowRenderer,I=c.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,I||(S.enabled=!1));const O=()=>{S&&(S.useNormalOffset=!0,I||(S.enabled=!0))},D=i.getSource();if(p.renderPass==="light-beam"&&D.type!=="batched-model")return;if(D.type==="vector"||D.type==="geojson")return function(K,ue,ce,he,ge){const _e=K.transform;if(_e.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${_e.projection.name} projection is not yet implemented`);const Se=_e.getFreeCameraOptions().position;if(!K.modelManager)return;const ee=K.modelManager;ce.modelManager=ee;const fe=K.shadowRenderer;if(!ce._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Pe=ce._unevaluatedLayout._values["model-id"],We={...ce.layout.get("model-id").parameters},ke=K.style.order.indexOf(ce.fqid);for(const be of he){const Xe=ue.getTile(be).getBucket(ce);if(!Xe||Xe.projection.name!==_e.projection.name)continue;const dt=Xe.getModelUris();dt&&!Xe.modelsRequested&&(ee.addModelsFromBucket(dt,ge),Xe.modelsRequested=!0);const pt=qu(be,_e);We.zoom=pt;const ft=Pe.possiblyEvaluate(We);if(Go(K,Xe,be),zs.shadowUniformsInitialized=!1,zs.useSingleShadowCascade=!!fe&&fe.getMaxCascadeForTile(be.toUnwrapped())===0,K.renderPass==="shadow"&&fe){if(K.currentShadowCascade===1&&Xe.isInsideFirstShadowMapFrustum)continue;const lt=_e.calculatePosMatrix(be.toUnwrapped(),_e.worldSize);if(zs.tileMatrix.set(lt),zs.shadowTileMatrix=Float32Array.from(fe.calculateShadowPassMatrixFromMatrix(lt)),zs.aabb.min.fill(0),zs.aabb.max[0]=zs.aabb.max[1]=o.a3,zs.aabb.max[2]=0,Ua(Xe,zs,K,ce.scope))continue}const Fe=1<<be.canonical.z,Ye=[((Se.x-be.wrap)*Fe-be.canonical.x)*o.a3,(Se.y*Fe-be.canonical.y)*o.a3,Se.z*Fe*o.a3];K.conflationActive&&Object.keys(Xe.instancesPerModel).length>0&&K.style.isLayerClipped(ce,ue.getSource())&&Xe.updateReplacement(be,K.replacementSource,ke)&&(Xe.uploaded=!1,Xe.upload(K.context));for(let lt in Xe.instancesPerModel){const Ct=Xe.instancesPerModel[lt];Ct.features.length>0&&(lt=ft.evaluate(Ct.features[0].feature,{}));const Pt=ee.getModel(lt,ge);if(Pt&&Pt.uploaded)for(const Lt of Pt.nodes)qn(K,ce,Lt,Ct,Ye,be,zs)}}}(p,i,c,_,D.type==="vector"?c.scope:""),void O();if(!D.loaded())return;if(D.type==="batched-model")return function(K,ue,ce,he){ce.resetLayerRenderingStats(K);const ge=K.context,_e=K.transform,Se=K.style.fog,ee=K.shadowRenderer;if(_e.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${_e.projection.name} projection is not yet implemented`);const fe=K.transform.getFreeCameraOptions().position,Pe=o._.scale([],[fe.x,fe.y,fe.z],K.transform.worldSize);o._.negate(Pe,Pe);const We=o.ad.identity([]),ke=o.cg(_e.center.lat,_e.zoom),be=o.ad.fromScaling([],[1,1,1/ke]);o.ad.translate(We,We,Pe);const Xe=ce.paint.get("model-opacity"),dt=new o.ae(ge.gl.LEQUAL,o.ae.ReadWrite,K.depthRangeFor3D),pt=new o.ae(ge.gl.LEQUAL,o.ae.ReadOnly,K.depthRangeFor3D),ft=new o.b6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Fe=K.renderPass==="shadow",Ye=Fe&&ee?ee.getCurrentCascadeFrustum():_e.getFrustum(_e.scaleZoom(_e.worldSize)),lt=ce.paint.get("model-front-cutoff"),Ct=lt[2]<1,Pt=Zl(K,ce.paint.get("model-cutoff-fade-range")),Lt=ce.getLayerRenderingStats();(function(Ot,It,it,jt){const Er=Ot.terrain?Ot.terrain.exaggeration():0,lr=Ot.transform.zoom;for(const yr of jt){const Rr=It.getTile(yr).getBucket(it);Rr&&(Ot.conflationActive&&Rr.updateReplacement(yr,Ot.replacementSource),Rr.evaluateScale(Ot,it),Ot.terrain&&Er>0&&Rr.elevationUpdate(Ot.terrain,Er,yr,it.source),Rr.needsReEvaluation(Ot,lr,it)&&Rr.evaluate(it))}})(K,ue,ce,he),function(){let Ot,It,it;Ct?(Ot=he.length-1,It=-1,it=-1):(Ot=0,It=he.length,it=1);for(let jt=Ot;jt!==It;jt+=it){const Er=he[jt],lr=ue.getTile(Er).getBucket(ce);if(!lr||!lr.uploaded)continue;let yr=!1;ee&&(yr=ee.getMaxCascadeForTile(Er.toUnwrapped())===0);const Rr=_e.calculatePosMatrix(Er.toUnwrapped(),_e.worldSize),yn=lr.modelTraits,Pr=[];for(const pr of lr.getNodesInfo()){if(pr.hiddenByReplacement||!pr.node.meshes)continue;const sn=pr.node;let Jr=0;K.terrain&&sn.elevation&&(Jr=sn.elevation*K.terrain.exaggeration());const kr=pr.evaluatedScale;if(kr[0]<=1&&kr[1]<=1&&kr[2]<=1&&(()=>{const Xr=pr.aabb;return ft.min=[...Xr.min],ft.max=[...Xr.max],ft.min[2]+=Jr,ft.max[2]+=Jr,o._.transformMat4(ft.min,ft.min,Rr),o._.transformMat4(ft.max,ft.max,Rr),ft})().intersects(Ye)===0)continue;const xr=[...Rr],dn=sn.anchor?sn.anchor[0]:0,Rn=sn.anchor?sn.anchor[1]:0;o.ad.translate(xr,xr,[dn*(kr[0]-1),Rn*(kr[1]-1),Jr]),o._.exactEquals(kr,o.cj)||o.ad.scale(xr,xr,kr);const en=o.ad.multiply([],xr,sn.matrix),pn=o.ad.multiply([],_e.expandedFarZProjMatrix,en),ct=o.ad.multiply([],_e.expandedFarZProjMatrix,xr),Ft=o.aA.transformMat4([],[dn,Rn,Jr,1],pn)[2];sn.hidden=!1;let wi=Xe;Fe||(Ct&&(wi*=lm(xr,_e,pr.aabb,lt)),wi*=yi(Pt,Ft)),wi!==0?Pr.push({nodeInfo:pr,depth:Ft,opacity:wi,wvpForNode:pn,wvpForTile:ct,nodeModelMatrix:en,tileModelMatrix:xr}):sn.hidden=!0}Fe||Pr.sort((pr,sn)=>!Ct||pr.opacity===1&&sn.opacity===1?pr.depth<sn.depth?-1:1:pr.opacity===1?-1:sn.opacity===1?1:pr.depth>sn.depth?-1:1);for(const pr of Pr){const sn=pr.nodeInfo,Jr=sn.node;let kr=o.ad.multiply([],be,pr.tileModelMatrix);o.ad.multiply(kr,We,kr);const xr=o.ad.invert([],kr);o.ad.transpose(xr,xr),o.ad.scale(xr,xr,Fs),kr=o.ad.multiply(kr,kr,Jr.matrix);const dn=K.renderPass==="light-beam",Rn=yn&o.cl.HasMapboxMeshFeatures,en=Rn?0:sn.evaluatedRMEA[0][2];for(let pn=0;pn<Jr.meshes.length;++pn){const ct=Jr.meshes[pn],Ft=pn===Jr.lightMeshIndex;let wi=pr.wvpForNode;if(Ft){if(!dn&&!K.terrain&&K.shadowRenderer){K.currentLayer<K.firstLightBeamLayer&&(K.firstLightBeamLayer=K.currentLayer);continue}wi=pr.wvpForTile}else if(dn)continue;const Xr={defines:[]},$e=[];if(eu(Xr.defines,$e,ct,K,ce.lut),Rn||Xr.defines.push("DIFFUSE_SHADED"),yr&&Xr.defines.push("SHADOWS_SINGLE_CASCADE"),Lt&&(Fe?Lt.numRenderedVerticesInShadowPass+=ct.vertexArray.length:Lt.numRenderedVerticesInTransparentPass+=ct.vertexArray.length),Fe){Oi(ct,pr.nodeModelMatrix,K,ce);continue}let Ji=null;if(Se){const qo=Yf(pr.nodeModelMatrix,K.transform);if(Ji=new Float32Array(qo),_e.projection.name!=="globe"){const yl=ct.aabb.min,vl=ct.aabb.max,[xl,pa]=Se.getOpacityForBounds(qo,yl[0],yl[1],vl[0],vl[1]);Xr.overrideFog=xl>=hn||pa>=hn}}const Bi=ct.material;let Ti;Bi.occlusionTexture&&Bi.occlusionTexture.offsetScale&&(Ti=Bi.occlusionTexture.offsetScale,Xr.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Fe&&ee&&(ee.useNormalOffset=!!ct.normalBuffer);const Ni=K.getOrCreateProgram("model",Xr);!Fe&&ee&&ee.setupShadowsFromMatrix(pr.tileModelMatrix,Ni,ee.useNormalOffset),K.uploadCommonUniforms(ge,Ni,null,Ji);const js=Bi.pbrMetallicRoughness;js.metallicFactor=.9,js.roughnessFactor=.5;const $a=tm(new Float32Array(wi),new Float32Array(kr),new Float32Array(xr),new Float32Array(Jr.matrix),K,pr.opacity,js.baseColorFactor.toRenderColor(null),Bi.emissiveFactor,js.metallicFactor,js.roughnessFactor,Bi,en,ce,[0,0,0],Ti);!Ft&&(sn.hasTranslucentParts||pr.opacity<1)&&Ni.draw(K,ge.gl.TRIANGLES,dt,o.ag.disabled,o.a.disabled,o.af.backCCW,$a,ce.id,ct.vertexBuffer,ct.indexBuffer,ct.segments,ce.paint,K.transform.zoom,void 0,$e),Ni.draw(K,ge.gl.TRIANGLES,Ft?pt:dt,o.ag.disabled,Ft||pr.opacity<1||sn.hasTranslucentParts?o.a.alphaBlended:o.a.unblended,o.af.backCCW,$a,ce.id,ct.vertexBuffer,ct.indexBuffer,ct.segments,ce.paint,K.transform.zoom,void 0,$e)}}}}()}(p,i,c,_),void O();if(D.type!=="model")return;const z=D.getModels(),B=[],j=p.transform.getFreeCameraOptions().position,$=o._.scale([],[j.x,j.y,j.z],p.transform.worldSize);o._.negate($,$);const H=[],X=[];let Y=0;for(const K of z){const ue=c.paint.get("model-rotation").constantOr(null),ce=c.paint.get("model-scale").constantOr(null),he=c.paint.get("model-translation").constantOr(null);K.computeModelMatrix(p,ue,ce,he,!0,!0,!1);const ge=o.ad.identity([]),_e=o.cg(K.position.lat,p.transform.zoom),Se=o.ad.fromScaling([],[1,1,1/_e]);o.ad.translate(ge,ge,$),B.push({zScaleMatrix:Se,negCameraPosMatrix:ge});for(const ee of K.nodes)wh(p.transform,ee,K.matrix,p.transform.expandedFarZProjMatrix,Y,H,X);Y++}if(H.sort((K,ue)=>ue.depth-K.depth),p.renderPass!=="shadow"){if(x===1)for(const K of X)Wu(K,p,c,B[K.modelIndex],o.ag.disabled,p.colorModeForRenderPass());else{for(const K of X)Wu(K,p,c,B[K.modelIndex],o.ag.disabled,o.a.disabled);for(const K of X)Wu(K,p,c,B[K.modelIndex],p.stencilModeFor3D(),p.colorModeForRenderPass());p.resetStencilClippingMasks()}for(const K of H)Wu(K,p,c,B[K.modelIndex],o.ag.disabled,p.colorModeForRenderPass());O()}else{for(const K of X)Oi(K.mesh,K.nodeModelMatrix,p,c);for(const K of H)Oi(K.mesh,K.nodeModelMatrix,p,c);O()}}},fa={model:function(p,i,c){const _=i.getSource();if(!_.loaded())return;if(_.type==="vector"||_.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,_.type==="vector"?p.scope:""));if(_.type==="batched-model"||_.type!=="model")return;const x=_.getModels();for(const w of x)w.upload(c.context)},raster:function(p,i,c){const _=i.getSource();if(!(_ instanceof Uu&&_.loaded()))return;const x=p.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!x)return;const w=p.paint.get("raster-array-band")||_.getInitialBand(x);if(w==null)return;const S=i.getIds().map(I=>i.getTileByID(I));for(const I of S)I.updateNeeded(x,w)&&_.prepareTile(I,x,w)},"raster-particle":function(p,i,c){const _=i.getSource();if(!(_ instanceof Uu&&_.loaded()))return;const x=p.sourceLayer||_.rasterLayerIds&&_.rasterLayerIds[0];if(!x)return;const w=p.paint.get("raster-particle-array-band")||_.getInitialBand(x);if(w==null)return;const S=i.getIds().map(I=>i.getTileByID(I));for(const I of S)I.updateNeeded(x,w)&&_.prepareTile(I,x,w)}};class p1{constructor(i,c,_,x){this.context=new es(i,c),this.occlusionBuffers=new tu(this.context),this.transform=_,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._timeStamp=o.e.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const w=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const S of w)this._debugParams.enabledLayers[S]=!0;x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),x.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),x.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const S of w)x.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],S);this.symbolParams=new Ms(x),this.setup(),this.numSublayers=o.bv.maxUnderzooming+o.bv.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.co,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Vp(this),this._wireframeDebugCache=new Th,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[]}updateTerrain(i,c){const _=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new qp(this,i));const x=this._terrain;this.transform.elevation=_?x:null,x.update(i,this.transform,c),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(i){const c=i.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,x]=c.getFovAdjustedRange(this.transform._fov);if(_>x)return void(this.transform.fogCullDistSq=null);const w=_+.78*(x-_);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(i){i&&!this._terrain&&(this._terrain=new qp(this,this.style)),this._forceTerrainMode=i}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,c){if(this.width=i*o.e.devicePixelRatio,this.height=c*o.e.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._mergedLayers[_].resize()}setup(){const i=this.context,c=new o.bt;c.emplaceBack(0,0),c.emplaceBack(o.a3,0),c.emplaceBack(0,o.a3),c.emplaceBack(o.a3,o.a3),this.tileExtentBuffer=i.createVertexBuffer(c,o.br.members),this.tileExtentSegments=o.b.simpleSegment(0,0,4,2);const _=new o.bt;_.emplaceBack(0,0),_.emplaceBack(o.a3,0),_.emplaceBack(0,o.a3),_.emplaceBack(o.a3,o.a3),this.debugBuffer=i.createVertexBuffer(_,o.br.members),this.debugSegments=o.b.simpleSegment(0,0,4,5);const x=new o.bt;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(x,o.br.members),this.viewportSegments=o.b.simpleSegment(0,0,4,2);const w=new o.cp;w.emplaceBack(0,0,0,0),w.emplaceBack(o.a3,0,o.a3,0),w.emplaceBack(0,o.a3,0,o.a3),w.emplaceBack(o.a3,o.a3,o.a3,o.a3),this.mercatorBoundsBuffer=i.createVertexBuffer(w,o.cq.members),this.mercatorBoundsSegments=o.b.simpleSegment(0,0,4,2);const S=new o.bu;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(S);const I=new o.cr;for(const D of[0,1,3,2,0])I.emplaceBack(D);this.debugIndexBuffer=i.createIndexBuffer(I),this.emptyTexture=new o.T(i,new o.i({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=o.ad.create();const O=this.context.gl;this.stencilClearMode=new o.ag({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,o.ae.disabled,this.stencilClearMode,o.a.disabled,o.af.disabled,Lf(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,c,_){if(!c||this.currentStencilSource===c.id||!i.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const O of _)if(this._tileClippingMaskIDs[O.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=c.id;const x=this.context,w=x.gl;this.nextStencilID+_.length>256&&this.clearStencil(),x.setColorMode(o.a.disabled),x.setDepthMode(o.ae.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of _){const O=c.getTile(I),D=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:B,tileBoundsSegments:j}=this.getTileBoundsBuffers(O);S.draw(this,w.TRIANGLES,o.ae.disabled,new o.ag({func:w.ALWAYS,mask:0},D,255,w.KEEP,w.KEEP,w.REPLACE),o.a.disabled,o.af.disabled,Lf(I.projMatrix),"$clipping",z,B,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,c=this.context.gl;return new o.ag({func:c.NOTEQUAL,mask:255},i,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const c=this.context.gl;return new o.ag({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(i){const c=this.context.gl,_=i.sort((S,I)=>I.overscaledZ-S.overscaledZ),x=_[_.length-1].overscaledZ,w=_[0].overscaledZ-x+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const S={};for(let I=0;I<w;I++)S[I+x]=new o.ag({func:c.GEQUAL,mask:255},I+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[S,_]}return[{[x]:o.ag.disabled},_]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new o.a([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new o.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.a.unblended:o.a.alphaBlended}colorModeForDrapableLayerRenderPass(i){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new o.a([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new o.C(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,c,_,x=!1){if(this.depthOcclusion)return new o.ae(this.context.gl.GREATER,o.ae.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return o.ae.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new o.ae(_||this.context.gl.LEQUAL,c,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const i=this.context.gl,c=Math.ceil(this.width),_=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),w=i.getParameter(i.TEXTURE_BINDING_2D);this.terrainDepthFBO&&this.terrainDepthFBO.width===c&&this.terrainDepthFBO.height===_||(this.terrainDepthFBO&&(this.terrainDepthFBO.destroy(),this.terrainDepthFBO=void 0,this.terrainDepthTexture=void 0),c!==0&&_!==0&&(this.terrainDepthFBO=new Es(this.context,c,_,!1,"texture"),this.terrainDepthTexture=new o.T(this.context,{width:c,height:_,data:null},i.DEPTH_STENCIL),this.terrainDepthFBO.depthAttachment.set(this.terrainDepthTexture.texture))),this.context.bindFramebuffer.set(x),i.bindTexture(i.TEXTURE_2D,w),this.terrainDepthFBO&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this.terrainDepthFBO.framebuffer),i.blitFramebuffer(0,0,c,_,0,0,c,_,i.DEPTH_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((i,c)=>i+c/this._fpsHistory.length,0))}render(i,c){const _=o.e.now();this._dt=_-this._timeStamp,this._timeStamp=_,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=c;const x=this.style._mergedLayers,w=this.style.order.filter(ee=>{const fe=x[ee];return!(fe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[fe.type]}),S=w.map(ee=>x[ee]),I=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(o.e.now()),this.imageManager.beginFrame();let O=0,D=!1;for(const ee in I){const fe=I[ee];fe.used&&(fe.prepare(this.context),fe.getSource().usedInConflation&&++O)}let z=!1;for(const ee of S)ee.isHidden(this.transform.zoom)||(ee.type==="clip"&&(z=!0),this.prepareLayer(ee));const B={},j={},$={},H={},X={};for(const ee in I){const fe=I[ee];B[ee]=fe.getVisibleCoordinates(),j[ee]=B[ee].slice().reverse(),$[ee]=fe.getVisibleCoordinates(!0).reverse(),H[ee]=fe.getShadowCasterCoordinates(),X[ee]=fe.sortCoordinatesByDistance(B[ee])}const Y=ee=>{const fe=this.style.getLayerSourceCache(ee);return fe&&fe.used?fe.getSource():null};if(O||z){const ee=[],fe=[];let Pe=0;for(const We of S)this.isSourceForClippingOrConflation(We,Y(We))&&(ee.push(We),fe.push(Pe)),Pe++;if(ee&&(z||ee.length>1)){const We=[];for(let ke=0;ke<ee.length;ke++){const be=ee[ke],Xe=fe[ke],dt=this.style.getLayerSourceCache(be);if(!dt||!dt.used||!dt.getSource().usedInConflation&&be.type!=="clip")continue;let pt=1/0,ft=o.cu.None;if(be.type==="clip"){pt=Xe;for(const Fe of be.layout.get("clip-layer-types"))ft|=Fe==="model"?o.cu.Model:Fe==="symbol"?o.cu.Symbol:o.cu.FillExtrusion}We.push({layer:be.fqid,cache:dt,order:pt,clipMask:ft})}this.replacementSource.setSources(We),D=!0}}D||this.replacementSource.clear(),this.conflationActive=D,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ee=0;ee<S.length;ee++){const fe=S[ee],Pe=fe.cutoffRange();if(this.longestCutoffRange=Math.max(Pe,this.longestCutoffRange),Pe>0){const We=Y(fe);We&&(this.minCutoffZoom=Math.max(We.minzoom,this.minCutoffZoom)),fe.minzoom&&(this.minCutoffZoom=Math.max(fe.minzoom,this.minCutoffZoom))}fe.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ee),this._lastOcclusionLayer=ee)}const K=this.style&&this.style.fog;K?(this._fogVisible=K.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=K.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding($),this.opaquePassCutoff=0);const ue=this._shadowRenderer;if(ue){ue.updateShadowParameters(this.transform,this.style.directionalLight);for(const ee in I)for(const fe of B[ee]){let Pe={min:0,max:0};this.terrain&&(Pe=this.terrain.getMinMaxForTile(fe)||Pe),ue.addShadowReceiver(fe.toUnwrapped(),Pe.min,Pe.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.cs(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new bh(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!o.ct(this.context.gl))return;this.renderPass="offscreen";for(const ee of S){const fe=i.getLayerSourceCache(ee);if(!ee.hasOffscreenPass()||ee.isHidden(this.transform.zoom))continue;const Pe=fe?j[fe.id]:void 0;(ee.type==="custom"||ee.type==="raster"||ee.type==="raster-particle"||ee.isSky()||Pe&&Pe.length)&&this.renderLayer(this,fe,ee,Pe)}this.depthRangeFor3D=[0,1-(S.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,H)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ce=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),he=(()=>{if(c.showOverdrawInspector)return o.C.black;const ee=this.style.fog;if(ee&&this.transform.projection.supportsFog){const fe=this.style.getLut(ee.scope);if(!ce){const Pe=ee.properties.get("color").toRenderColor(fe).toArray01();return new o.C(...Pe)}if(ce){const Pe=ee.properties.get("space-color").toRenderColor(fe).toArray01();return new o.C(...Pe)}}return o.C.transparent})();if(this.context.clear({color:he,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ce&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const ee=S[this.currentLayer],fe=i.getLayerSourceCache(ee);if(ee.isSky())continue;const Pe=fe?(ee.is3D()?X:j)[fe.id]:void 0;this._renderTileClippingMasks(ee,fe,Pe),this.renderLayer(this,fe,ee,Pe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ce&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.a1(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const ee=S[this.currentLayer],fe=i.getLayerSourceCache(ee);ee.isSky()&&this.renderLayer(this,fe,ee,fe?j[fe.id]:void 0)}function ge(ee,fe){let Pe;return fe&&(Pe=(ee.type==="symbol"?$:ee.is3D()?X:j)[fe.id]),Pe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<w.length;){const ee=S[this.currentLayer];if(ee.type==="raster"){const fe=i.getLayerSourceCache(ee);this.renderLayer(this,fe,ee,ge(ee,fe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let _e=0;ue&&(_e=ue.getShadowCastingLayerCount());let Se=!1;for(;this.currentLayer<w.length;){const ee=S[this.currentLayer],fe=i.getLayerSourceCache(ee);if(ee.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ee)){if(ee.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(Se||!this.terrain||!this.style.hasSymbolLayers()&&!this.style.hasCircleLayers()||this.transform.isOrthographic||(Se=!0,this.blitDepth()),ee.is3D()||this.terrain||this._renderTileClippingMasks(ee,fe,fe?B[fe.id]:void 0),this.renderLayer(this,fe,ee,ge(ee,fe)),!this.terrain&&ue&&_e>0&&ee.hasShadowPass()&&--_e==0&&(ue.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Pe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Pe;this.currentLayer++){const We=S[this.currentLayer];if(!We.hasLightBeamPass())continue;const ke=i.getLayerSourceCache(We);this.renderLayer(this,ke,We,ke?j[ke.id]:void 0)}this.currentLayer=Pe,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Pe=this.currentLayer;this.depthOcclusion=!0;for(const We of this.layersWithOcclusionOpacity){this.currentLayer=We;const ke=S[this.currentLayer],be=i.getLayerSourceCache(ke),Xe=be?j[be.id]:void 0;ke.is3D()||this.terrain||this._renderTileClippingMasks(ke,be,be?B[be.id]:void 0),this.renderLayer(this,be,ke,Xe)}this.depthOcclusion=!1,this.currentLayer=Pe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ee=null;S.forEach(fe=>{const Pe=i.getLayerSourceCache(fe);Pe&&!fe.isHidden(this.transform.zoom)&&Pe.getVisibleCoordinates().length&&(!ee||ee.getSource().maxzoom<Pe.getSource().maxzoom)&&(ee=Pe)}),ee&&this.options.showTileBoundaries&&um.debug(this,ee,ee.getVisibleCoordinates(),o.C.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&um.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.C(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ee){const fe=ee.transform.padding;Ut(ee,ee.transform.height-(fe.top||0),3,ay),Ut(ee,fe.bottom||0,3,Xf),Wr(ee,fe.left||0,3,sm),Wr(ee,ee.transform.width-(fe.right||0),3,ca);const Pe=ee.transform.centerPoint;(function(We,ke,be,Xe){jr(We,ke-1,be-10,2,20,Xe),jr(We,ke-10,be-1,20,2,Xe)})(ee,Pe.x,ee.transform.height-Pe.y,am)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),D||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:c}=this.transform.projection,_=!c||!c.includes(i.type);if(fa[i.type]&&(_||this.terrain&&i.type==="custom")){const x=this.style.getLayerSourceCache(i);fa[i.type](i,x,this)}this.gpuTimingEnd()}renderLayer(i,c,_,x){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||_.type==="model"||_.type==="raster"||_.type==="raster-particle"||x&&x.length)&&(this.id=_.id,this.gpuTimingStart(_),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(_.type)&&(!i.terrain||_.type!=="custom")||_.type==="clip"||um[_.type](i,c,_,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,_=this.context.gl;let x=this.gpuTimers[i.id];x||(x=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:_.createQuery()}),x.calls++,_.beginQuery(c.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,c=this.context.gl,_=c.createQuery();this.deferredRenderGpuTimeQueries.push(_),c.beginQuery(i.TIME_ELAPSED_EXT,_)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const c={};for(const _ in i){const x=i[_],w=this.context.extTimerQuery,S=w.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(x.query),c[_]=S}return c}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery,_=this.context.gl;let x=0;for(const w of i)x+=c.getQueryParameter(w,_.QUERY_RESULT)/1e6,c.deleteQueryEXT(w);return x}translatePosMatrix(i,c,_,x,w){if(!_[0]&&!_[1])return i;const S=w?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(S){const D=Math.sin(S),z=Math.cos(S);_=[_[0]*z-_[1]*D,_[0]*D+_[1]*z]}const I=[w?_[0]:o.bB(c,_[0],this.transform.zoom),w?_[1]:o.bB(c,_[1],this.transform.zoom),0],O=new Float32Array(16);return o.ad.translate(O,i,I),O}saveTileTexture(i){const c=i.size[0],_=this._tileTextures[c];_?_.push(i):this._tileTextures[c]=[i]}getTileTexture(i){const c=this._tileTextures[i];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,c,_){const x=_===void 0?this.terrain&&this.terrain.renderingToTexture:_,w=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||w.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?w.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):w.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||x||c!==void 0&&!c||w.push("FOG","FOG_DITHERING"),x&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(i,c){this.cache=this.cache||{};const _=c&&c.defines||[],x=c&&c.config,w=this.currentGlobalDefines(i,c&&c.overrideFog,c&&c.overrideRtt).concat(_),S=Hp.cacheKey(Br[i],i,w,x);return this.cache[S]||(this.cache[S]=new Hp(this.context,i,Br[i],x,ry[i],w)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.terrainDepthFBO&&(this.terrainDepthFBO.destroy(),this.terrainDepthFBO=void 0,this.terrainDepthTexture=void 0)}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,c){if(this.style.enable3dLights()){const _=this.style.directionalLight,x=this.style.ambientLight;if(_&&x){const w=((S,I,O)=>{const D=S.properties.get("direction"),z=S.properties.get("color").toRenderColor(O.getLut(S.scope)).toArray01(),B=S.properties.get("intensity"),j=I.properties.get("color").toRenderColor(O.getLut(I.scope)).toArray01(),$=I.properties.get("intensity"),H=[D.x,D.y,D.z],X=o.bA(j,$),Y=o.bA(z,B);return{u_lighting_ambient_color:X,u_lighting_directional_dir:H,u_lighting_directional_color:Y,u_ground_radiance:Xg(H,Y,X)}})(_,x,this.style);c.setLightsUniformValues(i,w)}}}uploadCommonUniforms(i,c,_,x,w){if(this.uploadCommonLightUniforms(i,c),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const I=S.getOpacity(this.transform.pitch),O=((D,z,B,j,$,H,X,Y,K,ue,ce,he)=>{const ge=D.transform,_e=z.properties.get("color").toRenderColor(D.style.getLut(z.scope)).toArray01();_e[3]=j;const Se=D.frameCounter/1e3%1,[ee,fe]=z.properties.get("vertical-range");return{u_fog_matrix:B?ge.calculateFogTileMatrix(B):he||D.identityMat,u_fog_range:z.getFovAdjustedRange(ge._fov),u_fog_color:_e,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ee,fe),fe],u_fog_temporal_offset:Se,u_frustum_tl:$,u_frustum_tr:H,u_frustum_br:X,u_frustum_bl:Y,u_globe_pos:K,u_globe_radius:ue,u_viewport:ce,u_globe_transition:o.a1(ge.zoom),u_is_globe:+(ge.projection.name==="globe")}})(this,S,_,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.e.devicePixelRatio,this.transform.height*o.e.devicePixelRatio],x);c.setFogUniformValues(i,O)}w&&c.setCutoffUniformValues(i,w.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,c=i.createTexture();return i.bindTexture(i.TEXTURE_2D,c),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,c=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const x of _)c[x.key]=i[x.key]||new o.by(x,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(i,c){return!(!i.is3D()||i.minzoom&&i.minzoom>this.transform.zoom||(this.style._clipLayerIndices.length||i.sourceLayer!=="building")&&i.type!=="clip"&&(!c||c.type!=="batched-model"))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[i.key];return c||(this._cachedTileFogOpacities[i.key]=c=this.style.fog.getOpacityForTile(i)),c[0]>=hn||c[1]>=hn}}class Kf{constructor(i,c,_,x){this.screenBounds=i,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(i,c){let _,x;if(i instanceof o.P||typeof i[0]=="number"){const w=o.P.convert(i);_=[w],x=c.isPointAboveHorizon(w)}else{const w=o.P.convert(i[0]),S=o.P.convert(i[1]);_=[w,S],x=o.cv(w,S).every(I=>c.isPointAboveHorizon(I))}return new Kf(_,c.getCameraPoint(),x,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return o.cv(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const c=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],x=o.cv(c,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<_.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?x[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(x[3]=this.cameraPoint)),o.cw(x,i)}bufferedCameraGeometryGlobe(i){const c=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],x=o.cv(c,_,i),w=this.cameraPoint.clone();switch(3*((w.y>c.y)+(w.y>_.y))+((w.x>c.x)+(w.x>_.x))){case 0:x[0]=w,x[4]=w.clone();break;case 1:x.splice(1,0,w);break;case 2:x[1]=w;break;case 3:x.splice(4,0,w);break;case 5:x.splice(2,0,w);break;case 6:x[3]=w;break;case 7:x.splice(3,0,w);break;case 8:x[2]=w}return x}containsTile(i,c,_,x=0){const w=i.queryPadding/c._pixelsPerMercatorPixel+1,S=_?this._bufferedCameraMercator(w,c):this._bufferedScreenMercator(w,c);let I=i.tileID.wrap+(S.unwrapped?x:0);const O=S.polygon.map(Y=>o.cx(i.tileTransform,Y,I));if(!o.cy(O,0,0,o.a3,o.a3))return;I=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const D=this.screenGeometryMercator.polygon.map(Y=>o.cz(i.tileTransform,Y,I)),z=D.map(Y=>new o.P(Y[0],Y[1])),B=c.getFreeCameraOptions().position||new o.Y(0,0,0),j=o.cz(i.tileTransform,B,I),$=D.map(Y=>{const K=o._.sub(Y,Y,j);return o._.normalize(K,K),new o.aT(j,K)}),H=o.bB(i,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:$,bufferedTilespaceGeometry:O,bufferedTilespaceBounds:(X=o.cA(O),X.min.x=o.at(X.min.x,0,o.a3),X.min.y=o.at(X.min.y,0,o.a3),X.max.x=o.at(X.max.x,0,o.a3),X.max.y=o.at(X.max.y,0,o.a3),X),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:H};var X}_bufferedScreenMercator(i,c){const _=Mh(i);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),c):{polygon:this.bufferedScreenGeometry(i).map(w=>c.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[_]=x,x}}_bufferedCameraMercator(i,c){const _=Mh(i);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),c):{polygon:this.bufferedCameraGeometry(i).map(w=>c.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[_]=x,x}}_projectAndResample(i,c){const _=function(w,S){const I=o.ad.multiply([],S.pixelMatrix,S.globeMatrix),O=[0,-o.cD,0,1],D=[0,o.cD,0,1],z=[0,0,0,1];o.aA.transformMat4(O,O,I),o.aA.transformMat4(D,D,I),o.aA.transformMat4(z,z,I);const B=new o.P(O[0]/O[3],O[1]/O[3]),j=new o.P(D[0]/D[3],D[1]/D[3]),$=o.cB(w,B)&&O[3]<z[3],H=o.cB(w,j)&&D[3]<z[3];if(!$&&!H)return null;const X=function(Se,ee,fe){for(let Pe=1;Pe<Se.length;Pe++){const We=Eh(ee.pointCoordinate3D(Se[Pe-1]).x),ke=Eh(ee.pointCoordinate3D(Se[Pe]).x);if(fe<0){if(We<ke)return{idx:Pe,t:-We/(ke-1-We)}}else if(ke<We)return{idx:Pe,t:(1-We)/(ke+1-We)}}return null}(w,S,$?-1:1);if(!X)return null;const{idx:Y,t:K}=X;let ue=Y>1?Qi(w.slice(0,Y),S):[],ce=Y<w.length?Qi(w.slice(Y),S):[];ue=ue.map(Se=>new o.P(Eh(Se.x),Se.y)),ce=ce.map(Se=>new o.P(Eh(Se.x),Se.y));const he=[...ue];he.length===0&&he.push(ce[ce.length-1]);const ge=o.a2(he[he.length-1].y,(ce.length===0?ue[0]:ce[0]).y,K);let _e;return _e=$?[new o.P(0,ge),new o.P(0,0),new o.P(1,0),new o.P(1,ge)]:[new o.P(1,ge),new o.P(1,1),new o.P(0,1),new o.P(0,ge)],he.push(..._e),ce.length===0?he.push(ue[0]):he.push(...ce),{polygon:he.map(Se=>new o.Y(Se.x,Se.y)),unwrapped:!1}}(i,c);if(_)return _;const x=function(w,S){let I=!1,O=-1/0,D=0;for(let B=0;B<w.length-1;B++)w[B].x>O&&(O=w[B].x,D=B);for(let B=0;B<w.length-1;B++){const j=(D+B)%(w.length-1),$=w[j],H=w[j+1];Math.abs($.x-H.x)>.5&&($.x<H.x?($.x+=1,j===0&&(w[w.length-1].x+=1)):(H.x+=1,j+1===w.length-1&&(w[0].x+=1)),I=!0)}const z=o.aj(S.center.lng);return I&&z<Math.abs(z-1)&&w.forEach(B=>{B.x-=1}),{polygon:w,unwrapped:I}}(Qi(i,c).map(w=>new o.P(Eh(w.x),w.y)),c);return{polygon:x.polygon.map(w=>new o.Y(w.x,w.y)),unwrapped:x.unwrapped}}}function Qi(p,i){return o.cC(p,c=>{const _=i.pointCoordinate3D(c);c.x=_.x,c.y=_.y},1/256)}function Eh(p){return p<0?1+p%1:p%1}function Mh(p){return 100*p|0}function ly(p,i){const c=o.ad.identity([]);return o.ad.scale(c,c,[.5*p.width,.5*-p.height,1]),o.ad.translate(c,c,[1,-1,0]),o.ad.multiply(c,c,p.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(c)}function Ih(p,i,c,_,x,w,S,I=!1){const O=p.tilesIn(_,S,I);O.sort(uy);const D=[];for(const B of O)D.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(i,c,p._state,B,x,w,ly(p.transform,B.tile.tileID),I)});const z=function(B){const j={},$={};for(const H of B){const X=H.queryResults,Y=H.wrappedTileID,K=$[Y]=$[Y]||{};for(const ue in X){const ce=X[ue],he=K[ue]=K[ue]||{},ge=j[ue]=j[ue]||[];for(const _e of ce)he[_e.featureIndex]||(he[_e.featureIndex]=!0,ge.push(_e))}}return j}(D);for(const B in z)z[B].forEach(j=>{const $=j.feature,H=$.layer;H&&H.type!=="background"&&H.type!=="sky"&&H.type!=="slot"&&($.source=H.source,H["source-layer"]&&($.sourceLayer=H["source-layer"]),$.state=$.id!==void 0?p.getFeatureState(H["source-layer"],$.id):{})});return z}function m1(p,i){const c=p.getRenderableIds().map(w=>p.getTileByID(w)),_=[],x={};for(let w=0;w<c.length;w++){const S=c[w],I=S.tileID.canonical.key;x[I]||(x[I]=!0,S.querySourceFeatures(_,i))}return _}function uy(p,i){const c=p.tileID,_=i.tileID;return c.overscaledZ-_.overscaledZ||c.canonical.y-_.canonical.y||c.wrap-_.wrap||c.canonical.x-_.canonical.x}class Ah{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const i=!1,c=!1;for(const _ in this.style._mergedLayers){const x=this.style._mergedLayers[_];if(x.type==="fill-extrusion")this.layers.push({layer:x,visible:i,visibilityChanged:c});else if(x.type==="model"){const w=this.style.getLayerSource(x);w&&w.type==="batched-model"&&this.layers.push({layer:x,visible:i,visibilityChanged:c})}}}onNewFrame(i){this.layersGotHidden=!1;for(const c of this.layers){const _=c.layer;let x=!1;_.type==="fill-extrusion"?x=!_.isHidden(i)&&_.paint.get("fill-extrusion-opacity")>0:_.type==="model"&&(x=!_.isHidden(i)&&_.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!x&&c.visible,c.visible=x}}updateZOffset(i,c){this.currentBuildingBuckets=[];for(const x of this.layers){const w=x.layer,S=this.style.getLayerSourceCache(w);let I=1;w.type==="fill-extrusion"&&(I=x.visible?w.paint.get("fill-extrusion-vertical-scale"):0);let O=S?S.getTile(c):null;if(!O&&S&&c.canonical.z>S.getSource().minzoom){let D=c.scaledTo(Math.min(S.getSource().maxzoom,c.overscaledZ-1));for(;D.overscaledZ>=S.getSource().minzoom&&(O=S.getTile(D),!O&&D.overscaledZ!==0);)D=D.scaledTo(D.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:O?O.getBucket(w):null,tileID:O?O.tileID:c,verticalScale:I})}i.hasAnyZOffset=!1;let _=!1;for(let x=0;x<i.symbolInstances.length;x++){const w=i.symbolInstances.get(x),S=w.zOffset,I=this._getHeightAtTileOffset(c,w.tileAnchorX,w.tileAnchorY);w.zOffset=I!==Number.NEGATIVE_INFINITY?I:S,_||S===w.zOffset||(_=!0),i.hasAnyZOffset||w.zOffset===0||(i.hasAnyZOffset=!0)}_&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,c,_,x){let w=c,S=_;if(i.canonical.z!==x.canonical.z){const I=x.canonical,O=1/(1<<i.canonical.z-I.z);w=(c+i.canonical.x*o.a3)*O-I.x*o.a3|0,S=(_+i.canonical.y*o.a3)*O-I.y*o.a3|0}return{tileX:w,tileY:S}}_getHeightAtTileOffset(i,c,_){let x,w;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;const{bucket:I,tileID:O,verticalScale:D}=this.currentBuildingBuckets[S];if(!I)continue;const{tileX:z,tileY:B}=this._mapCoordToOverlappingTile(i,c,_,O),j=I.getHeightAtTileCoord(z,B);j&&j.height!==void 0&&(j.hidden?x=j.height:w=Math.max(j.height*D,w||0))}if(w!==void 0)return w;for(let S=0;S<this.layers.length;++S){const I=this.layers[S];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:O,tileID:D}=this.currentBuildingBuckets[S];if(!O)continue;const{tileX:z,tileY:B}=this._mapCoordToOverlappingTile(i,c,_,D),j=O.getHeightAtTileCoord(z,B);if(j&&!j.hidden)return j.height===void 0&&x!==void 0?Math.min(j.maxHeight,x)*j.verticalScale:j.height?j.height*j.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Ch(p,i){const c={};for(const _ in p)_!=="ref"&&(c[_]=p[_]);return o.cE.forEach(_=>{_ in i&&(c[_]=i[_])}),c}function cy(p){p=p.slice();const i=Object.create(null);for(let c=0;c<p.length;c++)i[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=Ch(p[c],i[p[c].ref]));return p}const Fr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function cm(p,i,c){c.push({command:Fr.addSource,args:[p,i[p]]})}function Ph(p,i,c){i.push({command:Fr.removeSource,args:[p]}),c[p]=!0}function _l(p,i,c,_){Ph(p,c,_),cm(p,i,c)}function _1(p,i,c){let _;for(_ in p[c])if(p[c].hasOwnProperty(_)&&_!=="data"&&!R(p[c][_],i[c][_]))return!1;for(_ in i[c])if(i[c].hasOwnProperty(_)&&_!=="data"&&!R(p[c][_],i[c][_]))return!1;return!0}function Qf(p,i,c,_,x,w){let S;for(S in i=i||{},p=p||{})p.hasOwnProperty(S)&&(R(p[S],i[S])||c.push({command:w,args:[_,S,i[S],x]}));for(S in i)i.hasOwnProperty(S)&&!p.hasOwnProperty(S)&&(R(p[S],i[S])||c.push({command:w,args:[_,S,i[S],x]}))}function Jf(p){return p.id}function Oh(p,i){return p[i.id]=i,p}class g1{constructor(i,c){this.reset(i,c)}reset(i,c){this.points=i||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=o.at(i,0,1);let c=1,_=this._distances[c];const x=i*this.paddedLength+this.padding;for(;_<x&&c<this._distances.length;)_=this._distances[++c];const w=c-1,S=this._distances[w],I=_-S,O=I>0?(x-S)/I:0;return this.points[w].mult(1-O).add(this.points[c].mult(O))}}class ed{constructor(i,c,_){const x=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(i/_),this.yCellCount=Math.ceil(c/_);for(let S=0;S<this.xCellCount*this.yCellCount;S++)x.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=c,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,c,_,x,w){this._forEachCell(c,_,x,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(c),this.bboxes.push(_),this.bboxes.push(x),this.bboxes.push(w)}insertCircle(i,c,_,x){this._forEachCell(c-x,_-x,c+x,_+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(c),this.circles.push(_),this.circles.push(x)}_insertBoxCell(i,c,_,x,w,S){this.boxCells[w].push(S)}_insertCircleCell(i,c,_,x,w,S){this.circleCells[w].push(S)}_query(i,c,_,x,w,S){if(_<0||i>this.width||x<0||c>this.height)return!w&&[];const I=[];if(i<=0&&c<=0&&this.width<=_&&this.height<=x){if(w)return!0;for(let O=0;O<this.boxKeys.length;O++)I.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const D=this.circles[3*O],z=this.circles[3*O+1],B=this.circles[3*O+2];I.push({key:this.circleKeys[O],x1:D-B,y1:z-B,x2:D+B,y2:z+B})}return S?I.filter(S):I}return this._forEachCell(i,c,_,x,this._queryCell,I,{hitTest:w,seenUids:{box:{},circle:{}}},S),w?I.length>0:I}_queryCircle(i,c,_,x,w){const S=i-_,I=i+_,O=c-_,D=c+_;if(I<0||S>this.width||D<0||O>this.height)return!x&&[];const z=[];return this._forEachCell(S,O,I,D,this._queryCellCircle,z,{hitTest:x,circle:{x:i,y:c,radius:_},seenUids:{box:{},circle:{}}},w),x?z.length>0:z}query(i,c,_,x,w){return this._query(i,c,_,x,!1,w)}hitTest(i,c,_,x,w){return this._query(i,c,_,x,!0,w)}hitTestCircle(i,c,_,x){return this._queryCircle(i,c,_,!0,x)}_queryCell(i,c,_,x,w,S,I,O){const D=I.seenUids,z=this.boxCells[w];if(z!==null){const j=this.bboxes;for(const $ of z)if(!D.box[$]){D.box[$]=!0;const H=4*$;if(i<=j[H+2]&&c<=j[H+3]&&_>=j[H+0]&&x>=j[H+1]&&(!O||O(this.boxKeys[$]))){if(I.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[$],x1:j[H],y1:j[H+1],x2:j[H+2],y2:j[H+3]})}}}const B=this.circleCells[w];if(B!==null){const j=this.circles;for(const $ of B)if(!D.circle[$]){D.circle[$]=!0;const H=3*$;if(this._circleAndRectCollide(j[H],j[H+1],j[H+2],i,c,_,x)&&(!O||O(this.circleKeys[$]))){if(I.hitTest)return S.push(!0),!0;{const X=j[H],Y=j[H+1],K=j[H+2];S.push({key:this.circleKeys[$],x1:X-K,y1:Y-K,x2:X+K,y2:Y+K})}}}}}_queryCellCircle(i,c,_,x,w,S,I,O){const D=I.circle,z=I.seenUids,B=this.boxCells[w];if(B!==null){const $=this.bboxes;for(const H of B)if(!z.box[H]){z.box[H]=!0;const X=4*H;if(this._circleAndRectCollide(D.x,D.y,D.radius,$[X+0],$[X+1],$[X+2],$[X+3])&&(!O||O(this.boxKeys[H])))return S.push(!0),!0}}const j=this.circleCells[w];if(j!==null){const $=this.circles;for(const H of j)if(!z.circle[H]){z.circle[H]=!0;const X=3*H;if(this._circlesCollide($[X],$[X+1],$[X+2],D.x,D.y,D.radius)&&(!O||O(this.circleKeys[H])))return S.push(!0),!0}}}_forEachCell(i,c,_,x,w,S,I,O){const D=this._convertToXCellCoord(i),z=this._convertToYCellCoord(c),B=this._convertToXCellCoord(_),j=this._convertToYCellCoord(x);for(let $=D;$<=B;$++)for(let H=z;H<=j;H++)if(w.call(this,i,c,_,x,this.xCellCount*H+$,S,I,O))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,c,_,x,w,S){const I=x-i,O=w-c,D=_+S;return D*D>I*I+O*O}_circleAndRectCollide(i,c,_,x,w,S,I){const O=(S-x)/2,D=Math.abs(i-(x+O));if(D>O+_)return!1;const z=(I-w)/2,B=Math.abs(c-(w+z));if(B>z+_)return!1;if(D<=O||B<=z)return!0;const j=D-O,$=B-z;return j*j+$*$<=_*_}}const Ns=100;class hy{constructor(i,c,_=new ed(i.width+200,i.height+200,25),x=new ed(i.width+200,i.height+200,25)){this.transform=i,this.grid=_,this.ignoredGrid=x,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Ns,this.screenBottomBoundary=i.height+Ns,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=c}placeCollisionBox(i,c,_,x,w,S,I,O){let D=_.projectedAnchorX,z=_.projectedAnchorY,B=_.projectedAnchorZ;const j=_.elevation,$=_.tileID,H=i.getProjection();if(j&&$){const[_e,Se,ee]=H.upVector($.canonical,_.tileAnchorX,_.tileAnchorY),fe=H.upVectorScale($.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=_e*j*fe,z+=Se*j*fe,B+=ee*j*fe}const X=this.projectAndGetPerspectiveRatio(I,D,z,B,_.tileID,H.name==="globe"||!!j||this.transform.pitch>0,H),Y=S*X.perspectiveRatio,K=(_.x1*c+x.x-_.padding)*Y+X.point.x,ue=(_.y1*c+x.y-_.padding)*Y+X.point.y,ce=(_.x2*c+x.x+_.padding)*Y+X.point.x,he=(_.y2*c+x.y+_.padding)*Y+X.point.y,ge=X.perspectiveRatio<=.55||X.occluded;return!this.isInsideGrid(K,ue,ce,he)||!w&&this.grid.hitTest(K,ue,ce,he,O)||ge?{box:[],offscreen:!1,occluded:X.occluded}:{box:[K,ue,ce,he],offscreen:this.isOffscreen(K,ue,ce,he),occluded:!1}}placeCollisionCircles(i,c,_,x,w,S,I,O,D,z,B,j,$,H,X){const Y=[],K=this.transform.elevation,ue=i.getProjection(),ce=K?K.getAtTileOffsetFunc(X,this.transform.center.lat,this.transform.worldSize,ue):null,he=new o.P(_.tileAnchorX,_.tileAnchorY);let{x:ge,y:_e,z:Se}=ue.projectTilePoint(he.x,he.y,X.canonical);if(ce){const[ft,Fe,Ye]=ce(he);ge+=ft,_e+=Fe,Se+=Ye}const ee=ue.name==="globe",fe=this.projectAndGetPerspectiveRatio(I,ge,_e,Se,X,ee||!!K||this.transform.pitch>0,ue),{perspectiveRatio:Pe}=fe,We=(B?S/Pe:S*Pe)/o.bN,ke=fn(ge,_e,Se,O),be=fe.signedDistanceFromCamera>0?Hi(We,w,_.lineOffsetX*We,_.lineOffsetY*We,!1,ke,he,_,x,O,{},K&&!B?ce:null,B&&!!K,ue,X,B):null;let Xe=!1,dt=!1,pt=!0;if(be&&!fe.occluded){const ft=.5*$*Pe+H,Fe=new o.P(-100,-100),Ye=new o.P(this.screenRightBoundary,this.screenBottomBoundary),lt=new g1,{first:Ct,last:Pt}=be,Lt=Ct.path.length;let Ot=[];for(let jt=Lt-1;jt>=1;jt--)Ot.push(Ct.path[jt]);for(let jt=1;jt<Pt.path.length;jt++)Ot.push(Pt.path[jt]);const It=2.5*ft;D&&(Ot=Ot.map(([jt,Er,lr],yr)=>(ce&&!ee&&(lr=ce(yr<Lt-1?Ct.tilePath[Lt-1-yr]:Pt.tilePath[yr-Lt+2])[2]),fn(jt,Er,lr,D))),Ot.some(jt=>jt[3]<=0)&&(Ot=[]));let it=[];if(Ot.length>0){let jt=1/0,Er=-1/0,lr=1/0,yr=-1/0;for(const Rr of Ot)jt=Math.min(jt,Rr[0]),lr=Math.min(lr,Rr[1]),Er=Math.max(Er,Rr[0]),yr=Math.max(yr,Rr[1]);Er>=Fe.x&&jt<=Ye.x&&yr>=Fe.y&&lr<=Ye.y&&(it=[Ot.map(Rr=>new o.P(Rr[0],Rr[1]))],(jt<Fe.x||Er>Ye.x||lr<Fe.y||yr>Ye.y)&&(it=o.cF(it,Fe.x,Fe.y,Ye.x,Ye.y)))}for(const jt of it){lt.reset(jt,.25*ft);let Er=0;Er=lt.length<=.5*ft?1:Math.ceil(lt.paddedLength/It)+1;for(let lr=0;lr<Er;lr++){const yr=lr/Math.max(Er-1,1),Rr=lt.lerp(yr),yn=Rr.x+Ns,Pr=Rr.y+Ns;Y.push(yn,Pr,ft,0);const pr=yn-ft,sn=Pr-ft,Jr=yn+ft,kr=Pr+ft;if(pt=pt&&this.isOffscreen(pr,sn,Jr,kr),dt=dt||this.isInsideGrid(pr,sn,Jr,kr),!c&&this.grid.hitTestCircle(yn,Pr,ft,j)&&(Xe=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Xe,occluded:!1}}}}return{circles:!z&&Xe||!dt?[]:Y,offscreen:pt,collisionDetected:Xe,occluded:fe.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let _=1/0,x=1/0,w=-1/0,S=-1/0;for(const z of i){const B=new o.P(z.x+Ns,z.y+Ns);_=Math.min(_,B.x),x=Math.min(x,B.y),w=Math.max(w,B.x),S=Math.max(S,B.y),c.push(B)}const I=this.grid.query(_,x,w,S).concat(this.ignoredGrid.query(_,x,w,S)),O={},D={};for(const z of I){const B=z.key;if(O[B.bucketInstanceId]===void 0&&(O[B.bucketInstanceId]={}),O[B.bucketInstanceId][B.featureIndex])continue;const j=[new o.P(z.x1,z.y1),new o.P(z.x2,z.y1),new o.P(z.x2,z.y2),new o.P(z.x1,z.y2)];o.cG(c,j)&&(O[B.bucketInstanceId][B.featureIndex]=!0,D[B.bucketInstanceId]===void 0&&(D[B.bucketInstanceId]=[]),D[B.bucketInstanceId].push(B.featureIndex))}return D}insertCollisionBox(i,c,_,x,w){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:x,collisionGroupID:w},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,c,_,x,w){const S=c?this.ignoredGrid:this.grid,I={bucketInstanceId:_,featureIndex:x,collisionGroupID:w};for(let O=0;O<i.length;O+=4)S.insertCircle(I,i[O],i[O+1],i[O+2])}projectAndGetPerspectiveRatio(i,c,_,x,w,S,I){const O=[c,_,x,1];let D=!1;x||this.transform.pitch>0?(o.aA.transformMat4(O,O,i),this.fogState&&w&&I.name!=="globe"&&(D=function(j,$,H,X,Y,K){const ue=K.calculateFogTileMatrix(Y),ce=[$,H,X];return o._.transformMat4(ce,ce,ue),Mn(j,o._.length(ce),K.pitch,K._fov)}(this.fogState,c,_,x,w.toUnwrapped(),this.transform)>.9)):Fu(O,O,i);const z=O[3];return{point:new o.P((O[0]/z+1)/2*this.transform.width+Ns,(-O[1]/z+1)/2*this.transform.height+Ns),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/z*.5,1.5),signedDistanceFromCamera:z,occluded:S&&O[2]>z||D}}isOffscreen(i,c,_,x){return _<Ns||i>=this.screenRightBoundary||x<Ns||c>this.screenBottomBoundary}isInsideGrid(i,c,_,x){return _>=0&&i<this.gridRightBoundary&&x>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const i=o.ad.identity([]);return o.ad.translate(i,i,[-100,-100,0]),i}}class hm{constructor(i,c,_,x){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?c:-c))):x&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Hu{constructor(i,c,_,x,w,S=!1){this.text=new hm(i?i.text:null,c,_,w),this.icon=new hm(i?i.icon:null,c,x,w),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ja{constructor(i,c,_,x=!1){this.text=i,this.icon=c,this.skipFade=_,this.clipped=x}}class td{constructor(){this.invProjMatrix=o.ad.create(),this.viewportMatrix=o.ad.create(),this.circles=[]}}class fy{constructor(i,c,_,x,w){this.bucketInstanceId=i,this.featureIndex=c,this.sourceLayerIndex=_,this.bucketIndex=x,this.tileID=w}}class dy{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const c=++this.maxGroupID;this.collisionGroups[i]={ID:c,predicate:_=>_.collisionGroupID===c}}return this.collisionGroups[i]}}function Zu(p,i,c,_,x){const{horizontalAlign:w,verticalAlign:S}=o.bQ(p),I=-(w-.5)*i,O=-(S-.5)*c,D=o.bP(p,_);return new o.P(I+D[0]*x,O+D[1]*x)}function ru(p,i,c,_,x){const w=new o.P(p,i);return c&&w._rotate(_?x:-x),w}class py{constructor(i,c,_,x,w,S){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new hy(this.transform,w),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new dy(_),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,c,_,x){const w=_.getBucket(c),S=_.latestFeatureIndex;if(!w||!S||c.fqid!==w.layerIds[0])return;const I=w.layers[0].layout,O=_.collisionBoxArray,D=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),z=_.tileSize/o.a3,B=_.tileID.toUnwrapped();this.transform.setProjection(w.projection);const j=($=_.tileID,H=w.getProjection(),X=this.transform,H.name===this.projection?X.calculateProjMatrix($.toUnwrapped()):rm(X,H,$));var $,H,X;const Y=I.get("text-pitch-alignment")==="map",K=I.get("text-rotation-alignment")==="map";c.compileFilter();const ue=c.dynamicFilter(),ce=c.dynamicFilterNeedsFeature(),he=this.transform.calculatePixelsToTileUnitsMatrix(_),ge=zr(j,_.tileID.canonical,Y,K,this.transform,w.getProjection(),he);let _e=null;if(Y){const fe=bn(j,_.tileID.canonical,Y,K,this.transform,w.getProjection(),he);_e=o.ad.multiply([],this.transform.labelPlaneMatrix,fe)}let Se=null;ue&&_.latestFeatureIndex&&(Se={unwrappedTileID:B,dynamicFilter:ue,dynamicFilterNeedsFeature:ce,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new fy(w.bucketInstanceId,S,w.sourceLayerIndex,w.index,_.tileID);const ee={bucket:w,layout:I,posMatrix:j,textLabelPlaneMatrix:ge,labelToScreenMatrix:_e,clippingData:Se,scale:D,textPixelRatio:z,holdingForFade:_.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:o.aD(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.aD(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(x)for(const fe of w.sortKeyRanges){const{sortKey:Pe,symbolInstanceStart:We,symbolInstanceEnd:ke}=fe;i.push({sortKey:Pe,symbolInstanceStart:We,symbolInstanceEnd:ke,parameters:ee})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:ee})}attemptAnchorPlacement(i,c,_,x,w,S,I,O,D,z,B,j,$,H,X,Y,K,ue){const{textOffset0:ce,textOffset1:he,crossTileID:ge}=j,_e=[ce,he],Se=Zu(i,_,x,_e,w),ee=this.collisionIndex.placeCollisionBox(H,w,c,ru(Se.x,Se.y,S,I,this.transform.angle),B,O,D,z.predicate);if(Y){const fe=H.getSymbolInstanceIconSize(ue,this.transform.zoom,j.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(H,fe,Y,ru(Se.x,Se.y,S,I,this.transform.angle),B,O,D,z.predicate).box.length===0)return}if(ee.box.length>0){let fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[ge]&&this.prevPlacement.placements[ge]&&this.prevPlacement.placements[ge].text&&(fe=this.prevPlacement.variableOffsets[ge].anchor),this.variableOffsets[ge]={textOffset:_e,width:_,height:x,anchor:i,textScale:w,prevAnchor:fe},this.markUsedJustification(H,i,j,X),H.allowVerticalPlacement&&(this.markUsedOrientation(H,X,j),this.placedOrientations[ge]=X),{shift:Se,placedGlyphBoxes:ee}}}placeLayerBucketPart(i,c,_,x){const{bucket:w,layout:S,posMatrix:I,textLabelPlaneMatrix:O,labelToScreenMatrix:D,clippingData:z,textPixelRatio:B,holdingForFade:j,collisionBoxArray:$,partiallyEvaluatedTextSize:H,partiallyEvaluatedIconSize:X,collisionGroup:Y}=i.parameters,K=S.get("text-optional"),ue=S.get("icon-optional"),ce=S.get("text-allow-overlap"),he=S.get("icon-allow-overlap"),ge=S.get("text-rotation-alignment")==="map",_e=S.get("text-pitch-alignment")==="map",Se=S.get("symbol-z-order")==="viewport-y",ee=S.get("symbol-z-elevate");this.transform.setProjection(w.projection);let fe=ce&&(he||!w.hasIconData()||ue),Pe=he&&(ce||!w.hasTextData()||K);!w.collisionArrays&&$&&w.deserializeCollisionBoxes($),_&&x&&w.updateCollisionDebugBuffers(this.transform.zoom,$);const We=(ke,be,Xe)=>{const{crossTileID:dt,numVerticalGlyphVertices:pt}=ke;if(z){const Jr={zoom:this.transform.zoom,pitch:this.transform.pitch};let kr=null;if(z.dynamicFilterNeedsFeature){const xr=this.retainedQueryData[w.bucketInstanceId];kr=z.featureIndex.loadFeature({featureIndex:ke.featureIndex,bucketIndex:xr.bucketIndex,sourceLayerIndex:xr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,z.dynamicFilter)(Jr,kr,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new o.P(ke.tileAnchorX,ke.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[dt]=new ja(!1,!1,!1,!0),void c.add(dt)}if(c.has(dt))return;if(j)return void(this.placements[dt]=new ja(!1,!1,!1));let ft=!1,Fe=!1,Ye=!0,lt=!1,Ct=!1,Pt=null,Lt={box:null,offscreen:null,occluded:null},Ot={box:null,offscreen:null,occluded:null},It=null,it=null,jt=null,Er=0,lr=0,yr=0;Xe.textFeatureIndex?Er=Xe.textFeatureIndex:ke.useRuntimeCollisionCircles&&(Er=ke.featureIndex),Xe.verticalTextFeatureIndex&&(lr=Xe.verticalTextFeatureIndex);const Rr=Jr=>{Jr.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const kr=this.transform.elevation;Jr.elevation=ke.zOffset+(kr?kr.getAtTileOffset(Jr.tileID,Jr.tileAnchorX,Jr.tileAnchorY):0)},yn=Xe.textBox;if(yn){Rr(yn);const Jr=xr=>{let dn=o.aE.horizontal;if(w.allowVerticalPlacement&&!xr&&this.prevPlacement){const Rn=this.prevPlacement.placedOrientations[dt];Rn&&(this.placedOrientations[dt]=Rn,dn=Rn,this.markUsedOrientation(w,dn,ke))}return dn},kr=(xr,dn)=>{if(w.allowVerticalPlacement&&pt>0&&Xe.verticalTextBox){for(const Rn of w.writingModes)if(Rn===o.aE.vertical?(Lt=dn(),Ot=Lt):Lt=xr(),Lt&&Lt.box&&Lt.box.length)break}else Lt=xr()};if(S.get("text-variable-anchor")){let xr=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[dt]){const en=this.prevPlacement.variableOffsets[dt];xr.indexOf(en.anchor)>0&&(xr=xr.filter(pn=>pn!==en.anchor),xr.unshift(en.anchor))}const dn=(en,pn,ct)=>{const Ft=w.getSymbolInstanceTextSize(H,ke,this.transform.zoom,be),wi=(en.x2-en.x1)*Ft+2*en.padding,Xr=(en.y2-en.y1)*Ft+2*en.padding,$e=ke.hasIconTextFit&&!he?pn:null;$e&&Rr($e);let Ji={box:[],offscreen:!1,occluded:!1};const Bi=ce?2*xr.length:xr.length;for(let Ti=0;Ti<Bi;++Ti){const Ni=this.attemptAnchorPlacement(xr[Ti%xr.length],en,wi,Xr,Ft,ge,_e,B,I,Y,Ti>=xr.length,ke,be,w,ct,$e,H,X);if(Ni&&(Ji=Ni.placedGlyphBoxes,Ji&&Ji.box&&Ji.box.length)){ft=!0,Pt=Ni.shift;break}}return Ji};kr(()=>dn(yn,Xe.iconBox,o.aE.horizontal),()=>{const en=Xe.verticalTextBox;return en&&Rr(en),w.allowVerticalPlacement&&!(Lt&&Lt.box&&Lt.box.length)&&pt>0&&en?dn(en,Xe.verticalIconBox,o.aE.vertical):{box:null,offscreen:null,occluded:null}}),Lt&&(ft=Lt.box,Ye=Lt.offscreen,lt=Lt.occluded);const Rn=Jr(!(!Lt||!Lt.box));if(!ft&&this.prevPlacement){const en=this.prevPlacement.variableOffsets[dt];en&&(this.variableOffsets[dt]=en,this.markUsedJustification(w,en.anchor,ke,Rn))}}else{const xr=(dn,Rn)=>{const en=w.getSymbolInstanceTextSize(H,ke,this.transform.zoom,be),pn=this.collisionIndex.placeCollisionBox(w,en,dn,new o.P(0,0),ce,B,I,Y.predicate);return pn&&pn.box&&pn.box.length&&(this.markUsedOrientation(w,Rn,ke),this.placedOrientations[dt]=Rn),pn};kr(()=>xr(yn,o.aE.horizontal),()=>{const dn=Xe.verticalTextBox;return w.allowVerticalPlacement&&pt>0&&dn?(Rr(dn),xr(dn,o.aE.vertical)):{box:null,offscreen:null,occluded:null}}),Jr(!!(Lt&&Lt.box&&Lt.box.length))}}if(It=Lt,ft=It&&It.box&&It.box.length>0,Ye=It&&It.offscreen,lt=It&&It.occluded,ke.useRuntimeCollisionCircles){const Jr=w.text.placedSymbolArray.get(ke.centerJustifiedTextSymbolIndex>=0?ke.centerJustifiedTextSymbolIndex:ke.verticalPlacedTextSymbolIndex),kr=o.aF(w.textSizeData,H,Jr),xr=S.get("text-padding");it=this.collisionIndex.placeCollisionCircles(w,ce,Jr,w.lineVertexArray,w.glyphOffsetArray,kr,I,O,D,_,_e,Y.predicate,ke.collisionCircleDiameter*kr/o.bN,xr,this.retainedQueryData[w.bucketInstanceId].tileID),ft=ce||it.circles.length>0&&!it.collisionDetected,Ye=Ye&&it.offscreen,lt=it.occluded}if(Xe.iconFeatureIndex&&(yr=Xe.iconFeatureIndex),Xe.iconBox){const Jr=kr=>{Rr(kr);const xr=ke.hasIconTextFit&&Pt?ru(Pt.x,Pt.y,ge,_e,this.transform.angle):new o.P(0,0),dn=w.getSymbolInstanceIconSize(X,this.transform.zoom,ke.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,dn,kr,xr,he,B,I,Y.predicate)};Ot&&Ot.box&&Ot.box.length&&Xe.verticalIconBox?(jt=Jr(Xe.verticalIconBox),Fe=jt.box.length>0):(jt=Jr(Xe.iconBox),Fe=jt.box.length>0),Ye=Ye&&jt.offscreen,Ct=jt.occluded}const Pr=K||ke.numHorizontalGlyphVertices===0&&pt===0,pr=ue||ke.numIconVertices===0;if(Pr||pr?pr?Pr||(Fe=Fe&&ft):ft=Fe&&ft:Fe=ft=Fe&&ft,ft&&It&&It.box&&this.collisionIndex.insertCollisionBox(It.box,S.get("text-ignore-placement"),w.bucketInstanceId,Ot&&Ot.box&&lr?lr:Er,Y.ID),Fe&&jt&&this.collisionIndex.insertCollisionBox(jt.box,S.get("icon-ignore-placement"),w.bucketInstanceId,yr,Y.ID),it&&(ft&&this.collisionIndex.insertCollisionCircles(it.circles,S.get("text-ignore-placement"),w.bucketInstanceId,Er,Y.ID),_)){const Jr=w.bucketInstanceId;let kr=this.collisionCircleArrays[Jr];kr===void 0&&(kr=this.collisionCircleArrays[Jr]=new td);for(let xr=0;xr<it.circles.length;xr+=4)kr.circles.push(it.circles[xr+0]),kr.circles.push(it.circles[xr+1]),kr.circles.push(it.circles[xr+2]),kr.circles.push(it.collisionDetected?1:0)}const sn=w.projection.name!=="globe";fe=fe&&(sn||!lt),Pe=Pe&&(sn||!Ct),this.placements[dt]=new ja(ft||fe,Fe||Pe,Ye||w.justReloaded),c.add(dt)};if(ee&&this.buildingIndex&&(this.buildingIndex.updateZOffset(w,this.retainedQueryData[w.bucketInstanceId].tileID),w.updateZOffset()),Se){const ke=w.getSortedSymbolIndexes(this.transform.angle);for(let be=ke.length-1;be>=0;--be){const Xe=ke[be];We(w.symbolInstances.get(Xe),Xe,w.collisionArrays[Xe])}w.hasAnyZOffset&&o.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const ke=w.getSortedIndexesByZOffset();for(let be=0;be<ke.length;++be){const Xe=ke[be];We(w.symbolInstances.get(Xe),Xe,w.collisionArrays[Xe])}}else for(let ke=i.symbolInstanceStart;ke<i.symbolInstanceEnd;ke++)We(w.symbolInstances.get(ke),ke,w.collisionArrays[ke]);if(_&&w.bucketInstanceId in this.collisionCircleArrays){const ke=this.collisionCircleArrays[w.bucketInstanceId];o.ad.invert(ke.invProjMatrix,I),ke.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(i,c,_,x){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:O,crossTileID:D}=_,z=o.cJ(c),B=x===o.aE.vertical?O:z==="left"?w:z==="center"?S:z==="right"?I:-1;w>=0&&(i.text.placedSymbolArray.get(w).crossTileID=B>=0&&w!==B?0:D),S>=0&&(i.text.placedSymbolArray.get(S).crossTileID=B>=0&&S!==B?0:D),I>=0&&(i.text.placedSymbolArray.get(I).crossTileID=B>=0&&I!==B?0:D),O>=0&&(i.text.placedSymbolArray.get(O).crossTileID=B>=0&&O!==B?0:D)}markUsedOrientation(i,c,_){const x=c===o.aE.horizontal||c===o.aE.horizontalOnly?c:0,w=c===o.aE.vertical?c:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:D}=_,z=i.text.placedSymbolArray;S>=0&&(z.get(S).placedOrientation=x),I>=0&&(z.get(I).placedOrientation=x),O>=0&&(z.get(O).placedOrientation=x),D>=0&&(z.get(D).placedOrientation=w)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let _=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const x=c?c.symbolFadeChange(i):1,w=c?c.opacities:{},S=c?c.variableOffsets:{},I=c?c.placedOrientations:{};for(const O in this.placements){const D=this.placements[O],z=w[O];z?(this.opacities[O]=new Hu(z,x,D.text,D.icon,null,D.clipped),_=_||D.text!==z.text.placed||D.icon!==z.icon.placed):(this.opacities[O]=new Hu(null,x,D.text,D.icon,D.skipFade,D.clipped),_=_||D.text||D.icon)}for(const O in w){const D=w[O];if(!this.opacities[O]){const z=new Hu(D,x,!1,!1);z.isHidden()||(this.opacities[O]=z,_=_||D.text.placed||D.icon.placed)}}for(const O in S)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=S[O]);for(const O in I)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=I[O]);_?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:i)}updateLayerOpacities(i,c,_,x){const w=new Set;for(const S of c){const I=S.getBucket(i);I&&S.latestFeatureIndex&&i.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,w,S.collisionBoxArray,_,x,S.tileID),I.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(I,S.tileID),I.updateZOffset()))}}updateBucketOpacities(i,c,_,x,w,S){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const I=i.layers[0].layout,O=!!i.layers[0].dynamicFilter(),D=new Hu(null,0,!1,!1,!0),z=I.get("text-allow-overlap"),B=I.get("icon-allow-overlap"),j=I.get("text-variable-anchor"),$=I.get("text-rotation-alignment")==="map",H=I.get("text-pitch-alignment")==="map",X=new Hu(null,0,z&&(B||!i.hasIconData()||I.get("icon-optional")),B&&(z||!i.hasTextData()||I.get("text-optional")),!0);!i.collisionArrays&&_&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(_);const Y=(ue,ce,he)=>{for(let ge=0;ge<ce/4;ge++)ue.opacityVertexArray.emplaceBack(he)};let K=0;w&&i.updateReplacement(S,w);for(let ue=0;ue<i.symbolInstances.length;ue++){const ce=i.symbolInstances.get(ue),{numHorizontalGlyphVertices:he,numVerticalGlyphVertices:ge,crossTileID:_e,numIconVertices:Se,tileAnchorX:ee,tileAnchorY:fe}=ce,Pe=c.has(_e);let We=this.opacities[_e];Pe?We=D:We||(We=X,this.opacities[_e]=We),c.add(_e);const ke=he>0||ge>0,be=Se>0,Xe=this.placedOrientations[_e],dt=Xe===o.aE.vertical,pt=Xe===o.aE.horizontal||Xe===o.aE.horizontalOnly;!ke&&!be||We.isHidden()||K++;let ft=!1;if((ke||be)&&w)for(const Fe of i.activeReplacements){if(Fe.order<x||Fe.order===1/0||!(Fe.clipMask&o.cu.Symbol)||Fe.min.x>ee||ee>Fe.max.x||Fe.min.y>fe||fe>Fe.max.y)continue;const Ye=o.cH(ee,fe,S.canonical,Fe.footprintTileId.canonical);if(ft=o.cI(Ye,Fe),ft)break}if(ke){const Fe=ft?So:Dh(We.text);Y(i.text,he,dt?So:Fe),Y(i.text,ge,pt?So:Fe);const Ye=We.text.isHidden(),{leftJustifiedTextSymbolIndex:lt,centerJustifiedTextSymbolIndex:Ct,rightJustifiedTextSymbolIndex:Pt,verticalPlacedTextSymbolIndex:Lt}=ce,Ot=i.text.placedSymbolArray,It=Ye||dt?1:0;lt>=0&&(Ot.get(lt).hidden=It),Ct>=0&&(Ot.get(Ct).hidden=It),Pt>=0&&(Ot.get(Pt).hidden=It),Lt>=0&&(Ot.get(Lt).hidden=Ye||pt?1:0);const it=this.variableOffsets[_e];it&&this.markUsedJustification(i,it.anchor,ce,Xe);const jt=this.placedOrientations[_e];jt&&(this.markUsedJustification(i,"left",ce,jt),this.markUsedOrientation(i,jt,ce))}if(be){const Fe=ft?So:Dh(We.icon),{placedIconSymbolIndex:Ye,verticalPlacedIconSymbolIndex:lt}=ce,Ct=i.icon.placedSymbolArray,Pt=We.icon.isHidden()?1:0;Ye>=0&&(Y(i.icon,Se,dt?So:Fe),Ct.get(Ye).hidden=Pt),lt>=0&&(Y(i.icon,ce.numVerticalIconVertices,pt?So:Fe),Ct.get(lt).hidden=Pt)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Fe=i.collisionArrays[ue];if(Fe){let Ye=new o.P(0,0),lt=!0;if(Fe.textBox||Fe.verticalTextBox){if(j){const Pt=this.variableOffsets[_e];Pt?(Ye=Zu(Pt.anchor,Pt.width,Pt.height,Pt.textOffset,Pt.textScale),$&&Ye._rotate(H?this.transform.angle:-this.transform.angle)):lt=!1}O&&(lt=!We.clipped),Fe.textBox&&Xu(i.textCollisionBox.collisionVertexArray,We.text.placed,!lt||dt,Ye.x,Ye.y),Fe.verticalTextBox&&Xu(i.textCollisionBox.collisionVertexArray,We.text.placed,!lt||pt,Ye.x,Ye.y)}const Ct=lt&&!!(!pt&&Fe.verticalIconBox);Fe.iconBox&&Xu(i.iconCollisionBox.collisionVertexArray,We.icon.placed,Ct,ce.hasIconTextFit?Ye.x:0,ce.hasIconTextFit?Ye.y:0),Fe.verticalIconBox&&Xu(i.iconCollisionBox.collisionVertexArray,We.icon.placed,!Ct,ce.hasIconTextFit?Ye.x:0,ce.hasIconTextFit?Ye.y:0)}}}if(i.fullyClipped=K===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const ue=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ue.invProjMatrix,i.placementViewportMatrix=ue.viewportMatrix,i.collisionCircleArray=ue.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,c){const _=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*_>i}setStale(){this.stale=!0}}function Xu(p,i,c,_,x){p.emplaceBack(i?1:0,c?1:0,_||0,x||0),p.emplaceBack(i?1:0,c?1:0,_||0,x||0),p.emplaceBack(i?1:0,c?1:0,_||0,x||0),p.emplaceBack(i?1:0,c?1:0,_||0,x||0)}const ss=Math.pow(2,25),fm=Math.pow(2,24),At=Math.pow(2,17),my=Math.pow(2,16),dm=Math.pow(2,9),pm=Math.pow(2,8),_y=Math.pow(2,1);function Dh(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const i=p.placed?1:0,c=Math.floor(127*p.opacity);return c*ss+i*fm+c*At+i*my+c*dm+i*pm+c*_y+i}const So=0;class mm{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,c,_,x,w){const S=this._bucketParts;for(;this._currentTileIndex<i.length;)if(c.getBucketParts(S,x,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((I,O)=>I.sortKey-O.sortKey));this._currentPartIndex<S.length;){const I=S[this._currentPartIndex];if(c.placeLayerBucketPart(I,this._seenCrossTileIDs,_,I.symbolInstanceStart===0),this._currentPartIndex++,w())return!0}return!1}}class nu{constructor(i,c,_,x,w,S,I,O,D){this.placement=new py(i,w,S,I,O,D),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(i,c,_,x){const w=o.e.now(),S=()=>{const I=o.e.now()-w;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=c[i[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=O)&&(!I.maxzoom||I.maxzoom>O)){const D=I,z=D.layout.get("symbol-z-elevate"),B=this._inProgressLayer=this._inProgressLayer||new mm(D),j=o.al(I.source,I.scope);if(B.continuePlacement(z?x[j]:_[j],this.placement,this._showCollisionBoxes,I,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Yu=512/o.a3/2;class Ku{constructor(i,c,_){this.tileID=i,this.bucketInstanceId=_,this.index=new o.cK(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=i.canonical.x*o.a3,w=i.canonical.y*o.a3;for(let S=0;S<c.length;S++){const{key:I,crossTileID:O,tileAnchorX:D,tileAnchorY:z}=c.get(S),B=Math.floor((x+D)*Yu),j=Math.floor((w+z)*Yu);this.index.add(B,j),this.keys.push(I),this.crossTileIDs.push(O)}this.index.finish()}findMatches(i,c,_){const x=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),w=Yu/Math.pow(2,c.canonical.z-this.tileID.canonical.z),S=c.canonical.x*o.a3,I=c.canonical.y*o.a3;for(let O=0;O<i.length;O++){const D=i.get(O);if(D.crossTileID)continue;const{key:z,tileAnchorX:B,tileAnchorY:j}=D,$=Math.floor((S+B)*w),H=Math.floor((I+j)*w),X=this.index.range($-x,H-x,$+x,H+x);for(const Y of X){const K=this.crossTileIDs[Y];if(this.keys[Y]===z&&!_.has(K)){_.add(K),D.crossTileID=K;break}}}}}class y1{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class v1{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const c=Math.round((i-this.lng)/360);if(c!==0)for(const _ in this.indexes){const x=this.indexes[_],w={};for(const S in x){const I=x[S];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+c),w[I.tileID.key]=I}this.indexes[_]=w}this.lng=i}addBucket(i,c,_){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let w=0;w<c.symbolInstances.length;w++)c.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const x=this.usedCrossTileIDs[i.overscaledZ];for(const w in this.indexes){const S=this.indexes[w];if(Number(w)>i.overscaledZ)for(const I in S){const O=S[I];O.tileID.isChildOf(i)&&O.findMatches(c.symbolInstances,i,x)}else{const I=S[i.scaledTo(Number(w)).key];I&&I.findMatches(c.symbolInstances,i,x)}}for(let w=0;w<c.symbolInstances.length;w++){const S=c.symbolInstances.get(w);S.crossTileID||(S.crossTileID=_.generate(),x.add(S.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Ku(i,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(i,c){for(const _ of c.crossTileIDs)this.usedCrossTileIDs[i].delete(_)}removeStaleBuckets(i){let c=!1;for(const _ in this.indexes){const x=this.indexes[_];for(const w in x)i[x[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,x[w]),delete x[w],c=!0)}return c}}class _m{constructor(){this.layerIndexes={},this.crossTileIDs=new y1,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,c,_,x){let w=this.layerIndexes[i.fqid];w===void 0&&(w=this.layerIndexes[i.fqid]=new v1);let S=!1;const I={};x.name!=="globe"&&w.handleWrapJump(_);for(const O of c){const D=O.getBucket(i);D&&i.fqid===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(O.tileID,D,this.crossTileIDs)&&(S=!0),I[D.bucketInstanceId]=!0)}return w.removeStaleBuckets(I)&&(S=!0),S}pruneUnusedLayers(i){const c={};i.forEach(_=>{c[_]=!0});for(const _ in this.layerIndexes)c[_]||delete this.layerIndexes[_]}}const x1=new o.N({data:new o.O(o.L.colorTheme.data)}),gl=(p,i)=>gr(p,i&&i.filter(c=>c.identifier!=="source.canvas")),gy=o.ah(Fr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),gm=o.ah(Fr,["setCenter","setZoom","setBearing","setPitch"]),yy={version:8,layers:[],sources:{}},vy={duration:300,delay:0};class Us extends o.E{constructor(i,c={}){super(),this.map=i,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=o.W({},vy),this._buildingIndex=new Ah(this),this.crossTileSymbolIndex=new _m,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerIndices=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=c.styleChanges||new Me,this.dispatcher=c.dispatcher?c.dispatcher:new o.bw(o.bx(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new Is,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new o.cM(i._requestManager,c.localFontFamily?o.cN.all:c.localIdeographFontFamily?o.cN.ideographs:o.cN.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new Da(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._config=c.config,this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",o.cO());const _=this;this._rtlTextPluginCallback=Us.registerForPluginStateChange(x=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(w,S)=>{if(o.cP(w),S&&S.every(I=>I))for(const I in _._sourceCaches){const O=_._sourceCaches[I],D=O.getSource().type;D!=="vector"&&D!=="geojson"||O.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const w=this.getOwnSource(x.sourceId);if(w&&w.vectorLayerIds)for(const S in this._layers){const I=this._layers[S];I.source===w.id&&this._validateLayer(I)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(o.cQ(i))return i;const c=o.cR(i);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${o.cS(JSON.stringify(i))}`}_diffStyle(i,c,_){this.globalId=this._getGlobalId(i);const x=(w,S)=>{try{S(null,this.setState(w,_))}catch(I){S(I,!1)}};if(typeof i=="string"){const w=this.map._requestManager.normalizeStyleURL(i),S=this.map._requestManager.transformRequest(w,o.R.Style);o.g(S,(I,O)=>{I?this.fire(new o.d(I)):O&&x(O,c)})}else typeof i=="object"&&x(i,c)}loadURL(i,c={}){this.fire(new o.f("dataloading",{dataType:"style"}));const _=typeof c.validate=="boolean"?c.validate:!o.cQ(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,c.accessToken),this.resolvedImports.add(i);const x=this.importsCache.get(i);if(x)return this._load(x,_);const w=this.map._requestManager.transformRequest(i,o.R.Style);this._request=o.g(w,(S,I)=>{if(this._request=null,S)this.fire(new o.d(S));else if(I)return this.importsCache.set(i,I),this._load(I,_)})}loadJSON(i,c={}){this.fire(new o.f("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=o.e.frame(()=>{this._request=null,this._load(i,c.validate!==!1)})}loadEmpty(){this.fire(new o.f("dataloading",{dataType:"style"})),this._load(yy,!1)}_loadImports(i,c,_){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const w of i){const S=this._createFragmentStyle(w),I=new Promise(z=>{S.once("style.import.load",z),S.once("error",z)}).then(()=>this.mergeAll());if(x.push(I),this.resolvedImports.has(w.url)){S.loadEmpty();continue}const O=w.data||this.importsCache.get(w.url);O?(S.loadJSON(O,{validate:c}),this._isInternalStyle(O)&&(S.globalId=null)):w.url?S.loadURL(w.url,{validate:c}):S.loadEmpty();const D={style:S,id:w.id,config:w.config};if(_){const z=this.fragments.findIndex(({id:B})=>B===_);this.fragments=this.fragments.slice(0,z).concat(D).concat(this.fragments.slice(z))}else this.fragments.push(D)}return Promise.allSettled(x)}getImportGlobalIds(i=this,c=new Set){for(const _ of i.fragments)_.style.globalId&&c.add(_.style.globalId),this.getImportGlobalIds(_.style,c);return[...c.values()]}_createFragmentStyle(i){const c=this.scope?o.al(i.id,this.scope):i.id;let _;const x=this._initialConfig&&this._initialConfig[c];(i.config||x)&&(_=o.W({},i.config,x));const w=new Us(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:_,configOptions:this.options,configDependentLayers:this._configDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,c){const _=i.schema;if(this._isInternalStyle(i)){const S=o.W({},yy,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(S,c)}if(this.updateConfig(this._config,_),c&&gl(this,ve(i)))return;this._loaded=!0,this.stylesheet=o.cT(i);const x=()=>{for(const D in i.sources)this.addSource(D,i.sources[D],{validate:!1,isInitialLoad:!0});i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(i.glyphs,this.scope);const S=cy(this.stylesheet.layers);if(this._order=S.map(D=>D.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const D=this.stylesheet.lights[0];this.light=new $t(D.properties,D.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new $t(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const D of S){const z=o.cY(D,this.scope,this._styleColorTheme.lut,this.options);z.isConfigDependent&&this._configDependentLayers.add(z.fqid),z.setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z,this._serializedLayers[z.id]=z.serialize();const B=this.getOwnLayerSourceCache(z),j=!!this.directionalLight&&this.directionalLight.shadowsEnabled();B&&z.canCastShadows()&&j&&(B.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const I=this.stylesheet.terrain;I&&(this.checkCanvasFingerprintNoise(),this.terrainSetForDrapingOnly()||this._createTerrain(I,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.f("data",{dataType:"style"}));const O=this.isRootStyle();i.imports?this._loadImports(i.imports,c).then(()=>{this._reloadImports(),this.fire(new o.f(O?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.f(O?"style.load":"style.import.load")))},w=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=w,w){const S=this._evaluateColorThemeData(w);this._loadColorTheme(S).then(()=>{x()}).catch(I=>{o.w(`Couldn't load color theme from the stylesheet: ${I}`),x()})}else this._styleColorTheme.lut=null,x()}isRootStyle(){return this.importDepth===0}mergeAll(){let i,c,_,x,w,S,I,O;const D={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(z=>{if(z.stylesheet){if(z.light!=null&&(i=z.light),z.stylesheet.lights)for(const B of z.stylesheet.lights)B.type==="ambient"&&z.ambientLight!=null&&(c=z.ambientLight),B.type==="directional"&&z.directionalLight!=null&&(_=z.directionalLight);x=this._prioritizeTerrain(x,z.terrain,z.stylesheet.terrain),z.stylesheet.fog&&z.fog!=null&&(w=z.fog),z.stylesheet.camera!=null&&(O=z.stylesheet.camera),z.stylesheet.projection!=null&&(S=z.stylesheet.projection),z.stylesheet.transition!=null&&(I=z.stylesheet.transition),D[z.scope]=z._styleColorTheme}}),this.light=i,this.ambientLight=c,this.directionalLight=_,this.fog=w,this._styleColorThemeForScope=D,x===null?delete this.terrain:this.terrain=x,this.camera=O||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=o.W({},vy,I),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){const c=_=>{for(const x of _.fragments)c(x.style);i(_)};c(this)}_prioritizeTerrain(i,c,_){const x=i&&i.drapeRenderMode===0;return _===null?c&&c.drapeRenderMode===0?c:x?i:null:c!=null&&(!i||x||c&&c.drapeRenderMode===1)?c:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{i=this._prioritizeTerrain(i,c.terrain,c.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(i=c.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){const i={},c={},_={};this.forEachFragmentStyle(x=>{for(const w in x._sourceCaches){const S=o.al(w,x.scope);i[S]=x._sourceCaches[w]}for(const w in x._otherSourceCaches){const S=o.al(w,x.scope);c[S]=x._otherSourceCaches[w]}for(const w in x._symbolSourceCaches){const S=o.al(w,x.scope);_[S]=x._symbolSourceCaches[w]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=_}mergeLayers(){const i={},c=[],_={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(const I of S._order){const O=S._layers[I];if(O.type==="slot"){const D=o.cU(I);if(i[D])continue;i[D]=[]}O.slot&&i[O.slot]?i[O.slot].push(O):c.push(O)}}),this._mergedOrder=[],this._clipLayerIndices=[];let x=0;const w=(S=[])=>{for(const I of S)if(I.type==="slot"){const O=o.cU(I.id);i[O]&&w(i[O]),this._mergedSlots.push(O)}else{const O=o.al(I.id,I.scope);this._mergedOrder.push(O),_[O]=I,I.is3D()&&(this._has3DLayers=!0),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0),I.type==="clip"&&this._clipLayerIndices.push(x),x++}};w(c),this._mergedLayers=_,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=o.W({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?function(c,_,x){const w=o.W({},_);for(const I of Object.keys(o.L.colorTheme))w[I]===void 0&&(w[I]=o.L.colorTheme[I].default);const S=new o.U(x1,c,new Map(x));return S.setTransitionOrValue(w,x),S.untransitioned().possiblyEvaluate(new o.X(0))}(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((_,x)=>{const w="data:image/png;base64,";if(!i||i.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void _();let S=i;S.startsWith(w)||(S=w+S);const I="mapbox-reserved-lut",O=new Image;O.src=S,O.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},O.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void _();this._styleColorTheme.lutLoading=!1;const{width:D,height:z,data:B}=o.e.getImageData(O);if(z>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(D!==z*z)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new o.i({width:D,height:z},B),pixelRatio:1,sdf:!1,version:0});const j=this.imageManager.getImage(I,this.scope);j?(this._styleColorTheme.lut={image:j.data,data:i},_()):x(new Error("Missing LUT image."))}})}getLut(i){const c=this._styleColorThemeForScope[i];return c?c.lut:null}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(c,_,x){let w,S,I;const O=o.e.devicePixelRatio>1?"@2x":"";let D=o.g(_.transformRequest(_.normalizeSpriteURL(c,O,".json"),o.R.SpriteJSON),(j,$)=>{D=null,I||(I=j,w=$,B())}),z=o.h(_.transformRequest(_.normalizeSpriteURL(c,O,".png"),o.R.SpriteImage),(j,$)=>{z=null,I||(I=j,S=$,B())});function B(){if(I)x(I);else if(w&&S){const j=o.e.getImageData(S),$={};for(const H in w){const{width:X,height:Y,x:K,y:ue,sdf:ce,pixelRatio:he,stretchX:ge,stretchY:_e,content:Se}=w[H],ee=new o.i({width:X,height:Y});o.i.copy(j,ee,{x:K,y:ue},{x:0,y:0},{width:X,height:Y},null),$[H]={data:ee,pixelRatio:he,sdf:ce,stretchX:ge,stretchY:_e,content:Se}}x(null,$)}}return{cancel(){D&&(D.cancel(),D=null),z&&(z.cancel(),z=null)}}}(i,this.map._requestManager,(c,_)=>{if(this._spriteRequest=null,c)this.fire(new o.d(c));else if(_)for(const x in _)this.imageManager.addImage(x,this.scope,_[x]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.f("data",{dataType:"style"}))})}_validateLayer(i){const c=this.getOwnSource(i.source);if(!c)return;const _=i.sourceLayer;_&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(_)===-1)&&this.fire(new o.d(new Error(`Source layer "${_}" does not exist on source "${c.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,c)=>{const _=this.fragments[c];return _&&_.style&&(i.data=_.style.serialize()),i})}_serializeSources(){const i={};for(const c in this._sourceCaches){const _=this._sourceCaches[c].getSource();i[_.id]||(i[_.id]=_.serialize())}return i}_serializeLayers(i){const c=[];for(const _ of i){const x=this._layers[_];x&&x.type!=="custom"&&c.push(x.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const c=this.getOwnLayer(i);if(c)return c;this.fire(new o.d(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const c=this.getOwnSource(i);if(c)return c;this.fire(new o.d(new Error(`The source '${i}' does not exist in the map's style.`)))}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const c=this.calculateLightsBrightness();i.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c));const _=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const I in S){const{updatedIds:O,removedIds:D}=S[I];(O||D)&&(this._updateWorkerLayers(I,O,D),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._changes.reset()}const w={};for(const S in this._mergedSourceCaches){const I=this._mergedSourceCaches[S];w[S]=I.used,I.used=!1,I.tileCoverLift=0}for(const S of this._mergedOrder){const I=this._mergedLayers[S];if(I.recalculate(i,this._availableImages),!I.isHidden(i.zoom)){const O=this.getLayerSourceCache(I);O&&(O.used=!0,O.tileCoverLift=Math.max(O.tileCoverLift,I.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let O=I.minzoom||0;O<(I.maxzoom||25.5);O++){const D=this.map.painter;if(D){const z=I.getProgramIds();if(!z)continue;for(const B of z){const j=I.getDefaultProgramParams(B,i.zoom,this._styleColorTheme.lut);j&&(D.style=this,this.fog&&(D._fogVisible=!0,j.overrideFog=!0,D.getOrCreateProgram(B,j)),D._fogVisible=!1,j.overrideFog=!1,D.getOrCreateProgram(B,j),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(j.overrideRtt=!0,D.getOrCreateProgram(B,j)))}}}}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();for(const S in w){const I=this._mergedSourceCaches[S];w[S]!==I.used&&I.getSource().fire(new o.f("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),_&&this.fire(new o.f("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=this._changes.getUpdatedImages();if(i.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],i);this._changes.resetUpdatedImages()}}_updateWorkerLayers(i,c,_){const x=this.getFragmentStyle(i);x&&this.dispatcher.broadcast("updateLayers",{layers:c?x._serializeLayers(c):[],scope:i,removedIds:_||[],options:x.options})}setState(i,c){if(this._checkLoaded(),gl(this,ve(i)))return!1;(i=o.cT(i)).layers=cy(i.layers);const _=function(S,I){if(!S)return[{command:Fr.setStyle,args:[I]}];let O=[];try{if(!R(S.version,I.version))return[{command:Fr.setStyle,args:[I]}];if(R(S.center,I.center)||O.push({command:Fr.setCenter,args:[I.center]}),R(S.zoom,I.zoom)||O.push({command:Fr.setZoom,args:[I.zoom]}),R(S.bearing,I.bearing)||O.push({command:Fr.setBearing,args:[I.bearing]}),R(S.pitch,I.pitch)||O.push({command:Fr.setPitch,args:[I.pitch]}),R(S.sprite,I.sprite)||O.push({command:Fr.setSprite,args:[I.sprite]}),R(S.glyphs,I.glyphs)||O.push({command:Fr.setGlyphs,args:[I.glyphs]}),R(S.imports,I.imports)||function($=[],H=[],X){H=H||[];const Y=($=$||[]).map(Jf),K=H.map(Jf),ue=$.reduce(Oh,{}),ce=H.reduce(Oh,{}),he=Y.slice();let ge,_e,Se,ee;for(ge=0,_e=0;ge<Y.length;ge++)Se=Y[ge],ce.hasOwnProperty(Se)?_e++:(X.push({command:Fr.removeImport,args:[Se]}),he.splice(he.indexOf(Se,_e),1));for(ge=0,_e=0;ge<K.length;ge++)Se=K[K.length-1-ge],he[he.length-1-ge]!==Se&&(ue.hasOwnProperty(Se)?(X.push({command:Fr.removeImport,args:[Se]}),he.splice(he.lastIndexOf(Se,he.length-_e),1)):_e++,ee=he[he.length-ge],X.push({command:Fr.addImport,args:[ce[Se],ee]}),he.splice(he.length-ge,0,Se));for(const fe of H){const Pe=ue[fe.id];Pe&&!R(Pe,fe)&&X.push({command:Fr.updateImport,args:[fe.id,fe]})}}(S.imports,I.imports,O),R(S.transition,I.transition)||O.push({command:Fr.setTransition,args:[I.transition]}),R(S.light,I.light)||O.push({command:Fr.setLight,args:[I.light]}),R(S.fog,I.fog)||O.push({command:Fr.setFog,args:[I.fog]}),R(S.projection,I.projection)||O.push({command:Fr.setProjection,args:[I.projection]}),R(S.lights,I.lights)||O.push({command:Fr.setLights,args:[I.lights]}),R(S.camera,I.camera)||O.push({command:Fr.setCamera,args:[I.camera]}),!R(S["color-theme"],I["color-theme"]))return[{command:Fr.setStyle,args:[I]}];const D={},z=[];(function($,H,X,Y){let K;for(K in H=H||{},$=$||{})$.hasOwnProperty(K)&&(H.hasOwnProperty(K)||Ph(K,X,Y));for(K in H){if(!H.hasOwnProperty(K))continue;const ue=H[K];$.hasOwnProperty(K)?R($[K],ue)||($[K].type==="geojson"&&ue.type==="geojson"&&_1($,H,K)?X.push({command:Fr.setGeoJSONSourceData,args:[K,ue.data]}):_l(K,H,X,Y)):cm(K,H,X)}})(S.sources,I.sources,z,D);const B=[];S.layers&&S.layers.forEach($=>{$.source&&D[$.source]?O.push({command:Fr.removeLayer,args:[$.id]}):B.push($)});let j=S.terrain;j&&D[j.source]&&(O.push({command:Fr.setTerrain,args:[void 0]}),j=void 0),O=O.concat(z),R(j,I.terrain)||O.push({command:Fr.setTerrain,args:[I.terrain]}),function($,H,X){H=H||[];const Y=($=$||[]).map(Jf),K=H.map(Jf),ue=$.reduce(Oh,{}),ce=H.reduce(Oh,{}),he=Y.slice(),ge=Object.create(null);let _e,Se,ee,fe,Pe,We,ke;for(_e=0,Se=0;_e<Y.length;_e++)ee=Y[_e],ce.hasOwnProperty(ee)?Se++:(X.push({command:Fr.removeLayer,args:[ee]}),he.splice(he.indexOf(ee,Se),1));for(_e=0,Se=0;_e<K.length;_e++)ee=K[K.length-1-_e],he[he.length-1-_e]!==ee&&(ue.hasOwnProperty(ee)?(X.push({command:Fr.removeLayer,args:[ee]}),he.splice(he.lastIndexOf(ee,he.length-Se),1)):Se++,We=he[he.length-_e],X.push({command:Fr.addLayer,args:[ce[ee],We]}),he.splice(he.length-_e,0,ee),ge[ee]=!0);for(_e=0;_e<K.length;_e++)if(ee=K[_e],fe=ue[ee],Pe=ce[ee],!ge[ee]&&!R(fe,Pe))if(R(fe.source,Pe.source)&&R(fe["source-layer"],Pe["source-layer"])&&R(fe.type,Pe.type)){for(ke in Qf(fe.layout,Pe.layout,X,ee,null,Fr.setLayoutProperty),Qf(fe.paint,Pe.paint,X,ee,null,Fr.setPaintProperty),R(fe.slot,Pe.slot)||X.push({command:Fr.setSlot,args:[ee,Pe.slot]}),R(fe.filter,Pe.filter)||X.push({command:Fr.setFilter,args:[ee,Pe.filter]}),R(fe.minzoom,Pe.minzoom)&&R(fe.maxzoom,Pe.maxzoom)||X.push({command:Fr.setLayerZoomRange,args:[ee,Pe.minzoom,Pe.maxzoom]}),fe)fe.hasOwnProperty(ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&ke!=="slot"&&(ke.indexOf("paint.")===0?Qf(fe[ke],Pe[ke],X,ee,ke.slice(6),Fr.setPaintProperty):R(fe[ke],Pe[ke])||X.push({command:Fr.setLayerProperty,args:[ee,ke,Pe[ke]]}));for(ke in Pe)Pe.hasOwnProperty(ke)&&!fe.hasOwnProperty(ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&ke!=="slot"&&(ke.indexOf("paint.")===0?Qf(fe[ke],Pe[ke],X,ee,ke.slice(6),Fr.setPaintProperty):R(fe[ke],Pe[ke])||X.push({command:Fr.setLayerProperty,args:[ee,ke,Pe[ke]]}))}else X.push({command:Fr.removeLayer,args:[ee]}),We=he[he.lastIndexOf(ee)+1],X.push({command:Fr.addLayer,args:[Pe,We]})}(B,I.layers,O)}catch(D){console.warn("Unable to compute style diff:",D),O=[{command:Fr.setStyle,args:[I]}]}return O}(this.serialize(),i).filter(S=>!(S.command in gm));if(_.length===0)return!1;const x=_.filter(S=>!(S.command in gy));if(x.length>0)throw new Error(`Unimplemented: ${x.map(S=>S.command).join(", ")}.`);const w=[];return _.forEach(S=>{w.push(this[S.command].apply(this,S.args))}),c&&Promise.all(w).then(c),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(i,c){return this.getImage(i)?this.fire(new o.d(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,this.scope,c),this._afterImageUpdated(i),this)}updateImage(i,c){this.imageManager.updateImage(i,this.scope,c)}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._afterImageUpdated(i),this):this.fire(new o.d(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(i),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new o.f("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(i,c,_={}){return this._checkLoaded(),this._validate(br,`models.${i}`,c,null,_)||(this.modelManager.addModel(i,c,this.scope),this._changes.setDirty()),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this):this.fire(new o.d(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,c,_={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(we,`sources.${i}`,c,null,_))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const x=Pi(i,c,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const w=S=>{const I=(S?"symbol:":"other:")+x.id,O=o.al(I,this.scope),D=this._sourceCaches[I]=new o.bv(O,x,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=D,D.onAdd(this.map)};w(!1),c.type!=="vector"&&c.type!=="geojson"||w(!0),x.onAdd&&x.onAdd(this.map),_.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const c=this.getOwnSource(i);if(!c)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===i)return this.fire(new o.d(new Error(`Source "${i}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new o.d(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const _=this.getOwnSourceCaches(i);for(const x of _){const w=o.cU(x.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(x.id),x.fire(new o.f("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,c){this._checkLoaded(),this.getOwnSource(i).setData(c),this._changes.setDirty()}getOwnSource(i){const c=this.getOwnSourceCache(i);return c&&c.getSource()}getOwnSources(){const i=[];for(const c in this._otherSourceCaches){const _=this.getOwnSourceCache(c);_&&i.push(_.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const c in i){const _=i[c]._tiles;for(const x in _){const w=_[x];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const x of i){if(this._validate(qe,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(x),w.updateTransitions(c)}else this.ambientLight=new sa(x,mr,this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(x),w.updateTransitions(c)}else this.directionalLight=new sa(x,Cs,this.scope,this.options)}}const _=new o.X(this.z||0,c);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,c=this.ambientLight;if(!i||!c)return;const _=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),x=i.properties.get("color").toRenderColor(null).toArray01(),w=i.properties.get("intensity"),S=i.properties.get("direction"),I=1-o.ac(S.x,S.y,S.z)[2]/90,O=_(x)*w*I,D=c.properties.get("color").toRenderColor(null).toArray01(),z=c.properties.get("intensity");return(O+_(D)*z)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(!i)return this;if(o.cV(i)){const c=o.cW(i),_=this.fragments.find(({id:w})=>w===c);if(!_)throw new Error(`Style import not found: ${i}`);const x=o.cU(i);return _.style.getFragmentStyle(x)}{const c=this.fragments.find(({id:_})=>_===i);if(!c)throw new Error(`Style import not found: ${i}`);return c.style}}getConfigProperty(i,c){const _=this.getFragmentStyle(i);if(!_)return null;const x=o.al(c,_.scope),w=_.options.get(x),S=w?w.value||w.default:null;return S?S.serialize():null}setConfigProperty(i,c,_){const x=this.getFragmentStyle(i);if(!x)return;const w=x.stylesheet.schema;if(!w||!w[c])return;const S=o.y(_);if(S.result!=="success")return void gl(this,S.value);const I=S.value.expression,O=o.al(c,x.scope),D=x.options.get(O);if(!D)return;let z;const{minValue:B,maxValue:j,stepValue:$,type:H,values:X}=w[c],Y=o.y(w[c].default);Y.result==="success"&&(z=Y.value.expression),z?(this.options.set(O,{...D,value:I,default:z,minValue:B,maxValue:j,stepValue:$,type:H,values:X}),this.updateConfigDependencies()):this.fire(new o.d(new Error(`No schema defined for the config option "${c}" in the "${i}" fragment.`)))}getConfig(i){const c=this.getFragmentStyle(i);if(!c)return null;const _=c.stylesheet.schema;if(!_)return null;const x={};for(const w in _){const S=o.al(w,c.scope),I=c.options.get(S),O=I?I.value||I.default:null;x[w]=O?O.serialize():null}return x}setConfig(i,c){const _=this.getFragmentStyle(i);_&&(_.updateConfig(c,_.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){const c=this.getFragmentStyle(i);return c?c.stylesheet.schema:null}setSchema(i,c){const _=this.getFragmentStyle(i);_&&(_.stylesheet.schema=c,_.updateConfig(_._config,c),this.updateConfigDependencies())}updateConfig(i,c){if(this._config=i,i||c)if(c)for(const _ in c){let x,w;const S=o.y(c[_].default);if(S.result==="success"&&(x=S.value.expression),i&&i[_]!==void 0){const j=o.y(i[_]);j.result==="success"&&(w=j.value.expression)}const{minValue:I,maxValue:O,stepValue:D,type:z,values:B}=c[_];if(x){const j=o.al(_,this.scope);this.options.set(j,{default:x,value:w,minValue:I,maxValue:O,stepValue:D,type:z,values:B})}else this.fire(new o.d(new Error(`No schema defined for config option "${_}".`)))}else this.fire(new o.d(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const i of this._configDependentLayers){const c=this.getLayer(i);c&&(c.possiblyEvaluateVisibility(),this._updateLayer(c))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(i=>{if(i._styleColorTheme.colorTheme){const c=i._evaluateColorThemeData(i._styleColorTheme.colorTheme);(!i._styleColorTheme.lut||i._styleColorTheme.lut&&c!==i._styleColorTheme.lut.data)&&i.setColorTheme(i._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(i,c,_={}){this._checkLoaded();const x=i.id;if(this._layers[x])return void this.fire(new o.d(new Error(`Layer with id "${x}" already exists on this map`)));let w;if(i.type==="custom"){if(gl(this,o.cX(i)))return;w=o.cY(i,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof i.source=="object"&&(this.addSource(x,i.source),i=o.cT(i),i=o.W(i,{source:x})),this._validate(St,`layers.${x}`,i,{arrayIndex:-1},_))return;w=o.cY(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[w.id]=w.serialize()}w.isConfigDependent&&this._configDependentLayers.add(w.fqid);let S=this._order.length;if(c){const z=this._order.indexOf(c);if(z===-1)return void this.fire(new o.d(new Error(`Layer with id "${c}" does not exist on this map.`)));w.slot===this._layers[c].slot?S=z:o.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,x),this._layerOrderChanged=!0,this._layers[x]=w;const I=this.getOwnLayerSourceCache(w),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&w.canCastShadows()&&O&&(I.castsShadows=!0);const D=this._changes.getRemovedLayer(w);if(D&&w.source&&I&&w.type!=="custom"){this._changes.discardLayerRemoval(w);const z=o.al(w.source,w.scope);D.type!==w.type?this._changes.updateSourceCache(z,"clear"):(this._changes.updateSourceCache(z,"reload"),I.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(i,c){this._checkLoaded();const _=this._checkLayer(i);if(!_||i===c)return;const x=this._order.indexOf(i);this._order.splice(x,1);let w=this._order.length;if(c){const S=this._order.indexOf(c);if(S===-1)return void this.fire(new o.d(new Error(`Layer with id "${c}" does not exist on this map.`)));_.slot===this._layers[c].slot?w=S:o.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();const c=this._checkLayer(i);if(!c)return;c.setEventedParent(null);const _=this._order.indexOf(i);this._order.splice(_,1),delete this._layers[i],delete this._serializedLayers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const x=this.getOwnLayerSourceCache(c);if(x&&x.castsShadows){let w=!1;for(const S in this._layers)if(this._layers[S].source===c.source&&this._layers[S].canCastShadows()){w=!0;break}x.castsShadows=w}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const c in this._layers)if(this._layers[c].type===i)return!0;return!1}setLayerZoomRange(i,c,_){this._checkLoaded();const x=this._checkLayer(i);x&&(x.minzoom===c&&x.maxzoom===_||(c!=null&&(x.minzoom=c),_!=null&&(x.maxzoom=_),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(i,c){this._checkLoaded();const _=this._checkLayer(i);_&&_.slot!==c&&(_.slot=c,this._updateLayer(_))}setFilter(i,c,_={}){this._checkLoaded();const x=this._checkLayer(i);if(x&&!R(x.filter,c))return c==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(yt,`layers.${x.id}.filter`,c,{layerType:x.type},_)||(x.filter=o.cT(c),this._updateLayer(x)))}getFilter(i){const c=this._checkLayer(i);if(c)return o.cT(c.filter)}setLayoutProperty(i,c,_,x={}){this._checkLoaded();const w=this._checkLayer(i);if(w&&!R(w.getLayoutProperty(c),_)){if(_!=null&&(!x||x.validate!==!1)&&gl(w,Qt.call(ve,{key:`layers.${i}.layout.${c}`,layerType:w.type,objectKey:c,value:_,styleSpec:o.L,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(c,_),w.isConfigDependent&&this._configDependentLayers.add(w.fqid),this._updateLayer(w)}}getLayoutProperty(i,c){const _=this._checkLayer(i);if(_)return _.getLayoutProperty(c)}setPaintProperty(i,c,_,x={}){this._checkLoaded();const w=this._checkLayer(i);if(!w||R(w.getPaintProperty(c),_)||_!=null&&(!x||x.validate!==!1)&&gl(w,Ht.call(ve,{key:`layers.${i}.paint.${c}`,layerType:w.type,objectKey:c,value:_,styleSpec:o.L})))return;const S=w.setPaintProperty(c,_);w.isConfigDependent&&this._configDependentLayers.add(w.fqid),S&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(i,c){const _=this._checkLayer(i);if(_)return _.getPaintProperty(c)}setFeatureState(i,c){this._checkLoaded();const _=i.source,x=i.sourceLayer,w=this._checkSource(_);if(!w)return;const S=w.type;if(S==="geojson"&&x)return void this.fire(new o.d(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!x)return void this.fire(new o.d(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new o.d(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(_);for(const O of I)O.setFeatureState(x,i.id,c)}removeFeatureState(i,c){this._checkLoaded();const _=i.source,x=this._checkSource(_);if(!x)return;const w=x.type,S=w==="vector"?i.sourceLayer:void 0;if(w==="vector"&&!S)return void this.fire(new o.d(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new o.d(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(_);for(const O of I)O.removeFeatureState(S,i.id,c)}getFeatureState(i){this._checkLoaded();const c=i.source,_=i.sourceLayer,x=this._checkSource(c);if(x){if(x.type!=="vector"||_)return i.id===void 0&&this.fire(new o.d(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(_,i.id);this.fire(new o.d(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=o.W({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return o.W({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),c=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return o.cZ({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},_=>_!==void 0)}_updateLayer(i){this._changes.updateLayer(i);const c=this.getLayerSourceCache(i),_=o.al(i.source,i.scope),x=this._changes.getUpdatedSourceCaches();i.source&&!x[_]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(_,"reload"),c.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const c=I=>this._mergedLayers[I].type==="fill-extrusion"||this._mergedLayers[I].type==="model",_=this.order,x={},w=[];for(let I=_.length-1;I>=0;I--){const O=_[I];if(c(O)){x[O]=I;for(const D of i){const z=D[O];if(z)for(const B of z)w.push(B)}}}w.sort((I,O)=>O.intersectionZ-I.intersectionZ);const S=[];for(let I=_.length-1;I>=0;I--){const O=_[I];if(c(O))for(let D=w.length-1;D>=0;D--){const z=w[D].feature;if(z.layer&&x[z.layer.id]<I)break;S.push(z),w.pop()}else for(const D of i){const z=D[O];if(z)for(const B of z)S.push(B.feature)}}return S}queryRenderedFeatures(i,c,_){c&&c.filter&&this._validate(yt,"queryRenderedFeatures.filter",c.filter,null,c),c.scope=this.scope,c.availableImages=this._availableImages,c.serializedLayers=this._serializedLayers;const x={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new o.d(new Error("parameters.layers must be an Array."))),[];for(const D of c.layers){const z=this._mergedLayers[D];if(!z)return this.fire(new o.d(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];x[z.source]=!0}}const w=[],S=c.serializedLayers||{},I=c&&c.layers?c.layers.some(D=>{const z=this.getLayer(D);return z&&z.is3D()}):this.has3DLayers(),O=Kf.createFromScreenPoints(i,_);for(const D in this._mergedSourceCaches){const z=this._mergedSourceCaches[D].getSource();if(!z||z.scope!==c.scope)continue;const B=this._mergedSourceCaches[D].getSource().id;c.layers&&!x[B]||w.push(Ih(this._mergedSourceCaches[D],this._mergedLayers,S,O,c,_,I,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(D,z,B,j,$,H,X){const Y={},K=H.queryRenderedSymbols(j),ue=[];for(const ce of Object.keys(K).map(Number))ue.push(X[ce]);ue.sort(uy);for(const ce of ue){const he=ce.featureIndex.lookupSymbolFeatures(K[ce.bucketInstanceId],z,ce.bucketIndex,ce.sourceLayerIndex,$.filter,$.layers,$.availableImages,D);for(const ge in he){const _e=Y[ge]=Y[ge]||[],Se=he[ge];Se.sort((ee,fe)=>{const Pe=ce.featureSortOrder;if(Pe){const We=Pe.indexOf(ee.featureIndex);return Pe.indexOf(fe.featureIndex)-We}return fe.featureIndex-ee.featureIndex});for(const ee of Se)_e.push(ee)}}for(const ce in Y)Y[ce].forEach(he=>{const ge=he.feature,_e=B(D[ce]);if(!_e)return;const Se=_e.getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=Se});return Y}(this._mergedLayers,S,this.getLayerSourceCache.bind(this),O.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(i,c){c&&c.filter&&this._validate(yt,"querySourceFeatures.filter",c.filter,null,c);const _=this.getOwnSourceCaches(i);let x=[];for(const w of _)x=x.concat(m1(w,c));return x}addSourceType(i,c,_){return Us.getSourceType(i)?_(new Error(`A source type called "${i}" already exists.`)):(Us.setSourceType(i,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:c.workerSourceURL},_):_(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,c,_={}){this._checkLoaded();const x=this.light.getLight();let w=!1;for(const I in i)if(!R(i[I],x[I])){w=!0;break}if(!w)return;const S=this._getTransitionParameters();this.light.setLight(i,c,_),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.e.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,c=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()&&c!==0||delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let _=i;const x=i.source==null;if(c===1){if(this.disableElevatedTerrain)return;if(typeof _.source=="object"){const I="terrain-dem-src";this.addSource(I,_.source),_=o.cT(_),_=o.W(_,{source:I})}const w=o.W({},_),S={};if(this.terrain&&x){w.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(S.style=I.serialize())}if(this._validate(Le,"terrain",w,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&c!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,c),this.fire(new o.f("data",{dataType:"style"}))}else{const w=this.terrain,S=w.get();for(const I of Object.keys(o.L.terrain))!_.hasOwnProperty(I)&&o.L.terrain[I].default&&(_[I]=o.L.terrain[I].default);for(const I in i)if(!R(i[I],S[I])){w.set(i,this.options),this.stylesheet.terrain=i;const O=this._getTransitionParameters({duration:0});w.updateTransitions(O),this.fire(new o.f("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const c=this.fog=new oa(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const _=this._getTransitionParameters({duration:0});c.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!R(c.get(),i)){c.set(i,this.options),this.stylesheet.fog=c.get();const _=this._getTransitionParameters({duration:0});c.updateTransitions(_)}}else this._createFog(i);this._markersNeedUpdate=!0}setColorTheme(i){this._checkLoaded();const c=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()};if(this._styleColorTheme.colorTheme=i,!i)return this._styleColorTheme.lut=null,void c();const _=this._evaluateColorThemeData(i);this._loadColorTheme(_).then(()=>{this.fire(new o.f("colorthemeset")),c()}).catch(x=>{o.w(`Couldn't set color theme: ${x}`)})}_getTransitionParameters(i){return{now:o.e.now(),transition:o.W(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],c=[];for(const _ in this._mergedLayers)this.isLayerDraped(this._mergedLayers[_])?i.push(_):c.push(_);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...c)}_createTerrain(i,c){const _=this.terrain=new Zr(i,c,this.scope,this.options);c===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});_.updateTransitions(x)}_force3DLayerUpdate(){for(const i in this._layers){const c=this._layers[i];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const c=this._layers[i];c.type==="symbol"&&this._updateLayer(c)}}_validate(i,c,_,x,w={}){if(w&&w.validate===!1)return!1;const S=o.W({},this.serialize());return gl(this,i.call(ve,o.W({key:c,style:S,value:_,styleSpec:o.L},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.c_.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(i){const c=this.getSourceCaches(i);for(const _ of c)_.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}reloadSource(i){const c=this.getSourceCaches(i);for(const _ of c)_.resume(),_.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}updateSources(i){let c;this.directionalLight&&(c=kf(this.directionalLight));for(const _ in this._mergedSourceCaches)this._mergedSourceCaches[_].update(i,void 0,void 0,c)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const c=this._sourceCaches[i];c.resume(),c.reload()}}_updatePlacement(i,c,_,x,w,S,I=!1){let O=!1,D=!1;const z={},B={};for(const $ of this._mergedOrder){const H=this._mergedLayers[$];if(H.type!=="symbol")continue;const X=o.al(H.source,H.scope);let Y=z[X];if(!Y){const ue=this.getLayerSourceCache(H);if(!ue)continue;const ce=ue.getRenderableIds(!0).map(he=>ue.getTileByID(he));B[X]=ce.slice(),Y=z[X]=ce.sort((he,ge)=>ge.tileID.overscaledZ-he.tileID.overscaledZ||(he.tileID.isLessThan(ge.tileID)?-1:1))}const K=this.crossTileSymbolIndex.addLayer(H,Y,c.center.lng,c.projection);O=O||K}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new o.f("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.e.now(),c.zoom))&&(this.pauseablePlacement=new nu(c,this._mergedOrder,I,_,x,w,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,z,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.e.now()),D=!0),O&&this.pauseablePlacement.placement.setStale()),D||O){this._buildingIndex.onNewFrame(c.zoom);for(let $=0;$<this._mergedOrder.length;$++){const H=this._mergedLayers[this._mergedOrder[$]];if(H.type!=="symbol")continue;const X=this.isLayerClipped(H)&&this._clipLayerIndices.some(Y=>$<Y);this.placement.updateLayerOpacities(H,z[o.al(H.source,H.scope)],$,X?S:null)}}let j=!1;for(const $ of this._mergedOrder){const H=this._mergedLayers[$];if(H.type!=="symbol")continue;const X=z[o.al(H.source,H.scope)];for(const Y of X){const K=Y.getBucket(H);K&&Y.latestFeatureIndex&&H.fqid===K.layerIds[0]&&(j=K.updateOcclusionOpacities(i.context,i.symbolParams,i._dt)||j)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.e.now())||j,occlusionQueryBasedOpacityChanged:j}}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,c){this._checkLoaded();const _=this.stylesheet.imports=this.stylesheet.imports||[];if(_.findIndex(({id:w})=>w===i.id)!==-1)return void this.fire(new o.d(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!c)return _.push(i),this._loadImports([i],!0);const x=_.findIndex(({id:w})=>w===c);return x===-1&&this.fire(new o.d(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=_.slice(0,x).concat(i).concat(_.slice(x)),this._loadImports([i],!0,c)}updateImport(i,c){this._checkLoaded();const _=this.stylesheet.imports||[],x=this.getImportIndex(i);return x===-1?this:typeof c=="string"?(this.setImportUrl(i,c),this):(c.url&&c.url!==_[x].url&&this.setImportUrl(i,c.url),R(c.config,_[x].config)||this.setImportConfig(i,c.config),R(c.data,_[x].data)||this.setImportData(i,c.data),this)}moveImport(i,c){this._checkLoaded();let _=this.stylesheet.imports||[];const x=this.getImportIndex(i);if(x===-1)return this;const w=this.getImportIndex(c);if(w===-1)return this;const S=_[x],I=this.fragments[x];return _=_.filter(({id:O})=>O!==i),this.fragments=this.fragments.filter(({id:O})=>O!==i),this.stylesheet.imports=_.slice(0,w).concat(S).concat(_.slice(w)),this.fragments=this.fragments.slice(0,w).concat(I).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(i,c){this._checkLoaded();const _=this.stylesheet.imports||[],x=this.getImportIndex(i);if(x===-1)return this;_[x].url=c;const w=this.fragments[x];return w.style=this._createFragmentStyle(_[x]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(c),this}setImportData(i,c){this._checkLoaded();const _=this.getImportIndex(i),x=this.stylesheet.imports||[];return _===-1?this:c?(this.fragments[_].style.setState(c),this._reloadImports(),this):(delete x[_].data,this.setImportUrl(i,x[_].url))}setImportConfig(i,c){this._checkLoaded();const _=this.getImportIndex(i),x=this.stylesheet.imports||[];if(_===-1)return this;c?x[_].config=c:delete x[_].config;const w=this.fragments[_],S=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=c,w.style.updateConfig(c,S),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const c=this.stylesheet.imports||[],_=this.getImportIndex(i);_!==-1&&(c.splice(_,1),this.fragments[_].style._remove(),this.fragments.splice(_,1),this._reloadImports())}getImportIndex(i){const c=(this.stylesheet.imports||[]).findIndex(_=>_.id===i);return c===-1&&this.fire(new o.d(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),c}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const c in this._mergedOtherSourceCaches){const _=this._mergedOtherSourceCaches[c];_&&i.push(_.getSource())}return i}getSource(i,c){const _=this.getSourceCache(i,c);return _&&_.getSource()}getLayerSource(i){const c=this.getLayerSourceCache(i);return c&&c.getSource()}getSourceCache(i,c){const _=o.al(i,c);return this._mergedOtherSourceCaches[_]}getLayerSourceCache(i){const c=o.al(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[i]&&c.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&c.push(this._mergedSymbolSourceCaches[i]),c}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const c in i){const _=i[c];_==="reload"?this.reloadSource(c):_==="clear"&&this.clearSource(c)}}updateLayers(i){const c=this._changes.getUpdatedPaintProperties();for(const _ of c){const x=this.getLayer(_);x&&x.updateTransitions(i)}}getImages(i,c,_){this.imageManager.getImages(c.icons,c.scope,_),this._updateTilesForChangedImages();const x=w=>{w&&w.setDependencies(c.tileID.key,c.type,c.icons)};x(this._otherSourceCaches[c.source]),x(this._symbolSourceCaches[c.source])}getGlyphs(i,c,_){this.glyphManager.getGlyphs(c.stacks,c.scope,_)}getResource(i,c,_){return o.c$(c,_)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const c=[];return this._otherSourceCaches[i]&&c.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&c.push(this._symbolSourceCaches[i]),c}_isSourceCacheLoaded(i){const c=this.getOwnSourceCaches(i);return c.length===0?(this.fire(new o.d(new Error(`There is no source with ID '${i}'`))),!1):c.every(_=>_.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(i,c){if(this._clipLayerIndices.length===0&&i.type!=="fill-extrusion")return!1;const _=i.type==="fill-extrusion"&&i.sourceLayer==="building";let x=0;if(i.is3D()){if(_||c&&c.type==="batched-model")return!0;i.type==="model"&&(x=o.cu.Model)}else i.type==="symbol"&&(x=o.cu.Symbol);for(const w of this._clipLayerIndices){const S=this._mergedLayers[this._mergedOrder[w]];if(!S)continue;const I=[];for(const O of S.layout.get("clip-layer-types"))I.push(O==="model"?o.cu.Model:O==="symbol"?o.cu.Symbol:o.cu.FillExtrusion);for(const O of I)if(x&O)return!0}return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function xy(p,i){let c=!1,_=null;const x=()=>{_=null,c&&(p(),_=setTimeout(x,i),c=!1)};return()=>(c=!0,_||x(),_)}Us.getSourceType=function(p){return Ff[p]},Us.setSourceType=function(p,i){Ff[p]=i},Us.registerForPluginStateChange=o.cL;class by{constructor(i){this._hashName=i&&encodeURIComponent(i),o.bp(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=xy(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const c=wy(i);if(this._hashName){const _=this._hashName;let x=!1;const w=location.hash.slice(1).split("&").map(S=>{const I=S.split("=")[0];return I===_?(x=!0,`${I}=${c}`):S}).filter(S=>S);return x||w.push(`${_}=${c}`),`#${w.join("&")}`}return`#${c}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let c;return i.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(c=_)}),(c&&c[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(_=>isNaN(_))){const _=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(c[3]||0):i.getBearing();return i.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:_,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function wy(p,i){const c=p.getCenter(),_=Math.round(100*p.getZoom())/100,x=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,x),S=Math.round(c.lng*w)/w,I=Math.round(c.lat*w)/w,O=p.getBearing(),D=p.getPitch();let z=i?`/${S}/${I}/${_}`:`${_}/${I}/${S}`;return(O||D)&&(z+="/"+Math.round(10*O)/10),D&&(z+=`/${Math.round(D)}`),z}const iu={linearity:.3,easing:o.d0(0,0,.3,1)},b1=o.W({deceleration:2500,maxSpeed:1400},iu),Ty=o.W({deceleration:20,maxSpeed:1400},iu),ym=o.W({deceleration:1e3,maxSpeed:360},iu),rd=o.W({deceleration:1e3,maxSpeed:90},iu);class vm{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.e.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,c=o.e.now();for(;i.length>0&&c-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)c.zoom+=w.zoomDelta||0,c.bearing+=w.bearingDelta||0,c.pitch+=w.pitchDelta||0,w.panDelta&&c.pan._add(w.panDelta),w.around&&(c.around=w.around),w.pinchAround&&(c.pinchAround=w.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(c.pan.mag()){const w=Qu(c.pan.mag(),_,o.W({},b1,i||{}));x.offset=c.pan.mult(w.amount/c.pan.mag()),x.center=this._map.transform.center,da(x,w)}if(c.zoom){const w=Qu(c.zoom,_,Ty);x.zoom=this._map.transform.zoom+w.amount,da(x,w)}if(c.bearing){const w=Qu(c.bearing,_,ym);x.bearing=this._map.transform.bearing+o.at(w.amount,-179,179),da(x,w)}if(c.pitch){const w=Qu(c.pitch,_,rd);x.pitch=this._map.transform.pitch+w.amount,da(x,w)}if(x.zoom||x.bearing){const w=c.pinchAround===void 0?c.around:c.pinchAround;x.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function da(p,i){(!p.duration||p.duration<i.duration)&&(p.duration=i.duration,p.easing=i.easing)}function Qu(p,i,c){const{maxSpeed:_,linearity:x,deceleration:w}=c,S=o.at(p*x/(i/1e3),-_,_),I=Math.abs(S)/(w*x);return{easing:c.easing,duration:1e3*I,amount:S*(I/2)}}class Eo extends o.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,_,x={}){const w=ze(c.getCanvasContainer(),_),S=c.unproject(w);super(i,o.W({point:w,lngLat:S,originalEvent:_},x)),this._defaultPrevented=!1,this.target=c}}class Va extends o.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,_){const x=i==="touchend"?_.changedTouches:_.touches,w=He(c.getCanvasContainer(),x),S=w.map(O=>c.unproject(O)),I=w.reduce((O,D,z,B)=>O.add(D.div(B.length)),new o.P(0,0));super(i,{points:w,point:I,lngLats:S,lngLat:c.unproject(I),originalEvent:_}),this._defaultPrevented=!1}}class Rh extends o.f{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class nd{constructor(i,c){this._map=i,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Rh(this._map,i))}mousedown(i,c){return this._mousedownPos=c,this._firePreventable(new Eo(i.type,this._map,i))}mouseup(i){this._map.fire(new Eo(i.type,this._map,i))}preclick(i){const c=o.W({},i);c.type="preclick",this._map.fire(new Eo(c.type,this._map,c))}click(i,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Eo(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Eo(i.type,this._map,i))}mouseover(i){this._map.fire(new Eo(i.type,this._map,i))}mouseout(i){this._map.fire(new Eo(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Va(i.type,this._map,i))}touchmove(i){this._map.fire(new Va(i.type,this._map,i))}touchend(i){this._map.fire(new Va(i.type,this._map,i))}touchcancel(i){this._map.fire(new Va(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xm{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new Eo(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Eo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Eo(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class kh{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,c){this.isEnabled()&&i.shiftKey&&i.button===0&&(q(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(i,c){if(!this._active)return;const _=c,x=this._startPos,w=this._lastPos;if(!x||!w||w.equals(_)||!this._box&&_.dist(x)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=te("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const S=Math.min(x.x,_.x),I=Math.max(x.x,_.x),O=Math.min(x.y,_.y),D=Math.max(x.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${O}px)`,this._box.style.width=I-S+"px",this._box.style.height=D-O+"px")})}mouseupWindow(i,c){if(!this._active)return;const _=this._startPos,x=c;if(_&&i.button===0){if(this.reset(),ye(),_.x!==x.x||_.y!==x.y)return this._map.fire(new o.f("boxzoomend",{originalEvent:i})),{cameraAnimation:w=>w.fitScreenCoordinates(_,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Q(),delete this._startPos,delete this._lastPos}_fireEvent(i,c){return this._map.fire(new o.f(i,{originalEvent:c}))}}function Ju(p,i){const c={};for(let _=0;_<p.length;_++)c[p[_].identifier]=i[_];return c}class bm{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,c,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),_.length===this.numTouches&&(this.centroid=function(x){const w=new o.P(0,0);for(const S of x)w._add(S);return w.div(x.length)}(c),this.touches=Ju(_,c)))}touchmove(i,c,_){if(this.aborted||!this.centroid)return;const x=Ju(_,c);for(const w in this.touches){const S=x[w];(!S||S.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(i,c,_){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class id{constructor(i){this.singleTap=new bm(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,c,_){this.singleTap.touchstart(i,c,_)}touchmove(i,c,_){this.singleTap.touchmove(i,c,_)}touchend(i,c,_){const x=this.singleTap.touchend(i,c,_);if(x){const w=i.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(x)<30;if(w&&S||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class wm{constructor(){this._zoomIn=new id({numTouches:1,numTaps:2}),this._zoomOut=new id({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,c,_){this._zoomIn.touchstart(i,c,_),this._zoomOut.touchstart(i,c,_)}touchmove(i,c,_){this._zoomIn.touchmove(i,c,_),this._zoomOut.touchmove(i,c,_)}touchend(i,c,_){const x=this._zoomIn.touchend(i,c,_),w=this._zoomOut.touchend(i,c,_);return x?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(x)},{originalEvent:i})}):w?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(w)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const od={0:1,2:2};class ou{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,c){return!1}_move(i,c){return{}}mousedown(i,c){if(this._lastPoint)return;const _=Ne(i);this._correctButton(i,_)&&(this._lastPoint=c,this._eventButton=_)}mousemoveWindow(i,c){const _=this._lastPoint;if(_){if(i.preventDefault(),this._eventButton!=null&&function(x,w){const S=od[w];return x.buttons===void 0||(x.buttons&S)!==S}(i,this._eventButton))this.reset();else if(this._moved||!(c.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(_,c)}}mouseupWindow(i){this._lastPoint&&Ne(i)===this._eventButton&&(this._moved&&ye(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sy extends ou{mousedown(i,c){super.mousedown(i,c),this._lastPoint&&(this._active=!0)}_correctButton(i,c){return c===0&&!i.ctrlKey}_move(i,c){return{around:c,panDelta:c.sub(i)}}}class Tm extends ou{_correctButton(i,c){return c===0&&i.ctrlKey||c===2}_move(i,c){const _=.8*(c.x-i.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(i){i.preventDefault()}}class Sm extends ou{_correctButton(i,c){return c===0&&i.ctrlKey||c===2}_move(i,c){const _=-.5*(c.y-i.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(i){i.preventDefault()}}class ec{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),o.bp(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(i,c,_){return this._calculateTransform(i,c,_)}touchmove(i,c,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!o.d1())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,c,_)}}touchend(i,c,_){this._calculateTransform(i,c,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,c,_){_.length>0&&(this._active=!0);const x=Ju(_,c),w=new o.P(0,0),S=new o.P(0,0);let I=0;for(const D in x){const z=x[D],B=this._touches[D];B&&(w._add(z),S._add(z.sub(B)),I++,x[D]=z)}if(this._touches=x,I<this._minTouches||!S.mag())return;const O=S.div(I);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(I),panDelta:O}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=te("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class sd{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,c,_){return{}}touchstart(i,c,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([c[0],c[1]]))}touchmove(i,c,_){const x=this._firstTwoTouches;if(!x)return;i.preventDefault();const[w,S]=x,I=ad(_,c,w),O=ad(_,c,S);if(!I||!O)return;const D=this._aroundCenter?null:I.add(O).div(2);return this._move([I,O],D,i)}touchend(i,c,_){if(!this._firstTwoTouches)return;const[x,w]=this._firstTwoTouches,S=ad(_,c,x),I=ad(_,c,w);S&&I||(this._active&&ye(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ad(p,i,c){for(let _=0;_<p.length;_++)if(p[_].identifier===c)return i[_]}function Ey(p,i){return Math.log(p/i)/Math.LN2}class w1 extends sd{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,c){const _=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Ey(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ey(this._distance,_),pinchAround:c}}}function ld(p,i){return 180*p.angleWith(i)/Math.PI}class Em extends sd{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,c){const _=this._vector;if(this._vector=i[0].sub(i[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ld(this._vector,_),pinchAround:c}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const c=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const x=ld(i,_);return Math.abs(x)<c}}function Lh(p){return Math.abs(p.y)>Math.abs(p.x)}class Mm extends sd{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,Lh(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,c,_){const x=this._lastPoints;if(!x)return;const w=i[0].sub(x[0]),S=i[1].sub(x[1]);return this._map._cooperativeGestures&&!o.d1()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(w,S,_.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(w.y+S.y)/2*-.5})}gestureBeginsVertically(i,c,_){if(this._valid!==void 0)return this._valid;const x=i.mag()>=2,w=c.mag()>=2;if(!x&&!w)return;if(!x||!w)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;const S=i.y>0==c.y>0;return Lh(i)&&Lh(c)&&S}}const My={panStep:100,bearingStep:15,pitchStep:10};class Iy{constructor(){const i=My;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let c=0,_=0,x=0,w=0,S=0;switch(i.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:i.shiftKey?_=-1:(i.preventDefault(),w=-1);break;case 39:i.shiftKey?_=1:(i.preventDefault(),w=1);break;case 38:i.shiftKey?x=1:(i.preventDefault(),S=-1);break;case 40:i.shiftKey?x=-1:(i.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(_=0,x=0),{cameraAnimation:I=>{const O=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:T1,zoom:c?Math.round(O)+c*(i.shiftKey?2:1):O,bearing:I.getBearing()+_*this._bearingStep,pitch:I.getPitch()+x*this._pitchStep,offset:[-w*this._panStep,-S*this._panStep],center:I.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function T1(p){return p*(2-p)}const tc=4.000244140625,zh=1/450;class Ay{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=zh,o.bp(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||o.d1()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const _=o.e.now(),x=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,c!==0&&c%tc==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(x*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),i.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=i,this._delta-=c,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=ze(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>tc?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&z!==0&&(z=1/z);const B=c(),j=Math.pow(2,B),$=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom($*z))),this._type==="wheel"&&(this._startZoom=B,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const _=typeof this._targetZoom=="number"?this._targetZoom:c(),x=this._startZoom,w=this._easing;let S,I=!1;if(this._type==="wheel"&&x&&w){const D=Math.min((o.e.now()-this._lastWheelEventTime)/200,1),z=w(D);S=o.a2(x,_,z),D<1?this._frameId||(this._frameId=!0):I=!0}else S=_,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let O=S-c();return O*this._lastDelta<0&&(O=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:O,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let c=o.d2;if(this._prevEase){const _=this._prevEase,x=(o.e.now()-_.start)/_.duration,w=_.easing(x+.01)-_.easing(x),S=.27/Math.sqrt(w*w+1e-4)*.01,I=Math.sqrt(.0729-S*S);c=o.d0(S,I,.25,1)}return this._prevEase={start:o.e.now(),duration:i,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=te("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Wo{constructor(i,c){this._clickZoom=i,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Im{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,c){return i.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(i.shiftKey?-1:1),around:_.unproject(c)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ud{constructor(){this._tap=new id({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,c,_){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=c[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(i,c,_))}touchmove(i,c,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const x=c[0],w=x.y-this._swipePoint.y;return this._swipePoint=x,i.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(i,c,_)}touchend(i,c,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(i,c,_)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cd{constructor(i,c,_){this._el=i,this._mousePan=c,this._touchPan=_}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Am{constructor(i,c,_){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=c,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Cm{constructor(i,c,_,x){this._el=i,this._touchZoom=c,this._touchRotate=_,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const su=p=>p.zoom||p.drag||p.pitch||p.rotate;class Pm extends o.f{}class Om{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,c){const _=o._.sub([],c,i);this.radius=o._.length(_[2]<0?o._.div([],_,this.constants):[_[0],_[1],0])}projectRay(i){o._.div(i,i,this.constants),o._.normalize(i,i),o._.mul(i,i,this.constants);const c=o._.scale([],i,this.radius);if(c[2]>0){const _=o._.scale([],[0,0,1],o._.dot(c,[0,0,1])),x=o._.scale([],o._.normalize([],[c[0],c[1],0]),this.radius),w=o._.add([],c,o._.scale([],o._.sub([],o._.add([],x,_),c),2));c[0]=w[0],c[1]=w[1]}return c}}function au(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Cy{constructor(i,c){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vm(i),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Om,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),o.bp(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,w,S]of this._listeners){const I=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(w,I,S)}}destroy(){for(const[i,c,_]of this._listeners){const x=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(c,x,_)}}_addDefaultHandlers(i){const c=this._map,_=c.getCanvasContainer();this._add("mapEvent",new nd(c,i));const x=c.boxZoom=new kh(c,i);this._add("boxZoom",x);const w=new wm,S=new Im;c.doubleClickZoom=new Wo(S,w),this._add("tapZoom",w),this._add("clickZoom",S);const I=new ud;this._add("tapDragZoom",I);const O=c.touchPitch=new Mm(c);this._add("touchPitch",O);const D=new Tm(i),z=new Sm(i);c.dragRotate=new Am(i,D,z),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const B=new Sy(i),j=new ec(c,i);c.dragPan=new cd(_,B,j),this._add("mousePan",B),this._add("touchPan",j,["touchZoom","touchRotate"]);const $=new Em,H=new w1;c.touchZoomRotate=new Cm(_,H,$,I),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),this._add("blockableMapEvent",new xm(c));const X=c.scrollZoom=new Ay(c,this);this._add("scrollZoom",X,["mousePan"]);const Y=c.keyboard=new Iy;this._add("keyboard",Y);for(const K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[K]&&c[K].enable(i[K])}_add(i,c,_){this._handlers.push({handlerName:i,handler:c,allowed:_}),this._handlersById[i]=c}stop(i){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!su(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,c,_){for(const x in i)if(x!==_&&(!c||c.indexOf(x)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const c=[];for(const _ of i)this._el.contains(_.target)&&c.push(_);return c}handleEvent(i,c){this._updatingCamera=!0;const _=i.type==="renderFrame",x=_?void 0:i,w={needsRenderFrame:!1},S={},I={},O=i.touches?this._getMapTouches(i.touches):void 0,D=O?He(this._el,O):_?void 0:ze(this._el,i);for(const{handlerName:j,handler:$,allowed:H}of this._handlers){if(!$.isEnabled())continue;let X;this._blockedByActive(I,H,j)?$.reset():$[c||i.type]&&(X=$[c||i.type](i,D,O),this.mergeHandlerResult(w,S,X,j,x),X&&X.needsRenderFrame&&this._triggerRenderFrame()),(X||$.isActive())&&(I[j]=$)}const z={};for(const j in this._previousActiveHandlers)I[j]||(z[j]=x);this._previousActiveHandlers=I,(Object.keys(z).length||au(w))&&(this._changes.push([w,S,z]),this._triggerRenderFrame()),(Object.keys(I).length||au(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=w;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(i,c,_,x,w){if(!_)return;o.W(i,_);const S={handlerName:x,originalEvent:_.originalEvent||w};_.zoomDelta!==void 0&&(c.zoom=S),_.panDelta!==void 0&&(c.drag=S),_.pitchDelta!==void 0&&(c.pitch=S),_.bearingDelta!==void 0&&(c.rotate=S)}_applyChanges(){const i={},c={},_={};for(const[x,w,S]of this._changes)x.panDelta&&(i.panDelta=(i.panDelta||new o.P(0,0))._add(x.panDelta)),x.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(i.around=x.around),x.aroundCoord!==void 0&&(i.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(i.pinchAround=x.pinchAround),x.noInertia&&(i.noInertia=x.noInertia),o.W(c,w),o.W(_,S);this._updateMapTransform(i,c,_),this._changes=[]}_updateMapTransform(i,c,_){const x=this._map,w=x.transform,S=ue=>[ue.x,ue.y,ue.z];if((ue=>{const ce=this._eventsInProgress.drag;return ce&&!this._handlersById[ce.handlerName].isActive()})()&&!au(i)){const ue=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),ue!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&x._stop(!0),!au(i))return void this._fireEvents(c,_,!0);let{panDelta:I,zoomDelta:O,bearingDelta:D,pitchDelta:z,around:B,aroundCoord:j,pinchAround:$}=i;w._isCameraConstrained&&(O>0&&(O=0),w._isCameraConstrained=!1),$!==void 0&&(B=$),(O||(ue=>c[ue]&&!this._eventsInProgress[ue])("drag"))&&B&&(this._dragOrigin=S(w.pointCoordinate3D(B)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",x._stop(!0),B=B||x.transform.centerPoint,D&&(w.bearing+=D),z&&(w.pitch+=z),w._updateCameraState();const H=[0,0,0];if(I)if(w.projection.name==="mercator"){const ue=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(B).dir),ce=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(B.sub(I)).dir);H[0]=ce[0]-ue[0],H[1]=ce[1]-ue[1]}else{const ue=w.pointCoordinate(B);if(w.projection.name==="globe"){I=I.rotate(-w.angle);const ce=w._pixelsPerMercatorPixel/w.worldSize;H[0]=-I.x*o.d3(o.ay(ue.y))*ce,H[1]=-I.y*o.d3(w.center.lat)*ce}else{const ce=w.pointCoordinate(B.sub(I));ue&&ce&&(H[0]=ce.x-ue.x,H[1]=ce.y-ue.y)}}const X=w.zoom,Y=[0,0,0];if(O){const ue=S(j||w.pointCoordinate3D(B)),ce={dir:o._.normalize([],o._.sub([],ue,w._camera.position))};if(ce.dir[2]<0){const he=w.zoomDeltaToMovement(ue,O);o._.scale(Y,ce.dir,he)}}const K=o._.add(H,H,Y);w._translateCameraConstrained(K),O&&Math.abs(w.zoom-X)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(c,_,!0)}_fireEvents(i,c,_){const x=su(this._eventsInProgress),w=su(i),S={};for(const z in i){const{originalEvent:B}=i[z];this._eventsInProgress[z]||(S[`${z}start`]=B),this._eventsInProgress[z]=i[z]}!x&&w&&this._fireEvent("movestart",w.originalEvent);for(const z in S)this._fireEvent(z,S[z]);w&&this._fireEvent("move",w.originalEvent);for(const z in i){const{originalEvent:B}=i[z];this._fireEvent(z,B)}const I={};let O;for(const z in this._eventsInProgress){const{handlerName:B,originalEvent:j}=this._eventsInProgress[z];this._handlersById[B].isActive()||(delete this._eventsInProgress[z],O=c[B]||j,I[`${z}end`]=O)}for(const z in I)this._fireEvent(z,I[z]);const D=su(this._eventsInProgress);if(_&&(x||w)&&!D){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;z?(B(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:O})):(this._map.fire(new o.f("moveend",{originalEvent:O})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,c){this._map.fire(new o.f(i,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new Pm("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Dm="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class rc extends o.E{constructor(i,c){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,o.bp(["_renderFrameCallback"],this)}getCenter(){return new o.aI(this.transform.center.lng,this.transform.center.lat)}setCenter(i,c){return this.jumpTo({center:i},c)}panBy(i,c,_){return i=o.P.convert(i).mult(-1),this.panTo(this.transform.center,o.W({offset:i},c),_)}panTo(i,c,_){return this.easeTo(o.W({center:i},c),_)}getZoom(){return this.transform.zoom}setZoom(i,c){return this.jumpTo({zoom:i},c),this}zoomTo(i,c,_){return this.easeTo(o.W({zoom:i},c),_)}zoomIn(i,c){return this.zoomTo(this.getZoom()+1,i,c),this}zoomOut(i,c){return this.zoomTo(this.getZoom()-1,i,c),this}getBearing(){return this.transform.bearing}setBearing(i,c){return this.jumpTo({bearing:i},c),this}getPadding(){return this.transform.padding}setPadding(i,c){return this.jumpTo({padding:i},c),this}rotateTo(i,c,_){return this.easeTo(o.W({bearing:i},c),_)}resetNorth(i,c){return this.rotateTo(0,o.W({duration:1e3},i),c),this}resetNorthPitch(i,c){return this.easeTo(o.W({bearing:0,pitch:0,duration:1e3},i),c),this}snapToNorth(i,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,c):this}getPitch(){return this.transform.pitch}setPitch(i,c){return this.jumpTo({pitch:i},c),this}cameraForBounds(i,c){i=o.ai.convert(i);const _=c&&c.bearing||0,x=c&&c.pitch||0,w=i.getNorthWest(),S=i.getSouthEast();return this._cameraForBounds(this.transform,w,S,_,x,c)}_extendPadding(i){const c={top:0,right:0,bottom:0,left:0};return i==null?o.W({},c,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:o.W({},c,i)}_extendCameraOptions(i){return(i=o.W({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,c){const _=c.max[0]-c.min[0],x=c.max[1]-c.min[1];return _/x>i.aspect?_/(2*Math.tan(.5*i.fovX)*i.aspect):x/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,c,_,x,w,S){const I=i.clone(),O=this._extendCameraOptions(S);I.bearing=x,I.pitch=w;const D=o.aI.convert(c),z=o.aI.convert(_),B=.5*(D.lat+z.lat),j=.5*(D.lng+z.lng),$=o.d4(B,j),H=o._.normalize([],$),X=o._.normalize([],o._.cross([],H,[0,1,0])),Y=o._.cross([],X,H),K=[X[0],X[1],X[2],0,Y[0],Y[1],Y[2],0,H[0],H[1],H[2],0,0,0,0,1],ue=[$,o.d4(D.lat,D.lng),o.d4(z.lat,D.lng),o.d4(z.lat,z.lng),o.d4(D.lat,z.lng),o.d4(B,D.lng),o.d4(B,z.lng),o.d4(D.lat,j),o.d4(z.lat,j)];let ce=o.b6.fromPoints(ue.map(lt=>[o._.dot(X,lt),o._.dot(Y,lt),o._.dot(H,lt)]));const he=o._.transformMat4([],ce.center,K);o._.squaredLength(he)===0&&o._.set(he,0,0,1),o._.normalize(he,he),o._.scale(he,he,o.cD),I.center=o.d5(he);const ge=I.getWorldToCameraMatrix(),_e=o.ad.invert(new Float64Array(16),ge);ce=o.b6.applyTransform(ce,o.ad.multiply([],ge,K));const Se=this._extendAABB(ce,I,O,x);if(!Se)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=Se,o._.transformMat4(he,he,ge);const ee=.5*(ce.max[2]-ce.min[2]),fe=this._minimumAABBFrustumDistance(I,ce),Pe=o._.scale([],[0,0,1],ee),We=o._.add(Pe,he,Pe),ke=fe+(I.pitch===0?0:o._.distance(he,We)),be=I.globeCenterInViewSpace,Xe=o._.sub([],he,[be[0],be[1],be[2]]);o._.normalize(Xe,Xe),o._.scale(Xe,Xe,ke);const dt=o._.add([],he,Xe);o._.transformMat4(dt,dt,_e);const pt=o.d7/o.cD,ft=o._.length(dt),Fe=o.ax(Math.max(ft*pt-o.d7,Number.EPSILON),0),Ye=Math.min(I.zoomFromMercatorZAdjusted(Fe),O.maxZoom);return Ye>.5*(o.b1+o.aU)?(I.setProjection({name:"mercator"}),I.zoom=Ye,this._cameraForBounds(I,c,_,x,w,S)):{center:I.center,zoom:Ye,bearing:x,pitch:w}}_extendAABB(i,c,_,x){const w=.5*((_.padding.left||0)+(_.padding.right||0)),S=.5*((_.padding.top||0)+(_.padding.bottom||0)),I=S,O=w,D=w,z=S,B=c.width-(O+D),j=c.height-(I+z),$=o._.sub([],i.max,i.min),H=Math.min(B/$[0],j/$[1]),X=Math.min(c.scaleZoom(c.scale*H),_.maxZoom);if(isNaN(X))return null;const Y=c.scale/c.zoomScale(X),K=new o.b6([i.min[0]-O*Y,i.min[1]-z*Y,i.min[2]],[i.max[0]+D*Y,i.max[1]+I*Y,i.max[2]]),ue=(typeof _.offset.x=="number"&&typeof _.offset.y=="number"?new o.P(_.offset.x,_.offset.y):o.P.convert(_.offset)).rotate(-o.ab(x));return K.center[0]-=ue.x*Y,K.center[1]+=ue.y*Y,K}queryTerrainElevation(i,c){const _=this.transform.elevation;return _?(c=o.W({},{exaggerated:!0},c),_.getAtPoint(o.Y.fromLngLat(i),null,c.exaggerated)):null}_cameraForBounds(i,c,_,x,w,S){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,c,_,x,w,S);const I=i.clone(),O=this._extendCameraOptions(S);I.bearing=x,I.pitch=w;const D=o.aI.convert(c),z=o.aI.convert(_),B=new o.aI(D.lng,z.lat),j=new o.aI(z.lng,D.lat),$=I.project(D),H=I.project(z),X=this.queryTerrainElevation(D),Y=this.queryTerrainElevation(z),K=this.queryTerrainElevation(B),ue=this.queryTerrainElevation(j),ce=[[$.x,$.y,Math.min(X||0,Y||0,K||0,ue||0)],[H.x,H.y,Math.max(X||0,Y||0,K||0,ue||0)]];let he=o.b6.fromPoints(ce);const ge=I.getWorldToCameraMatrix(),_e=o.ad.invert(new Float64Array(16),ge);he=o.b6.applyTransform(he,ge);const Se=this._extendAABB(he,I,O,x);if(!Se)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");he=Se;const ee=.5*o._.sub([],he.max,he.min)[2],fe=this._minimumAABBFrustumDistance(I,he),Pe=[0,0,1,0];o.aA.transformMat4(Pe,Pe,ge),o.aA.normalize(Pe,Pe);const We=o._.scale([],Pe,fe+ee),ke=o._.add([],he.center,We);o._.transformMat4(he.center,he.center,_e),o._.transformMat4(ke,ke,_e);const be=[he.center[0],he.center[1],ke[2]*I.pixelsPerMeter];o._.scale(be,be,1/I.worldSize);const Xe=o.d6(be[0]),dt=o.ay(be[1]),pt=Math.min(I._zoomFromMercatorZ(be[2]),O.maxZoom),ft=new o.aI(Xe,dt);return I.mercatorFromTransition&&pt<.5*(o.b1+o.aU)?(I.setProjection({name:"globe"}),I.zoom=pt,this._cameraForBounds(I,c,_,x,w,S)):{center:ft,zoom:pt,bearing:x,pitch:w}}fitBounds(i,c,_){const x=this.cameraForBounds(i,c);return this._fitInternal(x,c,_)}fitScreenCoordinates(i,c,_,x,w){const S=o.P.convert(i),I=o.P.convert(c),O=new o.P(Math.min(S.x,I.x),Math.min(S.y,I.y)),D=new o.P(Math.max(S.x,I.x),Math.max(S.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,I))return this;const z=this.transform.pointLocation3D(O),B=this.transform.pointLocation3D(D),j=this.transform.pointLocation3D(new o.P(O.x,D.y)),$=this.transform.pointLocation3D(new o.P(D.x,O.y)),H=[Math.min(z.lng,B.lng,j.lng,$.lng),Math.min(z.lat,B.lat,j.lat,$.lat)],X=[Math.max(z.lng,B.lng,j.lng,$.lng),Math.max(z.lat,B.lat,j.lat,$.lat)],Y=x&&x.pitch?x.pitch:this.getPitch(),K=this._cameraForBounds(this.transform,H,X,_,Y,x);return this._fitInternal(K,x,w)}_fitInternal(i,c,_){return i?(c=o.W(i,c)).linear?this.easeTo(c,_):this.flyTo(c,_):this}jumpTo(i,c){this.stop();const _=i.preloadOnly?this.transform.clone():this.transform;let x=!1,w=!1,S=!1;if("zoom"in i&&_.zoom!==+i.zoom&&(x=!0,_.zoom=+i.zoom),i.center!==void 0&&(_.center=o.aI.convert(i.center)),"bearing"in i&&_.bearing!==+i.bearing&&(w=!0,_.bearing=+i.bearing),"pitch"in i&&_.pitch!==+i.pitch&&(S=!0,_.pitch=+i.pitch),i.padding!=null){const I=typeof i.padding=="number"?this._extendPadding(i.padding):i.padding;_.isPaddingEqual(I)||(_.padding=I)}return i.preloadOnly?(this._preloadTiles(_),this):(this.fire(new o.f("movestart",c)).fire(new o.f("move",c)),x&&this.fire(new o.f("zoomstart",c)).fire(new o.f("zoom",c)).fire(new o.f("zoomend",c)),w&&this.fire(new o.f("rotatestart",c)).fire(new o.f("rotate",c)).fire(new o.f("rotateend",c)),S&&this.fire(new o.f("pitchstart",c)).fire(new o.f("pitch",c)).fire(new o.f("pitchend",c)),this.fire(new o.f("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(Dm),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,c){const _=this.transform;if(!_.projection.supportsFreeCamera)return o.w(Dm),this;this.stop();const x=_.zoom,w=_.pitch,S=_.bearing;_.setFreeCameraOptions(i);const I=x!==_.zoom,O=w!==_.pitch,D=S!==_.bearing;return this.fire(new o.f("movestart",c)).fire(new o.f("move",c)),I&&this.fire(new o.f("zoomstart",c)).fire(new o.f("zoom",c)).fire(new o.f("zoomend",c)),D&&this.fire(new o.f("rotatestart",c)).fire(new o.f("rotate",c)).fire(new o.f("rotateend",c)),O&&this.fire(new o.f("pitchstart",c)).fire(new o.f("pitch",c)).fire(new o.f("pitchend",c)),this.fire(new o.f("moveend",c)),this}easeTo(i,c){this._stop(!1,i.easeId),((i=o.W({offset:[0,0],duration:500,easing:o.d2},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const _=this.transform,x=this.getZoom(),w=this.getBearing(),S=this.getPitch(),I=this.getPadding(),O="zoom"in i?+i.zoom:x,D="bearing"in i?this._normalizeBearing(i.bearing,w):w,z="pitch"in i?+i.pitch:S,B=this._extendPadding(i.padding),j=o.P.convert(i.offset);let $,H,X;if(_.projection.name==="globe"){const fe=o.Y.fromLngLat(_.center),Pe=j.rotate(-_.angle);fe.x+=Pe.x/_.worldSize,fe.y+=Pe.y/_.worldSize;const We=fe.toLngLat(),ke=o.aI.convert(i.center||We);this._normalizeCenter(ke),$=_.centerPoint.add(Pe),H=new o.P(fe.x,fe.y).mult(_.worldSize),X=new o.P(o.aj(ke.lng),o.ak(ke.lat)).mult(_.worldSize).sub(H)}else{$=_.centerPoint.add(j);const fe=_.pointLocation($),Pe=o.aI.convert(i.center||fe);this._normalizeCenter(Pe),H=_.project(fe),X=_.project(Pe).sub(H)}const Y=_.zoomScale(O-x);let K,ue;i.around&&(K=o.aI.convert(i.around),ue=_.locationPoint(K));const ce=this._zooming||O!==x,he=this._rotating||w!==D,ge=this._pitching||z!==S,_e=!_.isPaddingEqual(B),Se=fe=>Pe=>{if(ce&&(fe.zoom=o.a2(x,O,Pe)),he&&(fe.bearing=o.a2(w,D,Pe)),ge&&(fe.pitch=o.a2(S,z,Pe)),_e&&(fe.interpolatePadding(I,B,Pe),$=fe.centerPoint.add(j)),K)fe.setLocationAtPoint(K,ue);else{const We=fe.zoomScale(fe.zoom-x),ke=O>x?Math.min(2,Y):Math.max(.5,Y),be=Math.pow(ke,1-Pe),Xe=fe.unproject(H.add(X.mult(Pe*be)).mult(We));fe.setLocationAtPoint(fe.renderWorldCopies?Xe.wrap():Xe,$)}return i.preloadOnly||this._fireMoveEvents(c),fe};if(i.preloadOnly){const fe=this._emulate(Se,i.duration,_);return this._preloadTiles(fe),this}const ee={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ce,this._rotating=he,this._pitching=ge,this._padding=_e,this._easeId=i.easeId,this._prepareEase(c,i.noMoveStart,ee),this._ease(Se(_),fe=>{_.cameraElevationReference==="sea"&&_.recenterOnTerrain(),this._afterEase(c,fe)},i),this}_prepareEase(i,c,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||_.moving||this.fire(new o.f("movestart",i)),this._zooming&&!_.zooming&&this.fire(new o.f("zoomstart",i)),this._rotating&&!_.rotating&&this.fire(new o.f("rotatestart",i)),this._pitching&&!_.pitching&&this.fire(new o.f("pitchstart",i))}_fireMoveEvents(i){this.fire(new o.f("move",i)),this._zooming&&this.fire(new o.f("zoom",i)),this._rotating&&this.fire(new o.f("rotate",i)),this._pitching&&this.fire(new o.f("pitch",i))}_afterEase(i,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,x=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new o.f("zoomend",i)),x&&this.fire(new o.f("rotateend",i)),w&&this.fire(new o.f("pitchend",i)),this.fire(new o.f("moveend",i))}flyTo(i,c){if(this._prefersReducedMotion(i)){const Ye=o.ah(i,["center","zoom","bearing","pitch","around","padding"]);return this.jumpTo(Ye,c)}this.stop(),i=o.W({offset:[0,0],speed:1.2,curve:1.42,easing:o.d2},i);const _=this.transform,x=this.getZoom(),w=this.getBearing(),S=this.getPitch(),I=this.getPadding(),O="zoom"in i?o.at(+i.zoom,_.minZoom,_.maxZoom):x,D="bearing"in i?this._normalizeBearing(i.bearing,w):w,z="pitch"in i?+i.pitch:S,B=this._extendPadding(i.padding),j=_.zoomScale(O-x),$=o.P.convert(i.offset);let H=_.centerPoint.add($);const X=_.pointLocation(H),Y=o.aI.convert(i.center||X);this._normalizeCenter(Y);const K=_.project(X),ue=_.project(Y).sub(K);let ce=i.curve;const he=Math.max(_.width,_.height),ge=he/j,_e=ue.mag();if("minZoom"in i){const Ye=o.at(Math.min(i.minZoom,x,O),_.minZoom,_.maxZoom),lt=he/_.zoomScale(Ye-x);ce=Math.sqrt(lt/_e*2)}const Se=ce*ce;function ee(Ye){const lt=(ge*ge-he*he+(Ye?-1:1)*Se*Se*_e*_e)/(2*(Ye?ge:he)*Se*_e);return Math.log(Math.sqrt(lt*lt+1)-lt)}function fe(Ye){return(Math.exp(Ye)-Math.exp(-Ye))/2}function Pe(Ye){return(Math.exp(Ye)+Math.exp(-Ye))/2}const We=ee(0);let ke=function(Ye){return Pe(We)/Pe(We+ce*Ye)},be=function(Ye){return he*((Pe(We)*(fe(lt=We+ce*Ye)/Pe(lt))-fe(We))/Se)/_e;var lt},Xe=(ee(1)-We)/ce;if(Math.abs(_e)<1e-6||!isFinite(Xe)){if(Math.abs(he-ge)<1e-6)return this.easeTo(i,c);const Ye=ge<he?-1:1;Xe=Math.abs(Math.log(ge/he))/ce,be=function(){return 0},ke=function(lt){return Math.exp(Ye*ce*lt)}}i.duration="duration"in i?+i.duration:1e3*Xe/("screenSpeed"in i?+i.screenSpeed/ce:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const dt=w!==D,pt=z!==S,ft=!_.isPaddingEqual(B),Fe=Ye=>lt=>{const Ct=lt*Xe,Pt=1/ke(Ct);Ye.zoom=lt===1?O:x+Ye.scaleZoom(Pt),dt&&(Ye.bearing=o.a2(w,D,lt)),pt&&(Ye.pitch=o.a2(S,z,lt)),ft&&(Ye.interpolatePadding(I,B,lt),H=Ye.centerPoint.add($));const Lt=lt===1?Y:Ye.unproject(K.add(ue.mult(be(Ct))).mult(Pt));return Ye.setLocationAtPoint(Ye.renderWorldCopies?Lt.wrap():Lt,H),Ye._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(c),Ye};if(i.preloadOnly){const Ye=this._emulate(Fe,i.duration,_);return this._preloadTiles(Ye),this}return this._zooming=!0,this._rotating=dt,this._pitching=pt,this._padding=ft,this._prepareEase(c,!1),this._ease(Fe(_),()=>this._afterEase(c),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,c)}if(!i){const _=this.handlers;_&&_.stop(!1)}return this}_ease(i,c,_){_.animate===!1||_.duration===0?(i(1),c()):(this._easeStart=o.e.now(),this._easeOptions=_,this._onEaseFrame=i,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((o.e.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,c){i=o.au(i,-180,180);const _=Math.abs(i-c);return Math.abs(i-360-c)<_&&(i-=360),Math.abs(i+360-c)<_&&(i+=360),i}_normalizeCenter(i){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const _=i.lng-c.center.lng;i.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&o.e.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,c,_){const x=Math.ceil(15*c/1e3),w=[],S=i(_.clone());for(let I=0;I<=x;I++){const O=S(I/x);w.push(O.clone())}return w}_preloadTiles(i,c){}}class Py{constructor(i={}){this.options=i,o.bp(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const c=this.options&&this.options.compact;return this._map=i,this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=te("button","mapboxgl-ctrl-attrib-button",this._container),te("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=te("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,c){const _=this._map._getUIString(`AttributionControl.${c}`);i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.d8.ACCESS_TOKEN}];if(i){const _=c.reduce((x,w,S)=>(w.value&&(x+=`${w.key}=${w.value}${S<c.length-1?"&":""}`),x),"?");i.href=`${o.d8.FEEDBACK_URL}/${_}#${wy(this._map,!0)}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const c=this._map.style._mergedSourceCaches;for(const x in c){const w=c[x];if(w.used){const S=w.getSource();S.attribution&&i.indexOf(S.attribution)<0&&i.push(S.attribution)}}i.sort((x,w)=>x.length-w.length),i=i.filter((x,w)=>{for(let S=w+1;S<i.length;S++)if(i[S].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const _=i.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,i.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Oy{constructor(){o.bp(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=te("div","mapboxgl-ctrl");const c=te("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const c in i){const _=i[c].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const c=i[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Dy{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const c=++this._id;return this._queue.push({callback:i,id:c,cancelled:!1}),c}remove(i){const c=this._currentlyRunning,_=c?this._queue.concat(c):this._queue;for(const x of _)if(x.id===i)return void(x.cancelled=!0)}run(i=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const _ of c)if(!_.cancelled&&(_.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ry(p,i,c){if(p=new o.aI(p.lng,p.lat),i){const _=new o.aI(p.lng-360,p.lat),x=new o.aI(p.lng+360,p.lat),w=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),S=c.locationPoint(p).distSqr(i),I=i.x<0||i.y<0||i.x>c.width||i.y>c.height;c.locationPoint(_).distSqr(i)<S&&(I||Math.abs(_.lng-c.center.lng)<w)?p=_:c.locationPoint(x).distSqr(i)<S&&(I||Math.abs(x.lng-c.center.lng)<w)&&(p=x)}for(;Math.abs(p.lng-c.center.lng)>180;){const _=c.locationPoint(p);if(_.x>=0&&_.y>=0&&_.x<=c.width&&_.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}const Rm={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class km extends o.E{constructor(i,c){if(super(),(i instanceof HTMLElement||c)&&(i=o.W({element:i},c)),o.bp(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=o.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=te("div");const w=41,S=27,I=se("svg",{display:"block",height:w*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${w}`},this._element),O=se("radialGradient",{id:"shadowGradient"},se("defs",{},I));se("stop",{offset:"10%","stop-opacity":.4},O),se("stop",{offset:"100%","stop-opacity":.05},O),se("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),se("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),se("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),se("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=o.P.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const _=this._element.classList;for(const w in Rm)_.remove(`mapboxgl-marker-anchor-${w}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`);const x=i&&i.className?i.className.trim().split(/\s+/):[];_.add(...x),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=o.aI.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const c=i.code,_=i.charCode||i.keyCode;c!=="Space"&&c!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(i){const c=i.originalEvent.target,_=this._element;this._popup&&(c===_||_.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,c=this._pos;if(!i||!c)return!1;const _=i.unproject(c),x=i.getFreeCameraOptions();if(!x.position)return!1;const w=x.position.toLngLat();return w.distanceTo(_)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const c=this._pos;if(!c||c.x<0||c.x>i.transform.width||c.y<0||c.y>i.transform.height)return void this._clearFadeTimer();const _=i.unproject(c);let x;i._showingGlobe()&&o.d9(i.transform,this._lngLat)?x=0:(x=1-i._queryFogOpacity(_),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${Rm[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const i=this._pos,c=this._map,_=this.getPitchAlignment();if(!c||!i||_!=="map")return"";if(!c._showingGlobe()){const O=c.getPitch();return O?`rotateX(${O}deg)`:""}const x=o.b0(o.da(c.transform,this._lngLat)),w=i.sub(o.db(c.transform)),S=Math.abs(w.x)+Math.abs(w.y);if(S===0)return"";const I=x/S;return`rotateX(${-w.y*I}deg) rotateY(${w.x*I}deg)`}_calculateZTransform(){const i=this._pos,c=this._map;if(!c||!i)return"";let _=0;const x=this.getRotationAlignment();if(x==="map")if(c._showingGlobe()){const w=c.project(new o.aI(this._lngLat.lng,this._lngLat.lat+.001)),S=c.project(new o.aI(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);_=o.b0(Math.atan2(S.y,S.x))-90}else _=-c.getBearing();else if(x==="horizon"){const w=o.$(4,6,c.getZoom()),S=o.db(c.transform);S.y+=w*c.transform.height;const I=i.sub(S),O=o.b0(Math.atan2(I.y,I.x));_=(O>90?O-270:O+90)*(1-w)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=Ry(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=o.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const c=this._map;if(!c)return;const _=this._pointerdownPos,x=this._positionDelta;if(_&&x){if(!this._isDragging){const w=this._clickTolerance||c._clickTolerance;if(i.point.dist(_)<w)return;this._isDragging=!0}this._pos=i.point.sub(x),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.f("dragstart"))),this.fire(new o.f("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.f("dragend")),this._state="inactive"}_addDragHandler(i){const c=this._map,_=this._pos;c&&_&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(_),this._pointerdownPos=i.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const c=this._map;return c&&(i?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Lm={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},zm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Fm(p=new o.P(0,0),i="bottom"){if(typeof p=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(i){case"top":return new o.P(0,p);case"top-left":return new o.P(c,c);case"top-right":return new o.P(-c,c);case"bottom":return new o.P(0,-p);case"bottom-left":return new o.P(c,-c);case"bottom-right":return new o.P(-c,-c);case"left":return new o.P(p,0);case"right":return new o.P(-p,0)}return new o.P(0,0)}return p instanceof o.P||Array.isArray(p)?o.P.convert(p):o.P.convert(p[i]||[0,0])}class nc{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const c=o.b9((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,c,_){this._start=this.getValue(c),this._end=i,this._startTime=c,this._endTime=c+_}}const ky={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Ly{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}const zy={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},Bm={showCompass:!0,showZoom:!0,visualizePitch:!1};class lu{constructor(i,c,_=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Tm({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,_&&(this.mousePitch=new Sm({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),o.bp(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(i,c){this.mouseRotate.mousedown(i,c),this.mousePitch&&this.mousePitch.mousedown(i,c),q()}move(i,c){const _=this.map,x=this.mouseRotate.mousemoveWindow(i,c),w=x&&x.bearingDelta;if(w&&_.setBearing(_.getBearing()+w),this.mousePitch){const S=this.mousePitch.mousemoveWindow(i,c),I=S&&S.pitchDelta;I&&_.setPitch(_.getPitch()+I)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Q(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(o.W({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),ze(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,ze(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=He(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=He(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Fy={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},uu={maxWidth:100,unit:"metric"},By={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:o.dt,supported:U,setRTLTextPlugin:o.dv,getRTLTextPluginStatus:o.dw,Map:class extends rc{constructor(p){o.dc.mark(o.dd.create);const i=p;if((p=o.W({},zy,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&o.de(window)&&(p.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new zn(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._repaint=!!p.repaint,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new Dy,this._domRenderTaskQueue=new Dy,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.df(),this._locale=o.W({},ky,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._tessellationStep=p.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new nc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._lastDirtyFrameId=0,this._requestManager=new o.dg(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?{...p.contextCreateOptions}:{},typeof p.container=="string"){const c=document.getElementById(p.container);if(!c)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=c}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),o.bp(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Ly),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Cy(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||o.d8.DEFAULT_STYLE,{config:p.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),p.hash&&(this._hash=new by(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});const c=p.bounds;c&&(this.resize(),this.fitBounds(c,o.W({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new Py({customAttribution:p.customAttribution})),this._logoControl=new Oy,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new o.f(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new o.f(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(p,i){if(i===void 0&&(i=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new o.d(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=p.onAdd(this);this._controls.push(p);const _=this._controlPositions[i];return i.indexOf("bottom")!==-1?_.insertBefore(c,_.firstChild):_.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new o.d(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(p);return i>-1&&this._controls.splice(i,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new o.f("movestart",p)).fire(new o.f("move",p)),this.fire(new o.f("resize",p)),i&&this.fire(new o.f("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(o.ai.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new o.f("zoomstart")).fire(new o.f("zoom")).fire(new o.f("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new o.f("zoomstart")).fire(new o.f("zoom")).fire(new o.f("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new o.f("pitchstart")).fire(new o.f("pitch")).fire(new o.f("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new o.f("pitchstart")).fire(new o.f("pitch")).fire(new o.f("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(i=>i==="auto"?navigator.language:i):p}setLanguage(p){const i=this._parseLanguage(p);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const p=this.transform,i=p.projection.name;let c;i==="globe"&&p.zoom>=o.aU?(p.setMercatorFromTransition(),c=!0):i==="mercator"&&p.zoom<o.aU&&(p.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,i){return this._updateProjection(p||i||{name:"mercator"})}_updateProjection(p){let i;return i=p.name==="globe"&&this.transform.zoom>=o.aU?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p){return this.transform.locationPoint3D(o.aI.convert(p))}unproject(p){return this.transform.pointLocation3D(o.P.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,i,c){if(p==="mouseenter"||p==="mouseover"){let _=!1;const x=S=>{const I=i.filter(D=>this.getLayer(D)),O=I.length?this.queryRenderedFeatures(S.point,{layers:I}):[];O.length?_||(_=!0,c.call(this,new Eo(p,this,S.originalEvent,{features:O}))):_=!1},w=()=>{_=!1};return{layers:new Set(i),listener:c,delegates:{mousemove:x,mouseout:w}}}if(p==="mouseleave"||p==="mouseout"){let _=!1;const x=S=>{const I=i.filter(O=>this.getLayer(O));(I.length?this.queryRenderedFeatures(S.point,{layers:I}):[]).length?_=!0:_&&(_=!1,c.call(this,new Eo(p,this,S.originalEvent)))},w=S=>{_&&(_=!1,c.call(this,new Eo(p,this,S.originalEvent)))};return{layers:new Set(i),listener:c,delegates:{mousemove:x,mouseout:w}}}{const _=x=>{const w=i.filter(I=>this.getLayer(I)),S=w.length?this.queryRenderedFeatures(x.point,{layers:w}):[];S.length&&(x.features=S,c.call(this,x),delete x.features)};return{layers:new Set(i),listener:c,delegates:{[p]:_}}}}on(p,i,c){if(typeof i=="function"||c===void 0)return super.on(p,i);if(Array.isArray(i)||(i=[i]),i){for(const x of i)if(!this._isValidId(x))return this}const _=this._createDelegatedListener(p,i,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(_);for(const x in _.delegates)this.on(x,_.delegates[x]);return this}once(p,i,c){if(typeof i=="function"||c===void 0)return super.once(p,i);if(Array.isArray(i)||(i=[i]),i){for(const x of i)if(!this._isValidId(x))return this}const _=this._createDelegatedListener(p,i,c);for(const x in _.delegates)this.once(x,_.delegates[x]);return this}off(p,i,c){if(typeof i=="function"||c===void 0)return super.off(p,i);const _=new Set(Array.isArray(i)?i:[i]);for(const S of _)if(!this._isValidId(S))return this;const x=(S,I)=>{if(S.size!==I.size)return!1;for(const O of S)if(!I.has(O))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[p]:void 0;return w&&(S=>{for(let I=0;I<S.length;I++){const O=S[I];if(O.listener===c&&x(O.layers,_)){for(const D in O.delegates)this.off(D,O.delegates[D]);return S.splice(I,1),this}}})(w),this}queryRenderedFeatures(p,i){if(!this.style)return[];if(i!==void 0||p===void 0||p instanceof o.P||Array.isArray(p)||(i=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],(i=i||{}).layers&&Array.isArray(i.layers)){for(const c of i.layers)if(!this._isValidId(c))return[]}return this.style.queryRenderedFeatures(p,i,this.transform)}querySourceFeatures(p,i){return this._isValidId(p)?this.style.querySourceFeatures(p,i):[]}isPointOnSurface(p){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&o.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(p))}setStyle(p,i){return i=o.W({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&p&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(p,(c,_)=>{c?(o.w(`Unable to perform style diff: ${String(c.message||c.error||c)}. Rebuilding the style from scratch.`),this._updateStyle(p,i)):_&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(p,i))}_getUIString(p){const i=this._locale[p];if(i==null)throw new Error(`Missing UI string '${p}'`);return i}_updateStyle(p,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p){const c=o.W({},i);i&&i.config&&(c.initialConfig=i.config,delete c.config),this.style=new Us(this,c).load(p),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Us(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new o.d(new Error("IDs can't be empty."))),!1):!o.cV(p)||(this.fire(new o.d(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}addSource(p,i){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,i),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,i,c){this._lazyInitEmptyStyle(),this.style.addSourceType(p,i,c)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,i,{pixelRatio:c=1,sdf:_=!1,stretchX:x,stretchY:w,content:S}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:I,height:O,data:D}=o.e.getImageData(i);this.style.addImage(p,{data:new o.i({width:I,height:O},D),pixelRatio:c,stretchX:x,stretchY:w,content:S,sdf:_,version:0})}else if(i.width===void 0||i.height===void 0)this.fire(new o.d(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:O}=i,D=i;this.style.addImage(p,{data:new o.i({width:I,height:O},new Uint8Array(D.data)),pixelRatio:c,stretchX:x,stretchY:w,content:S,sdf:_,version:0,userImage:D}),D.onAdd&&D.onAdd(this,p)}}updateImage(p,i){this._lazyInitEmptyStyle();const c=this.style.getImage(p);if(!c)return void this.fire(new o.d(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?o.e.getImageData(i):i,{width:x,height:w,data:S}=_;if(x===void 0||w===void 0)return void this.fire(new o.d(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==c.data.width||w!==c.data.height)return void this.fire(new o.d(new Error(`The width and height of the updated image (${x}, ${w})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`)));const I=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);c.data.replace(S,I),this.style.updateImage(p,c)}hasImage(p){return p?!!this.style&&!!this.style.getImage(p):(this.fire(new o.d(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,i){o.h(this._requestManager.transformRequest(p,o.R.Image),(c,_)=>{i(c,_ instanceof HTMLImageElement?o.e.getImageData(_):_)})}listImages(){return this.style.listImages()}addModel(p,i){this._lazyInitEmptyStyle(),this.style.addModel(p,i)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new o.d(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,i){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,i),this._update(!0)):this}getSlot(p){const i=this.getLayer(p);return i&&i.slot||null}setSlot(p,i){return this.style.setSlot(p,i),this.style.mergeLayers(),this._update(!0)}addImport(p,i){return this.style.addImport(p,i),this}updateImport(p,i){return typeof i!="string"&&i.id!==p?(this.removeImport(p),this.addImport(i)):(this.style.updateImport(p,i),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,i){return this.style.moveImport(p,i),this._update(!0)}moveLayer(p,i){return this._isValidId(p)?(this.style.moveLayer(p,i),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){if(!this._isValidId(p))return null;const i=this.style.getOwnLayer(p);return i?i.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(p,i,c){return this._isValidId(p)?(this.style.setLayerZoomRange(p,i,c),this._update(!0)):this}setFilter(p,i,c={}){return this._isValidId(p)?(this.style.setFilter(p,i,c),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,i,c,_={}){return this._isValidId(p)?(this.style.setPaintProperty(p,i,c,_),this._update(!0)):this}getPaintProperty(p,i){return this._isValidId(p)?this.style.getPaintProperty(p,i):null}setLayoutProperty(p,i,c,_={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,i,c,_),this._update(!0)):this}getLayoutProperty(p,i){return this._isValidId(p)?this.style.getLayoutProperty(p,i):null}getSchema(p){return this.style.getSchema(p)}setSchema(p,i){return this.style.setSchema(p,i),this._update(!0)}getConfig(p){return this.style.getConfig(p)}setConfig(p,i){return this.style.setConfig(p,i),this._update(!0)}getConfigProperty(p,i){return this.style.getConfigProperty(p,i)}setConfigProperty(p,i,c){return this.style.setConfigProperty(p,i,c),this._update(!0)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){const i=p[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(p){return this._lazyInitEmptyStyle(),this.style.setColorTheme(p),this._update(!0)}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.aI.convert(p),this.transform):0}setFeatureState(p,i){return this._isValidId(p.source)?(this.style.setFeatureState(p,i),this._update()):this}removeFeatureState(p,i){return this._isValidId(p.source)?(this.style.removeFeatureState(p,i),this._update()):this}getFeatureState(p){return this._isValidId(p.source)?this.style.getFeatureState(p):null}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let c,_,x,w=this._container;for(;w&&(!_||!x);){const S=window.getComputedStyle(w).transform;S&&S!=="none"&&(c=S.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(_=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(x=c[3])),w=w.parentElement}this._containerWidth=_?Math.abs(p/_):p,this._containerHeight=x?Math.abs(i/x):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=te("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=te("div","mapboxgl-canvas-container",p);this._canvas=te("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=te("div","mapboxgl-control-container",p),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{_[x]=te("div",`mapboxgl-ctrl-${x}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,i){const c=o.e.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(i),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${i}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const i=this._markers.indexOf(p);i!==-1&&this._markers.splice(i,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const i=this._popups.indexOf(p);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const p=o.W({},U.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",p);i?(o.dh(i,!0),this.painter=new p1(i,this._contextCreateOptions,this.transform,this._tp),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.di.testSupport(i)):this.fire(new o.d(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.f("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new o.f("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty&&!this._occlusionOpacityChanged&&this._occlusionCriteriaSatisfied()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let i;this.fire(new o.f("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,_=o.e.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=x.createQuery(),x.beginQuery(c.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,z=this.transform.pitch,B=o.e.now(),j=new o.X(D,{now:B,fadeDuration:w,pitch:z,transition:this.style.transition});this.style.update(j)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(_),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(_);const I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource);if(I&&(this._placementDirty=I.needsRerender,this._occlusionOpacityChanged=I.occlusionQueryBasedOpacityChanged),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.f("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.dc.mark(o.dd.load),this.fire(new o.f("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const D=o.e.now()-_;x.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const z=x.getQueryParameter(i,x.QUERY_RESULT)/1e6;x.deleteQuery(i),this.fire(new o.f("gpu-timing-frame",{cpuTime:D,gpuTime:z}))},50)}if(this.listens("gpu-timing-layer")){const D=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(D);this.fire(new o.f("gpu-timing-layer",{layerTimes:z}))},50)}if(this.listens("gpu-timing-deferred-render")){const D=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const z=this.painter.queryGpuTimeDeferredRender(D);this.fire(new o.f("gpu-timing-deferred-render",{gpuTime:z}))},50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||this._occlusionOpacityChanged||S;if((this._sourcesDirty||this._styleDirty||S||this._occlusionOpacityChanged)&&(this._lastDirtyFrameId=this._frameId),O||this._repaint||!this._occlusionCriteriaSatisfied())this.triggerRepaint();else{const D=!this.isMoving()&&this.loaded();if(D&&(S=this._updateAverageElevation(_,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),D&&(this.fire(new o.f("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new o.f("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}this._loaded&&!this._fullyLoaded&&!O&&this._occlusionCriteriaSatisfied()&&(this._fullyLoaded=!0,o.dc.mark(o.dd.fullLoad),this._performanceMetricsCollection&&o.dj(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const i of this._markers)p&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!p||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(p,i=!1){const c=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const _=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(_||(i||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const x=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=p;const S=Math.abs(x-w);if(S>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(w),c(w);this._averageElevation.easeTo(w,p,300)}else if(S>1e-4)return this._averageElevation.jumpTo(w),c(w)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){o.dk(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===o.dl||p.status===401)){const i=this.painter.context.gl;o.dh(i,!1),this._logoControl instanceof Oy&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.d(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&o.dn(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const c=this.painter.context.gl,_=c.createFramebuffer();function x(w){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,w,0);const S=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,S),S}return c.bindFramebuffer(c.FRAMEBUFFER,_),this._canvasPixelComparison(x(p),i.canvasCopies.map(x),i.timeStamps)}_canvasPixelComparison(p,i,c){let _=c[1]-c[0];const x=p.length/4;for(let w=0;w<i.length;w++){const S=i[w];let I=0;for(let O=0;O<S.length;O+=4)S[O]===p[O]&&S[O+1]===p[O+1]&&S[O+2]===p[O+2]&&S[O+3]===p[O+3]&&(I+=1);_+=(c[w+2]-c[w+1])*(1-I/x)}return _}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.dp(this.painter.context.gl),o.dq.remove(),o.dr.remove(),this._removed=!0,this.fire(new o.f("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=o.e.frame(i=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(i)}))}_preloadTiles(p){const i=this.style?this.style.getSourceCaches():[];return o.ds(i,(c,_)=>c._preloadTiles(p,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,this._tp.refreshUI(),p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,this._tp.refreshUI(),p&&this._update())}_setCacheLimits(p,i){o.du(p,i)}_occlusionCriteriaSatisfied(){const p=this.style&&(this.style.has3DLayers()||this.style.terrain&&!this.style.disableElevatedTerrain);return!(this.style&&this.style.hasSymbolLayers()&&p&&this.painter)||this._frameId-this._lastDirtyFrameId>5+2*this.painter.symbolParams.occlusionQueryFrameWindow}get version(){return o.dt}},NavigationControl:class{constructor(p={}){this.options=o.W({},Bm,p),this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(o.bp(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),te("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),te("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bp(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:i}):c.resetNorth({},{originalEvent:i}))}),this._compassIcon=te("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const i=p.getZoom(),c=i===p.getMaxZoom(),_=i===p.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new lu(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,i){const c=te("button",p,this._container);return c.type="button",c.addEventListener("click",i),c}_setButtonTitle(p,i){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${i}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends o.E{constructor(p={}){super();const i=navigator.geolocation;this.options=o.W({geolocation:i},Fy,p),o.bp(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=xy(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const i=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,p(c)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>i(c.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(p){const i=this._map.getMaxBounds(),c=p.coords;return!!i&&(c.longitude<i.getWest()||c.longitude>i.getEast()||c.latitude<i.getSouth()||c.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new o.f("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.f("geolocate",p)),this._finish()}}_updateCamera(p){const i=new o.aI(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,_=this._map.getBearing(),x=o.W({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(c),x,{geolocateSource:!0})}_updateMarker(p){if(p){const i=new o.aI(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,i=o.ax(1,p._center.lat)*p.worldSize,c=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.f("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=te("button","mapboxgl-ctrl-geolocate",this._container),te("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=te("div","mapboxgl-user-location"),this._dotElement.appendChild(te("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(te("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new km({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=te("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new km({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.f("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.f("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.f("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.f("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Py,ScaleControl:class{constructor(p={}){this.options=o.W({},uu,p),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.bp(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,i=this._map,c=i._containerHeight/2,_=i._containerWidth/2-p/2,x=i.unproject([_,c]),w=i.unproject([_+p,c]),S=x.distanceTo(w);if(this.options.unit==="imperial"){const I=3.2808*S;I>5280?this._setScale(p,I/5280,"mile"):this._setScale(p,I,"foot")}else this.options.unit==="nautical"?this._setScale(p,S/1852,"nautical-mile"):S>=1e3?this._setScale(p,S/1e3,"kilometer"):this._setScale(p,S,"meter")}_setScale(p,i,c){this._map._requestDomTask(()=>{const _=function(w){const S=Math.pow(10,`${Math.floor(w)}`.length-1);let I=w/S;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(O){const D=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*D)/D}(I),S*I}(i),x=_/i;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(_):`${_}&nbsp;${By[c]}`,this._container.style.width=p*x+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=te("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p={}){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:o.w("Full screen control 'container' must be a DOM element.")),o.bp(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=te("button","mapboxgl-ctrl-fullscreen",this._controlContainer);te("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.E{constructor(p){super(),this.options=o.W(Object.create(Lm),p),o.bp(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new o.f("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new o.f("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=o.aI.convert(p),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const i=document.createDocumentFragment(),c=document.createElement("body");let _;for(c.innerHTML=p;_=c.firstChild,_;)i.appendChild(_);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=te("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(p),this.options.closeButton){const c=this._closeButton=te("button","mapboxgl-popup-close-button",i);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let i;return this._classList.delete(p)?i=!1:(this._classList.add(p),i=!0),this._updateClassList(),i}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const i=this._map,c=this._container,_=this._pos;if(!i||!c||!_)return"bottom";const x=c.offsetWidth,w=c.offsetHeight,S=_.x<x/2,I=_.x>i.transform.width-x/2;if(_.y+p<w)return S?"top-left":I?"top-right":"top";if(_.y>i.transform.height-w){if(S)return"bottom-left";if(I)return"bottom-right"}return S?"left":I?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),p.className=i.join(" ")}_update(p){const i=this._map,c=this._content;if(!i||!this._lngLat&&!this._trackPointer||!c)return;let _=this._container;if(_||(_=this._container=te("div","mapboxgl-popup",i.getContainer()),this._tip=te("div","mapboxgl-popup-tip",_),_.appendChild(c)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ry(this._lngLat,this._pos,i.transform)),!this._trackPointer||p){const x=this._pos=this._trackPointer&&p instanceof o.P?p:i.project(this._lngLat),w=Fm(this.options.offset),S=this._anchor=this._getAnchor(w.y),I=Fm(this.options.offset,S),O=x.add(I).round();i._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${Rm[S]} translate(${O.x}px,${O.y}px)`)})}if(!this._marker&&i._showingGlobe()){const x=o.d9(i.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(zm);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:km,Style:Us,LngLat:o.aI,LngLatBounds:o.ai,Point:o.P,MercatorCoordinate:o.Y,FreeCameraOptions:Oe,Evented:o.E,config:o.d8,prewarm:o.dx,clearPrewarmedResources:o.dy,get accessToken(){return o.d8.ACCESS_TOKEN},set accessToken(p){o.d8.ACCESS_TOKEN=p},get baseApiUrl(){return o.d8.API_URL},set baseApiUrl(p){o.d8.API_URL=p},get workerCount(){return o.dz.workerCount},set workerCount(p){o.dz.workerCount=p},get maxParallelImageRequests(){return o.d8.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){o.d8.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){o.dA(p)},get workerUrl(){return o.dB.workerUrl},set workerUrl(p){o.dB.workerUrl=p},get workerClass(){return o.dB.workerClass},set workerClass(p){o.dB.workerClass=p},get workerParams(){return o.dB.workerParams},set workerParams(p){o.dB.workerParams=p},get dracoUrl(){return o.dC()},set dracoUrl(p){o.dD(p)},get meshoptUrl(){return o.dE()},set meshoptUrl(p){o.dF(p)},setNow:o.e.setNow,restoreNow:o.e.restoreNow}});var P=b;return P})})(Ok);var bj=Ok.exports;const hp=zg(bj);hp.accessToken="pk.eyJ1IjoicHJlZXRoaWRvbnRodSIsImEiOiJjbHU3cHh1bWMwOGFyMmxwbnRpaGEwbW1hIn0.s9nQ_ZEtcYhaY9SRDS-0Jw";const wj=()=>{const a=rr.useRef(null),n=rr.useRef(null),[h,m]=rr.useState(144.946457),[y,b]=rr.useState(-37.840935),[M,P]=rr.useState(10);return rr.useEffect(()=>{n.current||(n.current=new hp.Map({container:a.current,style:"mapbox://styles/preethidonthu/clzhabtb800l901r1898yax6k",center:[h,y],zoom:M}))}),ir.jsx("div",{className:"map-container",children:ir.jsx("div",{ref:a,className:"map"})})};function Tj(){return ir.jsxs("div",{id:"outro-slider",className:"h-screen p-10 bg-gray-50 font-robotoSlab absolute top-0 left-0 z-10 w-full flex flex-col gap-10 tracking-tight",children:[ir.jsx("div",{id:"navbar",className:"navbar",children:ir.jsx(jE,{})}),ir.jsx("div",{id:"mapbox",children:ir.jsx(wj,{})})]})}function lv(a){throw new Error('Could not dynamically require "'+a+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Rk={exports:{}};(function(a,n){(function(h){a.exports=h()})(function(){return function(){function h(m,y,b){function M(R,U){if(!y[R]){if(!m[R]){var V=typeof lv=="function"&&lv;if(!U&&V)return V(R,!0);if(P)return P(R,!0);var Z=new Error("Cannot find module '"+R+"'");throw Z.code="MODULE_NOT_FOUND",Z}var te=y[R]={exports:{}};m[R][0].call(te.exports,function(se){var re=m[R][1][se];return M(re||se)},te,te.exports,h,m,y,b)}return y[R].exports}for(var P=typeof lv=="function"&&lv,o=0;o<b.length;o++)M(b[o]);return M}return h}()({1:[function(h,m,y){var b=h("./toPropertyKey.js");function M(P,o,R){return o=b(o),o in P?Object.defineProperty(P,o,{value:R,enumerable:!0,configurable:!0,writable:!0}):P[o]=R,P}m.exports=M,m.exports.__esModule=!0,m.exports.default=m.exports},{"./toPropertyKey.js":4}],2:[function(h,m,y){var b=h("./defineProperty.js");function M(o,R){var U=Object.keys(o);if(Object.getOwnPropertySymbols){var V=Object.getOwnPropertySymbols(o);R&&(V=V.filter(function(Z){return Object.getOwnPropertyDescriptor(o,Z).enumerable})),U.push.apply(U,V)}return U}function P(o){for(var R=1;R<arguments.length;R++){var U=arguments[R]!=null?arguments[R]:{};R%2?M(Object(U),!0).forEach(function(V){b(o,V,U[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(U)):M(Object(U)).forEach(function(V){Object.defineProperty(o,V,Object.getOwnPropertyDescriptor(U,V))})}return o}m.exports=P,m.exports.__esModule=!0,m.exports.default=m.exports},{"./defineProperty.js":1}],3:[function(h,m,y){var b=h("./typeof.js").default;function M(P,o){if(b(P)!=="object"||P===null)return P;var R=P[Symbol.toPrimitive];if(R!==void 0){var U=R.call(P,o||"default");if(b(U)!=="object")return U;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(P)}m.exports=M,m.exports.__esModule=!0,m.exports.default=m.exports},{"./typeof.js":5}],4:[function(h,m,y){var b=h("./typeof.js").default,M=h("./toPrimitive.js");function P(o){var R=M(o,"string");return b(R)==="symbol"?R:String(R)}m.exports=P,m.exports.__esModule=!0,m.exports.default=m.exports},{"./toPrimitive.js":3,"./typeof.js":5}],5:[function(h,m,y){function b(M){"@babel/helpers - typeof";return m.exports=b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},m.exports.__esModule=!0,m.exports.default=m.exports,b(M)}m.exports=b,m.exports.__esModule=!0,m.exports.default=m.exports},{}],6:[function(h,m,y){var b={};function M(R){return Math.floor(Math.abs(R)+.5)*(R>=0?1:-1)}function P(R,U,V){R=M(R*V),U=M(U*V);var Z=R-U;Z<<=1,R-U<0&&(Z=~Z);for(var te="";Z>=32;)te+=String.fromCharCode((32|Z&31)+63),Z>>=5;return te+=String.fromCharCode(Z+63),te}b.decode=function(R,U){for(var V=0,Z=0,te=0,se=[],re=0,Te=0,ae=null,q,Q,le=Math.pow(10,Number.isInteger(U)?U:5);V<R.length;){ae=null,re=0,Te=0;do ae=R.charCodeAt(V++)-63,Te|=(ae&31)<<re,re+=5;while(ae>=32);q=Te&1?~(Te>>1):Te>>1,re=Te=0;do ae=R.charCodeAt(V++)-63,Te|=(ae&31)<<re,re+=5;while(ae>=32);Q=Te&1?~(Te>>1):Te>>1,Z+=q,te+=Q,se.push([Z/le,te/le])}return se},b.encode=function(R,U){if(!R.length)return"";for(var V=Math.pow(10,Number.isInteger(U)?U:5),Z=P(R[0][0],0,V)+P(R[0][1],0,V),te=1;te<R.length;te++){var se=R[te],re=R[te-1];Z+=P(se[0],re[0],V),Z+=P(se[1],re[1],V)}return Z};function o(R){for(var U=[],V=0;V<R.length;V++){var Z=R[V].slice();U.push([Z[1],Z[0]])}return U}b.fromGeoJSON=function(R,U){if(R&&R.type==="Feature"&&(R=R.geometry),!R||R.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return b.encode(o(R.coordinates),U)},b.toGeoJSON=function(R,U){var V=b.decode(R,U);return{type:"LineString",coordinates:o(V)}},typeof m=="object"&&m.exports&&(m.exports=b)},{}],7:[function(h,m,y){var b=typeof Reflect=="object"?Reflect:null,M=b&&typeof b.apply=="function"?b.apply:function(Me,Ie,Je){return Function.prototype.apply.call(Me,Ie,Je)},P;b&&typeof b.ownKeys=="function"?P=b.ownKeys:Object.getOwnPropertySymbols?P=function(Me){return Object.getOwnPropertyNames(Me).concat(Object.getOwnPropertySymbols(Me))}:P=function(Me){return Object.getOwnPropertyNames(Me)};function o(xe){console&&console.warn&&console.warn(xe)}var R=Number.isNaN||function(Me){return Me!==Me};function U(){U.init.call(this)}m.exports=U,m.exports.once=ze,U.EventEmitter=U,U.prototype._events=void 0,U.prototype._eventsCount=0,U.prototype._maxListeners=void 0;var V=10;function Z(xe){if(typeof xe!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof xe)}Object.defineProperty(U,"defaultMaxListeners",{enumerable:!0,get:function(){return V},set:function(xe){if(typeof xe!="number"||xe<0||R(xe))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+xe+".");V=xe}}),U.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},U.prototype.setMaxListeners=function(Me){if(typeof Me!="number"||Me<0||R(Me))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Me+".");return this._maxListeners=Me,this};function te(xe){return xe._maxListeners===void 0?U.defaultMaxListeners:xe._maxListeners}U.prototype.getMaxListeners=function(){return te(this)},U.prototype.emit=function(Me){for(var Ie=[],Je=1;Je<arguments.length;Je++)Ie.push(arguments[Je]);var Be=Me==="error",Ce=this._events;if(Ce!==void 0)Be=Be&&Ce.error===void 0;else if(!Be)return!1;if(Be){var Re;if(Ie.length>0&&(Re=Ie[0]),Re instanceof Error)throw Re;var rt=new Error("Unhandled error."+(Re?" ("+Re.message+")":""));throw rt.context=Re,rt}var st=Ce[Me];if(st===void 0)return!1;if(typeof st=="function")M(st,this,Ie);else for(var at=st.length,Ve=Q(st,at),Je=0;Je<at;++Je)M(Ve[Je],this,Ie);return!0};function se(xe,Me,Ie,Je){var Be,Ce,Re;if(Z(Ie),Ce=xe._events,Ce===void 0?(Ce=xe._events=Object.create(null),xe._eventsCount=0):(Ce.newListener!==void 0&&(xe.emit("newListener",Me,Ie.listener?Ie.listener:Ie),Ce=xe._events),Re=Ce[Me]),Re===void 0)Re=Ce[Me]=Ie,++xe._eventsCount;else if(typeof Re=="function"?Re=Ce[Me]=Je?[Ie,Re]:[Re,Ie]:Je?Re.unshift(Ie):Re.push(Ie),Be=te(xe),Be>0&&Re.length>Be&&!Re.warned){Re.warned=!0;var rt=new Error("Possible EventEmitter memory leak detected. "+Re.length+" "+String(Me)+" listeners added. Use emitter.setMaxListeners() to increase limit");rt.name="MaxListenersExceededWarning",rt.emitter=xe,rt.type=Me,rt.count=Re.length,o(rt)}return xe}U.prototype.addListener=function(Me,Ie){return se(this,Me,Ie,!1)},U.prototype.on=U.prototype.addListener,U.prototype.prependListener=function(Me,Ie){return se(this,Me,Ie,!0)};function re(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Te(xe,Me,Ie){var Je={fired:!1,wrapFn:void 0,target:xe,type:Me,listener:Ie},Be=re.bind(Je);return Be.listener=Ie,Je.wrapFn=Be,Be}U.prototype.once=function(Me,Ie){return Z(Ie),this.on(Me,Te(this,Me,Ie)),this},U.prototype.prependOnceListener=function(Me,Ie){return Z(Ie),this.prependListener(Me,Te(this,Me,Ie)),this},U.prototype.removeListener=function(Me,Ie){var Je,Be,Ce,Re,rt;if(Z(Ie),Be=this._events,Be===void 0)return this;if(Je=Be[Me],Je===void 0)return this;if(Je===Ie||Je.listener===Ie)--this._eventsCount===0?this._events=Object.create(null):(delete Be[Me],Be.removeListener&&this.emit("removeListener",Me,Je.listener||Ie));else if(typeof Je!="function"){for(Ce=-1,Re=Je.length-1;Re>=0;Re--)if(Je[Re]===Ie||Je[Re].listener===Ie){rt=Je[Re].listener,Ce=Re;break}if(Ce<0)return this;Ce===0?Je.shift():le(Je,Ce),Je.length===1&&(Be[Me]=Je[0]),Be.removeListener!==void 0&&this.emit("removeListener",Me,rt||Ie)}return this},U.prototype.off=U.prototype.removeListener,U.prototype.removeAllListeners=function(Me){var Ie,Je,Be;if(Je=this._events,Je===void 0)return this;if(Je.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):Je[Me]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete Je[Me]),this;if(arguments.length===0){var Ce=Object.keys(Je),Re;for(Be=0;Be<Ce.length;++Be)Re=Ce[Be],Re!=="removeListener"&&this.removeAllListeners(Re);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Ie=Je[Me],typeof Ie=="function")this.removeListener(Me,Ie);else if(Ie!==void 0)for(Be=Ie.length-1;Be>=0;Be--)this.removeListener(Me,Ie[Be]);return this};function ae(xe,Me,Ie){var Je=xe._events;if(Je===void 0)return[];var Be=Je[Me];return Be===void 0?[]:typeof Be=="function"?Ie?[Be.listener||Be]:[Be]:Ie?ye(Be):Q(Be,Be.length)}U.prototype.listeners=function(Me){return ae(this,Me,!0)},U.prototype.rawListeners=function(Me){return ae(this,Me,!1)},U.listenerCount=function(xe,Me){return typeof xe.listenerCount=="function"?xe.listenerCount(Me):q.call(xe,Me)},U.prototype.listenerCount=q;function q(xe){var Me=this._events;if(Me!==void 0){var Ie=Me[xe];if(typeof Ie=="function")return 1;if(Ie!==void 0)return Ie.length}return 0}U.prototype.eventNames=function(){return this._eventsCount>0?P(this._events):[]};function Q(xe,Me){for(var Ie=new Array(Me),Je=0;Je<Me;++Je)Ie[Je]=xe[Je];return Ie}function le(xe,Me){for(;Me+1<xe.length;Me++)xe[Me]=xe[Me+1];xe.pop()}function ye(xe){for(var Me=new Array(xe.length),Ie=0;Ie<Me.length;++Ie)Me[Ie]=xe[Ie].listener||xe[Ie];return Me}function ze(xe,Me){return new Promise(function(Ie,Je){function Be(Re){xe.removeListener(Me,Ce),Je(Re)}function Ce(){typeof xe.removeListener=="function"&&xe.removeListener("error",Be),Ie([].slice.call(arguments))}Ne(xe,Me,Ce,{once:!0}),Me!=="error"&&He(xe,Be,{once:!0})})}function He(xe,Me,Ie){typeof xe.on=="function"&&Ne(xe,"error",Me,Ie)}function Ne(xe,Me,Ie,Je){if(typeof xe.on=="function")Je.once?xe.once(Me,Ie):xe.on(Me,Ie);else if(typeof xe.addEventListener=="function")xe.addEventListener(Me,function Be(Ce){Je.once&&xe.removeEventListener(Me,Be),Ie(Ce)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof xe)}},{}],8:[function(h,m,y){(function(){var b=this,M={};typeof y<"u"?m.exports=M:b.fuzzy=M,M.simpleFilter=function(P,o){return o.filter(function(R){return M.test(P,R)})},M.test=function(P,o){return M.match(P,o)!==null},M.match=function(P,o,R){R=R||{};var U=0,V=[],Z=o.length,te=0,se=0,re=R.pre||"",Te=R.post||"",ae=R.caseSensitive&&o||o.toLowerCase(),q;P=R.caseSensitive&&P||P.toLowerCase();for(var Q=0;Q<Z;Q++)q=o[Q],ae[Q]===P[U]?(q=re+q+Te,U+=1,se+=1+se):se=0,te+=se,V[V.length]=q;return U===P.length?(te=ae===P?1/0:te,{rendered:V.join(""),score:te}):null},M.filter=function(P,o,R){return!o||o.length===0?[]:typeof P!="string"?o:(R=R||{},o.reduce(function(U,V,Z,te){var se=V;R.extract&&(se=R.extract(V));var re=M.match(P,se,R);return re!=null&&(U[U.length]={string:re.rendered,score:re.score,index:Z,original:V}),U},[]).sort(function(U,V){var Z=V.score-U.score;return Z||U.index-V.index}))}})()},{}],9:[function(h,m,y){var b=/<%=([\s\S]+?)%>/g;m.exports=b},{}],10:[function(h,m,y){(function(b){(function(){var M="Expected a function",P=NaN,o="[object Symbol]",R=/^\s+|\s+$/g,U=/^[-+]0x[0-9a-f]+$/i,V=/^0b[01]+$/i,Z=/^0o[0-7]+$/i,te=parseInt,se=typeof b=="object"&&b&&b.Object===Object&&b,re=typeof self=="object"&&self&&self.Object===Object&&self,Te=se||re||Function("return this")(),ae=Object.prototype,q=ae.toString,Q=Math.max,le=Math.min,ye=function(){return Te.Date.now()};function ze(Ie,Je,Be){var Ce,Re,rt,st,at,Ve,Dt=0,Bt=!1,Gt=!1,qt=!0;if(typeof Ie!="function")throw new TypeError(M);Je=Me(Je)||0,He(Be)&&(Bt=!!Be.leading,Gt="maxWait"in Be,rt=Gt?Q(Me(Be.maxWait)||0,Je):rt,qt="trailing"in Be?!!Be.trailing:qt);function or(Lr){var xn=Ce,$n=Re;return Ce=Re=void 0,Dt=Lr,st=Ie.apply($n,xn),st}function et(Lr){return Dt=Lr,at=setTimeout(dr,Je),Bt?or(Lr):st}function kt(Lr){var xn=Lr-Ve,$n=Lr-Dt,Ur=Je-xn;return Gt?le(Ur,rt-$n):Ur}function Vt(Lr){var xn=Lr-Ve,$n=Lr-Dt;return Ve===void 0||xn>=Je||xn<0||Gt&&$n>=rt}function dr(){var Lr=ye();if(Vt(Lr))return ht(Lr);at=setTimeout(dr,kt(Lr))}function ht(Lr){return at=void 0,qt&&Ce?or(Lr):(Ce=Re=void 0,st)}function vr(){at!==void 0&&clearTimeout(at),Dt=0,Ce=Ve=Re=at=void 0}function ar(){return at===void 0?st:ht(ye())}function $r(){var Lr=ye(),xn=Vt(Lr);if(Ce=arguments,Re=this,Ve=Lr,xn){if(at===void 0)return et(Ve);if(Gt)return at=setTimeout(dr,Je),or(Ve)}return at===void 0&&(at=setTimeout(dr,Je)),st}return $r.cancel=vr,$r.flush=ar,$r}function He(Ie){var Je=typeof Ie;return!!Ie&&(Je=="object"||Je=="function")}function Ne(Ie){return!!Ie&&typeof Ie=="object"}function xe(Ie){return typeof Ie=="symbol"||Ne(Ie)&&q.call(Ie)==o}function Me(Ie){if(typeof Ie=="number")return Ie;if(xe(Ie))return P;if(He(Ie)){var Je=typeof Ie.valueOf=="function"?Ie.valueOf():Ie;Ie=He(Je)?Je+"":Je}if(typeof Ie!="string")return Ie===0?Ie:+Ie;Ie=Ie.replace(R,"");var Be=V.test(Ie);return Be||Z.test(Ie)?te(Ie.slice(2),Be?2:8):U.test(Ie)?P:+Ie}m.exports=ze}).call(this)}).call(this,typeof Xo<"u"?Xo:typeof self<"u"?self:typeof window<"u"?window:{})},{}],11:[function(h,m,y){(function(b){(function(){var M=200,P="__lodash_hash_undefined__",o=1,R=2,U=9007199254740991,V="[object Arguments]",Z="[object Array]",te="[object AsyncFunction]",se="[object Boolean]",re="[object Date]",Te="[object Error]",ae="[object Function]",q="[object GeneratorFunction]",Q="[object Map]",le="[object Number]",ye="[object Null]",ze="[object Object]",He="[object Promise]",Ne="[object Proxy]",xe="[object RegExp]",Me="[object Set]",Ie="[object String]",Je="[object Symbol]",Be="[object Undefined]",Ce="[object WeakMap]",Re="[object ArrayBuffer]",rt="[object DataView]",st="[object Float32Array]",at="[object Float64Array]",Ve="[object Int8Array]",Dt="[object Int16Array]",Bt="[object Int32Array]",Gt="[object Uint8Array]",qt="[object Uint8ClampedArray]",or="[object Uint16Array]",et="[object Uint32Array]",kt=/[\\^$.*+?()[\]{}|]/g,Vt=/^\[object .+?Constructor\]$/,dr=/^(?:0|[1-9]\d*)$/,ht={};ht[st]=ht[at]=ht[Ve]=ht[Dt]=ht[Bt]=ht[Gt]=ht[qt]=ht[or]=ht[et]=!0,ht[V]=ht[Z]=ht[Re]=ht[se]=ht[rt]=ht[re]=ht[Te]=ht[ae]=ht[Q]=ht[le]=ht[ze]=ht[xe]=ht[Me]=ht[Ie]=ht[Ce]=!1;var vr=typeof b=="object"&&b&&b.Object===Object&&b,ar=typeof self=="object"&&self&&self.Object===Object&&self,$r=vr||ar||Function("return this")(),Lr=typeof y=="object"&&y&&!y.nodeType&&y,xn=Lr&&typeof m=="object"&&m&&!m.nodeType&&m,$n=xn&&xn.exports===Lr,Ur=$n&&vr.process,ni=function(){try{return Ur&&Ur.binding&&Ur.binding("util")}catch{}}(),ii=ni&&ni.isTypedArray;function kn(Oe,nt){for(var Rt=-1,hr=Oe==null?0:Oe.length,Kt=0,zr=[];++Rt<hr;){var bn=Oe[Rt];nt(bn,Rt,Oe)&&(zr[Kt++]=bn)}return zr}function Wt(Oe,nt){for(var Rt=-1,hr=nt.length,Kt=Oe.length;++Rt<hr;)Oe[Kt+Rt]=nt[Rt];return Oe}function er(Oe,nt){for(var Rt=-1,hr=Oe==null?0:Oe.length;++Rt<hr;)if(nt(Oe[Rt],Rt,Oe))return!0;return!1}function go(Oe,nt){for(var Rt=-1,hr=Array(Oe);++Rt<Oe;)hr[Rt]=nt(Rt);return hr}function bi(Oe){return function(nt){return Oe(nt)}}function Bo(Oe,nt){return Oe.has(nt)}function ws(Oe,nt){return Oe==null?void 0:Oe[nt]}function Ts(Oe){var nt=-1,Rt=Array(Oe.size);return Oe.forEach(function(hr,Kt){Rt[++nt]=[Kt,hr]}),Rt}function na(Oe,nt){return function(Rt){return Oe(nt(Rt))}}function No(Oe){var nt=-1,Rt=Array(Oe.size);return Oe.forEach(function(hr){Rt[++nt]=hr}),Rt}var Ss=Array.prototype,Es=Function.prototype,es=Object.prototype,ts=$r["__core-js_shared__"],Ms=Es.toString,Dn=es.hasOwnProperty,Da=function(){var Oe=/[^.]+$/.exec(ts&&ts.keys&&ts.keys.IE_PROTO||"");return Oe?"Symbol(src)_1."+Oe:""}(),sr=es.toString,Is=RegExp("^"+Ms.call(Dn).replace(kt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ln=$n?$r.Buffer:void 0,Gn=$r.Symbol,Uo=$r.Uint8Array,Wi=es.propertyIsEnumerable,yo=Ss.splice,ao=Gn?Gn.toStringTag:void 0,vo=Object.getOwnPropertySymbols,lo=ln?ln.isBuffer:void 0,ia=na(Object.keys,Object),rs=Ps($r,"DataView"),Ii=Ps($r,"Map"),uo=Ps($r,"Promise"),Ai=Ps($r,"Set"),xo=Ps($r,"WeakMap"),oi=Ps(Object,"create"),Yn=Qn(rs),Ra=Qn(Ii),ns=Qn(uo),As=Qn(Ai),ka=Qn(xo),is=Gn?Gn.prototype:void 0,Ae=is?is.valueOf:void 0;function W(Oe){var nt=-1,Rt=Oe==null?0:Oe.length;for(this.clear();++nt<Rt;){var hr=Oe[nt];this.set(hr[0],hr[1])}}function J(){this.__data__=oi?oi(null):{},this.size=0}function de(Oe){var nt=this.has(Oe)&&delete this.__data__[Oe];return this.size-=nt?1:0,nt}function ve(Oe){var nt=this.__data__;if(oi){var Rt=nt[Oe];return Rt===P?void 0:Rt}return Dn.call(nt,Oe)?nt[Oe]:void 0}function we(Oe){var nt=this.__data__;return oi?nt[Oe]!==void 0:Dn.call(nt,Oe)}function Ue(Oe,nt){var Rt=this.__data__;return this.size+=this.has(Oe)?0:1,Rt[Oe]=oi&&nt===void 0?P:nt,this}W.prototype.clear=J,W.prototype.delete=de,W.prototype.get=ve,W.prototype.has=we,W.prototype.set=Ue;function qe(Oe){var nt=-1,Rt=Oe==null?0:Oe.length;for(this.clear();++nt<Rt;){var hr=Oe[nt];this.set(hr[0],hr[1])}}function Le(){this.__data__=[],this.size=0}function Ke(Oe){var nt=this.__data__,Rt=oa(nt,Oe);if(Rt<0)return!1;var hr=nt.length-1;return Rt==hr?nt.pop():yo.call(nt,Rt,1),--this.size,!0}function St(Oe){var nt=this.__data__,Rt=oa(nt,Oe);return Rt<0?void 0:nt[Rt][1]}function yt(Oe){return oa(this.__data__,Oe)>-1}function Ht(Oe,nt){var Rt=this.__data__,hr=oa(Rt,Oe);return hr<0?(++this.size,Rt.push([Oe,nt])):Rt[hr][1]=nt,this}qe.prototype.clear=Le,qe.prototype.delete=Ke,qe.prototype.get=St,qe.prototype.has=yt,qe.prototype.set=Ht;function Qt(Oe){var nt=-1,Rt=Oe==null?0:Oe.length;for(this.clear();++nt<Rt;){var hr=Oe[nt];this.set(hr[0],hr[1])}}function br(){this.size=0,this.__data__={hash:new W,map:new(Ii||qe),string:new W}}function Sr(Oe){var nt=aa(this,Oe).delete(Oe);return this.size-=nt?1:0,nt}function gr(Oe){return aa(this,Oe).get(Oe)}function Ir(Oe){return aa(this,Oe).has(Oe)}function $t(Oe,nt){var Rt=aa(this,Oe),hr=Rt.size;return Rt.set(Oe,nt),this.size+=Rt.size==hr?0:1,this}Qt.prototype.clear=br,Qt.prototype.delete=Sr,Qt.prototype.get=gr,Qt.prototype.has=Ir,Qt.prototype.set=$t;function rn(Oe){var nt=-1,Rt=Oe==null?0:Oe.length;for(this.__data__=new Qt;++nt<Rt;)this.add(Oe[nt])}function Zr(Oe){return this.__data__.set(Oe,P),this}function Dr(Oe){return this.__data__.has(Oe)}rn.prototype.add=rn.prototype.push=Zr,rn.prototype.has=Dr;function on(Oe){var nt=this.__data__=new qe(Oe);this.size=nt.size}function hn(){this.__data__=new qe,this.size=0}function Mn(Oe){var nt=this.__data__,Rt=nt.delete(Oe);return this.size=nt.size,Rt}function si(Oe){return this.__data__.get(Oe)}function Kn(Oe){return this.__data__.has(Oe)}function jo(Oe,nt){var Rt=this.__data__;if(Rt instanceof qe){var hr=Rt.__data__;if(!Ii||hr.length<M-1)return hr.push([Oe,nt]),this.size=++Rt.size,this;Rt=this.__data__=new Qt(hr)}return Rt.set(Oe,nt),this.size=Rt.size,this}on.prototype.clear=hn,on.prototype.delete=Mn,on.prototype.get=si,on.prototype.has=Kn,on.prototype.set=jo;function jl(Oe,nt){var Rt=ai(Oe),hr=!Rt&&bo(Oe),Kt=!Rt&&!hr&&Jn(Oe),zr=!Rt&&!hr&&!Kt&&Fa(Oe),bn=Rt||hr||Kt||zr,fn=bn?go(Oe.length,String):[],ui=fn.length;for(var Qr in Oe)Dn.call(Oe,Qr)&&!(bn&&(Qr=="length"||Kt&&(Qr=="offset"||Qr=="parent")||zr&&(Qr=="buffer"||Qr=="byteLength"||Qr=="byteOffset")||Et(Qr,ui)))&&fn.push(Qr);return fn}function oa(Oe,nt){for(var Rt=Oe.length;Rt--;)if(Ln(Oe[Rt][0],nt))return Rt;return-1}function sa(Oe,nt,Rt){var hr=nt(Oe);return ai(Oe)?hr:Wt(hr,Rt(Oe))}function mr(Oe){return Oe==null?Oe===void 0?Be:ye:ao&&ao in Object(Oe)?Os(Oe):cr(Oe)}function Cs(Oe){return Mt(Oe)&&mr(Oe)==V}function Ci(Oe,nt,Rt,hr,Kt){return Oe===nt?!0:Oe==null||nt==null||!Mt(Oe)&&!Mt(nt)?Oe!==Oe&&nt!==nt:Vl(Oe,nt,Rt,hr,Ci,Kt)}function Vl(Oe,nt,Rt,hr,Kt,zr){var bn=ai(Oe),fn=ai(nt),ui=bn?Z:Ge(Oe),Qr=fn?Z:Ge(nt);ui=ui==V?ze:ui,Qr=Qr==V?ze:Qr;var qi=ui==ze,Hi=Qr==ze,ci=ui==Qr;if(ci&&Jn(Oe)){if(!Jn(nt))return!1;bn=!0,qi=!1}if(ci&&!qi)return zr||(zr=new on),bn||Fa(Oe)?La(Oe,nt,Rt,hr,Kt,zr):ql(Oe,nt,ui,Rt,hr,Kt,zr);if(!(Rt&o)){var Zi=qi&&Dn.call(Oe,"__wrapped__"),Xi=Hi&&Dn.call(nt,"__wrapped__");if(Zi||Xi){var Vo=Zi?Oe.value():Oe,Fi=Xi?nt.value():nt;return zr||(zr=new on),Kt(Vo,Fi,Rt,hr,zr)}}return ci?(zr||(zr=new on),Hl(Oe,nt,Rt,hr,Kt,zr)):!1}function $l(Oe){if(!wo(Oe)||Br(Oe))return!1;var nt=la(Oe)?Is:Vt;return nt.test(Qn(Oe))}function Gl(Oe){return Mt(Oe)&&Ds(Oe.length)&&!!ht[mr(Oe)]}function Wl(Oe){if(!Kr(Oe))return ia(Oe);var nt=[];for(var Rt in Object(Oe))Dn.call(Oe,Rt)&&Rt!="constructor"&&nt.push(Rt);return nt}function La(Oe,nt,Rt,hr,Kt,zr){var bn=Rt&o,fn=Oe.length,ui=nt.length;if(fn!=ui&&!(bn&&ui>fn))return!1;var Qr=zr.get(Oe);if(Qr&&zr.get(nt))return Qr==nt;var qi=-1,Hi=!0,ci=Rt&R?new rn:void 0;for(zr.set(Oe,nt),zr.set(nt,Oe);++qi<fn;){var Zi=Oe[qi],Xi=nt[qi];if(hr)var Vo=bn?hr(Xi,Zi,qi,nt,Oe,zr):hr(Zi,Xi,qi,Oe,nt,zr);if(Vo!==void 0){if(Vo)continue;Hi=!1;break}if(ci){if(!er(nt,function(Fi,Yi){if(!Bo(ci,Yi)&&(Zi===Fi||Kt(Zi,Fi,Rt,hr,zr)))return ci.push(Yi)})){Hi=!1;break}}else if(!(Zi===Xi||Kt(Zi,Xi,Rt,hr,zr))){Hi=!1;break}}return zr.delete(Oe),zr.delete(nt),Hi}function ql(Oe,nt,Rt,hr,Kt,zr,bn){switch(Rt){case rt:if(Oe.byteLength!=nt.byteLength||Oe.byteOffset!=nt.byteOffset)return!1;Oe=Oe.buffer,nt=nt.buffer;case Re:return!(Oe.byteLength!=nt.byteLength||!zr(new Uo(Oe),new Uo(nt)));case se:case re:case le:return Ln(+Oe,+nt);case Te:return Oe.name==nt.name&&Oe.message==nt.message;case xe:case Ie:return Oe==nt+"";case Q:var fn=Ts;case Me:var ui=hr&o;if(fn||(fn=No),Oe.size!=nt.size&&!ui)return!1;var Qr=bn.get(Oe);if(Qr)return Qr==nt;hr|=R,bn.set(Oe,nt);var qi=La(fn(Oe),fn(nt),hr,Kt,zr,bn);return bn.delete(Oe),qi;case Je:if(Ae)return Ae.call(Oe)==Ae.call(nt)}return!1}function Hl(Oe,nt,Rt,hr,Kt,zr){var bn=Rt&o,fn=hl(Oe),ui=fn.length,Qr=hl(nt),qi=Qr.length;if(ui!=qi&&!bn)return!1;for(var Hi=ui;Hi--;){var ci=fn[Hi];if(!(bn?ci in nt:Dn.call(nt,ci)))return!1}var Zi=zr.get(Oe);if(Zi&&zr.get(nt))return Zi==nt;var Xi=!0;zr.set(Oe,nt),zr.set(nt,Oe);for(var Vo=bn;++Hi<ui;){ci=fn[Hi];var Fi=Oe[ci],Yi=nt[ci];if(hr)var Fu=bn?hr(Yi,Fi,ci,nt,Oe,zr):hr(Fi,Yi,ci,Oe,nt,zr);if(!(Fu===void 0?Fi===Yi||Kt(Fi,Yi,Rt,hr,zr):Fu)){Xi=!1;break}Vo||(Vo=ci=="constructor")}if(Xi&&!Vo){var ho=Oe.constructor,dl=nt.constructor;ho!=dl&&"constructor"in Oe&&"constructor"in nt&&!(typeof ho=="function"&&ho instanceof ho&&typeof dl=="function"&&dl instanceof dl)&&(Xi=!1)}return zr.delete(Oe),zr.delete(nt),Xi}function hl(Oe){return sa(Oe,Rs,fl)}function aa(Oe,nt){var Rt=Oe.__data__;return Nt(nt)?Rt[typeof nt=="string"?"string":"hash"]:Rt.map}function Ps(Oe,nt){var Rt=ws(Oe,nt);return $l(Rt)?Rt:void 0}function Os(Oe){var nt=Dn.call(Oe,ao),Rt=Oe[ao];try{Oe[ao]=void 0;var hr=!0}catch{}var Kt=sr.call(Oe);return hr&&(nt?Oe[ao]=Rt:delete Oe[ao]),Kt}var fl=vo?function(Oe){return Oe==null?[]:(Oe=Object(Oe),kn(vo(Oe),function(nt){return Wi.call(Oe,nt)}))}:Ar,Ge=mr;(rs&&Ge(new rs(new ArrayBuffer(1)))!=rt||Ii&&Ge(new Ii)!=Q||uo&&Ge(uo.resolve())!=He||Ai&&Ge(new Ai)!=Me||xo&&Ge(new xo)!=Ce)&&(Ge=function(Oe){var nt=mr(Oe),Rt=nt==ze?Oe.constructor:void 0,hr=Rt?Qn(Rt):"";if(hr)switch(hr){case Yn:return rt;case Ra:return Q;case ns:return He;case As:return Me;case ka:return Ce}return nt});function Et(Oe,nt){return nt=nt??U,!!nt&&(typeof Oe=="number"||dr.test(Oe))&&Oe>-1&&Oe%1==0&&Oe<nt}function Nt(Oe){var nt=typeof Oe;return nt=="string"||nt=="number"||nt=="symbol"||nt=="boolean"?Oe!=="__proto__":Oe===null}function Br(Oe){return!!Da&&Da in Oe}function Kr(Oe){var nt=Oe&&Oe.constructor,Rt=typeof nt=="function"&&nt.prototype||es;return Oe===Rt}function cr(Oe){return sr.call(Oe)}function Qn(Oe){if(Oe!=null){try{return Ms.call(Oe)}catch{}try{return Oe+""}catch{}}return""}function Ln(Oe,nt){return Oe===nt||Oe!==Oe&&nt!==nt}var bo=Cs(function(){return arguments}())?Cs:function(Oe){return Mt(Oe)&&Dn.call(Oe,"callee")&&!Wi.call(Oe,"callee")},ai=Array.isArray;function co(Oe){return Oe!=null&&Ds(Oe.length)&&!la(Oe)}var Jn=lo||li;function za(Oe,nt){return Ci(Oe,nt)}function la(Oe){if(!wo(Oe))return!1;var nt=mr(Oe);return nt==ae||nt==q||nt==te||nt==Ne}function Ds(Oe){return typeof Oe=="number"&&Oe>-1&&Oe%1==0&&Oe<=U}function wo(Oe){var nt=typeof Oe;return Oe!=null&&(nt=="object"||nt=="function")}function Mt(Oe){return Oe!=null&&typeof Oe=="object"}var Fa=ii?bi(ii):Gl;function Rs(Oe){return co(Oe)?jl(Oe):Wl(Oe)}function Ar(){return[]}function li(){return!1}m.exports=za}).call(this)}).call(this,typeof Xo<"u"?Xo:typeof self<"u"?self:typeof window<"u"?window:{})},{}],12:[function(h,m,y){(function(b){(function(){var M=h("lodash._reinterpolate"),P=h("lodash.templatesettings"),o=800,R=16,U=1/0,V=9007199254740991,Z="[object Arguments]",te="[object Array]",se="[object AsyncFunction]",re="[object Boolean]",Te="[object Date]",ae="[object DOMException]",q="[object Error]",Q="[object Function]",le="[object GeneratorFunction]",ye="[object Map]",ze="[object Number]",He="[object Null]",Ne="[object Object]",xe="[object Proxy]",Me="[object RegExp]",Ie="[object Set]",Je="[object String]",Be="[object Symbol]",Ce="[object Undefined]",Re="[object WeakMap]",rt="[object ArrayBuffer]",st="[object DataView]",at="[object Float32Array]",Ve="[object Float64Array]",Dt="[object Int8Array]",Bt="[object Int16Array]",Gt="[object Int32Array]",qt="[object Uint8Array]",or="[object Uint8ClampedArray]",et="[object Uint16Array]",kt="[object Uint32Array]",Vt=/\b__p \+= '';/g,dr=/\b(__p \+=) '' \+/g,ht=/(__e\(.*?\)|\b__t\)) \+\n'';/g,vr=/[\\^$.*+?()[\]{}|]/g,ar=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,$r=/^\[object .+?Constructor\]$/,Lr=/^(?:0|[1-9]\d*)$/,xn=/($^)/,$n=/['\n\r\u2028\u2029\\]/g,Ur={};Ur[at]=Ur[Ve]=Ur[Dt]=Ur[Bt]=Ur[Gt]=Ur[qt]=Ur[or]=Ur[et]=Ur[kt]=!0,Ur[Z]=Ur[te]=Ur[rt]=Ur[re]=Ur[st]=Ur[Te]=Ur[q]=Ur[Q]=Ur[ye]=Ur[ze]=Ur[Ne]=Ur[Me]=Ur[Ie]=Ur[Je]=Ur[Re]=!1;var ni={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ii=typeof b=="object"&&b&&b.Object===Object&&b,kn=typeof self=="object"&&self&&self.Object===Object&&self,Wt=ii||kn||Function("return this")(),er=typeof y=="object"&&y&&!y.nodeType&&y,go=er&&typeof m=="object"&&m&&!m.nodeType&&m,bi=go&&go.exports===er,Bo=bi&&ii.process,ws=function(){try{var Ge=go&&go.require&&go.require("util").types;return Ge||Bo&&Bo.binding&&Bo.binding("util")}catch{}}(),Ts=ws&&ws.isTypedArray;function na(Ge,Et,Nt){switch(Nt.length){case 0:return Ge.call(Et);case 1:return Ge.call(Et,Nt[0]);case 2:return Ge.call(Et,Nt[0],Nt[1]);case 3:return Ge.call(Et,Nt[0],Nt[1],Nt[2])}return Ge.apply(Et,Nt)}function No(Ge,Et){for(var Nt=-1,Br=Ge==null?0:Ge.length,Kr=Array(Br);++Nt<Br;)Kr[Nt]=Et(Ge[Nt],Nt,Ge);return Kr}function Ss(Ge,Et){for(var Nt=-1,Br=Array(Ge);++Nt<Ge;)Br[Nt]=Et(Nt);return Br}function Es(Ge){return function(Et){return Ge(Et)}}function es(Ge,Et){return No(Et,function(Nt){return Ge[Nt]})}function ts(Ge){return"\\"+ni[Ge]}function Ms(Ge,Et){return Ge==null?void 0:Ge[Et]}function Dn(Ge,Et){return function(Nt){return Ge(Et(Nt))}}var Da=Function.prototype,sr=Object.prototype,Is=Wt["__core-js_shared__"],ln=Da.toString,Gn=sr.hasOwnProperty,Uo=function(){var Ge=/[^.]+$/.exec(Is&&Is.keys&&Is.keys.IE_PROTO||"");return Ge?"Symbol(src)_1."+Ge:""}(),Wi=sr.toString,yo=ln.call(Object),ao=RegExp("^"+ln.call(Gn).replace(vr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),vo=bi?Wt.Buffer:void 0,lo=Wt.Symbol,ia=Dn(Object.getPrototypeOf,Object),rs=sr.propertyIsEnumerable,Ii=lo?lo.toStringTag:void 0,uo=function(){try{var Ge=Ht(Object,"defineProperty");return Ge({},"",{}),Ge}catch{}}(),Ai=vo?vo.isBuffer:void 0,xo=Dn(Object.keys,Object),oi=Math.max,Yn=Date.now,Ra=lo?lo.prototype:void 0,ns=Ra?Ra.toString:void 0;function As(Ge,Et){var Nt=Kn(Ge),Br=!Nt&&si(Ge),Kr=!Nt&&!Br&&jl(Ge),cr=!Nt&&!Br&&!Kr&&Gl(Ge),Qn=Nt||Br||Kr||cr,Ln=Qn?Ss(Ge.length,String):[],bo=Ln.length;for(var ai in Ge)(Et||Gn.call(Ge,ai))&&!(Qn&&(ai=="length"||Kr&&(ai=="offset"||ai=="parent")||cr&&(ai=="buffer"||ai=="byteLength"||ai=="byteOffset")||br(ai,bo)))&&Ln.push(ai);return Ln}function ka(Ge,Et,Nt){var Br=Ge[Et];(!(Gn.call(Ge,Et)&&Mn(Br,Nt))||Nt===void 0&&!(Et in Ge))&&is(Ge,Et,Nt)}function is(Ge,Et,Nt){Et=="__proto__"&&uo?uo(Ge,Et,{configurable:!0,enumerable:!0,value:Nt,writable:!0}):Ge[Et]=Nt}function Ae(Ge){return Ge==null?Ge===void 0?Ce:He:Ii&&Ii in Object(Ge)?Qt(Ge):rn(Ge)}function W(Ge){return Ci(Ge)&&Ae(Ge)==Z}function J(Ge){if(!Cs(Ge)||gr(Ge))return!1;var Et=sa(Ge)?ao:$r;return Et.test(hn(Ge))}function de(Ge){return Ci(Ge)&&mr(Ge.length)&&!!Ur[Ae(Ge)]}function ve(Ge){if(!Ir(Ge))return xo(Ge);var Et=[];for(var Nt in Object(Ge))Gn.call(Ge,Nt)&&Nt!="constructor"&&Et.push(Nt);return Et}function we(Ge){if(!Cs(Ge))return $t(Ge);var Et=Ir(Ge),Nt=[];for(var Br in Ge)Br=="constructor"&&(Et||!Gn.call(Ge,Br))||Nt.push(Br);return Nt}function Ue(Ge,Et){return Dr(Zr(Ge,Et,Os),Ge+"")}var qe=uo?function(Ge,Et){return uo(Ge,"toString",{configurable:!0,enumerable:!1,value:Ps(Et),writable:!0})}:Os;function Le(Ge){if(typeof Ge=="string")return Ge;if(Kn(Ge))return No(Ge,Le)+"";if($l(Ge))return ns?ns.call(Ge):"";var Et=Ge+"";return Et=="0"&&1/Ge==-U?"-0":Et}function Ke(Ge,Et,Nt,Br){var Kr=!Nt;Nt||(Nt={});for(var cr=-1,Qn=Et.length;++cr<Qn;){var Ln=Et[cr],bo=Br?Br(Nt[Ln],Ge[Ln],Ln,Nt,Ge):void 0;bo===void 0&&(bo=Ge[Ln]),Kr?is(Nt,Ln,bo):ka(Nt,Ln,bo)}return Nt}function St(Ge){return Ue(function(Et,Nt){var Br=-1,Kr=Nt.length,cr=Kr>1?Nt[Kr-1]:void 0,Qn=Kr>2?Nt[2]:void 0;for(cr=Ge.length>3&&typeof cr=="function"?(Kr--,cr):void 0,Qn&&Sr(Nt[0],Nt[1],Qn)&&(cr=Kr<3?void 0:cr,Kr=1),Et=Object(Et);++Br<Kr;){var Ln=Nt[Br];Ln&&Ge(Et,Ln,Br,cr)}return Et})}function yt(Ge,Et,Nt,Br){return Ge===void 0||Mn(Ge,sr[Nt])&&!Gn.call(Br,Nt)?Et:Ge}function Ht(Ge,Et){var Nt=Ms(Ge,Et);return J(Nt)?Nt:void 0}function Qt(Ge){var Et=Gn.call(Ge,Ii),Nt=Ge[Ii];try{Ge[Ii]=void 0;var Br=!0}catch{}var Kr=Wi.call(Ge);return Br&&(Et?Ge[Ii]=Nt:delete Ge[Ii]),Kr}function br(Ge,Et){var Nt=typeof Ge;return Et=Et??V,!!Et&&(Nt=="number"||Nt!="symbol"&&Lr.test(Ge))&&Ge>-1&&Ge%1==0&&Ge<Et}function Sr(Ge,Et,Nt){if(!Cs(Nt))return!1;var Br=typeof Et;return(Br=="number"?jo(Nt)&&br(Et,Nt.length):Br=="string"&&Et in Nt)?Mn(Nt[Et],Ge):!1}function gr(Ge){return!!Uo&&Uo in Ge}function Ir(Ge){var Et=Ge&&Ge.constructor,Nt=typeof Et=="function"&&Et.prototype||sr;return Ge===Nt}function $t(Ge){var Et=[];if(Ge!=null)for(var Nt in Object(Ge))Et.push(Nt);return Et}function rn(Ge){return Wi.call(Ge)}function Zr(Ge,Et,Nt){return Et=oi(Et===void 0?Ge.length-1:Et,0),function(){for(var Br=arguments,Kr=-1,cr=oi(Br.length-Et,0),Qn=Array(cr);++Kr<cr;)Qn[Kr]=Br[Et+Kr];Kr=-1;for(var Ln=Array(Et+1);++Kr<Et;)Ln[Kr]=Br[Kr];return Ln[Et]=Nt(Qn),na(Ge,this,Ln)}}var Dr=on(qe);function on(Ge){var Et=0,Nt=0;return function(){var Br=Yn(),Kr=R-(Br-Nt);if(Nt=Br,Kr>0){if(++Et>=o)return arguments[0]}else Et=0;return Ge.apply(void 0,arguments)}}function hn(Ge){if(Ge!=null){try{return ln.call(Ge)}catch{}try{return Ge+""}catch{}}return""}function Mn(Ge,Et){return Ge===Et||Ge!==Ge&&Et!==Et}var si=W(function(){return arguments}())?W:function(Ge){return Ci(Ge)&&Gn.call(Ge,"callee")&&!rs.call(Ge,"callee")},Kn=Array.isArray;function jo(Ge){return Ge!=null&&mr(Ge.length)&&!sa(Ge)}var jl=Ai||fl;function oa(Ge){if(!Ci(Ge))return!1;var Et=Ae(Ge);return Et==q||Et==ae||typeof Ge.message=="string"&&typeof Ge.name=="string"&&!Vl(Ge)}function sa(Ge){if(!Cs(Ge))return!1;var Et=Ae(Ge);return Et==Q||Et==le||Et==se||Et==xe}function mr(Ge){return typeof Ge=="number"&&Ge>-1&&Ge%1==0&&Ge<=V}function Cs(Ge){var Et=typeof Ge;return Ge!=null&&(Et=="object"||Et=="function")}function Ci(Ge){return Ge!=null&&typeof Ge=="object"}function Vl(Ge){if(!Ci(Ge)||Ae(Ge)!=Ne)return!1;var Et=ia(Ge);if(Et===null)return!0;var Nt=Gn.call(Et,"constructor")&&Et.constructor;return typeof Nt=="function"&&Nt instanceof Nt&&ln.call(Nt)==yo}function $l(Ge){return typeof Ge=="symbol"||Ci(Ge)&&Ae(Ge)==Be}var Gl=Ts?Es(Ts):de;function Wl(Ge){return Ge==null?"":Le(Ge)}var La=St(function(Ge,Et,Nt,Br){Ke(Et,Hl(Et),Ge,Br)});function ql(Ge){return jo(Ge)?As(Ge):ve(Ge)}function Hl(Ge){return jo(Ge)?As(Ge,!0):we(Ge)}function hl(Ge,Et,Nt){var Br=P.imports._.templateSettings||P;Nt&&Sr(Ge,Et,Nt)&&(Et=void 0),Ge=Wl(Ge),Et=La({},Et,Br,yt);var Kr=La({},Et.imports,Br.imports,yt),cr=ql(Kr),Qn=es(Kr,cr),Ln,bo,ai=0,co=Et.interpolate||xn,Jn="__p += '",za=RegExp((Et.escape||xn).source+"|"+co.source+"|"+(co===M?ar:xn).source+"|"+(Et.evaluate||xn).source+"|$","g"),la=Gn.call(Et,"sourceURL")?"//# sourceURL="+(Et.sourceURL+"").replace(/[\r\n]/g," ")+`
`:"";Ge.replace(za,function(Mt,Fa,Rs,Ar,li,Oe){return Rs||(Rs=Ar),Jn+=Ge.slice(ai,Oe).replace($n,ts),Fa&&(Ln=!0,Jn+=`' +
__e(`+Fa+`) +
'`),li&&(bo=!0,Jn+=`';
`+li+`;
__p += '`),Rs&&(Jn+=`' +
((__t = (`+Rs+`)) == null ? '' : __t) +
'`),ai=Oe+Mt.length,Mt}),Jn+=`';
`;var Ds=Gn.call(Et,"variable")&&Et.variable;Ds||(Jn=`with (obj) {
`+Jn+`
}
`),Jn=(bo?Jn.replace(Vt,""):Jn).replace(dr,"$1").replace(ht,"$1;"),Jn="function("+(Ds||"obj")+`) {
`+(Ds?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Ln?", __e = _.escape":"")+(bo?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Jn+`return __p
}`;var wo=aa(function(){return Function(cr,la+"return "+Jn).apply(void 0,Qn)});if(wo.source=Jn,oa(wo))throw wo;return wo}var aa=Ue(function(Ge,Et){try{return na(Ge,void 0,Et)}catch(Nt){return oa(Nt)?Nt:new Error(Nt)}});function Ps(Ge){return function(){return Ge}}function Os(Ge){return Ge}function fl(){return!1}m.exports=hl}).call(this)}).call(this,typeof Xo<"u"?Xo:typeof self<"u"?self:typeof window<"u"?window:{})},{"lodash._reinterpolate":9,"lodash.templatesettings":13}],13:[function(h,m,y){(function(b){(function(){var M=h("lodash._reinterpolate"),P=1/0,o="[object Symbol]",R=/[&<>"'`]/g,U=RegExp(R.source),V=/<%-([\s\S]+?)%>/g,Z=/<%([\s\S]+?)%>/g,te={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},se=typeof b=="object"&&b&&b.Object===Object&&b,re=typeof self=="object"&&self&&self.Object===Object&&self,Te=se||re||Function("return this")();function ae(Ce){return function(Re){return Ce==null?void 0:Ce[Re]}}var q=ae(te),Q=Object.prototype,le=Q.toString,ye=Te.Symbol,ze=ye?ye.prototype:void 0,He=ze?ze.toString:void 0,Ne={escape:V,evaluate:Z,interpolate:M,variable:"",imports:{_:{escape:Be}}};function xe(Ce){if(typeof Ce=="string")return Ce;if(Ie(Ce))return He?He.call(Ce):"";var Re=Ce+"";return Re=="0"&&1/Ce==-P?"-0":Re}function Me(Ce){return!!Ce&&typeof Ce=="object"}function Ie(Ce){return typeof Ce=="symbol"||Me(Ce)&&le.call(Ce)==o}function Je(Ce){return Ce==null?"":xe(Ce)}function Be(Ce){return Ce=Je(Ce),Ce&&U.test(Ce)?Ce.replace(R,q):Ce}m.exports=Ne}).call(this)}).call(this,typeof Xo<"u"?Xo:typeof self<"u"?self:typeof window<"u"?window:{})},{"lodash._reinterpolate":9}],14:[function(h,m,y){const b=h("is-plain-obj"),{hasOwnProperty:M}=Object.prototype,{propertyIsEnumerable:P}=Object,o=(q,Q,le)=>Object.defineProperty(q,Q,{value:le,writable:!0,enumerable:!0,configurable:!0}),R=this,U={concatArrays:!1,ignoreUndefined:!1},V=q=>{const Q=[];for(const le in q)M.call(q,le)&&Q.push(le);if(Object.getOwnPropertySymbols){const le=Object.getOwnPropertySymbols(q);for(const ye of le)P.call(q,ye)&&Q.push(ye)}return Q};function Z(q){return Array.isArray(q)?te(q):b(q)?se(q):q}function te(q){const Q=q.slice(0,0);return V(q).forEach(le=>{o(Q,le,Z(q[le]))}),Q}function se(q){const Q=Object.getPrototypeOf(q)===null?Object.create(null):{};return V(q).forEach(le=>{o(Q,le,Z(q[le]))}),Q}const re=(q,Q,le,ye)=>(le.forEach(ze=>{typeof Q[ze]>"u"&&ye.ignoreUndefined||(ze in q&&q[ze]!==Object.getPrototypeOf(q)?o(q,ze,ae(q[ze],Q[ze],ye)):o(q,ze,Z(Q[ze])))}),q),Te=(q,Q,le)=>{let ye=q.slice(0,0),ze=0;return[q,Q].forEach(He=>{const Ne=[];for(let xe=0;xe<He.length;xe++)M.call(He,xe)&&(Ne.push(String(xe)),He===q?o(ye,ze++,He[xe]):o(ye,ze++,Z(He[xe])));ye=re(ye,He,V(He).filter(xe=>!Ne.includes(xe)),le)}),ye};function ae(q,Q,le){return le.concatArrays&&Array.isArray(q)&&Array.isArray(Q)?Te(q,Q,le):!b(Q)||!b(q)?Z(Q):re(q,Q,V(Q),le)}m.exports=function(...q){const Q=ae(Z(U),this!==R&&this||{},U);let le={_:{}};for(const ye of q)if(ye!==void 0){if(!b(ye))throw new TypeError("`"+ye+"` is not an Option Object");le=ae(le,{_:ye},Q)}return le._}},{"is-plain-obj":15}],15:[function(h,m,y){m.exports=b=>{if(Object.prototype.toString.call(b)!=="[object Object]")return!1;const M=Object.getPrototypeOf(b);return M===null||M===Object.prototype}},{}],16:[function(h,m,y){var b=m.exports={},M,P;function o(){throw new Error("setTimeout has not been defined")}function R(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?M=setTimeout:M=o}catch{M=o}try{typeof clearTimeout=="function"?P=clearTimeout:P=R}catch{P=R}})();function U(le){if(M===setTimeout)return setTimeout(le,0);if((M===o||!M)&&setTimeout)return M=setTimeout,setTimeout(le,0);try{return M(le,0)}catch{try{return M.call(null,le,0)}catch{return M.call(this,le,0)}}}function V(le){if(P===clearTimeout)return clearTimeout(le);if((P===R||!P)&&clearTimeout)return P=clearTimeout,clearTimeout(le);try{return P(le)}catch{try{return P.call(null,le)}catch{return P.call(this,le)}}}var Z=[],te=!1,se,re=-1;function Te(){!te||!se||(te=!1,se.length?Z=se.concat(Z):re=-1,Z.length&&ae())}function ae(){if(!te){var le=U(Te);te=!0;for(var ye=Z.length;ye;){for(se=Z,Z=[];++re<ye;)se&&se[re].run();re=-1,ye=Z.length}se=null,te=!1,V(le)}}b.nextTick=function(le){var ye=new Array(arguments.length-1);if(arguments.length>1)for(var ze=1;ze<arguments.length;ze++)ye[ze-1]=arguments[ze];Z.push(new q(le,ye)),Z.length===1&&!te&&U(ae)};function q(le,ye){this.fun=le,this.array=ye}q.prototype.run=function(){this.fun.apply(null,this.array)},b.title="browser",b.browser=!0,b.env={},b.argv=[],b.version="",b.versions={};function Q(){}b.on=Q,b.addListener=Q,b.once=Q,b.off=Q,b.removeListener=Q,b.removeAllListeners=Q,b.emit=Q,b.prependListener=Q,b.prependOnceListener=Q,b.listeners=function(le){return[]},b.binding=function(le){throw new Error("process.binding is not supported")},b.cwd=function(){return"/"},b.chdir=function(le){throw new Error("process.chdir is not supported")},b.umask=function(){return 0}},{}],17:[function(h,m,y){Object.defineProperty(y,"__esModule",{value:!0}),y.default=void 0;function b(o){var R=function(V){var Z=V.dispatch,te=V.getState;return function(se){return function(re){return typeof re=="function"?re(Z,te,o):se(re)}}};return R}var M=b();M.withExtraArgument=b;var P=M;y.default=P},{}],18:[function(h,m,y){(function(b){(function(){Object.defineProperty(y,"__esModule",{value:!0});var M=h("@babel/runtime/helpers/objectSpread2");function P(Ce){return Ce&&typeof Ce=="object"&&"default"in Ce?Ce:{default:Ce}}var o=P(M);function R(Ce){return"Minified Redux error #"+Ce+"; visit https://redux.js.org/Errors?code="+Ce+" for the full message or use the non-minified dev environment for full errors. "}var U=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),V=function(){return Math.random().toString(36).substring(7).split("").join(".")},Z={INIT:"@@redux/INIT"+V(),REPLACE:"@@redux/REPLACE"+V(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+V()}};function te(Ce){if(typeof Ce!="object"||Ce===null)return!1;for(var Re=Ce;Object.getPrototypeOf(Re)!==null;)Re=Object.getPrototypeOf(Re);return Object.getPrototypeOf(Ce)===Re}function se(Ce){if(Ce===void 0)return"undefined";if(Ce===null)return"null";var Re=typeof Ce;switch(Re){case"boolean":case"string":case"number":case"symbol":case"function":return Re}if(Array.isArray(Ce))return"array";if(ae(Ce))return"date";if(Te(Ce))return"error";var rt=re(Ce);switch(rt){case"Symbol":case"Promise":case"WeakMap":case"WeakSet":case"Map":case"Set":return rt}return Re.slice(8,-1).toLowerCase().replace(/\s/g,"")}function re(Ce){return typeof Ce.constructor=="function"?Ce.constructor.name:null}function Te(Ce){return Ce instanceof Error||typeof Ce.message=="string"&&Ce.constructor&&typeof Ce.constructor.stackTraceLimit=="number"}function ae(Ce){return Ce instanceof Date?!0:typeof Ce.toDateString=="function"&&typeof Ce.getDate=="function"&&typeof Ce.setDate=="function"}function q(Ce){var Re=typeof Ce;return b.env.NODE_ENV!=="production"&&(Re=se(Ce)),Re}function Q(Ce,Re,rt){var st;if(typeof Re=="function"&&typeof rt=="function"||typeof rt=="function"&&typeof arguments[3]=="function")throw new Error(b.env.NODE_ENV==="production"?R(0):"It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function. See https://redux.js.org/tutorials/fundamentals/part-4-store#creating-a-store-with-enhancers for an example.");if(typeof Re=="function"&&typeof rt>"u"&&(rt=Re,Re=void 0),typeof rt<"u"){if(typeof rt!="function")throw new Error(b.env.NODE_ENV==="production"?R(1):"Expected the enhancer to be a function. Instead, received: '"+q(rt)+"'");return rt(Q)(Ce,Re)}if(typeof Ce!="function")throw new Error(b.env.NODE_ENV==="production"?R(2):"Expected the root reducer to be a function. Instead, received: '"+q(Ce)+"'");var at=Ce,Ve=Re,Dt=[],Bt=Dt,Gt=!1;function qt(){Bt===Dt&&(Bt=Dt.slice())}function or(){if(Gt)throw new Error(b.env.NODE_ENV==="production"?R(3):"You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return Ve}function et(ht){if(typeof ht!="function")throw new Error(b.env.NODE_ENV==="production"?R(4):"Expected the listener to be a function. Instead, received: '"+q(ht)+"'");if(Gt)throw new Error(b.env.NODE_ENV==="production"?R(5):"You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api/store#subscribelistener for more details.");var vr=!0;return qt(),Bt.push(ht),function(){if(vr){if(Gt)throw new Error(b.env.NODE_ENV==="production"?R(6):"You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api/store#subscribelistener for more details.");vr=!1,qt();var $r=Bt.indexOf(ht);Bt.splice($r,1),Dt=null}}}function kt(ht){if(!te(ht))throw new Error(b.env.NODE_ENV==="production"?R(7):"Actions must be plain objects. Instead, the actual type was: '"+q(ht)+"'. You may need to add middleware to your store setup to handle dispatching other values, such as 'redux-thunk' to handle dispatching functions. See https://redux.js.org/tutorials/fundamentals/part-4-store#middleware and https://redux.js.org/tutorials/fundamentals/part-6-async-logic#using-the-redux-thunk-middleware for examples.");if(typeof ht.type>"u")throw new Error(b.env.NODE_ENV==="production"?R(8):'Actions may not have an undefined "type" property. You may have misspelled an action type string constant.');if(Gt)throw new Error(b.env.NODE_ENV==="production"?R(9):"Reducers may not dispatch actions.");try{Gt=!0,Ve=at(Ve,ht)}finally{Gt=!1}for(var vr=Dt=Bt,ar=0;ar<vr.length;ar++){var $r=vr[ar];$r()}return ht}function Vt(ht){if(typeof ht!="function")throw new Error(b.env.NODE_ENV==="production"?R(10):"Expected the nextReducer to be a function. Instead, received: '"+q(ht));at=ht,kt({type:Z.REPLACE})}function dr(){var ht,vr=et;return ht={subscribe:function($r){if(typeof $r!="object"||$r===null)throw new Error(b.env.NODE_ENV==="production"?R(11):"Expected the observer to be an object. Instead, received: '"+q($r)+"'");function Lr(){$r.next&&$r.next(or())}Lr();var xn=vr(Lr);return{unsubscribe:xn}}},ht[U]=function(){return this},ht}return kt({type:Z.INIT}),st={dispatch:kt,subscribe:et,getState:or,replaceReducer:Vt},st[U]=dr,st}var le=Q;function ye(Ce){typeof console<"u"&&typeof console.error=="function"&&console.error(Ce);try{throw new Error(Ce)}catch{}}function ze(Ce,Re,rt,st){var at=Object.keys(Re),Ve=rt&&rt.type===Z.INIT?"preloadedState argument passed to createStore":"previous state received by the reducer";if(at.length===0)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!te(Ce))return"The "+Ve+' has unexpected type of "'+q(Ce)+'". Expected argument to be an object with the following '+('keys: "'+at.join('", "')+'"');var Dt=Object.keys(Ce).filter(function(Bt){return!Re.hasOwnProperty(Bt)&&!st[Bt]});if(Dt.forEach(function(Bt){st[Bt]=!0}),!(rt&&rt.type===Z.REPLACE)&&Dt.length>0)return"Unexpected "+(Dt.length>1?"keys":"key")+" "+('"'+Dt.join('", "')+'" found in '+Ve+". ")+"Expected to find one of the known reducer keys instead: "+('"'+at.join('", "')+'". Unexpected keys will be ignored.')}function He(Ce){Object.keys(Ce).forEach(function(Re){var rt=Ce[Re],st=rt(void 0,{type:Z.INIT});if(typeof st>"u")throw new Error(b.env.NODE_ENV==="production"?R(12):'The slice reducer for key "'+Re+`" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.`);if(typeof rt(void 0,{type:Z.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(b.env.NODE_ENV==="production"?R(13):'The slice reducer for key "'+Re+'" returned undefined when probed with a random type. '+("Don't try to handle '"+Z.INIT+`' or other actions in "redux/*" `)+"namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.")})}function Ne(Ce){for(var Re=Object.keys(Ce),rt={},st=0;st<Re.length;st++){var at=Re[st];b.env.NODE_ENV!=="production"&&typeof Ce[at]>"u"&&ye('No reducer provided for key "'+at+'"'),typeof Ce[at]=="function"&&(rt[at]=Ce[at])}var Ve=Object.keys(rt),Dt;b.env.NODE_ENV!=="production"&&(Dt={});var Bt;try{He(rt)}catch(Gt){Bt=Gt}return function(qt,or){if(qt===void 0&&(qt={}),Bt)throw Bt;if(b.env.NODE_ENV!=="production"){var et=ze(qt,rt,or,Dt);et&&ye(et)}for(var kt=!1,Vt={},dr=0;dr<Ve.length;dr++){var ht=Ve[dr],vr=rt[ht],ar=qt[ht],$r=vr(ar,or);if(typeof $r>"u"){var Lr=or&&or.type;throw new Error(b.env.NODE_ENV==="production"?R(14):"When called with an action of type "+(Lr?'"'+String(Lr)+'"':"(unknown type)")+', the slice reducer for key "'+ht+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.')}Vt[ht]=$r,kt=kt||$r!==ar}return kt=kt||Ve.length!==Object.keys(qt).length,kt?Vt:qt}}function xe(Ce,Re){return function(){return Re(Ce.apply(this,arguments))}}function Me(Ce,Re){if(typeof Ce=="function")return xe(Ce,Re);if(typeof Ce!="object"||Ce===null)throw new Error(b.env.NODE_ENV==="production"?R(16):"bindActionCreators expected an object or a function, but instead received: '"+q(Ce)+`'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?`);var rt={};for(var st in Ce){var at=Ce[st];typeof at=="function"&&(rt[st]=xe(at,Re))}return rt}function Ie(){for(var Ce=arguments.length,Re=new Array(Ce),rt=0;rt<Ce;rt++)Re[rt]=arguments[rt];return Re.length===0?function(st){return st}:Re.length===1?Re[0]:Re.reduce(function(st,at){return function(){return st(at.apply(void 0,arguments))}})}function Je(){for(var Ce=arguments.length,Re=new Array(Ce),rt=0;rt<Ce;rt++)Re[rt]=arguments[rt];return function(st){return function(){var at=st.apply(void 0,arguments),Ve=function(){throw new Error(b.env.NODE_ENV==="production"?R(15):"Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},Dt={getState:at.getState,dispatch:function(){return Ve.apply(void 0,arguments)}},Bt=Re.map(function(Gt){return Gt(Dt)});return Ve=Ie.apply(void 0,Bt)(at.dispatch),o.default(o.default({},at),{},{dispatch:Ve})}}}function Be(){}b.env.NODE_ENV!=="production"&&typeof Be.name=="string"&&Be.name!=="isCrushed"&&ye('You are currently using minified code outside of NODE_ENV === "production". This means that you are running a slower development build of Redux. You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify or setting mode to production in webpack (https://webpack.js.org/concepts/mode/) to ensure you have the correct code for your production build.'),y.__DO_NOT_USE__ActionTypes=Z,y.applyMiddleware=Je,y.bindActionCreators=Me,y.combineReducers=Ne,y.compose=Ie,y.createStore=Q,y.legacy_createStore=le}).call(this)}).call(this,h("_process"))},{"@babel/runtime/helpers/objectSpread2":2,_process:16}],19:[function(h,m,y){var b=h("./src/suggestions");m.exports=b,typeof window<"u"&&(window.Suggestions=b)},{"./src/suggestions":21}],20:[function(h,m,y){var b=function(M){return this.component=M,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,M.el.parentNode.insertBefore(this.wrapper,M.el.nextSibling),this};b.prototype.show=function(){this.element.style.display="block"},b.prototype.hide=function(){this.element.style.display="none"},b.prototype.add=function(M){this.items.push(M)},b.prototype.clear=function(){this.items=[],this.active=0},b.prototype.isEmpty=function(){return!this.items.length},b.prototype.isVisible=function(){return this.element.style.display==="block"},b.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var M=0;M<this.items.length;M++)this.drawItem(this.items[M],this.active===M);this.show()},b.prototype.drawItem=function(M,P){var o=document.createElement("li"),R=document.createElement("a");P&&(o.className+=" active"),R.innerHTML=M.string,o.appendChild(R),this.element.appendChild(o),o.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),o.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,M)}).bind(this))},b.prototype.handleMouseUp=function(M){this.selectingListItem=!1,this.component.value(M.original),this.clear(),this.draw()},b.prototype.move=function(M){this.active=M,this.draw()},b.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)},b.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},b.prototype.drawError=function(M){var P=document.createElement("li");P.innerHTML=M,this.element.appendChild(P),this.show()},m.exports=b},{}],21:[function(h,m,y){var b=h("xtend"),M=h("fuzzy"),P=h("./list"),o=function(R,U,V){return V=V||{},this.options=b({minLength:2,limit:5,filter:!0,hideOnBlur:!0},V),this.el=R,this.data=U||[],this.list=new P(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(Z){this.handleKeyUp(Z.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(Z){this.handleKeyDown(Z)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(Z){this.handlePaste(Z)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};o.prototype.handleKeyUp=function(R){R===40||R===38||R===27||R===13||R===9||this.handleInputChange(this.el.value)},o.prototype.handleKeyDown=function(R){switch(R.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&R.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},o.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},o.prototype.handlePaste=function(R){if(R.clipboardData)this.handleInputChange(R.clipboardData.getData("Text"));else{var U=this;setTimeout(function(){U.handleInputChange(R.target.value)},100)}},o.prototype.handleInputChange=function(R){if(this.query=this.normalize(R),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(U){for(var V=0;V<U.length&&(this.list.add(U[V]),V!==this.options.limit-1);V++);this.list.draw()}).bind(this))},o.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},o.prototype.update=function(R){this.data=R,this.handleKeyUp()},o.prototype.clear=function(){this.data=[],this.list.clear()},o.prototype.normalize=function(R){return R=R.toLowerCase(),R},o.prototype.match=function(R,U){return R.indexOf(U)>-1},o.prototype.value=function(R){if(this.selected=R,this.el.value=this.getItemValue(R),document.createEvent){var U=document.createEvent("HTMLEvents");U.initEvent("change",!0,!1),this.el.dispatchEvent(U)}else this.el.fireEvent("onchange")},o.prototype.getCandidates=function(R){var U={pre:"<strong>",post:"</strong>",extract:(function(Z){return this.getItemValue(Z)}).bind(this)},V;this.options.filter?(V=M.filter(this.query,this.data,U),V=V.map((function(Z){return{original:Z.original,string:this.render(Z.original,Z.string)}}).bind(this))):V=this.data.map((function(Z){var te=this.render(Z);return{original:Z,string:te}}).bind(this)),R(V)},o.prototype.getItemValue=function(R){return R},o.prototype.render=function(R,U){if(U)return U;for(var V=R.original?this.getItemValue(R.original):this.getItemValue(R),Z=this.normalize(V),te=Z.lastIndexOf(this.query);te>-1;){var se=te+this.query.length;V=V.slice(0,te)+"<strong>"+V.slice(te,se)+"</strong>"+V.slice(se),te=Z.slice(0,te).lastIndexOf(this.query)}return V},o.prototype.renderError=function(R){this.list.drawError(R)},m.exports=o},{"./list":20,fuzzy:8,xtend:24}],22:[function(h,m,y){var b=h("turf-meta").coordEach;m.exports=function(M){var P=[1/0,1/0,-1/0,-1/0];return b(M,function(o){P[0]>o[0]&&(P[0]=o[0]),P[1]>o[1]&&(P[1]=o[1]),P[2]<o[0]&&(P[2]=o[0]),P[3]<o[1]&&(P[3]=o[1])}),P}},{"turf-meta":23}],23:[function(h,m,y){function b(R,U,V){var Z,te,se,re,Te,ae,q,Q,le=0,ye,ze=R.type==="FeatureCollection",He=R.type==="Feature",Ne=ze?R.features.length:1;for(Z=0;Z<Ne;Z++)for(Q=ze?R.features[Z].geometry:He?R.geometry:R,ye=Q.type==="GeometryCollection",ae=ye?Q.geometries.length:1,re=0;re<ae;re++)if(Te=ye?Q.geometries[re]:Q,q=Te.coordinates,le=V&&(Te.type==="Polygon"||Te.type==="MultiPolygon")?1:0,Te.type==="Point")U(q);else if(Te.type==="LineString"||Te.type==="MultiPoint")for(te=0;te<q.length;te++)U(q[te]);else if(Te.type==="Polygon"||Te.type==="MultiLineString")for(te=0;te<q.length;te++)for(se=0;se<q[te].length-le;se++)U(q[te][se]);else if(Te.type==="MultiPolygon")for(te=0;te<q.length;te++)for(se=0;se<q[te].length;se++)for(l=0;l<q[te][se].length-le;l++)U(q[te][se][l]);else throw new Error("Unknown Geometry Type")}m.exports.coordEach=b;function M(R,U,V,Z){return b(R,function(te){V=U(V,te)},Z),V}m.exports.coordReduce=M;function P(R,U){var V;switch(R.type){case"FeatureCollection":for(features=R.features,V=0;V<R.features.length;V++)U(R.features[V].properties);break;case"Feature":U(R.properties);break}}m.exports.propEach=P;function o(R,U,V){return P(R,function(Z){V=U(V,Z)}),V}m.exports.propReduce=o},{}],24:[function(h,m,y){m.exports=M;var b=Object.prototype.hasOwnProperty;function M(){for(var P={},o=0;o<arguments.length;o++){var R=arguments[o];for(var U in R)b.call(R,U)&&(P[U]=R[U])}return P}},{}],25:[function(h,m,y){function b(et){"@babel/helpers - typeof";return b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(kt){return typeof kt}:function(kt){return kt&&typeof Symbol=="function"&&kt.constructor===Symbol&&kt!==Symbol.prototype?"symbol":typeof kt},b(et)}Object.defineProperty(y,"__esModule",{value:!0}),y.addWaypoint=Dt,y.clearDestination=Me,y.clearOrigin=xe,y.createDestination=Re,y.createOrigin=Ce,y.eventEmit=or,y.eventSubscribe=qt,y.hoverMarker=Je,y.queryDestination=ze,y.queryDestinationCoordinates=Ne,y.queryOrigin=ye,y.queryOriginCoordinates=He,y.removeWaypoint=Gt,y.reverse=st,y.setDestinationFromCoordinates=Ve,y.setOptions=Ie,y.setOriginFromCoordinates=at,y.setProfile=rt,y.setRouteIndex=Be,y.setWaypoint=Bt;var M=U(h("../constants/action_types")),P=o(h("../utils"));function o(et){return et&&et.__esModule?et:{default:et}}function R(et){if(typeof WeakMap!="function")return null;var kt=new WeakMap,Vt=new WeakMap;return(R=function(ht){return ht?Vt:kt})(et)}function U(et,kt){if(et&&et.__esModule)return et;if(et===null||b(et)!=="object"&&typeof et!="function")return{default:et};var Vt=R(kt);if(Vt&&Vt.has(et))return Vt.get(et);var dr={},ht=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var vr in et)if(vr!=="default"&&Object.prototype.hasOwnProperty.call(et,vr)){var ar=ht?Object.getOwnPropertyDescriptor(et,vr):null;ar&&(ar.get||ar.set)?Object.defineProperty(dr,vr,ar):dr[vr]=et[vr]}return dr.default=et,Vt&&Vt.set(et,dr),dr}function V(et){return function(kt){var Vt=P.default.createPoint(et,{id:"origin","marker-symbol":"A"});kt({type:M.ORIGIN,origin:Vt}),kt(or("origin",{feature:Vt}))}}function Z(et){return function(kt){var Vt=P.default.createPoint(et,{id:"destination","marker-symbol":"B"});kt({type:M.DESTINATION,destination:Vt}),kt(or("destination",{feature:Vt}))}}function te(et){return function(kt){kt({type:M.DIRECTIONS_REQUEST_START,request:et})}}function se(et){return function(kt){kt({type:M.DIRECTIONS,directions:et}),kt(or("route",{route:et}))}}function re(et){return{type:M.WAYPOINTS,waypoints:et}}function Te(et){return{type:M.HOVER_MARKER,hoverMarker:et}}function ae(){return function(et,kt){var Vt=kt(),dr=Vt.api,ht=Vt.accessToken,vr=Vt.routeIndex,ar=Vt.profile,$r=Vt.alternatives,Lr=Vt.congestion,xn=Vt.destination,$n=Vt.language,Ur=Vt.exclude,ni=Vt.fetchDirectionsRequest;if(xn&&xn.geometry){ni&&ni.abort();var ii=q(kt),kn=[];kn.push("geometries=polyline"),$r&&kn.push("alternatives=true"),Lr&&kn.push("annotations=congestion"),kn.push("steps=true"),kn.push("overview=full"),$n&&kn.push("language="+$n),Ur&&kn.push("exclude="+Ur),ht&&kn.push("access_token="+ht);var Wt=new XMLHttpRequest;Wt.open("GET","".concat(dr).concat(ar,"/").concat(ii,".json?").concat(kn.join("&")),!0),et(te(Wt)),Wt.onload=function(){if(Wt.status>=200&&Wt.status<400){var er=JSON.parse(Wt.responseText);if(er.error)return et(se([])),et(le(er.error));if(er.message==="No route found")return et(le("No route found"));et(le(null)),er.routes[vr]||et(Be(0)),et(se(er.routes)),et(V(er.waypoints[0].location)),et(Z(er.waypoints[er.waypoints.length-1].location))}else return et(se([])),et(le(JSON.parse(Wt.responseText).message))},Wt.onerror=function(){return et(se([])),Wt.responseText?et(le(JSON.parse(Wt.responseText).message)):et(le("Error"))},Wt.send()}}}function q(et){var kt=et(),Vt=kt.origin,dr=kt.destination,ht=kt.waypoints,vr=[];return vr.push(Vt.geometry.coordinates.join(",")),vr.push(";"),ht.length&&ht.forEach(function(ar){vr.push(ar.geometry.coordinates.join(",")),vr.push(";")}),vr.push(dr.geometry.coordinates.join(",")),encodeURIComponent(vr.join(""))}function Q(et){var kt={id:"waypoint"};return Object.assign(et,{properties:et.properties?Object.assign(et.properties,kt):kt})}function le(et){return function(kt){kt({type:"ERROR",error:et}),et&&kt(or("error",{error:et}))}}function ye(et){return{type:M.ORIGIN_QUERY,query:et}}function ze(et){return{type:M.DESTINATION_QUERY,query:et}}function He(et){return{type:M.ORIGIN_FROM_COORDINATES,coordinates:et}}function Ne(et){return{type:M.DESTINATION_FROM_COORDINATES,coordinates:et}}function xe(){return function(et){et({type:M.ORIGIN_CLEAR}),et(or("clear",{type:"origin"})),et(le(null))}}function Me(){return function(et,kt){var Vt=kt(),dr=Vt.fetchDirectionsRequest;dr&&dr.abort(),et({type:M.DESTINATION_CLEAR}),et(or("clear",{type:"destination"})),et(le(null))}}function Ie(et){return{type:M.SET_OPTIONS,options:et}}function Je(et){return function(kt){var Vt=et?P.default.createPoint(et,{id:"hover"}):{};kt(Te(Vt))}}function Be(et){return{type:M.ROUTE_INDEX,routeIndex:et}}function Ce(et){return function(kt,Vt){var dr=Vt(),ht=dr.destination;kt(V(et)),ht.geometry&&kt(ae())}}function Re(et){return function(kt,Vt){var dr=Vt(),ht=dr.origin;kt(Z(et)),ht.geometry&&kt(ae())}}function rt(et){return function(kt,Vt){var dr=Vt(),ht=dr.origin,vr=dr.destination;kt({type:M.DIRECTIONS_PROFILE,profile:et}),kt(or("profile",{profile:et})),ht.geometry&&vr.geometry&&kt(ae())}}function st(){return function(et,kt){var Vt=kt();Vt.destination.geometry&&et(V(Vt.destination.geometry.coordinates)),Vt.origin.geometry&&et(Z(Vt.origin.geometry.coordinates)),Vt.origin.geometry&&Vt.destination.geometry&&et(ae());for(var dr=document.getElementsByClassName("suggestions"),ht=0;ht<dr.length;ht++)dr[ht].style.visibility="hidden"}}function at(et){return function(kt){if(P.default.validCoords(et)||(et=[P.default.wrap(et[0]),P.default.wrap(et[1])]),isNaN(et[0])&&isNaN(et[1]))return kt(le(new Error("Coordinates are not valid")));kt(He(et)),kt(Ce(et))}}function Ve(et){return function(kt){if(P.default.validCoords(et)||(et=[P.default.wrap(et[0]),P.default.wrap(et[1])]),isNaN(et[0])&&isNaN(et[1]))return kt(le(new Error("Coordinates are not valid")));kt(Re(et)),kt(Ne(et))}}function Dt(et,kt){return function(Vt,dr){var ht=dr(),vr=ht.destination,ar=ht.waypoints;ar.splice(et,0,Q(kt)),Vt(re(ar)),vr.geometry&&Vt(ae())}}function Bt(et,kt){return function(Vt,dr){var ht=dr(),vr=ht.destination,ar=ht.waypoints;ar[et]=Q(kt),Vt(re(ar)),vr.geometry&&Vt(ae())}}function Gt(et){return function(kt,Vt){var dr=Vt(),ht=dr.destination,vr=dr.waypoints;vr=vr.filter(function(ar){return!P.default.coordinateMatch(ar,et)}),kt(re(vr)),ht.geometry&&kt(ae())}}function qt(et,kt){return function(Vt,dr){var ht=dr(),vr=ht.events;return vr[et]=vr[et]||[],vr[et].push(kt),{type:M.EVENTS,events:vr}}}function or(et,kt){var Vt=this;return function(dr,ht){var vr=ht(),ar=vr.events;if(!ar[et])return{type:M.EVENTS,events:ar};for(var $r=ar[et].slice(),Lr=0;Lr<$r.length;Lr++)$r[Lr].call(Vt,kt)}}},{"../constants/action_types":26,"../utils":34}],26:[function(h,m,y){Object.defineProperty(y,"__esModule",{value:!0}),y.WAYPOINTS=y.SET_OPTIONS=y.ROUTE_INDEX=y.ORIGIN_QUERY=y.ORIGIN_FROM_COORDINATES=y.ORIGIN_CLEAR=y.ORIGIN=y.HOVER_MARKER=y.EVENTS=y.ERROR=y.DIRECTIONS_REQUEST_START=y.DIRECTIONS_PROFILE=y.DIRECTIONS=y.DESTINATION_QUERY=y.DESTINATION_FROM_COORDINATES=y.DESTINATION_CLEAR=y.DESTINATION=void 0;var b="DESTINATION";y.DESTINATION=b;var M="DESTINATION_CLEAR";y.DESTINATION_CLEAR=M;var P="DESTINATION_QUERY";y.DESTINATION_QUERY=P;var o="DESTINATION_FROM_COORDINATES";y.DESTINATION_FROM_COORDINATES=o;var R="DIRECTIONS";y.DIRECTIONS=R;var U="DIRECTIONS_REQUEST_START";y.DIRECTIONS_REQUEST_START=U;var V="DIRECTIONS_PROFILE";y.DIRECTIONS_PROFILE=V;var Z="EVENTS";y.EVENTS=Z;var te="ERROR";y.ERROR=te;var se="HOVER_MARKER";y.HOVER_MARKER=se;var re="ORIGIN";y.ORIGIN=re;var Te="ORIGIN_CLEAR";y.ORIGIN_CLEAR=Te;var ae="ORIGIN_QUERY";y.ORIGIN_QUERY=ae;var q="ORIGIN_FROM_COORDINATES";y.ORIGIN_FROM_COORDINATES=q;var Q="ROUTE_INDEX";y.ROUTE_INDEX=Q;var le="SET_OPTIONS";y.SET_OPTIONS=le;var ye="WAYPOINTS";y.WAYPOINTS=ye},{}],27:[function(h,m,y){Object.defineProperty(y,"__esModule",{value:!0}),y.default=void 0;var b=R(h("suggestions")),M=R(h("lodash.debounce")),P=h("events"),o=R(h("../utils"));function R(ae){return ae&&ae.__esModule?ae:{default:ae}}function U(ae){"@babel/helpers - typeof";return U=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(q){return typeof q}:function(q){return q&&typeof Symbol=="function"&&q.constructor===Symbol&&q!==Symbol.prototype?"symbol":typeof q},U(ae)}function V(ae,q){if(!(ae instanceof q))throw new TypeError("Cannot call a class as a function")}function Z(ae,q){for(var Q=0;Q<q.length;Q++){var le=q[Q];le.enumerable=le.enumerable||!1,le.configurable=!0,"value"in le&&(le.writable=!0),Object.defineProperty(ae,se(le.key),le)}}function te(ae,q,Q){return q&&Z(ae.prototype,q),Object.defineProperty(ae,"prototype",{writable:!1}),ae}function se(ae){var q=re(ae,"string");return U(q)==="symbol"?q:String(q)}function re(ae,q){if(U(ae)!=="object"||ae===null)return ae;var Q=ae[Symbol.toPrimitive];if(Q!==void 0){var le=Q.call(ae,q);if(U(le)!=="object")return le;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(ae)}var Te=function(){function ae(q){V(this,ae),this._ev=new P.EventEmitter,this.options=q,this.api=q&&q.api||"https://api.mapbox.com/geocoding/v5/mapbox.places/"}return te(ae,[{key:"onAdd",value:function(Q){this._map=Q,this.request=new XMLHttpRequest;var le=document.createElement("div");le.className="mapboxgl-ctrl-geocoder";var ye=document.createElement("span");ye.className="geocoder-icon geocoder-icon-search";var ze=this._inputEl=document.createElement("input");ze.type="text",ze.placeholder=this.options.placeholder,ze.addEventListener("keydown",(0,M.default)((function(Me){if(!Me.target.value)return this._clearEl.classList.remove("active");Me.metaKey||[9,27,37,39,13,38,40].indexOf(Me.keyCode)!==-1||this._queryFromInput(Me.target.value)}).bind(this)),200),ze.addEventListener("change",(function(Me){Me.target.value&&this._clearEl.classList.add("active");var Ie=this._typeahead.selected;if(Ie){if(this.options.flyTo)if(Ie.bbox&&Ie.context&&Ie.context.length<=3||Ie.bbox&&!Ie.context){var Je=Ie.bbox;Q.fitBounds([[Je[0],Je[1]],[Je[2],Je[3]]])}else Q.flyTo({center:Ie.center,zoom:this.options.zoom});this._input=Ie,this.fire("result",{result:Ie})}}).bind(this));var He=document.createElement("div");He.classList.add("geocoder-pin-right");var Ne=this._clearEl=document.createElement("button");Ne.className="geocoder-icon geocoder-icon-close",Ne.addEventListener("click",this._clear.bind(this));var xe=this._loadingEl=document.createElement("span");return xe.className="geocoder-icon geocoder-icon-loading",He.appendChild(Ne),He.appendChild(xe),le.appendChild(ye),le.appendChild(ze),le.appendChild(He),this.options.container&&(this.options.position=!1),this._typeahead=new b.default(ze,[],{filter:!1}),this._typeahead.getItemValue=function(Me){return Me.place_name},le}},{key:"_geocode",value:function(Q,le){this._loadingEl.classList.add("active"),this.fire("loading");var ye=this.options,ze=["placeholder","zoom","flyTo","accessToken","api"],He=Object.keys(this.options).filter(function(xe){return ze.indexOf(xe)===-1}).map(function(xe){return xe+"="+ye[xe]}),Ne=this.options.accessToken?this.options.accessToken:mapboxgl.accessToken;He.push("access_token="+Ne),this.request.abort(),this.request.open("GET",this.api+encodeURIComponent(Q.trim())+".json?"+He.join("&"),!0),this.request.onload=(function(){if(this._loadingEl.classList.remove("active"),this.request.status>=200&&this.request.status<400){var xe=JSON.parse(this.request.responseText);return xe.features.length?this._clearEl.classList.add("active"):(this._clearEl.classList.remove("active"),this._typeahead.selected=null),this.fire("results",{results:xe.features}),this._typeahead.update(xe.features),le(xe.features)}else this.fire("error",{error:JSON.parse(this.request.responseText).message})}).bind(this),this.request.onerror=(function(){this._loadingEl.classList.remove("active"),this.fire("error",{error:JSON.parse(this.request.responseText).message})}).bind(this),this.request.send()}},{key:"_queryFromInput",value:function(Q){Q=Q.trim(),Q||this._clear(),Q.length>2&&this._geocode(Q,(function(le){this._results=le}).bind(this))}},{key:"_change",value:function(){var Q=document.createEvent("HTMLEvents");Q.initEvent("change",!0,!1),this._inputEl.dispatchEvent(Q)}},{key:"_query",value:function(Q){Q&&(U(Q)==="object"&&Q.length&&(Q=[o.default.wrap(Q[0]),o.default.wrap(Q[1])].join()),this._geocode(Q,(function(le){if(le.length){var ye=le[0];this._results=le,this._typeahead.selected=ye,this._inputEl.value=ye.place_name,this._change()}}).bind(this)))}},{key:"_setInput",value:function(Q){Q&&(U(Q)==="object"&&Q.length&&(Q=[o.default.roundWithOriginalPrecision(o.default.wrap(Q[0]),Q[0]),o.default.roundWithOriginalPrecision(o.default.wrap(Q[1]),Q[1])].join()),this._inputEl.value=Q,this._input=null,this._typeahead.selected=null,this._typeahead.clear(),this._change())}},{key:"_clear",value:function(){this._input=null,this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._change(),this._inputEl.focus(),this._clearEl.classList.remove("active"),this.fire("clear")}},{key:"getResult",value:function(){return this._input}},{key:"query",value:function(Q){return this._query(Q),this}},{key:"setInput",value:function(Q){return this._setInput(Q),this}},{key:"on",value:function(Q,le){return this._ev.on(Q,le),this._ev.on("error",function(ye){console.log(ye)}),this}},{key:"fire",value:function(Q,le){return this._ev.emit(Q,le),this}},{key:"off",value:function(Q,le){return this._ev.removeListener(Q,le),this}}]),ae}();y.default=Te},{"../utils":34,events:7,"lodash.debounce":10,suggestions:19}],28:[function(h,m,y){Object.defineProperty(y,"__esModule",{value:!0}),y.default=void 0;var b=R(h("./geocoder")),M=R(h("lodash.template")),P=R(h("lodash.isequal")),o=R(h("turf-extent"));function R(q){return q&&q.__esModule?q:{default:q}}function U(q){"@babel/helpers - typeof";return U=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Q){return typeof Q}:function(Q){return Q&&typeof Symbol=="function"&&Q.constructor===Symbol&&Q!==Symbol.prototype?"symbol":typeof Q},U(q)}function V(q,Q){if(!(q instanceof Q))throw new TypeError("Cannot call a class as a function")}function Z(q,Q){for(var le=0;le<Q.length;le++){var ye=Q[le];ye.enumerable=ye.enumerable||!1,ye.configurable=!0,"value"in ye&&(ye.writable=!0),Object.defineProperty(q,se(ye.key),ye)}}function te(q,Q,le){return Q&&Z(q.prototype,Q),Object.defineProperty(q,"prototype",{writable:!1}),q}function se(q){var Q=re(q,"string");return U(Q)==="symbol"?Q:String(Q)}function re(q,Q){if(U(q)!=="object"||q===null)return q;var le=q[Symbol.toPrimitive];if(le!==void 0){var ye=le.call(q,Q);if(U(ye)!=="object")return ye;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(q)}var Te=(0,M.default)(`<div class='mapbox-directions-component mapbox-directions-inputs'>
  <div class='mapbox-directions-component-keyline'>
    <div class='mapbox-directions-origin'>
      <label class='mapbox-form-label'>
        <span class='directions-icon directions-icon-depart'></span>
      </label>
      <div id='mapbox-directions-origin-input'></div>
    </div>

    <button
      class='directions-icon directions-icon-reverse directions-reverse js-reverse-inputs'
      title='Reverse origin &amp; destination'>
    </button>

    <div class='mapbox-directions-destination'>
      <label class='mapbox-form-label'>
        <span class='directions-icon directions-icon-arrive'></span>
      </label>
      <div id='mapbox-directions-destination-input'></div>
    </div>
  </div>

  <% if (controls.profileSwitcher) { %>
  <div class='mapbox-directions-profile mapbox-directions-component-keyline mapbox-directions-clearfix'><input
      id='mapbox-directions-profile-driving-traffic'
      type='radio'
      name='profile'
      value='mapbox/driving-traffic'
      <% if (profile === 'mapbox/driving-traffic') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-driving-traffic'>Traffic</label>
    <input
      id='mapbox-directions-profile-driving'
      type='radio'
      name='profile'
      value='mapbox/driving'
      <% if (profile === 'mapbox/driving') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-driving'>Driving</label>
    <input
      id='mapbox-directions-profile-walking'
      type='radio'
      name='profile'
      value='mapbox/walking'
      <% if (profile === 'mapbox/walking') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-walking'>Walking</label>
    <input
      id='mapbox-directions-profile-cycling'
      type='radio'
      name='profile'
      value='mapbox/cycling'
      <% if (profile === 'mapbox/cycling') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-cycling'>Cycling</label>
  </div>
  <% } %>
</div>
`),ae=function(){function q(Q,le,ye,ze){V(this,q);var He=le.getState(),Ne=He.originQuery,xe=He.destinationQuery,Me=He.profile,Ie=He.controls;Q.innerHTML=Te({originQuery:Ne,destinationQuery:xe,profile:Me,controls:Ie}),this.container=Q,this.actions=ye,this.store=le,this._map=ze,this.onAdd(),this.render()}return te(q,[{key:"animateToCoordinates",value:function(le,ye){var ze=this.store.getState(),He=ze.origin,Ne=ze.destination,xe=ze.routePadding;if(He.geometry&&Ne.geometry&&!(0,P.default)(He.geometry,Ne.geometry)){var Me=(0,o.default)({type:"FeatureCollection",features:[He,Ne]});this._map.fitBounds([[Me[0],Me[1]],[Me[2],Me[3]]],{padding:xe})}else this._map.flyTo({center:ye})}},{key:"onAdd",value:function(){var le=this,ye=this.actions,ze=ye.clearOrigin,He=ye.clearDestination,Ne=ye.createOrigin,xe=ye.createDestination,Me=ye.setProfile,Ie=ye.reverse,Je=this.store.getState(),Be=Je.geocoder,Ce=Je.accessToken,Re=Je.flyTo,rt=Je.placeholderOrigin,st=Je.placeholderDestination,at=Je.zoom;this.originInput=new b.default(Object.assign({},{accessToken:Ce},Be,{flyTo:Re,placeholder:rt,zoom:at}));var Ve=this.originInput.onAdd(this._map),Dt=this.container.querySelector("#mapbox-directions-origin-input");Dt.appendChild(Ve),this.destinationInput=new b.default(Object.assign({},{accessToken:Ce},Be,{flyTo:Re,placeholder:st,zoom:at}));var Bt=this.destinationInput.onAdd(this._map);this.container.querySelector("#mapbox-directions-destination-input").appendChild(Bt),this.originInput.on("result",function(qt){var or=qt.result.center;Ne(or),le.animateToCoordinates("origin",or)}),this.originInput.on("clear",ze),this.destinationInput.on("result",function(qt){var or=qt.result.center;xe(or),le.animateToCoordinates("destination",or)}),this.destinationInput.on("clear",He);var Gt=this.container.querySelectorAll('input[type="radio"]');Array.prototype.forEach.call(Gt,function(qt){qt.addEventListener("change",function(){Me(qt.value)})}),this.container.querySelector(".js-reverse-inputs").addEventListener("click",function(){var qt=le.store.getState(),or=qt.origin,et=qt.destination;or&&le.actions.queryDestination(or.geometry.coordinates),et&&le.actions.queryOrigin(et.geometry.coordinates),Ie()})}},{key:"render",value:function(){var le=this;this.store.subscribe(function(){var ye=le.store.getState(),ze=ye.originQuery,He=ye.destinationQuery,Ne=ye.originQueryCoordinates,xe=ye.destinationQueryCoordinates;ze&&(le.originInput.query(ze),le.actions.queryOrigin(null)),He&&(le.destinationInput.query(He),le.actions.queryDestination(null)),Ne&&(le.originInput.setInput(Ne),le.animateToCoordinates("origin",Ne),le.actions.queryOriginCoordinates(null)),xe&&(le.destinationInput.setInput(xe),le.animateToCoordinates("destination",xe),le.actions.queryDestinationCoordinates(null))})}}]),q}();y.default=ae},{"./geocoder":27,"lodash.isequal":11,"lodash.template":12,"turf-extent":22}],29:[function(h,m,y){Object.defineProperty(y,"__esModule",{value:!0}),y.default=void 0;var b=o(h("../utils")),M=o(h("lodash.template")),P=o(h("lodash.isequal"));function o(q){return q&&q.__esModule?q:{default:q}}function R(q){"@babel/helpers - typeof";return R=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Q){return typeof Q}:function(Q){return Q&&typeof Symbol=="function"&&Q.constructor===Symbol&&Q!==Symbol.prototype?"symbol":typeof Q},R(q)}function U(q,Q){if(!(q instanceof Q))throw new TypeError("Cannot call a class as a function")}function V(q,Q){for(var le=0;le<Q.length;le++){var ye=Q[le];ye.enumerable=ye.enumerable||!1,ye.configurable=!0,"value"in ye&&(ye.writable=!0),Object.defineProperty(q,te(ye.key),ye)}}function Z(q,Q,le){return Q&&V(q.prototype,Q),Object.defineProperty(q,"prototype",{writable:!1}),q}function te(q){var Q=se(q,"string");return R(Q)==="symbol"?Q:String(Q)}function se(q,Q){if(R(q)!=="object"||q===null)return q;var le=q[Symbol.toPrimitive];if(le!==void 0){var ye=le.call(q,Q);if(R(ye)!=="object")return ye;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(q)}var re=(0,M.default)(`<div class='directions-control directions-control-directions'>
  <div class='mapbox-directions-component mapbox-directions-route-summary<% if (routes > 1) { %> mapbox-directions-multiple<% } %>'>
    <% if (routes > 1) { %>
    <div class='mapbox-directions-routes mapbox-directions-clearfix'>
      <% for (var i = 0; i < routes; i++) { %>
        <input type='radio' name='routes' id='<%= i %>' <% if (i === routeIndex) { %>checked<% } %>>
        <label for='<%= i %>' class='mapbox-directions-route'><%= i + 1 %></label>
      <% } %>
    </div>
    <% } %>
    <h1><%- duration %></h1>
    <span><%- distance %></span>
  </div>

  <div class='mapbox-directions-instructions'>
    <div class='mapbox-directions-instructions-wrapper'>
      <ol class='mapbox-directions-steps'>
        <% steps.forEach(function(step) { %>
          <%
            var distance = step.distance ? format(step.distance) : false;
            var icon = step.maneuver.modifier ? step.maneuver.modifier.replace(/\\s+/g, '-').toLowerCase() : step.maneuver.type.replace(/\\s+/g, '-').toLowerCase();

            if (['arrive', 'depart', 'waypoint'].includes(step.maneuver.type)) {
              icon = step.maneuver.type;
            }

            if (step.maneuver.type === 'roundabout' || step.maneuver.type === 'rotary') {
              icon = 'roundabout';
            }

            var lng = step.maneuver.location[0];
            var lat = step.maneuver.location[1];
          %>
          <li
            data-lat='<%= lat %>'
            data-lng='<%= lng %>'
            class='mapbox-directions-step'>
            <span class='directions-icon directions-icon-<%= icon %>'></span>
            <div class='mapbox-directions-step-maneuver'>
              <%= step.maneuver.instruction %>
            </div>
            <% if (distance) { %>
              <div class='mapbox-directions-step-distance'>
                <%= distance %>
              </div>
            <% } %>
          </li>
        <% }); %>
      </ol>
    </div>
  </div>
</div>
`),Te=(0,M.default)(`<div class='directions-control directions-control-directions'>
  <div class='mapbox-directions-error'>
    <%= error %>
  </div>
</div>
`),ae=function(){function q(Q,le,ye,ze){U(this,q),this.container=Q,this.actions=ye,this.store=le,this._map=ze,this.directions={},this.render()}return Z(q,[{key:"render",value:function(){var le=this;this.store.subscribe(function(){var ye=le.actions,ze=ye.hoverMarker,He=ye.setRouteIndex,Ne=le.store.getState(),xe=Ne.routeIndex,Me=Ne.unit,Ie=Ne.directions,Je=Ne.error,Be=Ne.compile,Ce=Ne.instructions,Re=!(0,P.default)(Ie[xe],le.directions);if(Je){le.container.innerHTML=Te({error:Je});return}var rt=Ce.showWaypointInstructions?void 0:function(Bt){return Bt.maneuver.type!=="waypoint"};if(Ie.length&&Re){var st=le.directions=Ie[xe],at=b.default.getAllSteps(st,rt);Be&&st.legs.forEach(function(Bt){Bt.steps.forEach(function(Gt){Gt.maneuver.instruction=Be("en",Gt)})}),le.container.innerHTML=re({routeIndex:xe,routes:Ie.length,steps:at,format:b.default.format[Me],duration:b.default.format.duration(st.duration),distance:b.default.format[Me](st.distance)});var Ve=le.container.querySelectorAll(".mapbox-directions-step");Array.prototype.forEach.call(Ve,function(Bt){var Gt=Bt.getAttribute("data-lng"),qt=Bt.getAttribute("data-lat");Bt.addEventListener("mouseover",function(){ze([Gt,qt])}),Bt.addEventListener("mouseout",function(){ze(null)}),Bt.addEventListener("click",function(){le._map.flyTo({center:[Gt,qt],zoom:16})})});var Dt=le.container.querySelectorAll('input[type="radio"]');Array.prototype.forEach.call(Dt,function(Bt){Bt.addEventListener("change",function(Gt){He(parseInt(Gt.target.id,10))})})}else le.container.innerHTML&&Re&&(le.container.innerHTML="")})}}]),q}();y.default=ae},{"../utils":34,"lodash.isequal":11,"lodash.template":12}],30:[function(h,m,y){Object.defineProperty(y,"__esModule",{value:!0}),y.default=void 0;var b=h("redux"),M=Te(h("redux-thunk")),P=h("@mapbox/polyline"),o=Te(h("./utils")),R=Te(h("./reducers")),U=re(h("./actions")),V=Te(h("./directions_style")),Z=Te(h("./controls/inputs")),te=Te(h("./controls/instructions"));function se(Ne){if(typeof WeakMap!="function")return null;var xe=new WeakMap,Me=new WeakMap;return(se=function(Je){return Je?Me:xe})(Ne)}function re(Ne,xe){if(Ne&&Ne.__esModule)return Ne;if(Ne===null||ae(Ne)!=="object"&&typeof Ne!="function")return{default:Ne};var Me=se(xe);if(Me&&Me.has(Ne))return Me.get(Ne);var Ie={},Je=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Be in Ne)if(Be!=="default"&&Object.prototype.hasOwnProperty.call(Ne,Be)){var Ce=Je?Object.getOwnPropertyDescriptor(Ne,Be):null;Ce&&(Ce.get||Ce.set)?Object.defineProperty(Ie,Be,Ce):Ie[Be]=Ne[Be]}return Ie.default=Ne,Me&&Me.set(Ne,Ie),Ie}function Te(Ne){return Ne&&Ne.__esModule?Ne:{default:Ne}}function ae(Ne){"@babel/helpers - typeof";return ae=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(xe){return typeof xe}:function(xe){return xe&&typeof Symbol=="function"&&xe.constructor===Symbol&&xe!==Symbol.prototype?"symbol":typeof xe},ae(Ne)}function q(Ne,xe){if(!(Ne instanceof xe))throw new TypeError("Cannot call a class as a function")}function Q(Ne,xe){for(var Me=0;Me<xe.length;Me++){var Ie=xe[Me];Ie.enumerable=Ie.enumerable||!1,Ie.configurable=!0,"value"in Ie&&(Ie.writable=!0),Object.defineProperty(Ne,ye(Ie.key),Ie)}}function le(Ne,xe,Me){return xe&&Q(Ne.prototype,xe),Object.defineProperty(Ne,"prototype",{writable:!1}),Ne}function ye(Ne){var xe=ze(Ne,"string");return ae(xe)==="symbol"?xe:String(xe)}function ze(Ne,xe){if(ae(Ne)!=="object"||Ne===null)return Ne;var Me=Ne[Symbol.toPrimitive];if(Me!==void 0){var Ie=Me.call(Ne,xe);if(ae(Ie)!=="object")return Ie;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(Ne)}var He=function(){function Ne(xe){q(this,Ne),this._directions=null,this._stateSnapshot=null,this._store=this._initStore(),this.actions=(0,b.bindActionCreators)(U,this._store.dispatch),this.actions.setOptions(xe||{}),this.options=xe||{},this.onDragDown=this._onDragDown.bind(this),this.onDragMove=this._onDragMove.bind(this),this.onDragUp=this._onDragUp.bind(this),this.move=this._move.bind(this),this.onClick=this._clickHandler().bind(this)}return le(Ne,[{key:"onAdd",value:function(Me){var Ie=this;this._map=Me;var Je=this._store.getState(),Be=Je.controls,Ce=this.container=document.createElement("div");Ce.className="mapboxgl-ctrl-directions mapboxgl-ctrl";var Re=document.createElement("div");Re.className="directions-control directions-control-inputs",new Z.default(Re,this._store,this.actions,this._map);var rt=document.createElement("div");return rt.className="directions-control directions-control-instructions",new te.default(rt,this._store,{hoverMarker:this.actions.hoverMarker,setRouteIndex:this.actions.setRouteIndex},this._map),Be.inputs&&Ce.appendChild(Re),Be.instructions&&Ce.appendChild(rt),this.subscribedActions(),this._map.loaded()?this.mapState():this._map.on("load",function(){return Ie.mapState()}),Ce}},{key:"onRemove",value:function(Me){return this.container.parentNode.removeChild(this.container),this.removeRoutes(),Me.off("mousedown",this.onDragDown),Me.off("mousemove",this.move),Me.off("touchstart",this.onDragDown),Me.off("touchstart",this.move),Me.off("click",this.onClick),this.storeUnsubscribe&&(this.storeUnsubscribe(),delete this.storeUnsubscribe),V.default.forEach(function(Ie){Me.getLayer(Ie.id)&&Me.removeLayer(Ie.id)}),Me.getSource("directions")&&Me.removeSource("directions"),Me.getSource("directions:markers")&&Me.removeSource("directions:markers"),this._map=null,this}},{key:"mapState",value:function(){var Me=this,Ie=this._store.getState(),Je=Ie.profile;Ie.alternatives,Ie.congestion;var Be=Ie.styles,Ce=Ie.interactive;Ie.compile,this.actions.eventEmit("profile",{profile:Je});var Re={type:"geojson",data:{type:"FeatureCollection",features:[]}};this._map.addSource("directions",Re),this._map.addSource("directions:markers",Re),Be&&Be.length&&Be.forEach(function(rt){return Me._map.addLayer(rt)}),V.default.forEach(function(rt){Me._map.getLayer(rt.id)||Me._map.addLayer(rt)}),Ce&&(this._map.on("mousedown",this.onDragDown),this._map.on("mousemove",this.move),this._map.on("click",this.onClick),this._map.on("touchstart",this.move),this._map.on("touchstart",this.onDragDown))}},{key:"_areMarkersChangedOnly",value:function(Me){var Ie=this,Je=[];return this._stateSnapshot?(Ne.SUBSCRIPTION_FIELDS.forEach(function(Be){Ie._stateSnapshot[Be]!==Me[Be]&&Je.push(Be)}),Je.length<=Ne.MARKER_FIELDS.length&&Je.every(function(Be){return Ne.MARKER_FIELDS.includes(Be)})):!1}},{key:"subscribedActions",value:function(){var Me=this;this.storeUnsubscribe=this._store.subscribe(function(){var Ie=Me._store.getState(),Je=Ie.origin,Be=Ie.destination,Ce=Ie.hoverMarker,Re=Ie.directions,rt=Ie.routeIndex,st=Me._areMarkersChangedOnly(Ie);Me._stateSnapshot=Ie;var at={type:"FeatureCollection",features:[Je,Be,Ce].filter(function(Dt){return Dt.geometry})};if(Me._map.style&&Me._map.getSource("directions:markers")&&Me._map.getSource("directions:markers").setData(at),!st){var Ve={type:"FeatureCollection",features:[]};Re.length&&Re.forEach(function(Dt,Bt){var Gt=[],qt=(0,P.decode)(Dt.geometry,5).map(function(et){return et.reverse()}),or=o.default.getAllSteps(Dt);qt.forEach(function(et,kt){var Vt=Gt[Gt.length-1],dr=Dt.legs[0].annotation&&Dt.legs[0].annotation.congestion&&Dt.legs[0].annotation.congestion[kt-1];if(Vt&&(!dr||Vt.properties.congestion===dr))Vt.geometry.coordinates.push(et);else{var ht={geometry:{type:"LineString",coordinates:[]},properties:{"route-index":Bt,route:Bt===rt?"selected":"alternate"}};Vt&&ht.geometry.coordinates.push(Vt.geometry.coordinates[Vt.geometry.coordinates.length-1]),ht.geometry.coordinates.push(et),dr&&(ht.properties.congestion=Dt.legs[0].annotation.congestion[kt-1]),Gt.push(ht)}}),Ve.features=Ve.features.concat(Gt),Bt===rt&&or.forEach(function(et){et.maneuver.type==="waypoint"&&Ve.features.push({type:"Feature",geometry:{type:"Point",coordinates:et.maneuver.location},properties:{id:"waypoint"}})})}),Me._map.style&&Me._map.getSource("directions")&&Me._map.getSource("directions").setData(Ve)}})}},{key:"_initStore",value:function(){var Me=(0,b.applyMiddleware)(M.default)(b.createStore);return Me(R.default)}},{key:"_clickHandler",value:function(){var Me=null,Ie=250;return function(Je){if(Me)clearTimeout(Me),Me=null,this._map.zoomIn();else{var Be=this._onSingleClick.bind(this);Me=setTimeout(function(){Be(Je),Me=null},Ie)}}}},{key:"_onSingleClick",value:function(Me){var Ie=this,Je=this._store.getState(),Be=Je.origin,Ce=[Me.lngLat.lng,Me.lngLat.lat];if(!Be.geometry)this.actions.setOriginFromCoordinates(Ce);else{var Re=this._map.queryRenderedFeatures(Me.point,{layers:["directions-origin-point","directions-destination-point","directions-waypoint-point","directions-route-line-alt"]});if(Re.length){if(Re.forEach(function(st){st.layer.id==="directions-waypoint-point"&&Ie.actions.removeWaypoint(st)}),Re[0].properties.route==="alternate"){var rt=Re[0].properties["route-index"];this.actions.setRouteIndex(rt)}}else this.actions.setDestinationFromCoordinates(Ce),this._map.flyTo({center:Ce})}}},{key:"_move",value:function(Me){var Ie=this,Je=this._store.getState(),Be=Je.hoverMarker,Ce=this._map.queryRenderedFeatures(Me.point,{layers:["directions-route-line-alt","directions-route-line","directions-origin-point","directions-destination-point","directions-hover-point"]});this._map.getCanvas().style.cursor=Ce.length?"pointer":"",Ce.length?(this.isCursorOverPoint=Ce[0],this._map.dragPan.disable(),Ce.forEach(function(Re){Re.layer.id==="directions-route-line"?Ie.actions.hoverMarker([Me.lngLat.lng,Me.lngLat.lat]):Be.geometry&&Ie.actions.hoverMarker(null)})):this.isCursorOverPoint&&(this.isCursorOverPoint=!1,this._map.dragPan.enable())}},{key:"_onDragDown",value:function(){this.isCursorOverPoint&&(this.isDragging=this.isCursorOverPoint,this._map.getCanvas().style.cursor="grab",this._map.on("mousemove",this.onDragMove),this._map.on("mouseup",this.onDragUp),this._map.on("touchmove",this.onDragMove),this._map.on("touchend",this.onDragUp))}},{key:"_onDragMove",value:function(Me){if(this.isDragging){var Ie=[Me.lngLat.lng,Me.lngLat.lat];switch(this.isDragging.layer.id){case"directions-origin-point":this.actions.createOrigin(Ie);break;case"directions-destination-point":this.actions.createDestination(Ie);break;case"directions-hover-point":this.actions.hoverMarker(Ie);break}}}},{key:"_onDragUp",value:function(){if(this.isDragging){var Me=this._store.getState(),Ie=Me.hoverMarker,Je=Me.origin,Be=Me.destination;switch(this.isDragging.layer.id){case"directions-origin-point":this.actions.setOriginFromCoordinates(Je.geometry.coordinates);break;case"directions-destination-point":this.actions.setDestinationFromCoordinates(Be.geometry.coordinates);break;case"directions-hover-point":Ie.geometry&&!o.default.coordinateMatch(this.isDragging,Ie)&&this.actions.addWaypoint(0,Ie);break}this.isDragging=!1,this._map.getCanvas().style.cursor="",this._map.off("touchmove",this.onDragMove),this._map.off("touchend",this.onDragUp),this._map.off("mousemove",this.onDragMove),this._map.off("mouseup",this.onDragUp)}}},{key:"interactive",value:function(Me){return Me?(this._map.on("touchstart",this.move),this._map.on("touchstart",this.onDragDown),this._map.on("mousedown",this.onDragDown),this._map.on("mousemove",this.move),this._map.on("click",this.onClick)):(this._map.off("touchstart",this.move),this._map.off("touchstart",this.onDragDown),this._map.off("mousedown",this.onDragDown),this._map.off("mousemove",this.move),this._map.off("click",this.onClick)),this}},{key:"getOrigin",value:function(){return this._store.getState().origin}},{key:"setOrigin",value:function(Me){return typeof Me=="string"?this.actions.queryOrigin(Me):this.actions.setOriginFromCoordinates(Me),this}},{key:"getDestination",value:function(){return this._store.getState().destination}},{key:"setDestination",value:function(Me){return typeof Me=="string"?this.actions.queryDestination(Me):this.actions.setDestinationFromCoordinates(Me),this}},{key:"reverse",value:function(){return this.actions.reverse(),this}},{key:"addWaypoint",value:function(Me,Ie){return Ie.type||(Ie=o.default.createPoint(Ie,{id:"waypoint"})),this.actions.addWaypoint(Me,Ie),this}},{key:"setWaypoint",value:function(Me,Ie){return Ie.type||(Ie=o.default.createPoint(Ie,{id:"waypoint"})),this.actions.setWaypoint(Me,Ie),this}},{key:"removeWaypoint",value:function(Me){var Ie=this._store.getState(),Je=Ie.waypoints;return this.actions.removeWaypoint(Je[Me]),this}},{key:"getWaypoints",value:function(){return this._store.getState().waypoints}},{key:"removeRoutes",value:function(){return this.actions.clearOrigin(),this.actions.clearDestination(),this}},{key:"on",value:function(Me,Ie){return this.actions.eventSubscribe(Me,Ie),this}}]),Ne}();y.default=He,He.MARKER_FIELDS=["origin","destination","hoverMarker"],He.SUBSCRIPTION_FIELDS=["origin","destination","hovedMarker","directions","routeIndex"]},{"./actions":25,"./controls/inputs":28,"./controls/instructions":29,"./directions_style":31,"./reducers":33,"./utils":34,"@mapbox/polyline":6,redux:18,"redux-thunk":17}],31:[function(h,m,y){Object.defineProperty(y,"__esModule",{value:!0}),y.default=void 0;var b=[{id:"directions-route-line-alt",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#bbb","line-width":4},filter:["all",["in","$type","LineString"],["in","route","alternate"]]},{id:"directions-route-line-casing",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#2d5f99","line-width":12},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-route-line",type:"line",source:"directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":{property:"congestion",type:"categorical",default:"#4882c5",stops:[["unknown","#4882c5"],["low","#4882c5"],["moderate","#f09a46"],["heavy","#e34341"],["severe","#8b2342"]]},"line-width":7},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-hover-point-casing",type:"circle",source:"directions:markers",paint:{"circle-radius":8,"circle-color":"#fff"},filter:["all",["in","$type","Point"],["in","id","hover"]]},{id:"directions-hover-point",type:"circle",source:"directions:markers",paint:{"circle-radius":6,"circle-color":"#3bb2d0"},filter:["all",["in","$type","Point"],["in","id","hover"]]},{id:"directions-waypoint-point-casing",type:"circle",source:"directions:markers",paint:{"circle-radius":8,"circle-color":"#fff"},filter:["all",["in","$type","Point"],["in","id","waypoint"]]},{id:"directions-waypoint-point",type:"circle",source:"directions:markers",paint:{"circle-radius":6,"circle-color":"#8a8bc9"},filter:["all",["in","$type","Point"],["in","id","waypoint"]]},{id:"directions-origin-point",type:"circle",source:"directions:markers",paint:{"circle-radius":18,"circle-color":"#3bb2d0"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-origin-label",type:"symbol",source:"directions:markers",layout:{"text-field":"A","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-destination-point",type:"circle",source:"directions:markers",paint:{"circle-radius":18,"circle-color":"#8a8bc9"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]},{id:"directions-destination-label",type:"symbol",source:"directions:markers",layout:{"text-field":"B","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]}],M=b;y.default=M},{}],32:[function(h,m,y){var b=M(h("./directions"));function M(P){return P&&P.__esModule?P:{default:P}}m.exports=b.default},{"./directions":30}],33:[function(h,m,y){function b(se){"@babel/helpers - typeof";return b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(re){return typeof re}:function(re){return re&&typeof Symbol=="function"&&re.constructor===Symbol&&re!==Symbol.prototype?"symbol":typeof re},b(se)}Object.defineProperty(y,"__esModule",{value:!0}),y.default=void 0;var M=U(h("../constants/action_types.js")),P=o(h("merge-options"));function o(se){return se&&se.__esModule?se:{default:se}}function R(se){if(typeof WeakMap!="function")return null;var re=new WeakMap,Te=new WeakMap;return(R=function(q){return q?Te:re})(se)}function U(se,re){if(se&&se.__esModule)return se;if(se===null||b(se)!=="object"&&typeof se!="function")return{default:se};var Te=R(re);if(Te&&Te.has(se))return Te.get(se);var ae={},q=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Q in se)if(Q!=="default"&&Object.prototype.hasOwnProperty.call(se,Q)){var le=q?Object.getOwnPropertyDescriptor(se,Q):null;le&&(le.get||le.set)?Object.defineProperty(ae,Q,le):ae[Q]=se[Q]}return ae.default=se,Te&&Te.set(se,ae),ae}var V=function(){return{api:"https://api.mapbox.com/directions/v5/",profile:"mapbox/driving-traffic",alternatives:!1,congestion:!1,unit:"imperial",flyTo:!0,placeholderOrigin:"Choose a starting place",placeholderDestination:"Choose destination",zoom:16,language:"en",compile:null,proximity:!1,styles:[],controls:{profileSwitcher:!0,inputs:!0,instructions:!0},instructions:{showWaypointInstructions:!0},geocoder:{},interactive:!0,events:{},origin:{},destination:{},hoverMarker:{},waypoints:[],originQuery:null,destinationQuery:null,originQueryCoordinates:null,destinationQueryCoordinates:null,directions:[],fetchDirectionsRequest:null,routeIndex:0,routePadding:80}};function Z(){var se=arguments.length>0&&arguments[0]!==void 0?arguments[0]:V(),re=arguments.length>1?arguments[1]:void 0;switch(re.type){case M.SET_OPTIONS:return(0,P.default)({},se,re.options);case M.DIRECTIONS_PROFILE:return Object.assign({},se,{profile:re.profile});case M.ORIGIN:return Object.assign({},se,{origin:re.origin,hoverMarker:{}});case M.DESTINATION:return Object.assign({},se,{destination:re.destination,hoverMarker:{}});case M.HOVER_MARKER:return Object.assign({},se,{hoverMarker:re.hoverMarker});case M.WAYPOINTS:return Object.assign({},se,{waypoints:re.waypoints});case M.ORIGIN_QUERY:return Object.assign({},se,{originQuery:re.query});case M.DESTINATION_QUERY:return Object.assign({},se,{destinationQuery:re.query});case M.ORIGIN_FROM_COORDINATES:return Object.assign({},se,{originQueryCoordinates:re.coordinates});case M.DESTINATION_FROM_COORDINATES:return Object.assign({},se,{destinationQueryCoordinates:re.coordinates});case M.ORIGIN_CLEAR:return Object.assign({},se,{origin:{},originQuery:"",waypoints:[],directions:[]});case M.DESTINATION_CLEAR:return Object.assign({},se,{destination:{},destinationQuery:"",waypoints:[],directions:[]});case M.DIRECTIONS_REQUEST_START:return Object.assign({},se,{fetchDirectionsRequest:re.request});case M.DIRECTIONS:return Object.assign({},se,{directions:re.directions,fetchDirectionsRequest:null});case M.ROUTE_INDEX:return Object.assign({},se,{routeIndex:re.routeIndex});case M.ERROR:return Object.assign({},se,{error:re.error});default:return se}}var te=Z;y.default=te},{"../constants/action_types.js":26,"merge-options":14}],34:[function(h,m,y){Object.defineProperty(y,"__esModule",{value:!0}),y.default=void 0;function b(te){return te[0]>=-180&&te[0]<=180&&te[1]>=-90&&te[1]<=90}function M(te,se){return te=te.geometry.coordinates,se=se.geometry.coordinates,te.join()===se.join()||te[0].toFixed(3)===se[0].toFixed(3)&&te[1].toFixed(3)===se[1].toFixed(3)}function P(te){var se=360,re=((te- -180)%se+se)%se+-180;return re===-180?180:re}function o(te,se){var re=0;return Math.floor(se)!==se&&(re=se.toString().split(".")[1].length),te.toFixed(Math.min(re,5))}function R(te,se){return{type:"Feature",geometry:{type:"Point",coordinates:te},properties:se||{}}}function U(te,se){return te.legs.reduce(function(re,Te,ae){ae>0&&(re[re.length-1].maneuver.type="waypoint",Te.steps[0].maneuver.type="");var q=re.concat(Te.steps);return se?q.filter(se):q},[])}var V={duration:function(se){var re=Math.floor(se/60),Te=Math.floor(re/60);return se%=60,re%=60,Te===0&&re===0?se+"s":Te===0?re+"min":Te+"h "+re+"min"},imperial:function(se){var re=se/1609.344;return re>=100?re.toFixed(0)+"mi":re>=10?re.toFixed(1)+"mi":re>=.1?re.toFixed(2)+"mi":(re*5280).toFixed(0)+"ft"},metric:function(se){return se>=1e5?(se/1e3).toFixed(0)+"km":se>=1e4?(se/1e3).toFixed(1)+"km":se>=100?(se/1e3).toFixed(2)+"km":se.toFixed(0)+"m"}},Z={format:V,coordinateMatch:M,createPoint:R,validCoords:b,wrap:P,roundWithOriginalPrecision:o,getAllSteps:U};y.default=Z},{}]},{},[32])(32)})})(Rk);var Sj=Rk.exports;const Ej=zg(Sj);var kk={},Lk={},Jx={exports:{}},j_={exports:{}};(function(){var a,n,h,m,y,b;typeof performance<"u"&&performance!==null&&performance.now?j_.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(j_.exports=function(){return(a()-y)/1e6},n=process.hrtime,a=function(){var M;return M=n(),M[0]*1e9+M[1]},m=a(),b=process.uptime()*1e9,y=m-b):Date.now?(j_.exports=function(){return Date.now()-h},h=Date.now()):(j_.exports=function(){return new Date().getTime()-h},h=new Date().getTime())}).call(Xo);var Mj=j_.exports,Ij=Mj,Cu=typeof window>"u"?Xo:window,uv=["moz","webkit"],fp="AnimationFrame",Sp=Cu["request"+fp],Mg=Cu["cancel"+fp]||Cu["cancelRequest"+fp];for(var D_=0;!Sp&&D_<uv.length;D_++)Sp=Cu[uv[D_]+"Request"+fp],Mg=Cu[uv[D_]+"Cancel"+fp]||Cu[uv[D_]+"CancelRequest"+fp];if(!Sp||!Mg){var zw=0,wP=0,tf=[],Aj=1e3/60;Sp=function(a){if(tf.length===0){var n=Ij(),h=Math.max(0,Aj-(n-zw));zw=h+n,setTimeout(function(){var m=tf.slice(0);tf.length=0;for(var y=0;y<m.length;y++)if(!m[y].cancelled)try{m[y].callback(zw)}catch(b){setTimeout(function(){throw b},0)}},Math.round(h))}return tf.push({handle:++wP,callback:a,cancelled:!1}),wP},Mg=function(a){for(var n=0;n<tf.length;n++)tf[n].handle===a&&(tf[n].cancelled=!0)}}Jx.exports=function(a){return Sp.call(Cu,a)};Jx.exports.cancel=function(){Mg.apply(Cu,arguments)};Jx.exports.polyfill=function(a){a||(a=Cu),a.requestAnimationFrame=Sp,a.cancelAnimationFrame=Mg};var Cj=Jx.exports,e1={exports:{}},Fw=null,TP=["Webkit","Moz","O","ms"],Pj=function(n){Fw||(Fw=document.createElement("div"));var h=Fw.style;if(n in h)return n;for(var m=n.charAt(0).toUpperCase()+n.slice(1),y=TP.length;y>=0;y--){var b=TP[y]+m;if(b in h)return b}return!1},Oj=Lj,Dj=/\s/,Rj=/(_|-|\.|:)/,kj=/([a-z][A-Z]|[A-Z][a-z])/;function Lj(a){return Dj.test(a)?a.toLowerCase():Rj.test(a)?(Fj(a)||a).toLowerCase():kj.test(a)?Nj(a).toLowerCase():a.toLowerCase()}var zj=/[\W_]+(.|$)/g;function Fj(a){return a.replace(zj,function(n,h){return h?" "+h:""})}var Bj=/(.)([A-Z]+)/g;function Nj(a){return a.replace(Bj,function(n,h,m){return h+" "+m.toLowerCase().split("").join(" ")})}var Uj=Oj,jj=Vj;function Vj(a){return Uj(a).replace(/[\W_]+(.|$)/g,function(n,h){return h?" "+h:""}).trim()}var $j=jj,Gj=Wj;function Wj(a){return $j(a).replace(/\s(\w)/g,function(n,h){return h.toUpperCase()})}var qj={animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridColumn:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,stopOpacity:!0,strokeDashoffset:!0,strokeOpacity:!0,strokeWidth:!0},Hj=function(a,n){return typeof n=="number"&&!qj[a]?n+"px":n},Zj=Pj,Xj=Gj,Iv={float:"cssFloat"},Yj=Hj;function fx(a,n,h){var m=Iv[n];if(typeof m>"u"&&(m=Qj(n)),m){if(h===void 0)return a.style[m];a.style[m]=Yj(m,h)}}function Kj(a,n){for(var h in n)n.hasOwnProperty(h)&&fx(a,h,n[h])}function Qj(a){var n=Xj(a),h=Zj(n);return Iv[n]=Iv[a]=Iv[h]=h,h}function zk(){arguments.length===2?typeof arguments[1]=="string"?arguments[0].style.cssText=arguments[1]:Kj(arguments[0],arguments[1]):fx(arguments[0],arguments[1],arguments[2])}e1.exports=zk;e1.exports.set=zk;e1.exports.get=function(a,n){return Array.isArray(n)?n.reduce(function(h,m){return h[m]=fx(a,m||""),h},{}):fx(a,n||"")};var Fk=e1.exports,Bk={exports:{}},Jj="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",eV=Jj,tV=eV;function Nk(){}function Uk(){}Uk.resetWarningCache=Nk;var rV=function(){function a(m,y,b,M,P,o){if(o!==tV){var R=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw R.name="Invariant Violation",R}}a.isRequired=a;function n(){return a}var h={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:n,element:a,elementType:a,instanceOf:n,node:a,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:Uk,resetWarningCache:Nk};return h.PropTypes=h,h};Bk.exports=rV();var nV=Bk.exports,jk={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=n;function n(h){return typeof h=="string"}})(jk);var Vk={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=b;var n=Fk,h=m(n);function m(M){return M&&M.__esModule?M:{default:M}}var y=!1;function b(){var M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(M&&y!==!1)return y;if(typeof document<"u"){var P=document.createElement("div");(0,h.default)(P,{width:100,height:100,position:"absolute",top:-9999,overflow:"scroll",MsOverflowStyle:"scrollbar"}),document.body.appendChild(P),y=P.offsetWidth-P.clientWidth,document.body.removeChild(P)}else y=0;return y||0}})(Vk);var $k={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=n;function n(){return!1}})($k);var Gk={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=n;function n(h){var m=h.clientWidth,y=getComputedStyle(h),b=y.paddingLeft,M=y.paddingRight;return m-parseFloat(b)-parseFloat(M)}})(Gk);var Wk={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=n;function n(h){var m=h.clientHeight,y=getComputedStyle(h),b=y.paddingTop,M=y.paddingBottom;return m-parseFloat(b)-parseFloat(M)}})(Wk);var ra={};Object.defineProperty(ra,"__esModule",{value:!0});ra.containerStyleDefault={position:"relative",overflow:"hidden",width:"100%",height:"100%"};ra.containerStyleAutoHeight={height:"auto"};ra.viewStyleDefault={position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"scroll",WebkitOverflowScrolling:"touch"};ra.viewStyleAutoHeight={position:"relative",top:void 0,left:void 0,right:void 0,bottom:void 0};ra.viewStyleUniversalInitial={overflow:"hidden",marginRight:0,marginBottom:0};ra.trackHorizontalStyleDefault={position:"absolute",height:6};ra.trackVerticalStyleDefault={position:"absolute",width:6};ra.thumbHorizontalStyleDefault={position:"relative",display:"block",height:"100%"};ra.thumbVerticalStyleDefault={position:"relative",display:"block",width:"100%"};ra.disableSelectStyle={userSelect:"none"};ra.disableSelectStyleReset={userSelect:""};var Pf={};Object.defineProperty(Pf,"__esModule",{value:!0});var eh=Object.assign||function(a){for(var n=1;n<arguments.length;n++){var h=arguments[n];for(var m in h)Object.prototype.hasOwnProperty.call(h,m)&&(a[m]=h[m])}return a};Pf.renderViewDefault=sV;Pf.renderTrackHorizontalDefault=aV;Pf.renderTrackVerticalDefault=lV;Pf.renderThumbHorizontalDefault=uV;Pf.renderThumbVerticalDefault=cV;var iV=rr,Vg=oV(iV);function oV(a){return a&&a.__esModule?a:{default:a}}function t1(a,n){var h={};for(var m in a)n.indexOf(m)>=0||Object.prototype.hasOwnProperty.call(a,m)&&(h[m]=a[m]);return h}function sV(a){return Vg.default.createElement("div",a)}function aV(a){var n=a.style,h=t1(a,["style"]),m=eh({},n,{right:2,bottom:2,left:2,borderRadius:3});return Vg.default.createElement("div",eh({style:m},h))}function lV(a){var n=a.style,h=t1(a,["style"]),m=eh({},n,{right:2,bottom:2,top:2,borderRadius:3});return Vg.default.createElement("div",eh({style:m},h))}function uV(a){var n=a.style,h=t1(a,["style"]),m=eh({},n,{cursor:"pointer",borderRadius:"inherit",backgroundColor:"rgba(0,0,0,.2)"});return Vg.default.createElement("div",eh({style:m},h))}function cV(a){var n=a.style,h=t1(a,["style"]),m=eh({},n,{cursor:"pointer",borderRadius:"inherit",backgroundColor:"rgba(0,0,0,.2)"});return Vg.default.createElement("div",eh({style:m},h))}(function(a){Object.defineProperty(a,"__esModule",{value:!0});var n=Object.assign||function(Je){for(var Be=1;Be<arguments.length;Be++){var Ce=arguments[Be];for(var Re in Ce)Object.prototype.hasOwnProperty.call(Ce,Re)&&(Je[Re]=Ce[Re])}return Je},h=function(){function Je(Be,Ce){for(var Re=0;Re<Ce.length;Re++){var rt=Ce[Re];rt.enumerable=rt.enumerable||!1,rt.configurable=!0,"value"in rt&&(rt.writable=!0),Object.defineProperty(Be,rt.key,rt)}}return function(Be,Ce,Re){return Ce&&Je(Be.prototype,Ce),Re&&Je(Be,Re),Be}}(),m=Cj,y=ze(m),b=Fk,M=ze(b),P=rr,o=nV,R=ze(o),U=jk,V=ze(U),Z=Vk,te=ze(Z),se=$k,re=ze(se),Te=Gk,ae=ze(Te),q=Wk,Q=ze(q),le=ra,ye=Pf;function ze(Je){return Je&&Je.__esModule?Je:{default:Je}}function He(Je,Be){var Ce={};for(var Re in Je)Be.indexOf(Re)>=0||Object.prototype.hasOwnProperty.call(Je,Re)&&(Ce[Re]=Je[Re]);return Ce}function Ne(Je,Be){if(!(Je instanceof Be))throw new TypeError("Cannot call a class as a function")}function xe(Je,Be){if(!Je)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Be&&(typeof Be=="object"||typeof Be=="function")?Be:Je}function Me(Je,Be){if(typeof Be!="function"&&Be!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof Be);Je.prototype=Object.create(Be&&Be.prototype,{constructor:{value:Je,enumerable:!1,writable:!0,configurable:!0}}),Be&&(Object.setPrototypeOf?Object.setPrototypeOf(Je,Be):Je.__proto__=Be)}var Ie=function(Je){Me(Be,Je);function Be(Ce){var Re;Ne(this,Be);for(var rt=arguments.length,st=Array(rt>1?rt-1:0),at=1;at<rt;at++)st[at-1]=arguments[at];var Ve=xe(this,(Re=Be.__proto__||Object.getPrototypeOf(Be)).call.apply(Re,[this,Ce].concat(st)));return Ve.getScrollLeft=Ve.getScrollLeft.bind(Ve),Ve.getScrollTop=Ve.getScrollTop.bind(Ve),Ve.getScrollWidth=Ve.getScrollWidth.bind(Ve),Ve.getScrollHeight=Ve.getScrollHeight.bind(Ve),Ve.getClientWidth=Ve.getClientWidth.bind(Ve),Ve.getClientHeight=Ve.getClientHeight.bind(Ve),Ve.getValues=Ve.getValues.bind(Ve),Ve.getThumbHorizontalWidth=Ve.getThumbHorizontalWidth.bind(Ve),Ve.getThumbVerticalHeight=Ve.getThumbVerticalHeight.bind(Ve),Ve.getScrollLeftForOffset=Ve.getScrollLeftForOffset.bind(Ve),Ve.getScrollTopForOffset=Ve.getScrollTopForOffset.bind(Ve),Ve.scrollLeft=Ve.scrollLeft.bind(Ve),Ve.scrollTop=Ve.scrollTop.bind(Ve),Ve.scrollToLeft=Ve.scrollToLeft.bind(Ve),Ve.scrollToTop=Ve.scrollToTop.bind(Ve),Ve.scrollToRight=Ve.scrollToRight.bind(Ve),Ve.scrollToBottom=Ve.scrollToBottom.bind(Ve),Ve.handleTrackMouseEnter=Ve.handleTrackMouseEnter.bind(Ve),Ve.handleTrackMouseLeave=Ve.handleTrackMouseLeave.bind(Ve),Ve.handleHorizontalTrackMouseDown=Ve.handleHorizontalTrackMouseDown.bind(Ve),Ve.handleVerticalTrackMouseDown=Ve.handleVerticalTrackMouseDown.bind(Ve),Ve.handleHorizontalThumbMouseDown=Ve.handleHorizontalThumbMouseDown.bind(Ve),Ve.handleVerticalThumbMouseDown=Ve.handleVerticalThumbMouseDown.bind(Ve),Ve.handleWindowResize=Ve.handleWindowResize.bind(Ve),Ve.handleScroll=Ve.handleScroll.bind(Ve),Ve.handleDrag=Ve.handleDrag.bind(Ve),Ve.handleDragEnd=Ve.handleDragEnd.bind(Ve),Ve.state={didMountUniversal:!1},Ve}return h(Be,[{key:"componentDidMount",value:function(){this.addListeners(),this.update(),this.componentDidMountUniversal()}},{key:"componentDidMountUniversal",value:function(){var Re=this.props.universal;Re&&this.setState({didMountUniversal:!0})}},{key:"componentDidUpdate",value:function(){this.update()}},{key:"componentWillUnmount",value:function(){this.removeListeners(),(0,m.cancel)(this.requestFrame),clearTimeout(this.hideTracksTimeout),clearInterval(this.detectScrollingInterval)}},{key:"getScrollLeft",value:function(){return this.view?this.view.scrollLeft:0}},{key:"getScrollTop",value:function(){return this.view?this.view.scrollTop:0}},{key:"getScrollWidth",value:function(){return this.view?this.view.scrollWidth:0}},{key:"getScrollHeight",value:function(){return this.view?this.view.scrollHeight:0}},{key:"getClientWidth",value:function(){return this.view?this.view.clientWidth:0}},{key:"getClientHeight",value:function(){return this.view?this.view.clientHeight:0}},{key:"getValues",value:function(){var Re=this.view||{},rt=Re.scrollLeft,st=rt===void 0?0:rt,at=Re.scrollTop,Ve=at===void 0?0:at,Dt=Re.scrollWidth,Bt=Dt===void 0?0:Dt,Gt=Re.scrollHeight,qt=Gt===void 0?0:Gt,or=Re.clientWidth,et=or===void 0?0:or,kt=Re.clientHeight,Vt=kt===void 0?0:kt;return{left:st/(Bt-et)||0,top:Ve/(qt-Vt)||0,scrollLeft:st,scrollTop:Ve,scrollWidth:Bt,scrollHeight:qt,clientWidth:et,clientHeight:Vt}}},{key:"getThumbHorizontalWidth",value:function(){var Re=this.props,rt=Re.thumbSize,st=Re.thumbMinSize,at=this.view,Ve=at.scrollWidth,Dt=at.clientWidth,Bt=(0,ae.default)(this.trackHorizontal),Gt=Math.ceil(Dt/Ve*Bt);return Bt<=Gt?0:rt||Math.max(Gt,st)}},{key:"getThumbVerticalHeight",value:function(){var Re=this.props,rt=Re.thumbSize,st=Re.thumbMinSize,at=this.view,Ve=at.scrollHeight,Dt=at.clientHeight,Bt=(0,Q.default)(this.trackVertical),Gt=Math.ceil(Dt/Ve*Bt);return Bt<=Gt?0:rt||Math.max(Gt,st)}},{key:"getScrollLeftForOffset",value:function(Re){var rt=this.view,st=rt.scrollWidth,at=rt.clientWidth,Ve=(0,ae.default)(this.trackHorizontal),Dt=this.getThumbHorizontalWidth();return Re/(Ve-Dt)*(st-at)}},{key:"getScrollTopForOffset",value:function(Re){var rt=this.view,st=rt.scrollHeight,at=rt.clientHeight,Ve=(0,Q.default)(this.trackVertical),Dt=this.getThumbVerticalHeight();return Re/(Ve-Dt)*(st-at)}},{key:"scrollLeft",value:function(){var Re=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this.view&&(this.view.scrollLeft=Re)}},{key:"scrollTop",value:function(){var Re=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this.view&&(this.view.scrollTop=Re)}},{key:"scrollToLeft",value:function(){this.view&&(this.view.scrollLeft=0)}},{key:"scrollToTop",value:function(){this.view&&(this.view.scrollTop=0)}},{key:"scrollToRight",value:function(){this.view&&(this.view.scrollLeft=this.view.scrollWidth)}},{key:"scrollToBottom",value:function(){this.view&&(this.view.scrollTop=this.view.scrollHeight)}},{key:"addListeners",value:function(){if(!(typeof document>"u"||!this.view)){var Re=this.view,rt=this.trackHorizontal,st=this.trackVertical,at=this.thumbHorizontal,Ve=this.thumbVertical;Re.addEventListener("scroll",this.handleScroll),(0,te.default)()&&(rt.addEventListener("mouseenter",this.handleTrackMouseEnter),rt.addEventListener("mouseleave",this.handleTrackMouseLeave),rt.addEventListener("mousedown",this.handleHorizontalTrackMouseDown),st.addEventListener("mouseenter",this.handleTrackMouseEnter),st.addEventListener("mouseleave",this.handleTrackMouseLeave),st.addEventListener("mousedown",this.handleVerticalTrackMouseDown),at.addEventListener("mousedown",this.handleHorizontalThumbMouseDown),Ve.addEventListener("mousedown",this.handleVerticalThumbMouseDown),window.addEventListener("resize",this.handleWindowResize))}}},{key:"removeListeners",value:function(){if(!(typeof document>"u"||!this.view)){var Re=this.view,rt=this.trackHorizontal,st=this.trackVertical,at=this.thumbHorizontal,Ve=this.thumbVertical;Re.removeEventListener("scroll",this.handleScroll),(0,te.default)()&&(rt.removeEventListener("mouseenter",this.handleTrackMouseEnter),rt.removeEventListener("mouseleave",this.handleTrackMouseLeave),rt.removeEventListener("mousedown",this.handleHorizontalTrackMouseDown),st.removeEventListener("mouseenter",this.handleTrackMouseEnter),st.removeEventListener("mouseleave",this.handleTrackMouseLeave),st.removeEventListener("mousedown",this.handleVerticalTrackMouseDown),at.removeEventListener("mousedown",this.handleHorizontalThumbMouseDown),Ve.removeEventListener("mousedown",this.handleVerticalThumbMouseDown),window.removeEventListener("resize",this.handleWindowResize),this.teardownDragging())}}},{key:"handleScroll",value:function(Re){var rt=this,st=this.props,at=st.onScroll,Ve=st.onScrollFrame;at&&at(Re),this.update(function(Dt){var Bt=Dt.scrollLeft,Gt=Dt.scrollTop;rt.viewScrollLeft=Bt,rt.viewScrollTop=Gt,Ve&&Ve(Dt)}),this.detectScrolling()}},{key:"handleScrollStart",value:function(){var Re=this.props.onScrollStart;Re&&Re(),this.handleScrollStartAutoHide()}},{key:"handleScrollStartAutoHide",value:function(){var Re=this.props.autoHide;Re&&this.showTracks()}},{key:"handleScrollStop",value:function(){var Re=this.props.onScrollStop;Re&&Re(),this.handleScrollStopAutoHide()}},{key:"handleScrollStopAutoHide",value:function(){var Re=this.props.autoHide;Re&&this.hideTracks()}},{key:"handleWindowResize",value:function(){(0,te.default)(!1),this.forceUpdate()}},{key:"handleHorizontalTrackMouseDown",value:function(Re){Re.preventDefault();var rt=Re.target,st=Re.clientX,at=rt.getBoundingClientRect(),Ve=at.left,Dt=this.getThumbHorizontalWidth(),Bt=Math.abs(Ve-st)-Dt/2;this.view.scrollLeft=this.getScrollLeftForOffset(Bt)}},{key:"handleVerticalTrackMouseDown",value:function(Re){Re.preventDefault();var rt=Re.target,st=Re.clientY,at=rt.getBoundingClientRect(),Ve=at.top,Dt=this.getThumbVerticalHeight(),Bt=Math.abs(Ve-st)-Dt/2;this.view.scrollTop=this.getScrollTopForOffset(Bt)}},{key:"handleHorizontalThumbMouseDown",value:function(Re){Re.preventDefault(),this.handleDragStart(Re);var rt=Re.target,st=Re.clientX,at=rt.offsetWidth,Ve=rt.getBoundingClientRect(),Dt=Ve.left;this.prevPageX=at-(st-Dt)}},{key:"handleVerticalThumbMouseDown",value:function(Re){Re.preventDefault(),this.handleDragStart(Re);var rt=Re.target,st=Re.clientY,at=rt.offsetHeight,Ve=rt.getBoundingClientRect(),Dt=Ve.top;this.prevPageY=at-(st-Dt)}},{key:"setupDragging",value:function(){(0,M.default)(document.body,le.disableSelectStyle),document.addEventListener("mousemove",this.handleDrag),document.addEventListener("mouseup",this.handleDragEnd),document.onselectstart=re.default}},{key:"teardownDragging",value:function(){(0,M.default)(document.body,le.disableSelectStyleReset),document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.handleDragEnd),document.onselectstart=void 0}},{key:"handleDragStart",value:function(Re){this.dragging=!0,Re.stopImmediatePropagation(),this.setupDragging()}},{key:"handleDrag",value:function(Re){if(this.prevPageX){var rt=Re.clientX,st=this.trackHorizontal.getBoundingClientRect(),at=st.left,Ve=this.getThumbHorizontalWidth(),Dt=Ve-this.prevPageX,Bt=-at+rt-Dt;this.view.scrollLeft=this.getScrollLeftForOffset(Bt)}if(this.prevPageY){var Gt=Re.clientY,qt=this.trackVertical.getBoundingClientRect(),or=qt.top,et=this.getThumbVerticalHeight(),kt=et-this.prevPageY,Vt=-or+Gt-kt;this.view.scrollTop=this.getScrollTopForOffset(Vt)}return!1}},{key:"handleDragEnd",value:function(){this.dragging=!1,this.prevPageX=this.prevPageY=0,this.teardownDragging(),this.handleDragEndAutoHide()}},{key:"handleDragEndAutoHide",value:function(){var Re=this.props.autoHide;Re&&this.hideTracks()}},{key:"handleTrackMouseEnter",value:function(){this.trackMouseOver=!0,this.handleTrackMouseEnterAutoHide()}},{key:"handleTrackMouseEnterAutoHide",value:function(){var Re=this.props.autoHide;Re&&this.showTracks()}},{key:"handleTrackMouseLeave",value:function(){this.trackMouseOver=!1,this.handleTrackMouseLeaveAutoHide()}},{key:"handleTrackMouseLeaveAutoHide",value:function(){var Re=this.props.autoHide;Re&&this.hideTracks()}},{key:"showTracks",value:function(){clearTimeout(this.hideTracksTimeout),(0,M.default)(this.trackHorizontal,{opacity:1}),(0,M.default)(this.trackVertical,{opacity:1})}},{key:"hideTracks",value:function(){var Re=this;if(!this.dragging&&!this.scrolling&&!this.trackMouseOver){var rt=this.props.autoHideTimeout;clearTimeout(this.hideTracksTimeout),this.hideTracksTimeout=setTimeout(function(){(0,M.default)(Re.trackHorizontal,{opacity:0}),(0,M.default)(Re.trackVertical,{opacity:0})},rt)}}},{key:"detectScrolling",value:function(){var Re=this;this.scrolling||(this.scrolling=!0,this.handleScrollStart(),this.detectScrollingInterval=setInterval(function(){Re.lastViewScrollLeft===Re.viewScrollLeft&&Re.lastViewScrollTop===Re.viewScrollTop&&(clearInterval(Re.detectScrollingInterval),Re.scrolling=!1,Re.handleScrollStop()),Re.lastViewScrollLeft=Re.viewScrollLeft,Re.lastViewScrollTop=Re.viewScrollTop},100))}},{key:"raf",value:function(Re){var rt=this;this.requestFrame&&y.default.cancel(this.requestFrame),this.requestFrame=(0,y.default)(function(){rt.requestFrame=void 0,Re()})}},{key:"update",value:function(Re){var rt=this;this.raf(function(){return rt._update(Re)})}},{key:"_update",value:function(Re){var rt=this.props,st=rt.onUpdate,at=rt.hideTracksWhenNotNeeded,Ve=this.getValues();if((0,te.default)()){var Dt=Ve.scrollLeft,Bt=Ve.clientWidth,Gt=Ve.scrollWidth,qt=(0,ae.default)(this.trackHorizontal),or=this.getThumbHorizontalWidth(),et=Dt/(Gt-Bt)*(qt-or),kt={width:or,transform:"translateX("+et+"px)"},Vt=Ve.scrollTop,dr=Ve.clientHeight,ht=Ve.scrollHeight,vr=(0,Q.default)(this.trackVertical),ar=this.getThumbVerticalHeight(),$r=Vt/(ht-dr)*(vr-ar),Lr={height:ar,transform:"translateY("+$r+"px)"};if(at){var xn={visibility:Gt>Bt?"visible":"hidden"},$n={visibility:ht>dr?"visible":"hidden"};(0,M.default)(this.trackHorizontal,xn),(0,M.default)(this.trackVertical,$n)}(0,M.default)(this.thumbHorizontal,kt),(0,M.default)(this.thumbVertical,Lr)}st&&st(Ve),typeof Re=="function"&&Re(Ve)}},{key:"render",value:function(){var Re=this,rt=(0,te.default)(),st=this.props;st.onScroll,st.onScrollFrame,st.onScrollStart,st.onScrollStop,st.onUpdate;var at=st.renderView,Ve=st.renderTrackHorizontal,Dt=st.renderTrackVertical,Bt=st.renderThumbHorizontal,Gt=st.renderThumbVertical,qt=st.tagName;st.hideTracksWhenNotNeeded;var or=st.autoHide;st.autoHideTimeout;var et=st.autoHideDuration;st.thumbSize,st.thumbMinSize;var kt=st.universal,Vt=st.autoHeight,dr=st.autoHeightMin,ht=st.autoHeightMax,vr=st.style,ar=st.children,$r=He(st,["onScroll","onScrollFrame","onScrollStart","onScrollStop","onUpdate","renderView","renderTrackHorizontal","renderTrackVertical","renderThumbHorizontal","renderThumbVertical","tagName","hideTracksWhenNotNeeded","autoHide","autoHideTimeout","autoHideDuration","thumbSize","thumbMinSize","universal","autoHeight","autoHeightMin","autoHeightMax","style","children"]),Lr=this.state.didMountUniversal,xn=n({},le.containerStyleDefault,Vt&&n({},le.containerStyleAutoHeight,{minHeight:dr,maxHeight:ht}),vr),$n=n({},le.viewStyleDefault,{marginRight:rt?-rt:0,marginBottom:rt?-rt:0},Vt&&n({},le.viewStyleAutoHeight,{minHeight:(0,V.default)(dr)?"calc("+dr+" + "+rt+"px)":dr+rt,maxHeight:(0,V.default)(ht)?"calc("+ht+" + "+rt+"px)":ht+rt}),Vt&&kt&&!Lr&&{minHeight:dr,maxHeight:ht},kt&&!Lr&&le.viewStyleUniversalInitial),Ur={transition:"opacity "+et+"ms",opacity:0},ni=n({},le.trackHorizontalStyleDefault,or&&Ur,(!rt||kt&&!Lr)&&{display:"none"}),ii=n({},le.trackVerticalStyleDefault,or&&Ur,(!rt||kt&&!Lr)&&{display:"none"});return(0,P.createElement)(qt,n({},$r,{style:xn,ref:function(Wt){Re.container=Wt}}),[(0,P.cloneElement)(at({style:$n}),{key:"view",ref:function(Wt){Re.view=Wt}},ar),(0,P.cloneElement)(Ve({style:ni}),{key:"trackHorizontal",ref:function(Wt){Re.trackHorizontal=Wt}},(0,P.cloneElement)(Bt({style:le.thumbHorizontalStyleDefault}),{ref:function(Wt){Re.thumbHorizontal=Wt}})),(0,P.cloneElement)(Dt({style:ii}),{key:"trackVertical",ref:function(Wt){Re.trackVertical=Wt}},(0,P.cloneElement)(Gt({style:le.thumbVerticalStyleDefault}),{ref:function(Wt){Re.thumbVertical=Wt}}))])}}]),Be}(P.Component);a.default=Ie,Ie.propTypes={onScroll:R.default.func,onScrollFrame:R.default.func,onScrollStart:R.default.func,onScrollStop:R.default.func,onUpdate:R.default.func,renderView:R.default.func,renderTrackHorizontal:R.default.func,renderTrackVertical:R.default.func,renderThumbHorizontal:R.default.func,renderThumbVertical:R.default.func,tagName:R.default.string,thumbSize:R.default.number,thumbMinSize:R.default.number,hideTracksWhenNotNeeded:R.default.bool,autoHide:R.default.bool,autoHideTimeout:R.default.number,autoHideDuration:R.default.number,autoHeight:R.default.bool,autoHeightMin:R.default.oneOfType([R.default.number,R.default.string]),autoHeightMax:R.default.oneOfType([R.default.number,R.default.string]),universal:R.default.bool,style:R.default.object,children:R.default.node},Ie.defaultProps={renderView:ye.renderViewDefault,renderTrackHorizontal:ye.renderTrackHorizontalDefault,renderTrackVertical:ye.renderTrackVerticalDefault,renderThumbHorizontal:ye.renderThumbHorizontalDefault,renderThumbVertical:ye.renderThumbVerticalDefault,tagName:"div",thumbMinSize:30,hideTracksWhenNotNeeded:!1,autoHide:!1,autoHideTimeout:1e3,autoHideDuration:200,autoHeight:!1,autoHeightMin:0,autoHeightMax:200,universal:!1}})(Lk);(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.Scrollbars=void 0;var n=Lk,h=m(n);function m(y){return y&&y.__esModule?y:{default:y}}a.default=h.default,a.Scrollbars=h.default})(kk);var SP=Object.prototype.toString,qk=function(n){var h=SP.call(n),m=h==="[object Arguments]";return m||(m=h!=="[object Array]"&&n!==null&&typeof n=="object"&&typeof n.length=="number"&&n.length>=0&&SP.call(n.callee)==="[object Function]"),m},Bw,EP;function hV(){if(EP)return Bw;EP=1;var a;if(!Object.keys){var n=Object.prototype.hasOwnProperty,h=Object.prototype.toString,m=qk,y=Object.prototype.propertyIsEnumerable,b=!y.call({toString:null},"toString"),M=y.call(function(){},"prototype"),P=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=function(Z){var te=Z.constructor;return te&&te.prototype===Z},R={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},U=function(){if(typeof window>"u")return!1;for(var Z in window)try{if(!R["$"+Z]&&n.call(window,Z)&&window[Z]!==null&&typeof window[Z]=="object")try{o(window[Z])}catch{return!0}}catch{return!0}return!1}(),V=function(Z){if(typeof window>"u"||!U)return o(Z);try{return o(Z)}catch{return!1}};a=function(te){var se=te!==null&&typeof te=="object",re=h.call(te)==="[object Function]",Te=m(te),ae=se&&h.call(te)==="[object String]",q=[];if(!se&&!re&&!Te)throw new TypeError("Object.keys called on a non-object");var Q=M&&re;if(ae&&te.length>0&&!n.call(te,0))for(var le=0;le<te.length;++le)q.push(String(le));if(Te&&te.length>0)for(var ye=0;ye<te.length;++ye)q.push(String(ye));else for(var ze in te)!(Q&&ze==="prototype")&&n.call(te,ze)&&q.push(String(ze));if(b)for(var He=V(te),Ne=0;Ne<P.length;++Ne)!(He&&P[Ne]==="constructor")&&n.call(te,P[Ne])&&q.push(P[Ne]);return q}}return Bw=a,Bw}var fV=Array.prototype.slice,dV=qk,MP=Object.keys,Av=MP?function(n){return MP(n)}:hV(),IP=Object.keys;Av.shim=function(){if(Object.keys){var n=function(){var h=Object.keys(arguments);return h&&h.length===arguments.length}(1,2);n||(Object.keys=function(m){return dV(m)?IP(fV.call(m)):IP(m)})}else Object.keys=Av;return Object.keys||Av};var VE=Av,pV=Error,mV=EvalError,_V=RangeError,gV=ReferenceError,Hk=SyntaxError,sh=TypeError,yV=URIError,r1=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var n={},h=Symbol("test"),m=Object(h);if(typeof h=="string"||Object.prototype.toString.call(h)!=="[object Symbol]"||Object.prototype.toString.call(m)!=="[object Symbol]")return!1;var y=42;n[h]=y;for(h in n)return!1;if(typeof Object.keys=="function"&&Object.keys(n).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(n).length!==0)return!1;var b=Object.getOwnPropertySymbols(n);if(b.length!==1||b[0]!==h||!Object.prototype.propertyIsEnumerable.call(n,h))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var M=Object.getOwnPropertyDescriptor(n,h);if(M.value!==y||M.enumerable!==!0)return!1}return!0},AP=typeof Symbol<"u"&&Symbol,vV=r1,$E=function(){return typeof AP!="function"||typeof Symbol!="function"||typeof AP("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:vV()},Nw={__proto__:null,foo:{}},xV=Object,bV=function(){return{__proto__:Nw}.foo===Nw.foo&&!(Nw instanceof xV)},wV="Function.prototype.bind called on incompatible ",TV=Object.prototype.toString,SV=Math.max,EV="[object Function]",CP=function(n,h){for(var m=[],y=0;y<n.length;y+=1)m[y]=n[y];for(var b=0;b<h.length;b+=1)m[b+n.length]=h[b];return m},MV=function(n,h){for(var m=[],y=h,b=0;y<n.length;y+=1,b+=1)m[b]=n[y];return m},IV=function(a,n){for(var h="",m=0;m<a.length;m+=1)h+=a[m],m+1<a.length&&(h+=n);return h},AV=function(n){var h=this;if(typeof h!="function"||TV.apply(h)!==EV)throw new TypeError(wV+h);for(var m=MV(arguments,1),y,b=function(){if(this instanceof y){var U=h.apply(this,CP(m,arguments));return Object(U)===U?U:this}return h.apply(n,CP(m,arguments))},M=SV(0,h.length-m.length),P=[],o=0;o<M;o++)P[o]="$"+o;if(y=Function("binder","return function ("+IV(P,",")+"){ return binder.apply(this,arguments); }")(b),h.prototype){var R=function(){};R.prototype=h.prototype,y.prototype=new R,R.prototype=null}return y},CV=AV,GE=Function.prototype.bind||CV,PV=Function.prototype.call,OV=Object.prototype.hasOwnProperty,DV=GE,Zk=DV.call(PV,OV),cn,RV=pV,kV=mV,LV=_V,zV=gV,Ep=Hk,dp=sh,FV=yV,Xk=Function,Uw=function(a){try{return Xk('"use strict"; return ('+a+").constructor;")()}catch{}},mf=Object.getOwnPropertyDescriptor;if(mf)try{mf({},"")}catch{mf=null}var jw=function(){throw new dp},BV=mf?function(){try{return arguments.callee,jw}catch{try{return mf(arguments,"callee").get}catch{return jw}}}():jw,Ud=$E(),NV=bV(),ro=Object.getPrototypeOf||(NV?function(a){return a.__proto__}:null),$d={},UV=typeof Uint8Array>"u"||!ro?cn:ro(Uint8Array),_f={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?cn:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?cn:ArrayBuffer,"%ArrayIteratorPrototype%":Ud&&ro?ro([][Symbol.iterator]()):cn,"%AsyncFromSyncIteratorPrototype%":cn,"%AsyncFunction%":$d,"%AsyncGenerator%":$d,"%AsyncGeneratorFunction%":$d,"%AsyncIteratorPrototype%":$d,"%Atomics%":typeof Atomics>"u"?cn:Atomics,"%BigInt%":typeof BigInt>"u"?cn:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?cn:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?cn:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?cn:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":RV,"%eval%":eval,"%EvalError%":kV,"%Float32Array%":typeof Float32Array>"u"?cn:Float32Array,"%Float64Array%":typeof Float64Array>"u"?cn:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?cn:FinalizationRegistry,"%Function%":Xk,"%GeneratorFunction%":$d,"%Int8Array%":typeof Int8Array>"u"?cn:Int8Array,"%Int16Array%":typeof Int16Array>"u"?cn:Int16Array,"%Int32Array%":typeof Int32Array>"u"?cn:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Ud&&ro?ro(ro([][Symbol.iterator]())):cn,"%JSON%":typeof JSON=="object"?JSON:cn,"%Map%":typeof Map>"u"?cn:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Ud||!ro?cn:ro(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?cn:Promise,"%Proxy%":typeof Proxy>"u"?cn:Proxy,"%RangeError%":LV,"%ReferenceError%":zV,"%Reflect%":typeof Reflect>"u"?cn:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?cn:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Ud||!ro?cn:ro(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?cn:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Ud&&ro?ro(""[Symbol.iterator]()):cn,"%Symbol%":Ud?Symbol:cn,"%SyntaxError%":Ep,"%ThrowTypeError%":BV,"%TypedArray%":UV,"%TypeError%":dp,"%Uint8Array%":typeof Uint8Array>"u"?cn:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?cn:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?cn:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?cn:Uint32Array,"%URIError%":FV,"%WeakMap%":typeof WeakMap>"u"?cn:WeakMap,"%WeakRef%":typeof WeakRef>"u"?cn:WeakRef,"%WeakSet%":typeof WeakSet>"u"?cn:WeakSet};if(ro)try{null.error}catch(a){var jV=ro(ro(a));_f["%Error.prototype%"]=jV}var VV=function a(n){var h;if(n==="%AsyncFunction%")h=Uw("async function () {}");else if(n==="%GeneratorFunction%")h=Uw("function* () {}");else if(n==="%AsyncGeneratorFunction%")h=Uw("async function* () {}");else if(n==="%AsyncGenerator%"){var m=a("%AsyncGeneratorFunction%");m&&(h=m.prototype)}else if(n==="%AsyncIteratorPrototype%"){var y=a("%AsyncGenerator%");y&&ro&&(h=ro(y.prototype))}return _f[n]=h,h},PP={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},$g=GE,dx=Zk,$V=$g.call(Function.call,Array.prototype.concat),GV=$g.call(Function.apply,Array.prototype.splice),OP=$g.call(Function.call,String.prototype.replace),px=$g.call(Function.call,String.prototype.slice),WV=$g.call(Function.call,RegExp.prototype.exec),qV=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,HV=/\\(\\)?/g,ZV=function(n){var h=px(n,0,1),m=px(n,-1);if(h==="%"&&m!=="%")throw new Ep("invalid intrinsic syntax, expected closing `%`");if(m==="%"&&h!=="%")throw new Ep("invalid intrinsic syntax, expected opening `%`");var y=[];return OP(n,qV,function(b,M,P,o){y[y.length]=P?OP(o,HV,"$1"):M||b}),y},XV=function(n,h){var m=n,y;if(dx(PP,m)&&(y=PP[m],m="%"+y[0]+"%"),dx(_f,m)){var b=_f[m];if(b===$d&&(b=VV(m)),typeof b>"u"&&!h)throw new dp("intrinsic "+n+" exists, but is not available. Please file an issue!");return{alias:y,name:m,value:b}}throw new Ep("intrinsic "+n+" does not exist!")},Nl=function(n,h){if(typeof n!="string"||n.length===0)throw new dp("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof h!="boolean")throw new dp('"allowMissing" argument must be a boolean');if(WV(/^%?[^%]*%?$/,n)===null)throw new Ep("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var m=ZV(n),y=m.length>0?m[0]:"",b=XV("%"+y+"%",h),M=b.name,P=b.value,o=!1,R=b.alias;R&&(y=R[0],GV(m,$V([0,1],R)));for(var U=1,V=!0;U<m.length;U+=1){var Z=m[U],te=px(Z,0,1),se=px(Z,-1);if((te==='"'||te==="'"||te==="`"||se==='"'||se==="'"||se==="`")&&te!==se)throw new Ep("property names with quotes must have matching quotes");if((Z==="constructor"||!V)&&(o=!0),y+="."+Z,M="%"+y+"%",dx(_f,M))P=_f[M];else if(P!=null){if(!(Z in P)){if(!h)throw new dp("base intrinsic for "+n+" exists, but the property is not available.");return}if(mf&&U+1>=m.length){var re=mf(P,Z);V=!!re,V&&"get"in re&&!("originalValue"in re.get)?P=re.get:P=P[Z]}else V=dx(P,Z),P=P[Z];V&&!o&&(_f[M]=P)}}return P},YV=Nl,Cv=YV("%Object.defineProperty%",!0)||!1;if(Cv)try{Cv({},"a",{value:1})}catch{Cv=!1}var WE=Cv,KV=Nl,Pv=KV("%Object.getOwnPropertyDescriptor%",!0);if(Pv)try{Pv([],"length")}catch{Pv=null}var qE=Pv,DP=WE,QV=Hk,jd=sh,RP=qE,HE=function(n,h,m){if(!n||typeof n!="object"&&typeof n!="function")throw new jd("`obj` must be an object or a function`");if(typeof h!="string"&&typeof h!="symbol")throw new jd("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new jd("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new jd("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new jd("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new jd("`loose`, if provided, must be a boolean");var y=arguments.length>3?arguments[3]:null,b=arguments.length>4?arguments[4]:null,M=arguments.length>5?arguments[5]:null,P=arguments.length>6?arguments[6]:!1,o=!!RP&&RP(n,h);if(DP)DP(n,h,{configurable:M===null&&o?o.configurable:!M,enumerable:y===null&&o?o.enumerable:!y,value:m,writable:b===null&&o?o.writable:!b});else if(P||!y&&!b&&!M)n[h]=m;else throw new QV("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},aS=WE,Yk=function(){return!!aS};Yk.hasArrayLengthDefineBug=function(){if(!aS)return null;try{return aS([],"length",{value:1}).length!==1}catch{return!0}};var ZE=Yk,JV=VE,e8=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",t8=Object.prototype.toString,r8=Array.prototype.concat,kP=HE,n8=function(a){return typeof a=="function"&&t8.call(a)==="[object Function]"},Kk=ZE(),i8=function(a,n,h,m){if(n in a){if(m===!0){if(a[n]===h)return}else if(!n8(m)||!m())return}Kk?kP(a,n,h,!0):kP(a,n,h)},Qk=function(a,n){var h=arguments.length>2?arguments[2]:{},m=JV(n);e8&&(m=r8.call(m,Object.getOwnPropertySymbols(n)));for(var y=0;y<m.length;y+=1)i8(a,m[y],n[m[y]],h[m[y]])};Qk.supportsDescriptors=!!Kk;var Of=Qk,Jk={exports:{}},o8=Nl,LP=HE,s8=ZE(),zP=qE,FP=sh,a8=o8("%Math.floor%"),l8=function(n,h){if(typeof n!="function")throw new FP("`fn` is not a function");if(typeof h!="number"||h<0||h>4294967295||a8(h)!==h)throw new FP("`length` must be a positive 32-bit integer");var m=arguments.length>2&&!!arguments[2],y=!0,b=!0;if("length"in n&&zP){var M=zP(n,"length");M&&!M.configurable&&(y=!1),M&&!M.writable&&(b=!1)}return(y||b||!m)&&(s8?LP(n,"length",h,!0,!0):LP(n,"length",h)),n};(function(a){var n=GE,h=Nl,m=l8,y=sh,b=h("%Function.prototype.apply%"),M=h("%Function.prototype.call%"),P=h("%Reflect.apply%",!0)||n.call(M,b),o=WE,R=h("%Math.max%");a.exports=function(Z){if(typeof Z!="function")throw new y("a function is required");var te=P(n,M,arguments);return m(te,1+R(0,Z.length-(arguments.length-1)),!0)};var U=function(){return P(n,b,arguments)};o?o(a.exports,"apply",{value:U}):a.exports.apply=U})(Jk);var Np=Jk.exports,eL=Nl,tL=Np,u8=tL(eL("String.prototype.indexOf")),Oa=function(n,h){var m=eL(n,!!h);return typeof m=="function"&&u8(n,".prototype.")>-1?tL(m):m},c8=VE,rL=r1(),nL=Oa,BP=Object,h8=nL("Array.prototype.push"),NP=nL("Object.prototype.propertyIsEnumerable"),f8=rL?Object.getOwnPropertySymbols:null,iL=function(n,h){if(n==null)throw new TypeError("target must be an object");var m=BP(n);if(arguments.length===1)return m;for(var y=1;y<arguments.length;++y){var b=BP(arguments[y]),M=c8(b),P=rL&&(Object.getOwnPropertySymbols||f8);if(P)for(var o=P(b),R=0;R<o.length;++R){var U=o[R];NP(b,U)&&h8(M,U)}for(var V=0;V<M.length;++V){var Z=M[V];if(NP(b,Z)){var te=b[Z];m[Z]=te}}}return m},Vw=iL,d8=function(){if(!Object.assign)return!1;for(var a="abcdefghijklmnopqrst",n=a.split(""),h={},m=0;m<n.length;++m)h[n[m]]=n[m];var y=Object.assign({},h),b="";for(var M in y)b+=M;return a!==b},p8=function(){if(!Object.assign||!Object.preventExtensions)return!1;var a=Object.preventExtensions({1:2});try{Object.assign(a,"xy")}catch{return a[1]==="y"}return!1},oL=function(){return!Object.assign||d8()||p8()?Vw:Object.assign},m8=Of,_8=oL,g8=function(){var n=_8();return m8(Object,{assign:n},{assign:function(){return Object.assign!==n}}),n},y8=Of,v8=Np,x8=iL,sL=oL,b8=g8,w8=v8.apply(sL()),aL=function(n,h){return w8(Object,arguments)};y8(aL,{getPolyfill:sL,implementation:x8,shim:b8});var T8=aL,Ig=function(){return typeof(function(){}).name=="string"},tg=Object.getOwnPropertyDescriptor;if(tg)try{tg([],"length")}catch{tg=null}Ig.functionsHaveConfigurableNames=function(){if(!Ig()||!tg)return!1;var n=tg(function(){},"name");return!!n&&!!n.configurable};var S8=Function.prototype.bind;Ig.boundFunctionsHaveNames=function(){return Ig()&&typeof S8=="function"&&(function(){}).bind().name!==""};var E8=Ig,UP=HE,M8=ZE(),I8=E8.functionsHaveConfigurableNames(),A8=sh,C8=function(n,h){if(typeof n!="function")throw new A8("`fn` is not a function");var m=arguments.length>2&&!!arguments[2];return(!m||I8)&&(M8?UP(n,"name",h,!0,!0):UP(n,"name",h)),n},P8=C8,O8=sh,D8=Object,lL=P8(function(){if(this==null||this!==D8(this))throw new O8("RegExp.prototype.flags getter called on non-object");var n="";return this.hasIndices&&(n+="d"),this.global&&(n+="g"),this.ignoreCase&&(n+="i"),this.multiline&&(n+="m"),this.dotAll&&(n+="s"),this.unicode&&(n+="u"),this.unicodeSets&&(n+="v"),this.sticky&&(n+="y"),n},"get flags",!0),R8=lL,k8=Of.supportsDescriptors,L8=Object.getOwnPropertyDescriptor,uL=function(){if(k8&&/a/mig.flags==="gim"){var n=L8(RegExp.prototype,"flags");if(n&&typeof n.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var h="",m={};if(Object.defineProperty(m,"hasIndices",{get:function(){h+="d"}}),Object.defineProperty(m,"sticky",{get:function(){h+="y"}}),h==="dy")return n.get}}return R8},z8=Of.supportsDescriptors,F8=uL,B8=Object.getOwnPropertyDescriptor,N8=Object.defineProperty,U8=TypeError,jP=Object.getPrototypeOf,j8=/a/,V8=function(){if(!z8||!jP)throw new U8("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var n=F8(),h=jP(j8),m=B8(h,"flags");return(!m||m.get!==n)&&N8(h,"flags",{configurable:!0,enumerable:!1,get:n}),n},$8=Of,G8=Np,W8=lL,cL=uL,q8=V8,hL=G8(cL());$8(hL,{getPolyfill:cL,implementation:W8,shim:q8});var H8=hL,Ov={exports:{}},Z8=r1,Df=function(){return Z8()&&!!Symbol.toStringTag},X8=Df(),Y8=Oa,lS=Y8("Object.prototype.toString"),n1=function(n){return X8&&n&&typeof n=="object"&&Symbol.toStringTag in n?!1:lS(n)==="[object Arguments]"},fL=function(n){return n1(n)?!0:n!==null&&typeof n=="object"&&typeof n.length=="number"&&n.length>=0&&lS(n)!=="[object Array]"&&lS(n.callee)==="[object Function]"},K8=function(){return n1(arguments)}();n1.isLegacyArguments=fL;var dL=K8?n1:fL;const Q8={},J8=Object.freeze(Object.defineProperty({__proto__:null,default:Q8},Symbol.toStringTag,{value:"Module"})),e$=J5(J8);var XE=typeof Map=="function"&&Map.prototype,$w=Object.getOwnPropertyDescriptor&&XE?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,mx=XE&&$w&&typeof $w.get=="function"?$w.get:null,VP=XE&&Map.prototype.forEach,YE=typeof Set=="function"&&Set.prototype,Gw=Object.getOwnPropertyDescriptor&&YE?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,_x=YE&&Gw&&typeof Gw.get=="function"?Gw.get:null,$P=YE&&Set.prototype.forEach,t$=typeof WeakMap=="function"&&WeakMap.prototype,rg=t$?WeakMap.prototype.has:null,r$=typeof WeakSet=="function"&&WeakSet.prototype,ng=r$?WeakSet.prototype.has:null,n$=typeof WeakRef=="function"&&WeakRef.prototype,GP=n$?WeakRef.prototype.deref:null,i$=Boolean.prototype.valueOf,o$=Object.prototype.toString,s$=Function.prototype.toString,a$=String.prototype.match,KE=String.prototype.slice,Bc=String.prototype.replace,l$=String.prototype.toUpperCase,WP=String.prototype.toLowerCase,pL=RegExp.prototype.test,qP=Array.prototype.concat,Ol=Array.prototype.join,u$=Array.prototype.slice,HP=Math.floor,uS=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Ww=Object.getOwnPropertySymbols,cS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Mp=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Fo=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Mp||!0)?Symbol.toStringTag:null,mL=Object.prototype.propertyIsEnumerable,ZP=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(a){return a.__proto__}:null);function XP(a,n){if(a===1/0||a===-1/0||a!==a||a&&a>-1e3&&a<1e3||pL.call(/e/,n))return n;var h=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof a=="number"){var m=a<0?-HP(-a):HP(a);if(m!==a){var y=String(m),b=KE.call(n,y.length+1);return Bc.call(y,h,"$&_")+"."+Bc.call(Bc.call(b,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Bc.call(n,h,"$&_")}var hS=e$,YP=hS.custom,KP=gL(YP)?YP:null,c$=function a(n,h,m,y){var b=h||{};if(Dc(b,"quoteStyle")&&b.quoteStyle!=="single"&&b.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Dc(b,"maxStringLength")&&(typeof b.maxStringLength=="number"?b.maxStringLength<0&&b.maxStringLength!==1/0:b.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var M=Dc(b,"customInspect")?b.customInspect:!0;if(typeof M!="boolean"&&M!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Dc(b,"indent")&&b.indent!==null&&b.indent!=="	"&&!(parseInt(b.indent,10)===b.indent&&b.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Dc(b,"numericSeparator")&&typeof b.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var P=b.numericSeparator;if(typeof n>"u")return"undefined";if(n===null)return"null";if(typeof n=="boolean")return n?"true":"false";if(typeof n=="string")return vL(n,b);if(typeof n=="number"){if(n===0)return 1/0/n>0?"0":"-0";var o=String(n);return P?XP(n,o):o}if(typeof n=="bigint"){var R=String(n)+"n";return P?XP(n,R):R}var U=typeof b.depth>"u"?5:b.depth;if(typeof m>"u"&&(m=0),m>=U&&U>0&&typeof n=="object")return fS(n)?"[Array]":"[Object]";var V=A$(b,m);if(typeof y>"u")y=[];else if(yL(y,n)>=0)return"[Circular]";function Z(Be,Ce,Re){if(Ce&&(y=u$.call(y),y.push(Ce)),Re){var rt={depth:b.depth};return Dc(b,"quoteStyle")&&(rt.quoteStyle=b.quoteStyle),a(Be,rt,m+1,y)}return a(Be,b,m+1,y)}if(typeof n=="function"&&!QP(n)){var te=v$(n),se=cv(n,Z);return"[Function"+(te?": "+te:" (anonymous)")+"]"+(se.length>0?" { "+Ol.call(se,", ")+" }":"")}if(gL(n)){var re=Mp?Bc.call(String(n),/^(Symbol\(.*\))_[^)]*$/,"$1"):cS.call(n);return typeof n=="object"&&!Mp?R_(re):re}if(E$(n)){for(var Te="<"+WP.call(String(n.nodeName)),ae=n.attributes||[],q=0;q<ae.length;q++)Te+=" "+ae[q].name+"="+_L(h$(ae[q].value),"double",b);return Te+=">",n.childNodes&&n.childNodes.length&&(Te+="..."),Te+="</"+WP.call(String(n.nodeName))+">",Te}if(fS(n)){if(n.length===0)return"[]";var Q=cv(n,Z);return V&&!I$(Q)?"["+dS(Q,V)+"]":"[ "+Ol.call(Q,", ")+" ]"}if(d$(n)){var le=cv(n,Z);return!("cause"in Error.prototype)&&"cause"in n&&!mL.call(n,"cause")?"{ ["+String(n)+"] "+Ol.call(qP.call("[cause]: "+Z(n.cause),le),", ")+" }":le.length===0?"["+String(n)+"]":"{ ["+String(n)+"] "+Ol.call(le,", ")+" }"}if(typeof n=="object"&&M){if(KP&&typeof n[KP]=="function"&&hS)return hS(n,{depth:U-m});if(M!=="symbol"&&typeof n.inspect=="function")return n.inspect()}if(x$(n)){var ye=[];return VP&&VP.call(n,function(Be,Ce){ye.push(Z(Ce,n,!0)+" => "+Z(Be,n))}),JP("Map",mx.call(n),ye,V)}if(T$(n)){var ze=[];return $P&&$P.call(n,function(Be){ze.push(Z(Be,n))}),JP("Set",_x.call(n),ze,V)}if(b$(n))return qw("WeakMap");if(S$(n))return qw("WeakSet");if(w$(n))return qw("WeakRef");if(m$(n))return R_(Z(Number(n)));if(g$(n))return R_(Z(uS.call(n)));if(_$(n))return R_(i$.call(n));if(p$(n))return R_(Z(String(n)));if(typeof window<"u"&&n===window)return"{ [object Window] }";if(typeof globalThis<"u"&&n===globalThis||typeof Xo<"u"&&n===Xo)return"{ [object globalThis] }";if(!f$(n)&&!QP(n)){var He=cv(n,Z),Ne=ZP?ZP(n)===Object.prototype:n instanceof Object||n.constructor===Object,xe=n instanceof Object?"":"null prototype",Me=!Ne&&Fo&&Object(n)===n&&Fo in n?KE.call(ah(n),8,-1):xe?"Object":"",Ie=Ne||typeof n.constructor!="function"?"":n.constructor.name?n.constructor.name+" ":"",Je=Ie+(Me||xe?"["+Ol.call(qP.call([],Me||[],xe||[]),": ")+"] ":"");return He.length===0?Je+"{}":V?Je+"{"+dS(He,V)+"}":Je+"{ "+Ol.call(He,", ")+" }"}return String(n)};function _L(a,n,h){var m=(h.quoteStyle||n)==="double"?'"':"'";return m+a+m}function h$(a){return Bc.call(String(a),/"/g,"&quot;")}function fS(a){return ah(a)==="[object Array]"&&(!Fo||!(typeof a=="object"&&Fo in a))}function f$(a){return ah(a)==="[object Date]"&&(!Fo||!(typeof a=="object"&&Fo in a))}function QP(a){return ah(a)==="[object RegExp]"&&(!Fo||!(typeof a=="object"&&Fo in a))}function d$(a){return ah(a)==="[object Error]"&&(!Fo||!(typeof a=="object"&&Fo in a))}function p$(a){return ah(a)==="[object String]"&&(!Fo||!(typeof a=="object"&&Fo in a))}function m$(a){return ah(a)==="[object Number]"&&(!Fo||!(typeof a=="object"&&Fo in a))}function _$(a){return ah(a)==="[object Boolean]"&&(!Fo||!(typeof a=="object"&&Fo in a))}function gL(a){if(Mp)return a&&typeof a=="object"&&a instanceof Symbol;if(typeof a=="symbol")return!0;if(!a||typeof a!="object"||!cS)return!1;try{return cS.call(a),!0}catch{}return!1}function g$(a){if(!a||typeof a!="object"||!uS)return!1;try{return uS.call(a),!0}catch{}return!1}var y$=Object.prototype.hasOwnProperty||function(a){return a in this};function Dc(a,n){return y$.call(a,n)}function ah(a){return o$.call(a)}function v$(a){if(a.name)return a.name;var n=a$.call(s$.call(a),/^function\s*([\w$]+)/);return n?n[1]:null}function yL(a,n){if(a.indexOf)return a.indexOf(n);for(var h=0,m=a.length;h<m;h++)if(a[h]===n)return h;return-1}function x$(a){if(!mx||!a||typeof a!="object")return!1;try{mx.call(a);try{_x.call(a)}catch{return!0}return a instanceof Map}catch{}return!1}function b$(a){if(!rg||!a||typeof a!="object")return!1;try{rg.call(a,rg);try{ng.call(a,ng)}catch{return!0}return a instanceof WeakMap}catch{}return!1}function w$(a){if(!GP||!a||typeof a!="object")return!1;try{return GP.call(a),!0}catch{}return!1}function T$(a){if(!_x||!a||typeof a!="object")return!1;try{_x.call(a);try{mx.call(a)}catch{return!0}return a instanceof Set}catch{}return!1}function S$(a){if(!ng||!a||typeof a!="object")return!1;try{ng.call(a,ng);try{rg.call(a,rg)}catch{return!0}return a instanceof WeakSet}catch{}return!1}function E$(a){return!a||typeof a!="object"?!1:typeof HTMLElement<"u"&&a instanceof HTMLElement?!0:typeof a.nodeName=="string"&&typeof a.getAttribute=="function"}function vL(a,n){if(a.length>n.maxStringLength){var h=a.length-n.maxStringLength,m="... "+h+" more character"+(h>1?"s":"");return vL(KE.call(a,0,n.maxStringLength),n)+m}var y=Bc.call(Bc.call(a,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,M$);return _L(y,"single",n)}function M$(a){var n=a.charCodeAt(0),h={8:"b",9:"t",10:"n",12:"f",13:"r"}[n];return h?"\\"+h:"\\x"+(n<16?"0":"")+l$.call(n.toString(16))}function R_(a){return"Object("+a+")"}function qw(a){return a+" { ? }"}function JP(a,n,h,m){var y=m?dS(h,m):Ol.call(h,", ");return a+" ("+n+") {"+y+"}"}function I$(a){for(var n=0;n<a.length;n++)if(yL(a[n],`
`)>=0)return!1;return!0}function A$(a,n){var h;if(a.indent==="	")h="	";else if(typeof a.indent=="number"&&a.indent>0)h=Ol.call(Array(a.indent+1)," ");else return null;return{base:h,prev:Ol.call(Array(n+1),h)}}function dS(a,n){if(a.length===0)return"";var h=`
`+n.prev+n.base;return h+Ol.call(a,","+h)+`
`+n.prev}function cv(a,n){var h=fS(a),m=[];if(h){m.length=a.length;for(var y=0;y<a.length;y++)m[y]=Dc(a,y)?n(a[y],a):""}var b=typeof Ww=="function"?Ww(a):[],M;if(Mp){M={};for(var P=0;P<b.length;P++)M["$"+b[P]]=b[P]}for(var o in a)Dc(a,o)&&(h&&String(Number(o))===o&&o<a.length||Mp&&M["$"+o]instanceof Symbol||(pL.call(/[^\w$]/,o)?m.push(n(o,a)+": "+n(a[o],a)):m.push(o+": "+n(a[o],a))));if(typeof Ww=="function")for(var R=0;R<b.length;R++)mL.call(a,b[R])&&m.push("["+n(b[R])+"]: "+n(a[b[R]],a));return m}var xL=Nl,Up=Oa,C$=c$,P$=sh,hv=xL("%WeakMap%",!0),fv=xL("%Map%",!0),O$=Up("WeakMap.prototype.get",!0),D$=Up("WeakMap.prototype.set",!0),R$=Up("WeakMap.prototype.has",!0),k$=Up("Map.prototype.get",!0),L$=Up("Map.prototype.set",!0),z$=Up("Map.prototype.has",!0),QE=function(a,n){for(var h=a,m;(m=h.next)!==null;h=m)if(m.key===n)return h.next=m.next,m.next=a.next,a.next=m,m},F$=function(a,n){var h=QE(a,n);return h&&h.value},B$=function(a,n,h){var m=QE(a,n);m?m.value=h:a.next={key:n,next:a.next,value:h}},N$=function(a,n){return!!QE(a,n)},bL=function(){var n,h,m,y={assert:function(b){if(!y.has(b))throw new P$("Side channel does not contain "+C$(b))},get:function(b){if(hv&&b&&(typeof b=="object"||typeof b=="function")){if(n)return O$(n,b)}else if(fv){if(h)return k$(h,b)}else if(m)return F$(m,b)},has:function(b){if(hv&&b&&(typeof b=="object"||typeof b=="function")){if(n)return R$(n,b)}else if(fv){if(h)return z$(h,b)}else if(m)return N$(m,b);return!1},set:function(b,M){hv&&b&&(typeof b=="object"||typeof b=="function")?(n||(n=new hv),D$(n,b,M)):fv?(h||(h=new fv),L$(h,b,M)):(m||(m={key:{},next:null}),B$(m,b,M))}};return y},U$=Zk,k_=bL(),bu=sh,JE={assert:function(a,n){if(!a||typeof a!="object"&&typeof a!="function")throw new bu("`O` is not an object");if(typeof n!="string")throw new bu("`slot` must be a string");if(k_.assert(a),!JE.has(a,n))throw new bu("`"+n+"` is not present on `O`")},get:function(a,n){if(!a||typeof a!="object"&&typeof a!="function")throw new bu("`O` is not an object");if(typeof n!="string")throw new bu("`slot` must be a string");var h=k_.get(a);return h&&h["$"+n]},has:function(a,n){if(!a||typeof a!="object"&&typeof a!="function")throw new bu("`O` is not an object");if(typeof n!="string")throw new bu("`slot` must be a string");var h=k_.get(a);return!!h&&U$(h,"$"+n)},set:function(a,n,h){if(!a||typeof a!="object"&&typeof a!="function")throw new bu("`O` is not an object");if(typeof n!="string")throw new bu("`slot` must be a string");var m=k_.get(a);m||(m={},k_.set(a,m)),m["$"+n]=h}};Object.freeze&&Object.freeze(JE);var j$=JE,L_=j$,V$=SyntaxError,eO=typeof StopIteration=="object"?StopIteration:null,$$=function(n){if(!eO)throw new V$("this environment lacks StopIteration");L_.set(n,"[[Done]]",!1);var h={next:function(){var y=L_.get(this,"[[Iterator]]"),b=L_.get(y,"[[Done]]");try{return{done:b,value:b?void 0:y.next()}}catch(M){if(L_.set(y,"[[Done]]",!0),M!==eO)throw M;return{done:!0,value:void 0}}}};return L_.set(h,"[[Iterator]]",n),h},G$={}.toString,wL=Array.isArray||function(a){return G$.call(a)=="[object Array]"},W$=String.prototype.valueOf,q$=function(n){try{return W$.call(n),!0}catch{return!1}},H$=Object.prototype.toString,Z$="[object String]",X$=Df(),TL=function(n){return typeof n=="string"?!0:typeof n!="object"?!1:X$?q$(n):H$.call(n)===Z$},eM=typeof Map=="function"&&Map.prototype?Map:null,Y$=typeof Set=="function"&&Set.prototype?Set:null,gx;eM||(gx=function(n){return!1});var SL=eM?Map.prototype.has:null,tO=Y$?Set.prototype.has:null;!gx&&!SL&&(gx=function(n){return!1});var EL=gx||function(n){if(!n||typeof n!="object")return!1;try{if(SL.call(n),tO)try{tO.call(n)}catch{return!0}return n instanceof eM}catch{}return!1},K$=typeof Map=="function"&&Map.prototype?Map:null,tM=typeof Set=="function"&&Set.prototype?Set:null,yx;tM||(yx=function(n){return!1});var rO=K$?Map.prototype.has:null,ML=tM?Set.prototype.has:null;!yx&&!ML&&(yx=function(n){return!1});var IL=yx||function(n){if(!n||typeof n!="object")return!1;try{if(ML.call(n),rO)try{rO.call(n)}catch{return!0}return n instanceof tM}catch{}return!1},nO=dL,iO=$$;if($E()||r1()){var Hw=Symbol.iterator;Ov.exports=function(n){if(n!=null&&typeof n[Hw]<"u")return n[Hw]();if(nO(n))return Array.prototype[Hw].call(n)}}else{var Q$=wL,J$=TL,oO=Nl,eG=oO("%Map%",!0),tG=oO("%Set%",!0),tl=Oa,sO=tl("Array.prototype.push"),aO=tl("String.prototype.charCodeAt"),rG=tl("String.prototype.slice"),nG=function(n,h){var m=n.length;if(h+1>=m)return h+1;var y=aO(n,h);if(y<55296||y>56319)return h+1;var b=aO(n,h+1);return b<56320||b>57343?h+1:h+2},Zw=function(n){var h=0;return{next:function(){var y=h>=n.length,b;return y||(b=n[h],h+=1),{done:y,value:b}}}},lO=function(n,h){if(Q$(n)||nO(n))return Zw(n);if(J$(n)){var m=0;return{next:function(){var b=nG(n,m),M=rG(n,m,b);return m=b,{done:b>n.length,value:M}}}}if(h&&typeof n["_es6-shim iterator_"]<"u")return n["_es6-shim iterator_"]()};if(!eG&&!tG)Ov.exports=function(n){if(n!=null)return lO(n,!0)};else{var iG=EL,oG=IL,uO=tl("Map.prototype.forEach",!0),cO=tl("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var hO=tl("Map.prototype.iterator",!0),fO=tl("Set.prototype.iterator",!0);var dO=tl("Map.prototype.@@iterator",!0)||tl("Map.prototype._es6-shim iterator_",!0),pO=tl("Set.prototype.@@iterator",!0)||tl("Set.prototype._es6-shim iterator_",!0),sG=function(n){if(iG(n)){if(hO)return iO(hO(n));if(dO)return dO(n);if(uO){var h=[];return uO(n,function(y,b){sO(h,[b,y])}),Zw(h)}}if(oG(n)){if(fO)return iO(fO(n));if(pO)return pO(n);if(cO){var m=[];return cO(n,function(y){sO(m,y)}),Zw(m)}}};Ov.exports=function(n){return sG(n)||lO(n)}}}var aG=Ov.exports,mO=function(a){return a!==a},AL=function(n,h){return n===0&&h===0?1/n===1/h:!!(n===h||mO(n)&&mO(h))},lG=AL,CL=function(){return typeof Object.is=="function"?Object.is:lG},uG=CL,cG=Of,hG=function(){var n=uG();return cG(Object,{is:n},{is:function(){return Object.is!==n}}),n},fG=Of,dG=Np,pG=AL,PL=CL,mG=hG,OL=dG(PL(),Object);fG(OL,{getPolyfill:PL,implementation:pG,shim:mG});var _G=OL,gG=Np,DL=Oa,yG=Nl,pS=yG("%ArrayBuffer%",!0),Dv=DL("ArrayBuffer.prototype.byteLength",!0),vG=DL("Object.prototype.toString"),_O=!!pS&&!Dv&&new pS(0).slice,gO=!!_O&&gG(_O),RL=Dv||gO?function(n){if(!n||typeof n!="object")return!1;try{return Dv?Dv(n):gO(n,0),!0}catch{return!1}}:pS?function(n){return vG(n)==="[object ArrayBuffer]"}:function(n){return!1},xG=Date.prototype.getDay,bG=function(n){try{return xG.call(n),!0}catch{return!1}},wG=Object.prototype.toString,TG="[object Date]",SG=Df(),EG=function(n){return typeof n!="object"||n===null?!1:SG?bG(n):wG.call(n)===TG},mS=Oa,kL=Df(),LL,zL,_S,gS;if(kL){LL=mS("Object.prototype.hasOwnProperty"),zL=mS("RegExp.prototype.exec"),_S={};var Xw=function(){throw _S};gS={toString:Xw,valueOf:Xw},typeof Symbol.toPrimitive=="symbol"&&(gS[Symbol.toPrimitive]=Xw)}var MG=mS("Object.prototype.toString"),IG=Object.getOwnPropertyDescriptor,AG="[object RegExp]",CG=kL?function(n){if(!n||typeof n!="object")return!1;var h=IG(n,"lastIndex"),m=h&&LL(h,"value");if(!m)return!1;try{zL(n,gS)}catch(y){return y===_S}}:function(n){return!n||typeof n!="object"&&typeof n!="function"?!1:MG(n)===AG},PG=Oa,yO=PG("SharedArrayBuffer.prototype.byteLength",!0),OG=yO?function(n){if(!n||typeof n!="object")return!1;try{return yO(n),!0}catch{return!1}}:function(n){return!1},DG=Number.prototype.toString,RG=function(n){try{return DG.call(n),!0}catch{return!1}},kG=Object.prototype.toString,LG="[object Number]",zG=Df(),FG=function(n){return typeof n=="number"?!0:typeof n!="object"?!1:zG?RG(n):kG.call(n)===LG},FL=Oa,BG=FL("Boolean.prototype.toString"),NG=FL("Object.prototype.toString"),UG=function(n){try{return BG(n),!0}catch{return!1}},jG="[object Boolean]",VG=Df(),$G=function(n){return typeof n=="boolean"?!0:n===null||typeof n!="object"?!1:VG&&Symbol.toStringTag in n?UG(n):NG(n)===jG},yS={exports:{}},GG=Object.prototype.toString,WG=$E();if(WG){var qG=Symbol.prototype.toString,HG=/^Symbol\(.*\)$/,ZG=function(n){return typeof n.valueOf()!="symbol"?!1:HG.test(qG.call(n))};yS.exports=function(n){if(typeof n=="symbol")return!0;if(GG.call(n)!=="[object Symbol]")return!1;try{return ZG(n)}catch{return!1}}}else yS.exports=function(n){return!1};var XG=yS.exports,vS={exports:{}},vO=typeof BigInt<"u"&&BigInt,YG=function(){return typeof vO=="function"&&typeof BigInt=="function"&&typeof vO(42)=="bigint"&&typeof BigInt(42)=="bigint"},KG=YG();if(KG){var QG=BigInt.prototype.valueOf,JG=function(n){try{return QG.call(n),!0}catch{}return!1};vS.exports=function(n){return n===null||typeof n>"u"||typeof n=="boolean"||typeof n=="string"||typeof n=="number"||typeof n=="symbol"||typeof n=="function"?!1:typeof n=="bigint"?!0:JG(n)}}else vS.exports=function(n){return!1};var eW=vS.exports,tW=TL,rW=FG,nW=$G,iW=XG,oW=eW,sW=function(n){if(n==null||typeof n!="object"&&typeof n!="function")return null;if(tW(n))return"String";if(rW(n))return"Number";if(nW(n))return"Boolean";if(iW(n))return"Symbol";if(oW(n))return"BigInt"},vx=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,xO=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,xx;vx||(xx=function(n){return!1});var xS=vx?vx.prototype.has:null,Yw=xO?xO.prototype.has:null;!xx&&!xS&&(xx=function(n){return!1});var aW=xx||function(n){if(!n||typeof n!="object")return!1;try{if(xS.call(n,xS),Yw)try{Yw.call(n,Yw)}catch{return!0}return n instanceof vx}catch{}return!1},bS={exports:{}},lW=Nl,BL=Oa,uW=lW("%WeakSet%",!0),Kw=BL("WeakSet.prototype.has",!0);if(Kw){var Qw=BL("WeakMap.prototype.has",!0);bS.exports=function(n){if(!n||typeof n!="object")return!1;try{if(Kw(n,Kw),Qw)try{Qw(n,Qw)}catch{return!0}return n instanceof uW}catch{}return!1}}else bS.exports=function(n){return!1};var cW=bS.exports,hW=EL,fW=IL,dW=aW,pW=cW,mW=function(n){if(n&&typeof n=="object"){if(hW(n))return"Map";if(fW(n))return"Set";if(dW(n))return"WeakMap";if(pW(n))return"WeakSet"}return!1},NL=Function.prototype.toString,rp=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,wS,Rv;if(typeof rp=="function"&&typeof Object.defineProperty=="function")try{wS=Object.defineProperty({},"length",{get:function(){throw Rv}}),Rv={},rp(function(){throw 42},null,wS)}catch(a){a!==Rv&&(rp=null)}else rp=null;var _W=/^\s*class\b/,TS=function(n){try{var h=NL.call(n);return _W.test(h)}catch{return!1}},Jw=function(n){try{return TS(n)?!1:(NL.call(n),!0)}catch{return!1}},kv=Object.prototype.toString,gW="[object Object]",yW="[object Function]",vW="[object GeneratorFunction]",xW="[object HTMLAllCollection]",bW="[object HTML document.all class]",wW="[object HTMLCollection]",TW=typeof Symbol=="function"&&!!Symbol.toStringTag,SW=!(0 in[,]),SS=function(){return!1};if(typeof document=="object"){var EW=document.all;kv.call(EW)===kv.call(document.all)&&(SS=function(n){if((SW||!n)&&(typeof n>"u"||typeof n=="object"))try{var h=kv.call(n);return(h===xW||h===bW||h===wW||h===gW)&&n("")==null}catch{}return!1})}var MW=rp?function(n){if(SS(n))return!0;if(!n||typeof n!="function"&&typeof n!="object")return!1;try{rp(n,null,wS)}catch(h){if(h!==Rv)return!1}return!TS(n)&&Jw(n)}:function(n){if(SS(n))return!0;if(!n||typeof n!="function"&&typeof n!="object")return!1;if(TW)return Jw(n);if(TS(n))return!1;var h=kv.call(n);return h!==yW&&h!==vW&&!/^\[object HTML/.test(h)?!1:Jw(n)},IW=MW,AW=Object.prototype.toString,UL=Object.prototype.hasOwnProperty,CW=function(n,h,m){for(var y=0,b=n.length;y<b;y++)UL.call(n,y)&&(m==null?h(n[y],y,n):h.call(m,n[y],y,n))},PW=function(n,h,m){for(var y=0,b=n.length;y<b;y++)m==null?h(n.charAt(y),y,n):h.call(m,n.charAt(y),y,n)},OW=function(n,h,m){for(var y in n)UL.call(n,y)&&(m==null?h(n[y],y,n):h.call(m,n[y],y,n))},DW=function(n,h,m){if(!IW(h))throw new TypeError("iterator must be a function");var y;arguments.length>=3&&(y=m),AW.call(n)==="[object Array]"?CW(n,h,y):typeof n=="string"?PW(n,h,y):OW(n,h,y)},RW=DW,kW=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],eT=kW,LW=typeof globalThis>"u"?Xo:globalThis,zW=function(){for(var n=[],h=0;h<eT.length;h++)typeof LW[eT[h]]=="function"&&(n[n.length]=eT[h]);return n},bx=RW,FW=zW,bO=Np,rM=Oa,Lv=qE,BW=rM("Object.prototype.toString"),jL=Df(),wO=typeof globalThis>"u"?Xo:globalThis,ES=FW(),nM=rM("String.prototype.slice"),tT=Object.getPrototypeOf,NW=rM("Array.prototype.indexOf",!0)||function(n,h){for(var m=0;m<n.length;m+=1)if(n[m]===h)return m;return-1},wx={__proto__:null};jL&&Lv&&tT?bx(ES,function(a){var n=new wO[a];if(Symbol.toStringTag in n){var h=tT(n),m=Lv(h,Symbol.toStringTag);if(!m){var y=tT(h);m=Lv(y,Symbol.toStringTag)}wx["$"+a]=bO(m.get)}}):bx(ES,function(a){var n=new wO[a],h=n.slice||n.set;h&&(wx["$"+a]=bO(h))});var UW=function(n){var h=!1;return bx(wx,function(m,y){if(!h)try{"$"+m(n)===y&&(h=nM(y,1))}catch{}}),h},jW=function(n){var h=!1;return bx(wx,function(m,y){if(!h)try{m(n),h=nM(y,1)}catch{}}),h},VW=function(n){if(!n||typeof n!="object")return!1;if(!jL){var h=nM(BW(n),8,-1);return NW(ES,h)>-1?h:h!=="Object"?!1:jW(n)}return Lv?UW(n):null},$W=Oa,TO=$W("ArrayBuffer.prototype.byteLength",!0),GW=RL,WW=function(n){return GW(n)?TO?TO(n):n.byteLength:NaN},VL=T8,Ul=Oa,SO=H8,qW=Nl,Ip=aG,HW=bL,EO=_G,MO=dL,IO=wL,AO=RL,CO=EG,PO=CG,OO=OG,DO=VE,RO=sW,kO=mW,LO=VW,zO=WW,FO=Ul("SharedArrayBuffer.prototype.byteLength",!0),BO=Ul("Date.prototype.getTime"),rT=Object.getPrototypeOf,NO=Ul("Object.prototype.toString"),Tx=qW("%Set%",!0),MS=Ul("Map.prototype.has",!0),Sx=Ul("Map.prototype.get",!0),UO=Ul("Map.prototype.size",!0),Ex=Ul("Set.prototype.add",!0),$L=Ul("Set.prototype.delete",!0),Mx=Ul("Set.prototype.has",!0),zv=Ul("Set.prototype.size",!0);function jO(a,n,h,m){for(var y=Ip(a),b;(b=y.next())&&!b.done;)if(ul(n,b.value,h,m))return $L(a,b.value),!0;return!1}function GL(a){if(typeof a>"u")return null;if(typeof a!="object")return typeof a=="symbol"?!1:typeof a=="string"||typeof a=="number"?+a==+a:!0}function ZW(a,n,h,m,y,b){var M=GL(h);if(M!=null)return M;var P=Sx(n,M),o=VL({},y,{strict:!1});return typeof P>"u"&&!MS(n,M)||!ul(m,P,o,b)?!1:!MS(a,M)&&ul(m,P,o,b)}function XW(a,n,h){var m=GL(h);return m??(Mx(n,m)&&!Mx(a,m))}function VO(a,n,h,m,y,b){for(var M=Ip(a),P,o;(P=M.next())&&!P.done;)if(o=P.value,ul(h,o,y,b)&&ul(m,Sx(n,o),y,b))return $L(a,o),!0;return!1}function ul(a,n,h,m){var y=h||{};if(y.strict?EO(a,n):a===n)return!0;var b=RO(a),M=RO(n);if(b!==M)return!1;if(!a||!n||typeof a!="object"&&typeof n!="object")return y.strict?EO(a,n):a==n;var P=m.has(a),o=m.has(n),R;if(P&&o){if(m.get(a)===m.get(n))return!0}else R={};return P||m.set(a,R),o||m.set(n,R),QW(a,n,y,m)}function $O(a){return!a||typeof a!="object"||typeof a.length!="number"||typeof a.copy!="function"||typeof a.slice!="function"||a.length>0&&typeof a[0]!="number"?!1:!!(a.constructor&&a.constructor.isBuffer&&a.constructor.isBuffer(a))}function YW(a,n,h,m){if(zv(a)!==zv(n))return!1;for(var y=Ip(a),b=Ip(n),M,P,o;(M=y.next())&&!M.done;)if(M.value&&typeof M.value=="object")o||(o=new Tx),Ex(o,M.value);else if(!Mx(n,M.value)){if(h.strict||!XW(a,n,M.value))return!1;o||(o=new Tx),Ex(o,M.value)}if(o){for(;(P=b.next())&&!P.done;)if(P.value&&typeof P.value=="object"){if(!jO(o,P.value,h.strict,m))return!1}else if(!h.strict&&!Mx(a,P.value)&&!jO(o,P.value,h.strict,m))return!1;return zv(o)===0}return!0}function KW(a,n,h,m){if(UO(a)!==UO(n))return!1;for(var y=Ip(a),b=Ip(n),M,P,o,R,U,V;(M=y.next())&&!M.done;)if(R=M.value[0],U=M.value[1],R&&typeof R=="object")o||(o=new Tx),Ex(o,R);else if(V=Sx(n,R),typeof V>"u"&&!MS(n,R)||!ul(U,V,h,m)){if(h.strict||!ZW(a,n,R,U,h,m))return!1;o||(o=new Tx),Ex(o,R)}if(o){for(;(P=b.next())&&!P.done;)if(R=P.value[0],V=P.value[1],R&&typeof R=="object"){if(!VO(o,a,R,V,h,m))return!1}else if(!h.strict&&(!a.has(R)||!ul(Sx(a,R),V,h,m))&&!VO(o,a,R,V,VL({},h,{strict:!1}),m))return!1;return zv(o)===0}return!0}function QW(a,n,h,m){var y,b;if(typeof a!=typeof n||a==null||n==null||NO(a)!==NO(n)||MO(a)!==MO(n))return!1;var M=IO(a),P=IO(n);if(M!==P)return!1;var o=a instanceof Error,R=n instanceof Error;if(o!==R||(o||R)&&(a.name!==n.name||a.message!==n.message))return!1;var U=PO(a),V=PO(n);if(U!==V||(U||V)&&(a.source!==n.source||SO(a)!==SO(n)))return!1;var Z=CO(a),te=CO(n);if(Z!==te||(Z||te)&&BO(a)!==BO(n)||h.strict&&rT&&rT(a)!==rT(n))return!1;var se=LO(a),re=LO(n);if(se!==re)return!1;if(se||re){if(a.length!==n.length)return!1;for(y=0;y<a.length;y++)if(a[y]!==n[y])return!1;return!0}var Te=$O(a),ae=$O(n);if(Te!==ae)return!1;if(Te||ae){if(a.length!==n.length)return!1;for(y=0;y<a.length;y++)if(a[y]!==n[y])return!1;return!0}var q=AO(a),Q=AO(n);if(q!==Q)return!1;if(q||Q)return zO(a)!==zO(n)?!1:typeof Uint8Array=="function"&&ul(new Uint8Array(a),new Uint8Array(n),h,m);var le=OO(a),ye=OO(n);if(le!==ye)return!1;if(le||ye)return FO(a)!==FO(n)?!1:typeof Uint8Array=="function"&&ul(new Uint8Array(a),new Uint8Array(n),h,m);if(typeof a!=typeof n)return!1;var ze=DO(a),He=DO(n);if(ze.length!==He.length)return!1;for(ze.sort(),He.sort(),y=ze.length-1;y>=0;y--)if(ze[y]!=He[y])return!1;for(y=ze.length-1;y>=0;y--)if(b=ze[y],!ul(a[b],n[b],h,m))return!1;var Ne=kO(a),xe=kO(n);return Ne!==xe?!1:Ne==="Set"||xe==="Set"?YW(a,n,h,m):Ne==="Map"?KW(a,n,h,m):!0}var JW=function(n,h,m){return ul(n,h,m,HW())};const eq=zg(JW);var tq=Object.defineProperty,On=(a,n)=>tq(a,"name",{value:n,configurable:!0}),rq=class{constructor(n){this.direction=!1,this.compareProperties=!0;var h,m,y;this.precision=10**-((h=n==null?void 0:n.precision)!=null?h:17),this.direction=(m=n==null?void 0:n.direction)!=null?m:!1,this.compareProperties=(y=n==null?void 0:n.compareProperties)!=null?y:!0}compare(n,h){if(n.type!==h.type||!V_(n,h))return!1;switch(n.type){case"Point":return this.compareCoord(n.coordinates,h.coordinates);case"LineString":return this.compareLine(n.coordinates,h.coordinates);case"Polygon":return this.comparePolygon(n,h);case"GeometryCollection":return this.compareGeometryCollection(n,h);case"Feature":return this.compareFeature(n,h);case"FeatureCollection":return this.compareFeatureCollection(n,h);default:if(n.type.startsWith("Multi")){const m=IS(n),y=IS(h);return m.every(b=>y.some(M=>this.compare(b,M)))}}return!1}compareCoord(n,h){return n.length===h.length&&n.every((m,y)=>Math.abs(m-h[y])<this.precision)}compareLine(n,h,m=0,y=!1){if(!V_(n,h))return!1;const b=n;let M=h;if(y&&!this.compareCoord(b[0],M[0])){const o=this.fixStartIndex(M,b);if(o)M=o;else return!1}const P=this.compareCoord(b[m],M[m]);return this.direction||P?this.comparePath(b,M):this.compareCoord(b[m],M[M.length-(1+m)])?this.comparePath(b.slice().reverse(),M):!1}fixStartIndex(n,h){let m,y=-1;for(let b=0;b<n.length;b++)if(this.compareCoord(n[b],h[0])){y=b;break}return y>=0&&(m=[].concat(n.slice(y,n.length),n.slice(1,y+1))),m}comparePath(n,h){return n.every((m,y)=>this.compareCoord(m,h[y]))}comparePolygon(n,h){if(this.compareLine(n.coordinates[0],h.coordinates[0],1,!0)){const m=n.coordinates.slice(1,n.coordinates.length),y=h.coordinates.slice(1,h.coordinates.length);return m.every(b=>y.some(M=>this.compareLine(b,M,1,!0)))}return!1}compareGeometryCollection(n,h){return V_(n.geometries,h.geometries)&&this.compareBBox(n,h)&&n.geometries.every((m,y)=>this.compare(m,h.geometries[y]))}compareFeature(n,h){return n.id===h.id&&(this.compareProperties?eq(n.properties,h.properties):!0)&&this.compareBBox(n,h)&&this.compare(n.geometry,h.geometry)}compareFeatureCollection(n,h){return V_(n.features,h.features)&&this.compareBBox(n,h)&&n.features.every((m,y)=>this.compare(m,h.features[y]))}compareBBox(n,h){return!n.bbox&&!h.bbox||(n.bbox&&h.bbox?this.compareCoord(n.bbox,h.bbox):!1)}};On(rq,"GeojsonEquality");function V_(a,n){return a.coordinates?a.coordinates.length===n.coordinates.length:a.length===n.length}On(V_,"sameLength");function IS(a){return a.coordinates.map(n=>({type:a.type.replace("Multi",""),coordinates:n}))}On(IS,"explode");var hs=63710088e-1,WL={centimeters:hs*100,centimetres:hs*100,degrees:360/(2*Math.PI),feet:hs*3.28084,inches:hs*39.37,kilometers:hs/1e3,kilometres:hs/1e3,meters:hs,metres:hs,miles:hs/1609.344,millimeters:hs*1e3,millimetres:hs*1e3,nauticalmiles:hs/1852,radians:1,yards:hs*1.0936},GO={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Ca(a,n,h={}){const m={type:"Feature"};return(h.id===0||h.id)&&(m.id=h.id),h.bbox&&(m.bbox=h.bbox),m.properties=n||{},m.geometry=a,m}On(Ca,"feature");function nq(a,n,h={}){switch(a){case"Point":return ol(n).geometry;case"LineString":return sl(n).geometry;case"Polygon":return iM(n).geometry;case"MultiPoint":return HL(n).geometry;case"MultiLineString":return qL(n).geometry;case"MultiPolygon":return ZL(n).geometry;default:throw new Error(a+" is invalid")}}On(nq,"geometry");function ol(a,n,h={}){if(!a)throw new Error("coordinates is required");if(!Array.isArray(a))throw new Error("coordinates must be an Array");if(a.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ap(a[0])||!Ap(a[1]))throw new Error("coordinates must contain numbers");return Ca({type:"Point",coordinates:a},n,h)}On(ol,"point");function iq(a,n,h={}){return Gg(a.map(m=>ol(m,n)),h)}On(iq,"points");function iM(a,n,h={}){for(const y of a){if(y.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(y[y.length-1].length!==y[0].length)throw new Error("First and last Position are not equivalent.");for(let b=0;b<y[y.length-1].length;b++)if(y[y.length-1][b]!==y[0][b])throw new Error("First and last Position are not equivalent.")}return Ca({type:"Polygon",coordinates:a},n,h)}On(iM,"polygon");function oq(a,n,h={}){return Gg(a.map(m=>iM(m,n)),h)}On(oq,"polygons");function sl(a,n,h={}){if(a.length<2)throw new Error("coordinates must be an array of two or more positions");return Ca({type:"LineString",coordinates:a},n,h)}On(sl,"lineString");function sq(a,n,h={}){return Gg(a.map(m=>sl(m,n)),h)}On(sq,"lineStrings");function Gg(a,n={}){const h={type:"FeatureCollection"};return n.id&&(h.id=n.id),n.bbox&&(h.bbox=n.bbox),h.features=a,h}On(Gg,"featureCollection");function qL(a,n,h={}){return Ca({type:"MultiLineString",coordinates:a},n,h)}On(qL,"multiLineString");function HL(a,n,h={}){return Ca({type:"MultiPoint",coordinates:a},n,h)}On(HL,"multiPoint");function ZL(a,n,h={}){return Ca({type:"MultiPolygon",coordinates:a},n,h)}On(ZL,"multiPolygon");function aq(a,n,h={}){return Ca({type:"GeometryCollection",geometries:a},n,h)}On(aq,"geometryCollection");function lq(a,n=0){if(n&&!(n>=0))throw new Error("precision must be a positive number");const h=Math.pow(10,n||0);return Math.round(a*h)/h}On(lq,"round");function oM(a,n="kilometers"){const h=WL[n];if(!h)throw new Error(n+" units is invalid");return a*h}On(oM,"radiansToLength");function sM(a,n="kilometers"){const h=WL[n];if(!h)throw new Error(n+" units is invalid");return a/h}On(sM,"lengthToRadians");function uq(a,n){return XL(sM(a,n))}On(uq,"lengthToDegrees");function cq(a){let n=a%360;return n<0&&(n+=360),n}On(cq,"bearingToAzimuth");function XL(a){return a%(2*Math.PI)*180/Math.PI}On(XL,"radiansToDegrees");function $_(a){return a%360*Math.PI/180}On($_,"degreesToRadians");function aM(a,n="kilometers",h="kilometers"){if(!(a>=0))throw new Error("length must be a positive number");return oM(sM(a,n),h)}On(aM,"convertLength");function hq(a,n="meters",h="kilometers"){if(!(a>=0))throw new Error("area must be a positive number");const m=GO[n];if(!m)throw new Error("invalid original units");const y=GO[h];if(!y)throw new Error("invalid final units");return a/m*y}On(hq,"convertArea");function Ap(a){return!isNaN(a)&&a!==null&&!Array.isArray(a)}On(Ap,"isNumber");function lM(a){return a!==null&&typeof a=="object"&&!Array.isArray(a)}On(lM,"isObject");function fq(a){if(!a)throw new Error("bbox is required");if(!Array.isArray(a))throw new Error("bbox must be an Array");if(a.length!==4&&a.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");a.forEach(n=>{if(!Ap(n))throw new Error("bbox must only contain numbers")})}On(fq,"validateBBox");function dq(a){if(!a)throw new Error("id is required");if(["string","number"].indexOf(typeof a)===-1)throw new Error("id must be a number or a string")}On(dq,"validateId");var pq=Object.defineProperty,lh=(a,n)=>pq(a,"name",{value:n,configurable:!0});function Ag(a){if(!a)throw new Error("coord is required");if(!Array.isArray(a)){if(a.type==="Feature"&&a.geometry!==null&&a.geometry.type==="Point")return[...a.geometry.coordinates];if(a.type==="Point")return[...a.coordinates]}if(Array.isArray(a)&&a.length>=2&&!Array.isArray(a[0])&&!Array.isArray(a[1]))return[...a];throw new Error("coord must be GeoJSON Point or an Array of numbers")}lh(Ag,"getCoord");function mq(a){if(Array.isArray(a))return a;if(a.type==="Feature"){if(a.geometry!==null)return a.geometry.coordinates}else if(a.coordinates)return a.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}lh(mq,"getCoords");function YL(a){if(a.length>1&&Ap(a[0])&&Ap(a[1]))return!0;if(Array.isArray(a[0])&&a[0].length)return YL(a[0]);throw new Error("coordinates must only contain numbers")}lh(YL,"containsNumber");function _q(a,n,h){if(!n||!h)throw new Error("type and name required");if(!a||a.type!==n)throw new Error("Invalid input to "+h+": must be a "+n+", given "+a.type)}lh(_q,"geojsonType");function AS(a,n,h){if(!a)throw new Error("No feature passed");if(!h)throw new Error(".featureOf() requires a name");if(!a||a.type!=="Feature"||!a.geometry)throw new Error("Invalid input to "+h+", Feature with geometry required");if(!a.geometry||a.geometry.type!==n)throw new Error("Invalid input to "+h+": must be a "+n+", given "+a.geometry.type)}lh(AS,"featureOf");function gq(a,n,h){if(!a)throw new Error("No featureCollection passed");if(!h)throw new Error(".collectionOf() requires a name");if(!a||a.type!=="FeatureCollection")throw new Error("Invalid input to "+h+", FeatureCollection required");for(const m of a.features){if(!m||m.type!=="Feature"||!m.geometry)throw new Error("Invalid input to "+h+", Feature with geometry required");if(!m.geometry||m.geometry.type!==n)throw new Error("Invalid input to "+h+": must be a "+n+", given "+m.geometry.type)}}lh(gq,"collectionOf");function yq(a){return a.type==="Feature"?a.geometry:a}lh(yq,"getGeom");function vq(a,n){return a.type==="FeatureCollection"?"FeatureCollection":a.type==="GeometryCollection"?"GeometryCollection":a.type==="Feature"&&a.geometry!==null?a.geometry.type:a.type}lh(vq,"getType");var xq=Object.defineProperty,bq=(a,n)=>xq(a,"name",{value:n,configurable:!0});function KL(a,n,h={}){var m=Ag(a),y=Ag(n),b=$_(y[1]-m[1]),M=$_(y[0]-m[0]),P=$_(m[1]),o=$_(y[1]),R=Math.pow(Math.sin(b/2),2)+Math.pow(Math.sin(M/2),2)*Math.cos(P)*Math.cos(o);return oM(2*Math.atan2(Math.sqrt(R),Math.sqrt(1-R)),h.units)}bq(KL,"distance");var wq=Object.defineProperty,_o=(a,n)=>wq(a,"name",{value:n,configurable:!0});function Wg(a,n,h){if(a!==null)for(var m,y,b,M,P,o,R,U=0,V=0,Z,te=a.type,se=te==="FeatureCollection",re=te==="Feature",Te=se?a.features.length:1,ae=0;ae<Te;ae++){R=se?a.features[ae].geometry:re?a.geometry:a,Z=R?R.type==="GeometryCollection":!1,P=Z?R.geometries.length:1;for(var q=0;q<P;q++){var Q=0,le=0;if(M=Z?R.geometries[q]:R,M!==null){o=M.coordinates;var ye=M.type;switch(U=h&&(ye==="Polygon"||ye==="MultiPolygon")?1:0,ye){case null:break;case"Point":if(n(o,V,ae,Q,le)===!1)return!1;V++,Q++;break;case"LineString":case"MultiPoint":for(m=0;m<o.length;m++){if(n(o[m],V,ae,Q,le)===!1)return!1;V++,ye==="MultiPoint"&&Q++}ye==="LineString"&&Q++;break;case"Polygon":case"MultiLineString":for(m=0;m<o.length;m++){for(y=0;y<o[m].length-U;y++){if(n(o[m][y],V,ae,Q,le)===!1)return!1;V++}ye==="MultiLineString"&&Q++,ye==="Polygon"&&le++}ye==="Polygon"&&Q++;break;case"MultiPolygon":for(m=0;m<o.length;m++){for(le=0,y=0;y<o[m].length;y++){for(b=0;b<o[m][y].length-U;b++){if(n(o[m][y][b],V,ae,Q,le)===!1)return!1;V++}le++}Q++}break;case"GeometryCollection":for(m=0;m<M.geometries.length;m++)if(Wg(M.geometries[m],n,h)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}_o(Wg,"coordEach");function Tq(a,n,h,m){var y=h;return Wg(a,function(b,M,P,o,R){M===0&&h===void 0?y=b:y=n(y,b,M,P,o,R)},m),y}_o(Tq,"coordReduce");function QL(a,n){var h;switch(a.type){case"FeatureCollection":for(h=0;h<a.features.length&&n(a.features[h].properties,h)!==!1;h++);break;case"Feature":n(a.properties,0);break}}_o(QL,"propEach");function Sq(a,n,h){var m=h;return QL(a,function(y,b){b===0&&h===void 0?m=y:m=n(m,y,b)}),m}_o(Sq,"propReduce");function JL(a,n){if(a.type==="Feature")n(a,0);else if(a.type==="FeatureCollection")for(var h=0;h<a.features.length&&n(a.features[h],h)!==!1;h++);}_o(JL,"featureEach");function Eq(a,n,h){var m=h;return JL(a,function(y,b){b===0&&h===void 0?m=y:m=n(m,y,b)}),m}_o(Eq,"featureReduce");function Mq(a){var n=[];return Wg(a,function(h){n.push(h)}),n}_o(Mq,"coordAll");function uM(a,n){var h,m,y,b,M,P,o,R,U,V,Z=0,te=a.type==="FeatureCollection",se=a.type==="Feature",re=te?a.features.length:1;for(h=0;h<re;h++){for(P=te?a.features[h].geometry:se?a.geometry:a,R=te?a.features[h].properties:se?a.properties:{},U=te?a.features[h].bbox:se?a.bbox:void 0,V=te?a.features[h].id:se?a.id:void 0,o=P?P.type==="GeometryCollection":!1,M=o?P.geometries.length:1,y=0;y<M;y++){if(b=o?P.geometries[y]:P,b===null){if(n(null,Z,R,U,V)===!1)return!1;continue}switch(b.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(n(b,Z,R,U,V)===!1)return!1;break}case"GeometryCollection":{for(m=0;m<b.geometries.length;m++)if(n(b.geometries[m],Z,R,U,V)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}Z++}}_o(uM,"geomEach");function Iq(a,n,h){var m=h;return uM(a,function(y,b,M,P,o){b===0&&h===void 0?m=y:m=n(m,y,b,M,P,o)}),m}_o(Iq,"geomReduce");function i1(a,n){uM(a,function(h,m,y,b,M){var P=h===null?null:h.type;switch(P){case null:case"Point":case"LineString":case"Polygon":return n(Ca(h,y,{bbox:b,id:M}),m,0)===!1?!1:void 0}var o;switch(P){case"MultiPoint":o="Point";break;case"MultiLineString":o="LineString";break;case"MultiPolygon":o="Polygon";break}for(var R=0;R<h.coordinates.length;R++){var U=h.coordinates[R],V={type:o,coordinates:U};if(n(Ca(V,y),m,R)===!1)return!1}})}_o(i1,"flattenEach");function Aq(a,n,h){var m=h;return i1(a,function(y,b,M){b===0&&M===0&&h===void 0?m=y:m=n(m,y,b,M)}),m}_o(Aq,"flattenReduce");function cM(a,n){i1(a,function(h,m,y){var b=0;if(h.geometry){var M=h.geometry.type;if(!(M==="Point"||M==="MultiPoint")){var P,o=0,R=0,U=0;if(Wg(h,function(V,Z,te,se,re){if(P===void 0||m>o||se>R||re>U){P=V,o=m,R=se,U=re,b=0;return}var Te=sl([P,V],h.properties);if(n(Te,m,y,re,b)===!1)return!1;b++,P=V})===!1)return!1}}})}_o(cM,"segmentEach");function Cq(a,n,h){var m=h,y=!1;return cM(a,function(b,M,P,o,R){y===!1&&h===void 0?m=b:m=n(m,b,M,P,o,R),y=!0}),m}_o(Cq,"segmentReduce");function ez(a,n){if(!a)throw new Error("geojson is required");i1(a,function(h,m,y){if(h.geometry!==null){var b=h.geometry.type,M=h.geometry.coordinates;switch(b){case"LineString":if(n(h,m,y,0,0)===!1)return!1;break;case"Polygon":for(var P=0;P<M.length;P++)if(n(sl(M[P],h.properties),m,y,P)===!1)return!1;break}}})}_o(ez,"lineEach");function Pq(a,n,h){var m=h;return ez(a,function(y,b,M,P){b===0&&h===void 0?m=y:m=n(m,y,b,M,P)}),m}_o(Pq,"lineReduce");function Oq(a,n){if(n=n||{},!lM(n))throw new Error("options is invalid");var h=n.featureIndex||0,m=n.multiFeatureIndex||0,y=n.geometryIndex||0,b=n.segmentIndex||0,M=n.properties,P;switch(a.type){case"FeatureCollection":h<0&&(h=a.features.length+h),M=M||a.features[h].properties,P=a.features[h].geometry;break;case"Feature":M=M||a.properties,P=a.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":P=a;break;default:throw new Error("geojson is invalid")}if(P===null)return null;var o=P.coordinates;switch(P.type){case"Point":case"MultiPoint":return null;case"LineString":return b<0&&(b=o.length+b-1),sl([o[b],o[b+1]],M,n);case"Polygon":return y<0&&(y=o.length+y),b<0&&(b=o[y].length+b-1),sl([o[y][b],o[y][b+1]],M,n);case"MultiLineString":return m<0&&(m=o.length+m),b<0&&(b=o[m].length+b-1),sl([o[m][b],o[m][b+1]],M,n);case"MultiPolygon":return m<0&&(m=o.length+m),y<0&&(y=o[m].length+y),b<0&&(b=o[m][y].length-b-1),sl([o[m][y][b],o[m][y][b+1]],M,n)}throw new Error("geojson is invalid")}_o(Oq,"findSegment");function Dq(a,n){if(n=n||{},!lM(n))throw new Error("options is invalid");var h=n.featureIndex||0,m=n.multiFeatureIndex||0,y=n.geometryIndex||0,b=n.coordIndex||0,M=n.properties,P;switch(a.type){case"FeatureCollection":h<0&&(h=a.features.length+h),M=M||a.features[h].properties,P=a.features[h].geometry;break;case"Feature":M=M||a.properties,P=a.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":P=a;break;default:throw new Error("geojson is invalid")}if(P===null)return null;var o=P.coordinates;switch(P.type){case"Point":return ol(o,M,n);case"MultiPoint":return m<0&&(m=o.length+m),ol(o[m],M,n);case"LineString":return b<0&&(b=o.length+b),ol(o[b],M,n);case"Polygon":return y<0&&(y=o.length+y),b<0&&(b=o[y].length+b),ol(o[y][b],M,n);case"MultiLineString":return m<0&&(m=o.length+m),b<0&&(b=o[m].length+b),ol(o[m][b],M,n);case"MultiPolygon":return m<0&&(m=o.length+m),y<0&&(y=o[m].length+y),b<0&&(b=o[m][y].length-b),ol(o[m][y][b],M,n)}throw new Error("geojson is invalid")}_o(Dq,"findPoint");var Rq=Object.defineProperty,tz=(a,n)=>Rq(a,"name",{value:n,configurable:!0});function rz(a,n,h={}){const m=Ag(a),y=Ag(n);y[0]+=y[0]-m[0]>180?-360:m[0]-y[0]>180?360:0;const b=nz(m,y);return aM(b,"meters",h.units)}tz(rz,"rhumbDistance");function nz(a,n,h){h=h===void 0?hs:Number(h);const m=h,y=a[1]*Math.PI/180,b=n[1]*Math.PI/180,M=b-y;let P=Math.abs(n[0]-a[0])*Math.PI/180;P>Math.PI&&(P-=2*Math.PI);const o=Math.log(Math.tan(b/2+Math.PI/4)/Math.tan(y/2+Math.PI/4)),R=Math.abs(o)>1e-11?M/o:Math.cos(y);return Math.sqrt(M*M+R*R*P*P)*m}tz(nz,"calculateRhumbDistance");var kq=Object.defineProperty,o1=(a,n)=>kq(a,"name",{value:n,configurable:!0});function iz(a,n,h={}){if(h.method||(h.method="geodesic"),h.units||(h.units="kilometers"),!a)throw new Error("pt is required");if(Array.isArray(a)?a=ol(a):a.type==="Point"?a=Ca(a):AS(a,"Point","point"),!n)throw new Error("line is required");Array.isArray(n)?n=sl(n):n.type==="LineString"?n=Ca(n):AS(n,"LineString","line");let m=1/0;const y=a.geometry.coordinates;return cM(n,b=>{const M=b.geometry.coordinates[0],P=b.geometry.coordinates[1],o=oz(y,M,P,h);o<m&&(m=o)}),aM(m,"degrees",h.units)}o1(iz,"pointToLineDistance");function oz(a,n,h,m){const y=[h[0]-n[0],h[1]-n[1]],b=[a[0]-n[0],a[1]-n[1]],M=CS(b,y);if(M<=0)return Fv(a,n,{method:m.method,units:"degrees"});const P=CS(y,y);if(P<=M)return Fv(a,h,{method:m.method,units:"degrees"});const o=M/P,R=[n[0]+o*y[0],n[1]+o*y[1]];return Fv(a,R,{method:m.method,units:"degrees"})}o1(oz,"distanceToSegment");function CS(a,n){return a[0]*n[0]+a[1]*n[1]}o1(CS,"dot");function Fv(a,n,h){return h.method==="planar"?rz(a,n,h):KL(a,n,h)}o1(Fv,"calcDistance");var sz={exports:{}};(function(a){var n={};function h(b){return Math.floor(Math.abs(b)+.5)*(b>=0?1:-1)}function m(b,M,P){b=h(b*P),M=h(M*P);var o=(b-M)*2;o<0&&(o=-o-1);for(var R="";o>=32;)R+=String.fromCharCode((32|o&31)+63),o/=32;return R+=String.fromCharCode((o|0)+63),R}n.decode=function(b,M){for(var P=0,o=0,R=0,U=[],V=0,Z=0,te=null,se,re,Te=Math.pow(10,Number.isInteger(M)?M:5);P<b.length;){te=null,V=1,Z=0;do te=b.charCodeAt(P++)-63,Z+=(te&31)*V,V*=32;while(te>=32);se=Z&1?(-Z-1)/2:Z/2,V=1,Z=0;do te=b.charCodeAt(P++)-63,Z+=(te&31)*V,V*=32;while(te>=32);re=Z&1?(-Z-1)/2:Z/2,o+=se,R+=re,U.push([o/Te,R/Te])}return U},n.encode=function(b,M){if(!b.length)return"";for(var P=Math.pow(10,Number.isInteger(M)?M:5),o=m(b[0][0],0,P)+m(b[0][1],0,P),R=1;R<b.length;R++){var U=b[R],V=b[R-1];o+=m(U[0],V[0],P),o+=m(U[1],V[1],P)}return o};function y(b){for(var M=[],P=0;P<b.length;P++){var o=b[P].slice();M.push([o[1],o[0]])}return M}n.fromGeoJSON=function(b,M){if(b&&b.type==="Feature"&&(b=b.geometry),!b||b.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return n.encode(y(b.coordinates),M)},n.toGeoJSON=function(b,M){var P=n.decode(b,M);return{type:"LineString",coordinates:y(P)}},a.exports&&(a.exports=n)})(sz);var Lq=sz.exports;const zq=zg(Lq);hp.accessToken="pk.eyJ1IjoibWVsb24xMTU1IiwiYSI6ImNsejlhM2tkcjAxbG4ya3B0eTc1eHRvNG8ifQ.kpENBsizEwkPe4TqVHDkdA";const Fq=()=>{const a=rr.useRef(null),n=rr.useRef(null),[h,m]=rr.useState(144.946457),[y,b]=rr.useState(-37.840935),[M,P]=rr.useState(12),[o,R]=rr.useState(!1),[U,V]=rr.useState([]),[Z,te]=rr.useState({type:"FeatureCollection",features:[]}),[se,re]=rr.useState({low:0,medium:0,high:0}),[Te,ae]=rr.useState(!1),q=()=>{R(!1),["low","medium","high"].forEach(Q=>{n.current.getLayer(`accidents-layer-${Q}`)&&n.current.setLayoutProperty(`accidents-layer-${Q}`,"visibility","none")})};return rr.useEffect(()=>{fetch("http://127.0.0.1:8000/api/accidents/?format=json").then(Q=>Q.json()).then(Q=>{te(Q)}).catch(Q=>console.error("Error fetching accidents data:",Q))},[]),rr.useEffect(()=>{if(Te||Z.features.length===0)return;n.current=new hp.Map({container:a.current,style:"mapbox://styles/mapbox/streets-v12",center:[h,y],zoom:M});const Q=new Ej({accessToken:hp.accessToken,unit:"metric",profile:"mapbox/cycling",controls:{inputs:!0,instructions:!1,profileSwitcher:!1}});n.current.addControl(Q,"top-left");const le=new hp.NavigationControl({visualizePitch:!0});n.current.addControl(le,"bottom-right"),Q.on("route",ye=>{R(!0);const ze=ye.route[0],He=zq.decode(ze.geometry).map(Be=>[Be[1],Be[0]]),Ne=ze.legs.map(Be=>Be.steps.map(Ce=>Ce.maneuver.instruction));V(Ne.flat()),["low","medium","high"].forEach(Be=>{n.current.getSource(`accidents-${Be}`)&&(n.current.removeLayer(`accidents-layer-${Be}`),n.current.removeSource(`accidents-${Be}`))});const xe=sl(He),Me=Gg(Z.features.filter(Be=>{const Ce=ol(Be.geometry.coordinates);return iz(Ce,xe,{units:"meters"})<=100})),Ie=Me.features.reduce((Be,Ce)=>{const Re=Ce.properties.severity;return Be[Re]=(Be[Re]||0)+1,Be},{low:0,medium:0,high:0});re(Ie);const Je={low:"green",medium:"orange",high:"red"};["low","medium","high"].forEach(Be=>{const Ce=Me.features.filter(Re=>Re.properties.severity===Be);n.current.addSource(`accidents-${Be}`,{type:"geojson",data:{type:"FeatureCollection",features:Ce}}),n.current.addLayer({id:`accidents-layer-${Be}`,type:"circle",source:`accidents-${Be}`,paint:{"circle-radius":4,"circle-stroke-width":2,"circle-color":Je[Be],"circle-stroke-color":"white"}})})}),ae(!0)},[Z,Te]),ir.jsxs("div",{className:"map-container",children:[ir.jsx("div",{ref:a,className:"map"}),o&&ir.jsxs("div",{className:"instructions",children:[ir.jsx("button",{className:"close-button",onClick:q,children:ir.jsx("i",{className:"fas fa-times"})}),ir.jsx(kk.Scrollbars,{children:ir.jsxs("div",{className:"route-details",children:[ir.jsx("h1",{className:"font-bold",children:"Accidents along the route:"}),ir.jsxs("p",{className:"font-bold",children:["Low Severity: ",se.low]}),ir.jsxs("p",{className:"font-bold",children:["Medium Severity: ",se.medium]}),ir.jsxs("p",{className:"font-bold",children:["High Severity: ",se.high]}),ir.jsx("ol",{children:U.map((Q,le)=>ir.jsx("li",{children:`${le+1}. ${Q}`},le))})]})})]}),o&&ir.jsxs("div",{className:"legend",children:[ir.jsx("h3",{children:"Legend"}),ir.jsxs("div",{className:"legend-item",children:[ir.jsx("span",{className:"legend-color",style:{backgroundColor:"green"}}),"Low Severity"]}),ir.jsxs("div",{className:"legend-item",children:[ir.jsx("span",{className:"legend-color",style:{backgroundColor:"orange"}}),"Medium Severity"]}),ir.jsxs("div",{className:"legend-item",children:[ir.jsx("span",{className:"legend-color",style:{backgroundColor:"red"}}),"High Severity"]})]})]})};function Tu(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function az(a,n){a.prototype=Object.create(n.prototype),a.prototype.constructor=a,a.__proto__=n}/*!
 * GSAP 3.12.5
 * https://gsap.com
 *
 * @license Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Ks={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Cp={duration:.5,overwrite:!1,delay:0},hM,ko,ri,Sa=1e8,jn=1/Sa,PS=Math.PI*2,Bq=PS/4,Nq=0,lz=Math.sqrt,Uq=Math.cos,jq=Math.sin,so=function(n){return typeof n=="string"},xi=function(n){return typeof n=="function"},ku=function(n){return typeof n=="number"},fM=function(n){return typeof n>"u"},Bl=function(n){return typeof n=="object"},gs=function(n){return n!==!1},dM=function(){return typeof window<"u"},dv=function(n){return xi(n)||so(n)},uz=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},Lo=Array.isArray,OS=/(?:-?\.?\d|\.)+/gi,cz=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,np=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,nT=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,hz=/[+-]=-?[.\d]+/,fz=/[^,'"\[\]\s]+/gi,Vq=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,pi,Pl,DS,pM,Js={},Ix={},dz,pz=function(n){return(Ix=Mf(n,Js))&&bs},mM=function(n,h){return console.warn("Invalid property",n,"set to",h,"Missing plugin? gsap.registerPlugin()")},Cg=function(n,h){return!h&&console.warn(n)},mz=function(n,h){return n&&(Js[n]=h)&&Ix&&(Ix[n]=h)||Js},Pg=function(){return 0},$q={suppressEvents:!0,isStart:!0,kill:!1},Bv={suppressEvents:!0,kill:!1},Gq={suppressEvents:!0},_M={},Yc=[],RS={},_z,qs={},iT={},WO=30,Nv=[],gM="",yM=function(n){var h=n[0],m,y;if(Bl(h)||xi(h)||(n=[n]),!(m=(h._gsap||{}).harness)){for(y=Nv.length;y--&&!Nv[y].targetTest(h););m=Nv[y]}for(y=n.length;y--;)n[y]&&(n[y]._gsap||(n[y]._gsap=new Uz(n[y],m)))||n.splice(y,1);return n},gf=function(n){return n._gsap||yM(Ea(n))[0]._gsap},gz=function(n,h,m){return(m=n[h])&&xi(m)?n[h]():fM(m)&&n.getAttribute&&n.getAttribute(h)||m},ys=function(n,h){return(n=n.split(",")).forEach(h)||n},Ei=function(n){return Math.round(n*1e5)/1e5||0},io=function(n){return Math.round(n*1e7)/1e7||0},pp=function(n,h){var m=h.charAt(0),y=parseFloat(h.substr(2));return n=parseFloat(n),m==="+"?n+y:m==="-"?n-y:m==="*"?n*y:n/y},Wq=function(n,h){for(var m=h.length,y=0;n.indexOf(h[y])<0&&++y<m;);return y<m},Ax=function(){var n=Yc.length,h=Yc.slice(0),m,y;for(RS={},Yc.length=0,m=0;m<n;m++)y=h[m],y&&y._lazy&&(y.render(y._lazy[0],y._lazy[1],!0)._lazy=0)},yz=function(n,h,m,y){Yc.length&&!ko&&Ax(),n.render(h,m,ko&&h<0&&(n._initted||n._startAt)),Yc.length&&!ko&&Ax()},vz=function(n){var h=parseFloat(n);return(h||h===0)&&(n+"").match(fz).length<2?h:so(n)?n.trim():n},xz=function(n){return n},Pa=function(n,h){for(var m in h)m in n||(n[m]=h[m]);return n},qq=function(n){return function(h,m){for(var y in m)y in h||y==="duration"&&n||y==="ease"||(h[y]=m[y])}},Mf=function(n,h){for(var m in h)n[m]=h[m];return n},qO=function a(n,h){for(var m in h)m!=="__proto__"&&m!=="constructor"&&m!=="prototype"&&(n[m]=Bl(h[m])?a(n[m]||(n[m]={}),h[m]):h[m]);return n},Cx=function(n,h){var m={},y;for(y in n)y in h||(m[y]=n[y]);return m},ig=function(n){var h=n.parent||pi,m=n.keyframes?qq(Lo(n.keyframes)):Pa;if(gs(n.inherit))for(;h;)m(n,h.vars.defaults),h=h.parent||h._dp;return n},Hq=function(n,h){for(var m=n.length,y=m===h.length;y&&m--&&n[m]===h[m];);return m<0},bz=function(n,h,m,y,b){var M=n[y],P;if(b)for(P=h[b];M&&M[b]>P;)M=M._prev;return M?(h._next=M._next,M._next=h):(h._next=n[m],n[m]=h),h._next?h._next._prev=h:n[y]=h,h._prev=M,h.parent=h._dp=n,h},s1=function(n,h,m,y){m===void 0&&(m="_first"),y===void 0&&(y="_last");var b=h._prev,M=h._next;b?b._next=M:n[m]===h&&(n[m]=M),M?M._prev=b:n[y]===h&&(n[y]=b),h._next=h._prev=h.parent=null},th=function(n,h){n.parent&&(!h||n.parent.autoRemoveChildren)&&n.parent.remove&&n.parent.remove(n),n._act=0},yf=function(n,h){if(n&&(!h||h._end>n._dur||h._start<0))for(var m=n;m;)m._dirty=1,m=m.parent;return n},Zq=function(n){for(var h=n.parent;h&&h.parent;)h._dirty=1,h.totalDuration(),h=h.parent;return n},kS=function(n,h,m,y){return n._startAt&&(ko?n._startAt.revert(Bv):n.vars.immediateRender&&!n.vars.autoRevert||n._startAt.render(h,!0,y))},Xq=function a(n){return!n||n._ts&&a(n.parent)},HO=function(n){return n._repeat?Pp(n._tTime,n=n.duration()+n._rDelay)*n:0},Pp=function(n,h){var m=Math.floor(n/=h);return n&&m===n?m-1:m},Px=function(n,h){return(n-h._start)*h._ts+(h._ts>=0?0:h._dirty?h.totalDuration():h._tDur)},a1=function(n){return n._end=io(n._start+(n._tDur/Math.abs(n._ts||n._rts||jn)||0))},l1=function(n,h){var m=n._dp;return m&&m.smoothChildTiming&&n._ts&&(n._start=io(m._time-(n._ts>0?h/n._ts:((n._dirty?n.totalDuration():n._tDur)-h)/-n._ts)),a1(n),m._dirty||yf(m,n)),n},wz=function(n,h){var m;if((h._time||!h._dur&&h._initted||h._start<n._time&&(h._dur||!h.add))&&(m=Px(n.rawTime(),h),(!h._dur||qg(0,h.totalDuration(),m)-h._tTime>jn)&&h.render(m,!0)),yf(n,h)._dp&&n._initted&&n._time>=n._dur&&n._ts){if(n._dur<n.duration())for(m=n;m._dp;)m.rawTime()>=0&&m.totalTime(m._tTime),m=m._dp;n._zTime=-jn}},Rl=function(n,h,m,y){return h.parent&&th(h),h._start=io((ku(m)?m:m||n!==pi?xa(n,m,h):n._time)+h._delay),h._end=io(h._start+(h.totalDuration()/Math.abs(h.timeScale())||0)),bz(n,h,"_first","_last",n._sort?"_start":0),LS(h)||(n._recent=h),y||wz(n,h),n._ts<0&&l1(n,n._tTime),n},Tz=function(n,h){return(Js.ScrollTrigger||mM("scrollTrigger",h))&&Js.ScrollTrigger.create(h,n)},Sz=function(n,h,m,y,b){if(xM(n,h,b),!n._initted)return 1;if(!m&&n._pt&&!ko&&(n._dur&&n.vars.lazy!==!1||!n._dur&&n.vars.lazy)&&_z!==Hs.frame)return Yc.push(n),n._lazy=[b,y],1},Yq=function a(n){var h=n.parent;return h&&h._ts&&h._initted&&!h._lock&&(h.rawTime()<0||a(h))},LS=function(n){var h=n.data;return h==="isFromStart"||h==="isStart"},Kq=function(n,h,m,y){var b=n.ratio,M=h<0||!h&&(!n._start&&Yq(n)&&!(!n._initted&&LS(n))||(n._ts<0||n._dp._ts<0)&&!LS(n))?0:1,P=n._rDelay,o=0,R,U,V;if(P&&n._repeat&&(o=qg(0,n._tDur,h),U=Pp(o,P),n._yoyo&&U&1&&(M=1-M),U!==Pp(n._tTime,P)&&(b=1-M,n.vars.repeatRefresh&&n._initted&&n.invalidate())),M!==b||ko||y||n._zTime===jn||!h&&n._zTime){if(!n._initted&&Sz(n,h,y,m,o))return;for(V=n._zTime,n._zTime=h||(m?jn:0),m||(m=h&&!V),n.ratio=M,n._from&&(M=1-M),n._time=0,n._tTime=o,R=n._pt;R;)R.r(M,R.d),R=R._next;h<0&&kS(n,h,m,!0),n._onUpdate&&!m&&Xs(n,"onUpdate"),o&&n._repeat&&!m&&n.parent&&Xs(n,"onRepeat"),(h>=n._tDur||h<0)&&n.ratio===M&&(M&&th(n,1),!m&&!ko&&(Xs(n,M?"onComplete":"onReverseComplete",!0),n._prom&&n._prom()))}else n._zTime||(n._zTime=h)},Qq=function(n,h,m){var y;if(m>h)for(y=n._first;y&&y._start<=m;){if(y.data==="isPause"&&y._start>h)return y;y=y._next}else for(y=n._last;y&&y._start>=m;){if(y.data==="isPause"&&y._start<h)return y;y=y._prev}},Op=function(n,h,m,y){var b=n._repeat,M=io(h)||0,P=n._tTime/n._tDur;return P&&!y&&(n._time*=M/n._dur),n._dur=M,n._tDur=b?b<0?1e10:io(M*(b+1)+n._rDelay*b):M,P>0&&!y&&l1(n,n._tTime=n._tDur*P),n.parent&&a1(n),m||yf(n.parent,n),n},ZO=function(n){return n instanceof Yo?yf(n):Op(n,n._dur)},Jq={_start:0,endTime:Pg,totalDuration:Pg},xa=function a(n,h,m){var y=n.labels,b=n._recent||Jq,M=n.duration()>=Sa?b.endTime(!1):n._dur,P,o,R;return so(h)&&(isNaN(h)||h in y)?(o=h.charAt(0),R=h.substr(-1)==="%",P=h.indexOf("="),o==="<"||o===">"?(P>=0&&(h=h.replace(/=/,"")),(o==="<"?b._start:b.endTime(b._repeat>=0))+(parseFloat(h.substr(1))||0)*(R?(P<0?b:m).totalDuration()/100:1)):P<0?(h in y||(y[h]=M),y[h]):(o=parseFloat(h.charAt(P-1)+h.substr(P+1)),R&&m&&(o=o/100*(Lo(m)?m[0]:m).totalDuration()),P>1?a(n,h.substr(0,P-1),m)+o:M+o)):h==null?M:+h},og=function(n,h,m){var y=ku(h[1]),b=(y?2:1)+(n<2?0:1),M=h[b],P,o;if(y&&(M.duration=h[1]),M.parent=m,n){for(P=M,o=m;o&&!("immediateRender"in P);)P=o.vars.defaults||{},o=gs(o.vars.inherit)&&o.parent;M.immediateRender=gs(P.immediateRender),n<2?M.runBackwards=1:M.startAt=h[b-1]}return new Li(h[0],M,h[b+1])},uh=function(n,h){return n||n===0?h(n):h},qg=function(n,h,m){return m<n?n:m>h?h:m},Ro=function(n,h){return!so(n)||!(h=Vq.exec(n))?"":h[1]},eH=function(n,h,m){return uh(m,function(y){return qg(n,h,y)})},zS=[].slice,Ez=function(n,h){return n&&Bl(n)&&"length"in n&&(!h&&!n.length||n.length-1 in n&&Bl(n[0]))&&!n.nodeType&&n!==Pl},tH=function(n,h,m){return m===void 0&&(m=[]),n.forEach(function(y){var b;return so(y)&&!h||Ez(y,1)?(b=m).push.apply(b,Ea(y)):m.push(y)})||m},Ea=function(n,h,m){return ri&&!h&&ri.selector?ri.selector(n):so(n)&&!m&&(DS||!Dp())?zS.call((h||pM).querySelectorAll(n),0):Lo(n)?tH(n,m):Ez(n)?zS.call(n,0):n?[n]:[]},FS=function(n){return n=Ea(n)[0]||Cg("Invalid scope")||{},function(h){var m=n.current||n.nativeElement||n;return Ea(h,m.querySelectorAll?m:m===n?Cg("Invalid scope")||pM.createElement("div"):n)}},Mz=function(n){return n.sort(function(){return .5-Math.random()})},Iz=function(n){if(xi(n))return n;var h=Bl(n)?n:{each:n},m=vf(h.ease),y=h.from||0,b=parseFloat(h.base)||0,M={},P=y>0&&y<1,o=isNaN(y)||P,R=h.axis,U=y,V=y;return so(y)?U=V={center:.5,edges:.5,end:1}[y]||0:!P&&o&&(U=y[0],V=y[1]),function(Z,te,se){var re=(se||h).length,Te=M[re],ae,q,Q,le,ye,ze,He,Ne,xe;if(!Te){if(xe=h.grid==="auto"?0:(h.grid||[1,Sa])[1],!xe){for(He=-Sa;He<(He=se[xe++].getBoundingClientRect().left)&&xe<re;);xe<re&&xe--}for(Te=M[re]=[],ae=o?Math.min(xe,re)*U-.5:y%xe,q=xe===Sa?0:o?re*V/xe-.5:y/xe|0,He=0,Ne=Sa,ze=0;ze<re;ze++)Q=ze%xe-ae,le=q-(ze/xe|0),Te[ze]=ye=R?Math.abs(R==="y"?le:Q):lz(Q*Q+le*le),ye>He&&(He=ye),ye<Ne&&(Ne=ye);y==="random"&&Mz(Te),Te.max=He-Ne,Te.min=Ne,Te.v=re=(parseFloat(h.amount)||parseFloat(h.each)*(xe>re?re-1:R?R==="y"?re/xe:xe:Math.max(xe,re/xe))||0)*(y==="edges"?-1:1),Te.b=re<0?b-re:b,Te.u=Ro(h.amount||h.each)||0,m=m&&re<0?Fz(m):m}return re=(Te[Z]-Te.min)/Te.max||0,io(Te.b+(m?m(re):re)*Te.v)+Te.u}},BS=function(n){var h=Math.pow(10,((n+"").split(".")[1]||"").length);return function(m){var y=io(Math.round(parseFloat(m)/n)*n*h);return(y-y%1)/h+(ku(m)?0:Ro(m))}},Az=function(n,h){var m=Lo(n),y,b;return!m&&Bl(n)&&(y=m=n.radius||Sa,n.values?(n=Ea(n.values),(b=!ku(n[0]))&&(y*=y)):n=BS(n.increment)),uh(h,m?xi(n)?function(M){return b=n(M),Math.abs(b-M)<=y?b:M}:function(M){for(var P=parseFloat(b?M.x:M),o=parseFloat(b?M.y:0),R=Sa,U=0,V=n.length,Z,te;V--;)b?(Z=n[V].x-P,te=n[V].y-o,Z=Z*Z+te*te):Z=Math.abs(n[V]-P),Z<R&&(R=Z,U=V);return U=!y||R<=y?n[U]:M,b||U===M||ku(M)?U:U+Ro(M)}:BS(n))},Cz=function(n,h,m,y){return uh(Lo(n)?!h:m===!0?!!(m=0):!y,function(){return Lo(n)?n[~~(Math.random()*n.length)]:(m=m||1e-5)&&(y=m<1?Math.pow(10,(m+"").length-2):1)&&Math.floor(Math.round((n-m/2+Math.random()*(h-n+m*.99))/m)*m*y)/y})},rH=function(){for(var n=arguments.length,h=new Array(n),m=0;m<n;m++)h[m]=arguments[m];return function(y){return h.reduce(function(b,M){return M(b)},y)}},nH=function(n,h){return function(m){return n(parseFloat(m))+(h||Ro(m))}},iH=function(n,h,m){return Oz(n,h,0,1,m)},Pz=function(n,h,m){return uh(m,function(y){return n[~~h(y)]})},oH=function a(n,h,m){var y=h-n;return Lo(n)?Pz(n,a(0,n.length),h):uh(m,function(b){return(y+(b-n)%y)%y+n})},sH=function a(n,h,m){var y=h-n,b=y*2;return Lo(n)?Pz(n,a(0,n.length-1),h):uh(m,function(M){return M=(b+(M-n)%b)%b||0,n+(M>y?b-M:M)})},Og=function(n){for(var h=0,m="",y,b,M,P;~(y=n.indexOf("random(",h));)M=n.indexOf(")",y),P=n.charAt(y+7)==="[",b=n.substr(y+7,M-y-7).match(P?fz:OS),m+=n.substr(h,y-h)+Cz(P?b:+b[0],P?0:+b[1],+b[2]||1e-5),h=M+1;return m+n.substr(h,n.length-h)},Oz=function(n,h,m,y,b){var M=h-n,P=y-m;return uh(b,function(o){return m+((o-n)/M*P||0)})},aH=function a(n,h,m,y){var b=isNaN(n+h)?0:function(te){return(1-te)*n+te*h};if(!b){var M=so(n),P={},o,R,U,V,Z;if(m===!0&&(y=1)&&(m=null),M)n={p:n},h={p:h};else if(Lo(n)&&!Lo(h)){for(U=[],V=n.length,Z=V-2,R=1;R<V;R++)U.push(a(n[R-1],n[R]));V--,b=function(se){se*=V;var re=Math.min(Z,~~se);return U[re](se-re)},m=h}else y||(n=Mf(Lo(n)?[]:{},n));if(!U){for(o in h)vM.call(P,n,o,"get",h[o]);b=function(se){return TM(se,P)||(M?n.p:n)}}}return uh(m,b)},XO=function(n,h,m){var y=n.labels,b=Sa,M,P,o;for(M in y)P=y[M]-h,P<0==!!m&&P&&b>(P=Math.abs(P))&&(o=M,b=P);return o},Xs=function(n,h,m){var y=n.vars,b=y[h],M=ri,P=n._ctx,o,R,U;if(b)return o=y[h+"Params"],R=y.callbackScope||n,m&&Yc.length&&Ax(),P&&(ri=P),U=o?b.apply(R,o):b.call(R),ri=M,U},G_=function(n){return th(n),n.scrollTrigger&&n.scrollTrigger.kill(!!ko),n.progress()<1&&Xs(n,"onInterrupt"),n},ip,Dz=[],Rz=function(n){if(n)if(n=!n.name&&n.default||n,dM()||n.headless){var h=n.name,m=xi(n),y=h&&!m&&n.init?function(){this._props=[]}:n,b={init:Pg,render:TM,add:vM,kill:TH,modifier:wH,rawVars:0},M={targetTest:0,get:0,getSetter:wM,aliases:{},register:0};if(Dp(),n!==y){if(qs[h])return;Pa(y,Pa(Cx(n,b),M)),Mf(y.prototype,Mf(b,Cx(n,M))),qs[y.prop=h]=y,n.targetTest&&(Nv.push(y),_M[h]=1),h=(h==="css"?"CSS":h.charAt(0).toUpperCase()+h.substr(1))+"Plugin"}mz(h,y),n.register&&n.register(bs,y,vs)}else Dz.push(n)},Bn=255,W_={aqua:[0,Bn,Bn],lime:[0,Bn,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Bn],navy:[0,0,128],white:[Bn,Bn,Bn],olive:[128,128,0],yellow:[Bn,Bn,0],orange:[Bn,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Bn,0,0],pink:[Bn,192,203],cyan:[0,Bn,Bn],transparent:[Bn,Bn,Bn,0]},oT=function(n,h,m){return n+=n<0?1:n>1?-1:0,(n*6<1?h+(m-h)*n*6:n<.5?m:n*3<2?h+(m-h)*(2/3-n)*6:h)*Bn+.5|0},kz=function(n,h,m){var y=n?ku(n)?[n>>16,n>>8&Bn,n&Bn]:0:W_.black,b,M,P,o,R,U,V,Z,te,se;if(!y){if(n.substr(-1)===","&&(n=n.substr(0,n.length-1)),W_[n])y=W_[n];else if(n.charAt(0)==="#"){if(n.length<6&&(b=n.charAt(1),M=n.charAt(2),P=n.charAt(3),n="#"+b+b+M+M+P+P+(n.length===5?n.charAt(4)+n.charAt(4):"")),n.length===9)return y=parseInt(n.substr(1,6),16),[y>>16,y>>8&Bn,y&Bn,parseInt(n.substr(7),16)/255];n=parseInt(n.substr(1),16),y=[n>>16,n>>8&Bn,n&Bn]}else if(n.substr(0,3)==="hsl"){if(y=se=n.match(OS),!h)o=+y[0]%360/360,R=+y[1]/100,U=+y[2]/100,M=U<=.5?U*(R+1):U+R-U*R,b=U*2-M,y.length>3&&(y[3]*=1),y[0]=oT(o+1/3,b,M),y[1]=oT(o,b,M),y[2]=oT(o-1/3,b,M);else if(~n.indexOf("="))return y=n.match(cz),m&&y.length<4&&(y[3]=1),y}else y=n.match(OS)||W_.transparent;y=y.map(Number)}return h&&!se&&(b=y[0]/Bn,M=y[1]/Bn,P=y[2]/Bn,V=Math.max(b,M,P),Z=Math.min(b,M,P),U=(V+Z)/2,V===Z?o=R=0:(te=V-Z,R=U>.5?te/(2-V-Z):te/(V+Z),o=V===b?(M-P)/te+(M<P?6:0):V===M?(P-b)/te+2:(b-M)/te+4,o*=60),y[0]=~~(o+.5),y[1]=~~(R*100+.5),y[2]=~~(U*100+.5)),m&&y.length<4&&(y[3]=1),y},Lz=function(n){var h=[],m=[],y=-1;return n.split(Kc).forEach(function(b){var M=b.match(np)||[];h.push.apply(h,M),m.push(y+=M.length+1)}),h.c=m,h},YO=function(n,h,m){var y="",b=(n+y).match(Kc),M=h?"hsla(":"rgba(",P=0,o,R,U,V;if(!b)return n;if(b=b.map(function(Z){return(Z=kz(Z,h,1))&&M+(h?Z[0]+","+Z[1]+"%,"+Z[2]+"%,"+Z[3]:Z.join(","))+")"}),m&&(U=Lz(n),o=m.c,o.join(y)!==U.c.join(y)))for(R=n.replace(Kc,"1").split(np),V=R.length-1;P<V;P++)y+=R[P]+(~o.indexOf(P)?b.shift()||M+"0,0,0,0)":(U.length?U:b.length?b:m).shift());if(!R)for(R=n.split(Kc),V=R.length-1;P<V;P++)y+=R[P]+b[P];return y+R[V]},Kc=function(){var a="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",n;for(n in W_)a+="|"+n+"\\b";return new RegExp(a+")","gi")}(),lH=/hsl[a]?\(/,zz=function(n){var h=n.join(" "),m;if(Kc.lastIndex=0,Kc.test(h))return m=lH.test(h),n[1]=YO(n[1],m),n[0]=YO(n[0],m,Lz(n[1])),!0},Dg,Hs=function(){var a=Date.now,n=500,h=33,m=a(),y=m,b=1e3/240,M=b,P=[],o,R,U,V,Z,te,se=function re(Te){var ae=a()-y,q=Te===!0,Q,le,ye,ze;if((ae>n||ae<0)&&(m+=ae-h),y+=ae,ye=y-m,Q=ye-M,(Q>0||q)&&(ze=++V.frame,Z=ye-V.time*1e3,V.time=ye=ye/1e3,M+=Q+(Q>=b?4:b-Q),le=1),q||(o=R(re)),le)for(te=0;te<P.length;te++)P[te](ye,Z,ze,Te)};return V={time:0,frame:0,tick:function(){se(!0)},deltaRatio:function(Te){return Z/(1e3/(Te||60))},wake:function(){dz&&(!DS&&dM()&&(Pl=DS=window,pM=Pl.document||{},Js.gsap=bs,(Pl.gsapVersions||(Pl.gsapVersions=[])).push(bs.version),pz(Ix||Pl.GreenSockGlobals||!Pl.gsap&&Pl||{}),Dz.forEach(Rz)),U=typeof requestAnimationFrame<"u"&&requestAnimationFrame,o&&V.sleep(),R=U||function(Te){return setTimeout(Te,M-V.time*1e3+1|0)},Dg=1,se(2))},sleep:function(){(U?cancelAnimationFrame:clearTimeout)(o),Dg=0,R=Pg},lagSmoothing:function(Te,ae){n=Te||1/0,h=Math.min(ae||33,n)},fps:function(Te){b=1e3/(Te||240),M=V.time*1e3+b},add:function(Te,ae,q){var Q=ae?function(le,ye,ze,He){Te(le,ye,ze,He),V.remove(Q)}:Te;return V.remove(Te),P[q?"unshift":"push"](Q),Dp(),Q},remove:function(Te,ae){~(ae=P.indexOf(Te))&&P.splice(ae,1)&&te>=ae&&te--},_listeners:P},V}(),Dp=function(){return!Dg&&Hs.wake()},_n={},uH=/^[\d.\-M][\d.\-,\s]/,cH=/["']/g,hH=function(n){for(var h={},m=n.substr(1,n.length-3).split(":"),y=m[0],b=1,M=m.length,P,o,R;b<M;b++)o=m[b],P=b!==M-1?o.lastIndexOf(","):o.length,R=o.substr(0,P),h[y]=isNaN(R)?R.replace(cH,"").trim():+R,y=o.substr(P+1).trim();return h},fH=function(n){var h=n.indexOf("(")+1,m=n.indexOf(")"),y=n.indexOf("(",h);return n.substring(h,~y&&y<m?n.indexOf(")",m+1):m)},dH=function(n){var h=(n+"").split("("),m=_n[h[0]];return m&&h.length>1&&m.config?m.config.apply(null,~n.indexOf("{")?[hH(h[1])]:fH(n).split(",").map(vz)):_n._CE&&uH.test(n)?_n._CE("",n):m},Fz=function(n){return function(h){return 1-n(1-h)}},Bz=function a(n,h){for(var m=n._first,y;m;)m instanceof Yo?a(m,h):m.vars.yoyoEase&&(!m._yoyo||!m._repeat)&&m._yoyo!==h&&(m.timeline?a(m.timeline,h):(y=m._ease,m._ease=m._yEase,m._yEase=y,m._yoyo=h)),m=m._next},vf=function(n,h){return n&&(xi(n)?n:_n[n]||dH(n))||h},Rf=function(n,h,m,y){m===void 0&&(m=function(o){return 1-h(1-o)}),y===void 0&&(y=function(o){return o<.5?h(o*2)/2:1-h((1-o)*2)/2});var b={easeIn:h,easeOut:m,easeInOut:y},M;return ys(n,function(P){_n[P]=Js[P]=b,_n[M=P.toLowerCase()]=m;for(var o in b)_n[M+(o==="easeIn"?".in":o==="easeOut"?".out":".inOut")]=_n[P+"."+o]=b[o]}),b},Nz=function(n){return function(h){return h<.5?(1-n(1-h*2))/2:.5+n((h-.5)*2)/2}},sT=function a(n,h,m){var y=h>=1?h:1,b=(m||(n?.3:.45))/(h<1?h:1),M=b/PS*(Math.asin(1/y)||0),P=function(U){return U===1?1:y*Math.pow(2,-10*U)*jq((U-M)*b)+1},o=n==="out"?P:n==="in"?function(R){return 1-P(1-R)}:Nz(P);return b=PS/b,o.config=function(R,U){return a(n,R,U)},o},aT=function a(n,h){h===void 0&&(h=1.70158);var m=function(M){return M?--M*M*((h+1)*M+h)+1:0},y=n==="out"?m:n==="in"?function(b){return 1-m(1-b)}:Nz(m);return y.config=function(b){return a(n,b)},y};ys("Linear,Quad,Cubic,Quart,Quint,Strong",function(a,n){var h=n<5?n+1:n;Rf(a+",Power"+(h-1),n?function(m){return Math.pow(m,h)}:function(m){return m},function(m){return 1-Math.pow(1-m,h)},function(m){return m<.5?Math.pow(m*2,h)/2:1-Math.pow((1-m)*2,h)/2})});_n.Linear.easeNone=_n.none=_n.Linear.easeIn;Rf("Elastic",sT("in"),sT("out"),sT());(function(a,n){var h=1/n,m=2*h,y=2.5*h,b=function(P){return P<h?a*P*P:P<m?a*Math.pow(P-1.5/n,2)+.75:P<y?a*(P-=2.25/n)*P+.9375:a*Math.pow(P-2.625/n,2)+.984375};Rf("Bounce",function(M){return 1-b(1-M)},b)})(7.5625,2.75);Rf("Expo",function(a){return a?Math.pow(2,10*(a-1)):0});Rf("Circ",function(a){return-(lz(1-a*a)-1)});Rf("Sine",function(a){return a===1?1:-Uq(a*Bq)+1});Rf("Back",aT("in"),aT("out"),aT());_n.SteppedEase=_n.steps=Js.SteppedEase={config:function(n,h){n===void 0&&(n=1);var m=1/n,y=n+(h?0:1),b=h?1:0,M=1-jn;return function(P){return((y*qg(0,M,P)|0)+b)*m}}};Cp.ease=_n["quad.out"];ys("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(a){return gM+=a+","+a+"Params,"});var Uz=function(n,h){this.id=Nq++,n._gsap=this,this.target=n,this.harness=h,this.get=h?h.get:gz,this.set=h?h.getSetter:wM},Rg=function(){function a(h){this.vars=h,this._delay=+h.delay||0,(this._repeat=h.repeat===1/0?-2:h.repeat||0)&&(this._rDelay=h.repeatDelay||0,this._yoyo=!!h.yoyo||!!h.yoyoEase),this._ts=1,Op(this,+h.duration,1,1),this.data=h.data,ri&&(this._ctx=ri,ri.data.push(this)),Dg||Hs.wake()}var n=a.prototype;return n.delay=function(m){return m||m===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+m-this._delay),this._delay=m,this):this._delay},n.duration=function(m){return arguments.length?this.totalDuration(this._repeat>0?m+(m+this._rDelay)*this._repeat:m):this.totalDuration()&&this._dur},n.totalDuration=function(m){return arguments.length?(this._dirty=0,Op(this,this._repeat<0?m:(m-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},n.totalTime=function(m,y){if(Dp(),!arguments.length)return this._tTime;var b=this._dp;if(b&&b.smoothChildTiming&&this._ts){for(l1(this,m),!b._dp||b.parent||wz(b,this);b&&b.parent;)b.parent._time!==b._start+(b._ts>=0?b._tTime/b._ts:(b.totalDuration()-b._tTime)/-b._ts)&&b.totalTime(b._tTime,!0),b=b.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&m<this._tDur||this._ts<0&&m>0||!this._tDur&&!m)&&Rl(this._dp,this,this._start-this._delay)}return(this._tTime!==m||!this._dur&&!y||this._initted&&Math.abs(this._zTime)===jn||!m&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=m),yz(this,m,y)),this},n.time=function(m,y){return arguments.length?this.totalTime(Math.min(this.totalDuration(),m+HO(this))%(this._dur+this._rDelay)||(m?this._dur:0),y):this._time},n.totalProgress=function(m,y){return arguments.length?this.totalTime(this.totalDuration()*m,y):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},n.progress=function(m,y){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-m:m)+HO(this),y):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},n.iteration=function(m,y){var b=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(m-1)*b,y):this._repeat?Pp(this._tTime,b)+1:1},n.timeScale=function(m,y){if(!arguments.length)return this._rts===-jn?0:this._rts;if(this._rts===m)return this;var b=this.parent&&this._ts?Px(this.parent._time,this):this._tTime;return this._rts=+m||0,this._ts=this._ps||m===-jn?0:this._rts,this.totalTime(qg(-Math.abs(this._delay),this._tDur,b),y!==!1),a1(this),Zq(this)},n.paused=function(m){return arguments.length?(this._ps!==m&&(this._ps=m,m?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Dp(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==jn&&(this._tTime-=jn)))),this):this._ps},n.startTime=function(m){if(arguments.length){this._start=m;var y=this.parent||this._dp;return y&&(y._sort||!this.parent)&&Rl(y,this,m-this._delay),this}return this._start},n.endTime=function(m){return this._start+(gs(m)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},n.rawTime=function(m){var y=this.parent||this._dp;return y?m&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Px(y.rawTime(m),this):this._tTime:this._tTime},n.revert=function(m){m===void 0&&(m=Gq);var y=ko;return ko=m,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(m),this.totalTime(-.01,m.suppressEvents)),this.data!=="nested"&&m.kill!==!1&&this.kill(),ko=y,this},n.globalTime=function(m){for(var y=this,b=arguments.length?m:y.rawTime();y;)b=y._start+b/(Math.abs(y._ts)||1),y=y._dp;return!this.parent&&this._sat?this._sat.globalTime(m):b},n.repeat=function(m){return arguments.length?(this._repeat=m===1/0?-2:m,ZO(this)):this._repeat===-2?1/0:this._repeat},n.repeatDelay=function(m){if(arguments.length){var y=this._time;return this._rDelay=m,ZO(this),y?this.time(y):this}return this._rDelay},n.yoyo=function(m){return arguments.length?(this._yoyo=m,this):this._yoyo},n.seek=function(m,y){return this.totalTime(xa(this,m),gs(y))},n.restart=function(m,y){return this.play().totalTime(m?-this._delay:0,gs(y))},n.play=function(m,y){return m!=null&&this.seek(m,y),this.reversed(!1).paused(!1)},n.reverse=function(m,y){return m!=null&&this.seek(m||this.totalDuration(),y),this.reversed(!0).paused(!1)},n.pause=function(m,y){return m!=null&&this.seek(m,y),this.paused(!0)},n.resume=function(){return this.paused(!1)},n.reversed=function(m){return arguments.length?(!!m!==this.reversed()&&this.timeScale(-this._rts||(m?-jn:0)),this):this._rts<0},n.invalidate=function(){return this._initted=this._act=0,this._zTime=-jn,this},n.isActive=function(){var m=this.parent||this._dp,y=this._start,b;return!!(!m||this._ts&&this._initted&&m.isActive()&&(b=m.rawTime(!0))>=y&&b<this.endTime(!0)-jn)},n.eventCallback=function(m,y,b){var M=this.vars;return arguments.length>1?(y?(M[m]=y,b&&(M[m+"Params"]=b),m==="onUpdate"&&(this._onUpdate=y)):delete M[m],this):M[m]},n.then=function(m){var y=this;return new Promise(function(b){var M=xi(m)?m:xz,P=function(){var R=y.then;y.then=null,xi(M)&&(M=M(y))&&(M.then||M===y)&&(y.then=R),b(M),y.then=R};y._initted&&y.totalProgress()===1&&y._ts>=0||!y._tTime&&y._ts<0?P():y._prom=P})},n.kill=function(){G_(this)},a}();Pa(Rg.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-jn,_prom:0,_ps:!1,_rts:1});var Yo=function(a){az(n,a);function n(m,y){var b;return m===void 0&&(m={}),b=a.call(this,m)||this,b.labels={},b.smoothChildTiming=!!m.smoothChildTiming,b.autoRemoveChildren=!!m.autoRemoveChildren,b._sort=gs(m.sortChildren),pi&&Rl(m.parent||pi,Tu(b),y),m.reversed&&b.reverse(),m.paused&&b.paused(!0),m.scrollTrigger&&Tz(Tu(b),m.scrollTrigger),b}var h=n.prototype;return h.to=function(y,b,M){return og(0,arguments,this),this},h.from=function(y,b,M){return og(1,arguments,this),this},h.fromTo=function(y,b,M,P){return og(2,arguments,this),this},h.set=function(y,b,M){return b.duration=0,b.parent=this,ig(b).repeatDelay||(b.repeat=0),b.immediateRender=!!b.immediateRender,new Li(y,b,xa(this,M),1),this},h.call=function(y,b,M){return Rl(this,Li.delayedCall(0,y,b),M)},h.staggerTo=function(y,b,M,P,o,R,U){return M.duration=b,M.stagger=M.stagger||P,M.onComplete=R,M.onCompleteParams=U,M.parent=this,new Li(y,M,xa(this,o)),this},h.staggerFrom=function(y,b,M,P,o,R,U){return M.runBackwards=1,ig(M).immediateRender=gs(M.immediateRender),this.staggerTo(y,b,M,P,o,R,U)},h.staggerFromTo=function(y,b,M,P,o,R,U,V){return P.startAt=M,ig(P).immediateRender=gs(P.immediateRender),this.staggerTo(y,b,P,o,R,U,V)},h.render=function(y,b,M){var P=this._time,o=this._dirty?this.totalDuration():this._tDur,R=this._dur,U=y<=0?0:io(y),V=this._zTime<0!=y<0&&(this._initted||!R),Z,te,se,re,Te,ae,q,Q,le,ye,ze,He;if(this!==pi&&U>o&&y>=0&&(U=o),U!==this._tTime||M||V){if(P!==this._time&&R&&(U+=this._time-P,y+=this._time-P),Z=U,le=this._start,Q=this._ts,ae=!Q,V&&(R||(P=this._zTime),(y||!b)&&(this._zTime=y)),this._repeat){if(ze=this._yoyo,Te=R+this._rDelay,this._repeat<-1&&y<0)return this.totalTime(Te*100+y,b,M);if(Z=io(U%Te),U===o?(re=this._repeat,Z=R):(re=~~(U/Te),re&&re===U/Te&&(Z=R,re--),Z>R&&(Z=R)),ye=Pp(this._tTime,Te),!P&&this._tTime&&ye!==re&&this._tTime-ye*Te-this._dur<=0&&(ye=re),ze&&re&1&&(Z=R-Z,He=1),re!==ye&&!this._lock){var Ne=ze&&ye&1,xe=Ne===(ze&&re&1);if(re<ye&&(Ne=!Ne),P=Ne?0:U%R?R:U,this._lock=1,this.render(P||(He?0:io(re*Te)),b,!R)._lock=0,this._tTime=U,!b&&this.parent&&Xs(this,"onRepeat"),this.vars.repeatRefresh&&!He&&(this.invalidate()._lock=1),P&&P!==this._time||ae!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(R=this._dur,o=this._tDur,xe&&(this._lock=2,P=Ne?R:-1e-4,this.render(P,!0),this.vars.repeatRefresh&&!He&&this.invalidate()),this._lock=0,!this._ts&&!ae)return this;Bz(this,He)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(q=Qq(this,io(P),io(Z)),q&&(U-=Z-(Z=q._start))),this._tTime=U,this._time=Z,this._act=!Q,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=y,P=0),!P&&Z&&!b&&!re&&(Xs(this,"onStart"),this._tTime!==U))return this;if(Z>=P&&y>=0)for(te=this._first;te;){if(se=te._next,(te._act||Z>=te._start)&&te._ts&&q!==te){if(te.parent!==this)return this.render(y,b,M);if(te.render(te._ts>0?(Z-te._start)*te._ts:(te._dirty?te.totalDuration():te._tDur)+(Z-te._start)*te._ts,b,M),Z!==this._time||!this._ts&&!ae){q=0,se&&(U+=this._zTime=-jn);break}}te=se}else{te=this._last;for(var Me=y<0?y:Z;te;){if(se=te._prev,(te._act||Me<=te._end)&&te._ts&&q!==te){if(te.parent!==this)return this.render(y,b,M);if(te.render(te._ts>0?(Me-te._start)*te._ts:(te._dirty?te.totalDuration():te._tDur)+(Me-te._start)*te._ts,b,M||ko&&(te._initted||te._startAt)),Z!==this._time||!this._ts&&!ae){q=0,se&&(U+=this._zTime=Me?-jn:jn);break}}te=se}}if(q&&!b&&(this.pause(),q.render(Z>=P?0:-jn)._zTime=Z>=P?1:-1,this._ts))return this._start=le,a1(this),this.render(y,b,M);this._onUpdate&&!b&&Xs(this,"onUpdate",!0),(U===o&&this._tTime>=this.totalDuration()||!U&&P)&&(le===this._start||Math.abs(Q)!==Math.abs(this._ts))&&(this._lock||((y||!R)&&(U===o&&this._ts>0||!U&&this._ts<0)&&th(this,1),!b&&!(y<0&&!P)&&(U||P||!o)&&(Xs(this,U===o&&y>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(U<o&&this.timeScale()>0)&&this._prom())))}return this},h.add=function(y,b){var M=this;if(ku(b)||(b=xa(this,b,y)),!(y instanceof Rg)){if(Lo(y))return y.forEach(function(P){return M.add(P,b)}),this;if(so(y))return this.addLabel(y,b);if(xi(y))y=Li.delayedCall(0,y);else return this}return this!==y?Rl(this,y,b):this},h.getChildren=function(y,b,M,P){y===void 0&&(y=!0),b===void 0&&(b=!0),M===void 0&&(M=!0),P===void 0&&(P=-Sa);for(var o=[],R=this._first;R;)R._start>=P&&(R instanceof Li?b&&o.push(R):(M&&o.push(R),y&&o.push.apply(o,R.getChildren(!0,b,M)))),R=R._next;return o},h.getById=function(y){for(var b=this.getChildren(1,1,1),M=b.length;M--;)if(b[M].vars.id===y)return b[M]},h.remove=function(y){return so(y)?this.removeLabel(y):xi(y)?this.killTweensOf(y):(s1(this,y),y===this._recent&&(this._recent=this._last),yf(this))},h.totalTime=function(y,b){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=io(Hs.time-(this._ts>0?y/this._ts:(this.totalDuration()-y)/-this._ts))),a.prototype.totalTime.call(this,y,b),this._forcing=0,this):this._tTime},h.addLabel=function(y,b){return this.labels[y]=xa(this,b),this},h.removeLabel=function(y){return delete this.labels[y],this},h.addPause=function(y,b,M){var P=Li.delayedCall(0,b||Pg,M);return P.data="isPause",this._hasPause=1,Rl(this,P,xa(this,y))},h.removePause=function(y){var b=this._first;for(y=xa(this,y);b;)b._start===y&&b.data==="isPause"&&th(b),b=b._next},h.killTweensOf=function(y,b,M){for(var P=this.getTweensOf(y,M),o=P.length;o--;)Nc!==P[o]&&P[o].kill(y,b);return this},h.getTweensOf=function(y,b){for(var M=[],P=Ea(y),o=this._first,R=ku(b),U;o;)o instanceof Li?Wq(o._targets,P)&&(R?(!Nc||o._initted&&o._ts)&&o.globalTime(0)<=b&&o.globalTime(o.totalDuration())>b:!b||o.isActive())&&M.push(o):(U=o.getTweensOf(P,b)).length&&M.push.apply(M,U),o=o._next;return M},h.tweenTo=function(y,b){b=b||{};var M=this,P=xa(M,y),o=b,R=o.startAt,U=o.onStart,V=o.onStartParams,Z=o.immediateRender,te,se=Li.to(M,Pa({ease:b.ease||"none",lazy:!1,immediateRender:!1,time:P,overwrite:"auto",duration:b.duration||Math.abs((P-(R&&"time"in R?R.time:M._time))/M.timeScale())||jn,onStart:function(){if(M.pause(),!te){var Te=b.duration||Math.abs((P-(R&&"time"in R?R.time:M._time))/M.timeScale());se._dur!==Te&&Op(se,Te,0,1).render(se._time,!0,!0),te=1}U&&U.apply(se,V||[])}},b));return Z?se.render(0):se},h.tweenFromTo=function(y,b,M){return this.tweenTo(b,Pa({startAt:{time:xa(this,y)}},M))},h.recent=function(){return this._recent},h.nextLabel=function(y){return y===void 0&&(y=this._time),XO(this,xa(this,y))},h.previousLabel=function(y){return y===void 0&&(y=this._time),XO(this,xa(this,y),1)},h.currentLabel=function(y){return arguments.length?this.seek(y,!0):this.previousLabel(this._time+jn)},h.shiftChildren=function(y,b,M){M===void 0&&(M=0);for(var P=this._first,o=this.labels,R;P;)P._start>=M&&(P._start+=y,P._end+=y),P=P._next;if(b)for(R in o)o[R]>=M&&(o[R]+=y);return yf(this)},h.invalidate=function(y){var b=this._first;for(this._lock=0;b;)b.invalidate(y),b=b._next;return a.prototype.invalidate.call(this,y)},h.clear=function(y){y===void 0&&(y=!0);for(var b=this._first,M;b;)M=b._next,this.remove(b),b=M;return this._dp&&(this._time=this._tTime=this._pTime=0),y&&(this.labels={}),yf(this)},h.totalDuration=function(y){var b=0,M=this,P=M._last,o=Sa,R,U,V;if(arguments.length)return M.timeScale((M._repeat<0?M.duration():M.totalDuration())/(M.reversed()?-y:y));if(M._dirty){for(V=M.parent;P;)R=P._prev,P._dirty&&P.totalDuration(),U=P._start,U>o&&M._sort&&P._ts&&!M._lock?(M._lock=1,Rl(M,P,U-P._delay,1)._lock=0):o=U,U<0&&P._ts&&(b-=U,(!V&&!M._dp||V&&V.smoothChildTiming)&&(M._start+=U/M._ts,M._time-=U,M._tTime-=U),M.shiftChildren(-U,!1,-1/0),o=0),P._end>b&&P._ts&&(b=P._end),P=R;Op(M,M===pi&&M._time>b?M._time:b,1,1),M._dirty=0}return M._tDur},n.updateRoot=function(y){if(pi._ts&&(yz(pi,Px(y,pi)),_z=Hs.frame),Hs.frame>=WO){WO+=Ks.autoSleep||120;var b=pi._first;if((!b||!b._ts)&&Ks.autoSleep&&Hs._listeners.length<2){for(;b&&!b._ts;)b=b._next;b||Hs.sleep()}}},n}(Rg);Pa(Yo.prototype,{_lock:0,_hasPause:0,_forcing:0});var pH=function(n,h,m,y,b,M,P){var o=new vs(this._pt,n,h,0,1,qz,null,b),R=0,U=0,V,Z,te,se,re,Te,ae,q;for(o.b=m,o.e=y,m+="",y+="",(ae=~y.indexOf("random("))&&(y=Og(y)),M&&(q=[m,y],M(q,n,h),m=q[0],y=q[1]),Z=m.match(nT)||[];V=nT.exec(y);)se=V[0],re=y.substring(R,V.index),te?te=(te+1)%5:re.substr(-5)==="rgba("&&(te=1),se!==Z[U++]&&(Te=parseFloat(Z[U-1])||0,o._pt={_next:o._pt,p:re||U===1?re:",",s:Te,c:se.charAt(1)==="="?pp(Te,se)-Te:parseFloat(se)-Te,m:te&&te<4?Math.round:0},R=nT.lastIndex);return o.c=R<y.length?y.substring(R,y.length):"",o.fp=P,(hz.test(y)||ae)&&(o.e=0),this._pt=o,o},vM=function(n,h,m,y,b,M,P,o,R,U){xi(y)&&(y=y(b||0,n,M));var V=n[h],Z=m!=="get"?m:xi(V)?R?n[h.indexOf("set")||!xi(n["get"+h.substr(3)])?h:"get"+h.substr(3)](R):n[h]():V,te=xi(V)?R?vH:Gz:bM,se;if(so(y)&&(~y.indexOf("random(")&&(y=Og(y)),y.charAt(1)==="="&&(se=pp(Z,y)+(Ro(Z)||0),(se||se===0)&&(y=se))),!U||Z!==y||NS)return!isNaN(Z*y)&&y!==""?(se=new vs(this._pt,n,h,+Z||0,y-(Z||0),typeof V=="boolean"?bH:Wz,0,te),R&&(se.fp=R),P&&se.modifier(P,this,n),this._pt=se):(!V&&!(h in n)&&mM(h,y),pH.call(this,n,h,Z,y,te,o||Ks.stringFilter,R))},mH=function(n,h,m,y,b){if(xi(n)&&(n=sg(n,b,h,m,y)),!Bl(n)||n.style&&n.nodeType||Lo(n)||uz(n))return so(n)?sg(n,b,h,m,y):n;var M={},P;for(P in n)M[P]=sg(n[P],b,h,m,y);return M},jz=function(n,h,m,y,b,M){var P,o,R,U;if(qs[n]&&(P=new qs[n]).init(b,P.rawVars?h[n]:mH(h[n],y,b,M,m),m,y,M)!==!1&&(m._pt=o=new vs(m._pt,b,n,0,1,P.render,P,0,P.priority),m!==ip))for(R=m._ptLookup[m._targets.indexOf(b)],U=P._props.length;U--;)R[P._props[U]]=o;return P},Nc,NS,xM=function a(n,h,m){var y=n.vars,b=y.ease,M=y.startAt,P=y.immediateRender,o=y.lazy,R=y.onUpdate,U=y.runBackwards,V=y.yoyoEase,Z=y.keyframes,te=y.autoRevert,se=n._dur,re=n._startAt,Te=n._targets,ae=n.parent,q=ae&&ae.data==="nested"?ae.vars.targets:Te,Q=n._overwrite==="auto"&&!hM,le=n.timeline,ye,ze,He,Ne,xe,Me,Ie,Je,Be,Ce,Re,rt,st;if(le&&(!Z||!b)&&(b="none"),n._ease=vf(b,Cp.ease),n._yEase=V?Fz(vf(V===!0?b:V,Cp.ease)):0,V&&n._yoyo&&!n._repeat&&(V=n._yEase,n._yEase=n._ease,n._ease=V),n._from=!le&&!!y.runBackwards,!le||Z&&!y.stagger){if(Je=Te[0]?gf(Te[0]).harness:0,rt=Je&&y[Je.prop],ye=Cx(y,_M),re&&(re._zTime<0&&re.progress(1),h<0&&U&&P&&!te?re.render(-1,!0):re.revert(U&&se?Bv:$q),re._lazy=0),M){if(th(n._startAt=Li.set(Te,Pa({data:"isStart",overwrite:!1,parent:ae,immediateRender:!0,lazy:!re&&gs(o),startAt:null,delay:0,onUpdate:R&&function(){return Xs(n,"onUpdate")},stagger:0},M))),n._startAt._dp=0,n._startAt._sat=n,h<0&&(ko||!P&&!te)&&n._startAt.revert(Bv),P&&se&&h<=0&&m<=0){h&&(n._zTime=h);return}}else if(U&&se&&!re){if(h&&(P=!1),He=Pa({overwrite:!1,data:"isFromStart",lazy:P&&!re&&gs(o),immediateRender:P,stagger:0,parent:ae},ye),rt&&(He[Je.prop]=rt),th(n._startAt=Li.set(Te,He)),n._startAt._dp=0,n._startAt._sat=n,h<0&&(ko?n._startAt.revert(Bv):n._startAt.render(-1,!0)),n._zTime=h,!P)a(n._startAt,jn,jn);else if(!h)return}for(n._pt=n._ptCache=0,o=se&&gs(o)||o&&!se,ze=0;ze<Te.length;ze++){if(xe=Te[ze],Ie=xe._gsap||yM(Te)[ze]._gsap,n._ptLookup[ze]=Ce={},RS[Ie.id]&&Yc.length&&Ax(),Re=q===Te?ze:q.indexOf(xe),Je&&(Be=new Je).init(xe,rt||ye,n,Re,q)!==!1&&(n._pt=Ne=new vs(n._pt,xe,Be.name,0,1,Be.render,Be,0,Be.priority),Be._props.forEach(function(at){Ce[at]=Ne}),Be.priority&&(Me=1)),!Je||rt)for(He in ye)qs[He]&&(Be=jz(He,ye,n,Re,xe,q))?Be.priority&&(Me=1):Ce[He]=Ne=vM.call(n,xe,He,"get",ye[He],Re,q,0,y.stringFilter);n._op&&n._op[ze]&&n.kill(xe,n._op[ze]),Q&&n._pt&&(Nc=n,pi.killTweensOf(xe,Ce,n.globalTime(h)),st=!n.parent,Nc=0),n._pt&&o&&(RS[Ie.id]=1)}Me&&Hz(n),n._onInit&&n._onInit(n)}n._onUpdate=R,n._initted=(!n._op||n._pt)&&!st,Z&&h<=0&&le.render(Sa,!0,!0)},_H=function(n,h,m,y,b,M,P,o){var R=(n._pt&&n._ptCache||(n._ptCache={}))[h],U,V,Z,te;if(!R)for(R=n._ptCache[h]=[],Z=n._ptLookup,te=n._targets.length;te--;){if(U=Z[te][h],U&&U.d&&U.d._pt)for(U=U.d._pt;U&&U.p!==h&&U.fp!==h;)U=U._next;if(!U)return NS=1,n.vars[h]="+=0",xM(n,P),NS=0,o?Cg(h+" not eligible for reset"):1;R.push(U)}for(te=R.length;te--;)V=R[te],U=V._pt||V,U.s=(y||y===0)&&!b?y:U.s+(y||0)+M*U.c,U.c=m-U.s,V.e&&(V.e=Ei(m)+Ro(V.e)),V.b&&(V.b=U.s+Ro(V.b))},gH=function(n,h){var m=n[0]?gf(n[0]).harness:0,y=m&&m.aliases,b,M,P,o;if(!y)return h;b=Mf({},h);for(M in y)if(M in b)for(o=y[M].split(","),P=o.length;P--;)b[o[P]]=b[M];return b},yH=function(n,h,m,y){var b=h.ease||y||"power1.inOut",M,P;if(Lo(h))P=m[n]||(m[n]=[]),h.forEach(function(o,R){return P.push({t:R/(h.length-1)*100,v:o,e:b})});else for(M in h)P=m[M]||(m[M]=[]),M==="ease"||P.push({t:parseFloat(n),v:h[M],e:b})},sg=function(n,h,m,y,b){return xi(n)?n.call(h,m,y,b):so(n)&&~n.indexOf("random(")?Og(n):n},Vz=gM+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",$z={};ys(Vz+",id,stagger,delay,duration,paused,scrollTrigger",function(a){return $z[a]=1});var Li=function(a){az(n,a);function n(m,y,b,M){var P;typeof y=="number"&&(b.duration=y,y=b,b=null),P=a.call(this,M?y:ig(y))||this;var o=P.vars,R=o.duration,U=o.delay,V=o.immediateRender,Z=o.stagger,te=o.overwrite,se=o.keyframes,re=o.defaults,Te=o.scrollTrigger,ae=o.yoyoEase,q=y.parent||pi,Q=(Lo(m)||uz(m)?ku(m[0]):"length"in y)?[m]:Ea(m),le,ye,ze,He,Ne,xe,Me,Ie;if(P._targets=Q.length?yM(Q):Cg("GSAP target "+m+" not found. https://gsap.com",!Ks.nullTargetWarn)||[],P._ptLookup=[],P._overwrite=te,se||Z||dv(R)||dv(U)){if(y=P.vars,le=P.timeline=new Yo({data:"nested",defaults:re||{},targets:q&&q.data==="nested"?q.vars.targets:Q}),le.kill(),le.parent=le._dp=Tu(P),le._start=0,Z||dv(R)||dv(U)){if(He=Q.length,Me=Z&&Iz(Z),Bl(Z))for(Ne in Z)~Vz.indexOf(Ne)&&(Ie||(Ie={}),Ie[Ne]=Z[Ne]);for(ye=0;ye<He;ye++)ze=Cx(y,$z),ze.stagger=0,ae&&(ze.yoyoEase=ae),Ie&&Mf(ze,Ie),xe=Q[ye],ze.duration=+sg(R,Tu(P),ye,xe,Q),ze.delay=(+sg(U,Tu(P),ye,xe,Q)||0)-P._delay,!Z&&He===1&&ze.delay&&(P._delay=U=ze.delay,P._start+=U,ze.delay=0),le.to(xe,ze,Me?Me(ye,xe,Q):0),le._ease=_n.none;le.duration()?R=U=0:P.timeline=0}else if(se){ig(Pa(le.vars.defaults,{ease:"none"})),le._ease=vf(se.ease||y.ease||"none");var Je=0,Be,Ce,Re;if(Lo(se))se.forEach(function(rt){return le.to(Q,rt,">")}),le.duration();else{ze={};for(Ne in se)Ne==="ease"||Ne==="easeEach"||yH(Ne,se[Ne],ze,se.easeEach);for(Ne in ze)for(Be=ze[Ne].sort(function(rt,st){return rt.t-st.t}),Je=0,ye=0;ye<Be.length;ye++)Ce=Be[ye],Re={ease:Ce.e,duration:(Ce.t-(ye?Be[ye-1].t:0))/100*R},Re[Ne]=Ce.v,le.to(Q,Re,Je),Je+=Re.duration;le.duration()<R&&le.to({},{duration:R-le.duration()})}}R||P.duration(R=le.duration())}else P.timeline=0;return te===!0&&!hM&&(Nc=Tu(P),pi.killTweensOf(Q),Nc=0),Rl(q,Tu(P),b),y.reversed&&P.reverse(),y.paused&&P.paused(!0),(V||!R&&!se&&P._start===io(q._time)&&gs(V)&&Xq(Tu(P))&&q.data!=="nested")&&(P._tTime=-jn,P.render(Math.max(0,-U)||0)),Te&&Tz(Tu(P),Te),P}var h=n.prototype;return h.render=function(y,b,M){var P=this._time,o=this._tDur,R=this._dur,U=y<0,V=y>o-jn&&!U?o:y<jn?0:y,Z,te,se,re,Te,ae,q,Q,le;if(!R)Kq(this,y,b,M);else if(V!==this._tTime||!y||M||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==U){if(Z=V,Q=this.timeline,this._repeat){if(re=R+this._rDelay,this._repeat<-1&&U)return this.totalTime(re*100+y,b,M);if(Z=io(V%re),V===o?(se=this._repeat,Z=R):(se=~~(V/re),se&&se===io(V/re)&&(Z=R,se--),Z>R&&(Z=R)),ae=this._yoyo&&se&1,ae&&(le=this._yEase,Z=R-Z),Te=Pp(this._tTime,re),Z===P&&!M&&this._initted&&se===Te)return this._tTime=V,this;se!==Te&&(Q&&this._yEase&&Bz(Q,ae),this.vars.repeatRefresh&&!ae&&!this._lock&&this._time!==re&&this._initted&&(this._lock=M=1,this.render(io(re*se),!0).invalidate()._lock=0))}if(!this._initted){if(Sz(this,U?y:Z,M,b,V))return this._tTime=0,this;if(P!==this._time&&!(M&&this.vars.repeatRefresh&&se!==Te))return this;if(R!==this._dur)return this.render(y,b,M)}if(this._tTime=V,this._time=Z,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=q=(le||this._ease)(Z/R),this._from&&(this.ratio=q=1-q),Z&&!P&&!b&&!se&&(Xs(this,"onStart"),this._tTime!==V))return this;for(te=this._pt;te;)te.r(q,te.d),te=te._next;Q&&Q.render(y<0?y:Q._dur*Q._ease(Z/this._dur),b,M)||this._startAt&&(this._zTime=y),this._onUpdate&&!b&&(U&&kS(this,y,b,M),Xs(this,"onUpdate")),this._repeat&&se!==Te&&this.vars.onRepeat&&!b&&this.parent&&Xs(this,"onRepeat"),(V===this._tDur||!V)&&this._tTime===V&&(U&&!this._onUpdate&&kS(this,y,!0,!0),(y||!R)&&(V===this._tDur&&this._ts>0||!V&&this._ts<0)&&th(this,1),!b&&!(U&&!P)&&(V||P||ae)&&(Xs(this,V===o?"onComplete":"onReverseComplete",!0),this._prom&&!(V<o&&this.timeScale()>0)&&this._prom()))}return this},h.targets=function(){return this._targets},h.invalidate=function(y){return(!y||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(y),a.prototype.invalidate.call(this,y)},h.resetTo=function(y,b,M,P,o){Dg||Hs.wake(),this._ts||this.play();var R=Math.min(this._dur,(this._dp._time-this._start)*this._ts),U;return this._initted||xM(this,R),U=this._ease(R/this._dur),_H(this,y,b,M,P,U,R,o)?this.resetTo(y,b,M,P,1):(l1(this,0),this.parent||bz(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},h.kill=function(y,b){if(b===void 0&&(b="all"),!y&&(!b||b==="all"))return this._lazy=this._pt=0,this.parent?G_(this):this;if(this.timeline){var M=this.timeline.totalDuration();return this.timeline.killTweensOf(y,b,Nc&&Nc.vars.overwrite!==!0)._first||G_(this),this.parent&&M!==this.timeline.totalDuration()&&Op(this,this._dur*this.timeline._tDur/M,0,1),this}var P=this._targets,o=y?Ea(y):P,R=this._ptLookup,U=this._pt,V,Z,te,se,re,Te,ae;if((!b||b==="all")&&Hq(P,o))return b==="all"&&(this._pt=0),G_(this);for(V=this._op=this._op||[],b!=="all"&&(so(b)&&(re={},ys(b,function(q){return re[q]=1}),b=re),b=gH(P,b)),ae=P.length;ae--;)if(~o.indexOf(P[ae])){Z=R[ae],b==="all"?(V[ae]=b,se=Z,te={}):(te=V[ae]=V[ae]||{},se=b);for(re in se)Te=Z&&Z[re],Te&&((!("kill"in Te.d)||Te.d.kill(re)===!0)&&s1(this,Te,"_pt"),delete Z[re]),te!=="all"&&(te[re]=1)}return this._initted&&!this._pt&&U&&G_(this),this},n.to=function(y,b){return new n(y,b,arguments[2])},n.from=function(y,b){return og(1,arguments)},n.delayedCall=function(y,b,M,P){return new n(b,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:y,onComplete:b,onReverseComplete:b,onCompleteParams:M,onReverseCompleteParams:M,callbackScope:P})},n.fromTo=function(y,b,M){return og(2,arguments)},n.set=function(y,b){return b.duration=0,b.repeatDelay||(b.repeat=0),new n(y,b)},n.killTweensOf=function(y,b,M){return pi.killTweensOf(y,b,M)},n}(Rg);Pa(Li.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});ys("staggerTo,staggerFrom,staggerFromTo",function(a){Li[a]=function(){var n=new Yo,h=zS.call(arguments,0);return h.splice(a==="staggerFromTo"?5:4,0,0),n[a].apply(n,h)}});var bM=function(n,h,m){return n[h]=m},Gz=function(n,h,m){return n[h](m)},vH=function(n,h,m,y){return n[h](y.fp,m)},xH=function(n,h,m){return n.setAttribute(h,m)},wM=function(n,h){return xi(n[h])?Gz:fM(n[h])&&n.setAttribute?xH:bM},Wz=function(n,h){return h.set(h.t,h.p,Math.round((h.s+h.c*n)*1e6)/1e6,h)},bH=function(n,h){return h.set(h.t,h.p,!!(h.s+h.c*n),h)},qz=function(n,h){var m=h._pt,y="";if(!n&&h.b)y=h.b;else if(n===1&&h.e)y=h.e;else{for(;m;)y=m.p+(m.m?m.m(m.s+m.c*n):Math.round((m.s+m.c*n)*1e4)/1e4)+y,m=m._next;y+=h.c}h.set(h.t,h.p,y,h)},TM=function(n,h){for(var m=h._pt;m;)m.r(n,m.d),m=m._next},wH=function(n,h,m,y){for(var b=this._pt,M;b;)M=b._next,b.p===y&&b.modifier(n,h,m),b=M},TH=function(n){for(var h=this._pt,m,y;h;)y=h._next,h.p===n&&!h.op||h.op===n?s1(this,h,"_pt"):h.dep||(m=1),h=y;return!m},SH=function(n,h,m,y){y.mSet(n,h,y.m.call(y.tween,m,y.mt),y)},Hz=function(n){for(var h=n._pt,m,y,b,M;h;){for(m=h._next,y=b;y&&y.pr>h.pr;)y=y._next;(h._prev=y?y._prev:M)?h._prev._next=h:b=h,(h._next=y)?y._prev=h:M=h,h=m}n._pt=b},vs=function(){function a(h,m,y,b,M,P,o,R,U){this.t=m,this.s=b,this.c=M,this.p=y,this.r=P||Wz,this.d=o||this,this.set=R||bM,this.pr=U||0,this._next=h,h&&(h._prev=this)}var n=a.prototype;return n.modifier=function(m,y,b){this.mSet=this.mSet||this.set,this.set=SH,this.m=m,this.mt=b,this.tween=y},a}();ys(gM+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(a){return _M[a]=1});Js.TweenMax=Js.TweenLite=Li;Js.TimelineLite=Js.TimelineMax=Yo;pi=new Yo({sortChildren:!1,defaults:Cp,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Ks.stringFilter=zz;var xf=[],Uv={},EH=[],KO=0,MH=0,lT=function(n){return(Uv[n]||EH).map(function(h){return h()})},US=function(){var n=Date.now(),h=[];n-KO>2&&(lT("matchMediaInit"),xf.forEach(function(m){var y=m.queries,b=m.conditions,M,P,o,R;for(P in y)M=Pl.matchMedia(y[P]).matches,M&&(o=1),M!==b[P]&&(b[P]=M,R=1);R&&(m.revert(),o&&h.push(m))}),lT("matchMediaRevert"),h.forEach(function(m){return m.onMatch(m,function(y){return m.add(null,y)})}),KO=n,lT("matchMedia"))},Zz=function(){function a(h,m){this.selector=m&&FS(m),this.data=[],this._r=[],this.isReverted=!1,this.id=MH++,h&&this.add(h)}var n=a.prototype;return n.add=function(m,y,b){xi(m)&&(b=y,y=m,m=xi);var M=this,P=function(){var R=ri,U=M.selector,V;return R&&R!==M&&R.data.push(M),b&&(M.selector=FS(b)),ri=M,V=y.apply(M,arguments),xi(V)&&M._r.push(V),ri=R,M.selector=U,M.isReverted=!1,V};return M.last=P,m===xi?P(M,function(o){return M.add(null,o)}):m?M[m]=P:P},n.ignore=function(m){var y=ri;ri=null,m(this),ri=y},n.getTweens=function(){var m=[];return this.data.forEach(function(y){return y instanceof a?m.push.apply(m,y.getTweens()):y instanceof Li&&!(y.parent&&y.parent.data==="nested")&&m.push(y)}),m},n.clear=function(){this._r.length=this.data.length=0},n.kill=function(m,y){var b=this;if(m?function(){for(var P=b.getTweens(),o=b.data.length,R;o--;)R=b.data[o],R.data==="isFlip"&&(R.revert(),R.getChildren(!0,!0,!1).forEach(function(U){return P.splice(P.indexOf(U),1)}));for(P.map(function(U){return{g:U._dur||U._delay||U._sat&&!U._sat.vars.immediateRender?U.globalTime(0):-1/0,t:U}}).sort(function(U,V){return V.g-U.g||-1/0}).forEach(function(U){return U.t.revert(m)}),o=b.data.length;o--;)R=b.data[o],R instanceof Yo?R.data!=="nested"&&(R.scrollTrigger&&R.scrollTrigger.revert(),R.kill()):!(R instanceof Li)&&R.revert&&R.revert(m);b._r.forEach(function(U){return U(m,b)}),b.isReverted=!0}():this.data.forEach(function(P){return P.kill&&P.kill()}),this.clear(),y)for(var M=xf.length;M--;)xf[M].id===this.id&&xf.splice(M,1)},n.revert=function(m){this.kill(m||{})},a}(),IH=function(){function a(h){this.contexts=[],this.scope=h,ri&&ri.data.push(this)}var n=a.prototype;return n.add=function(m,y,b){Bl(m)||(m={matches:m});var M=new Zz(0,b||this.scope),P=M.conditions={},o,R,U;ri&&!M.selector&&(M.selector=ri.selector),this.contexts.push(M),y=M.add("onMatch",y),M.queries=m;for(R in m)R==="all"?U=1:(o=Pl.matchMedia(m[R]),o&&(xf.indexOf(M)<0&&xf.push(M),(P[R]=o.matches)&&(U=1),o.addListener?o.addListener(US):o.addEventListener("change",US)));return U&&y(M,function(V){return M.add(null,V)}),this},n.revert=function(m){this.kill(m||{})},n.kill=function(m){this.contexts.forEach(function(y){return y.kill(m,!0)})},a}(),Ox={registerPlugin:function(){for(var n=arguments.length,h=new Array(n),m=0;m<n;m++)h[m]=arguments[m];h.forEach(function(y){return Rz(y)})},timeline:function(n){return new Yo(n)},getTweensOf:function(n,h){return pi.getTweensOf(n,h)},getProperty:function(n,h,m,y){so(n)&&(n=Ea(n)[0]);var b=gf(n||{}).get,M=m?xz:vz;return m==="native"&&(m=""),n&&(h?M((qs[h]&&qs[h].get||b)(n,h,m,y)):function(P,o,R){return M((qs[P]&&qs[P].get||b)(n,P,o,R))})},quickSetter:function(n,h,m){if(n=Ea(n),n.length>1){var y=n.map(function(U){return bs.quickSetter(U,h,m)}),b=y.length;return function(U){for(var V=b;V--;)y[V](U)}}n=n[0]||{};var M=qs[h],P=gf(n),o=P.harness&&(P.harness.aliases||{})[h]||h,R=M?function(U){var V=new M;ip._pt=0,V.init(n,m?U+m:U,ip,0,[n]),V.render(1,V),ip._pt&&TM(1,ip)}:P.set(n,o);return M?R:function(U){return R(n,o,m?U+m:U,P,1)}},quickTo:function(n,h,m){var y,b=bs.to(n,Mf((y={},y[h]="+=0.1",y.paused=!0,y),m||{})),M=function(o,R,U){return b.resetTo(h,o,R,U)};return M.tween=b,M},isTweening:function(n){return pi.getTweensOf(n,!0).length>0},defaults:function(n){return n&&n.ease&&(n.ease=vf(n.ease,Cp.ease)),qO(Cp,n||{})},config:function(n){return qO(Ks,n||{})},registerEffect:function(n){var h=n.name,m=n.effect,y=n.plugins,b=n.defaults,M=n.extendTimeline;(y||"").split(",").forEach(function(P){return P&&!qs[P]&&!Js[P]&&Cg(h+" effect requires "+P+" plugin.")}),iT[h]=function(P,o,R){return m(Ea(P),Pa(o||{},b),R)},M&&(Yo.prototype[h]=function(P,o,R){return this.add(iT[h](P,Bl(o)?o:(R=o)&&{},this),R)})},registerEase:function(n,h){_n[n]=vf(h)},parseEase:function(n,h){return arguments.length?vf(n,h):_n},getById:function(n){return pi.getById(n)},exportRoot:function(n,h){n===void 0&&(n={});var m=new Yo(n),y,b;for(m.smoothChildTiming=gs(n.smoothChildTiming),pi.remove(m),m._dp=0,m._time=m._tTime=pi._time,y=pi._first;y;)b=y._next,(h||!(!y._dur&&y instanceof Li&&y.vars.onComplete===y._targets[0]))&&Rl(m,y,y._start-y._delay),y=b;return Rl(pi,m,0),m},context:function(n,h){return n?new Zz(n,h):ri},matchMedia:function(n){return new IH(n)},matchMediaRefresh:function(){return xf.forEach(function(n){var h=n.conditions,m,y;for(y in h)h[y]&&(h[y]=!1,m=1);m&&n.revert()})||US()},addEventListener:function(n,h){var m=Uv[n]||(Uv[n]=[]);~m.indexOf(h)||m.push(h)},removeEventListener:function(n,h){var m=Uv[n],y=m&&m.indexOf(h);y>=0&&m.splice(y,1)},utils:{wrap:oH,wrapYoyo:sH,distribute:Iz,random:Cz,snap:Az,normalize:iH,getUnit:Ro,clamp:eH,splitColor:kz,toArray:Ea,selector:FS,mapRange:Oz,pipe:rH,unitize:nH,interpolate:aH,shuffle:Mz},install:pz,effects:iT,ticker:Hs,updateRoot:Yo.updateRoot,plugins:qs,globalTimeline:pi,core:{PropTween:vs,globals:mz,Tween:Li,Timeline:Yo,Animation:Rg,getCache:gf,_removeLinkedListItem:s1,reverting:function(){return ko},context:function(n){return n&&ri&&(ri.data.push(n),n._ctx=ri),ri},suppressOverwrites:function(n){return hM=n}}};ys("to,from,fromTo,delayedCall,set,killTweensOf",function(a){return Ox[a]=Li[a]});Hs.add(Yo.updateRoot);ip=Ox.to({},{duration:0});var AH=function(n,h){for(var m=n._pt;m&&m.p!==h&&m.op!==h&&m.fp!==h;)m=m._next;return m},CH=function(n,h){var m=n._targets,y,b,M;for(y in h)for(b=m.length;b--;)M=n._ptLookup[b][y],M&&(M=M.d)&&(M._pt&&(M=AH(M,y)),M&&M.modifier&&M.modifier(h[y],n,m[b],y))},uT=function(n,h){return{name:n,rawVars:1,init:function(y,b,M){M._onInit=function(P){var o,R;if(so(b)&&(o={},ys(b,function(U){return o[U]=1}),b=o),h){o={};for(R in b)o[R]=h(b[R]);b=o}CH(P,b)}}}},bs=Ox.registerPlugin({name:"attr",init:function(n,h,m,y,b){var M,P,o;this.tween=m;for(M in h)o=n.getAttribute(M)||"",P=this.add(n,"setAttribute",(o||0)+"",h[M],y,b,0,0,M),P.op=M,P.b=o,this._props.push(M)},render:function(n,h){for(var m=h._pt;m;)ko?m.set(m.t,m.p,m.b,m):m.r(n,m.d),m=m._next}},{name:"endArray",init:function(n,h){for(var m=h.length;m--;)this.add(n,m,n[m]||0,h[m],0,0,0,0,0,1)}},uT("roundProps",BS),uT("modifiers"),uT("snap",Az))||Ox;Li.version=Yo.version=bs.version="3.12.5";dz=1;dM()&&Dp();_n.Power0;_n.Power1;_n.Power2;_n.Power3;_n.Power4;_n.Linear;_n.Quad;_n.Cubic;_n.Quart;_n.Quint;_n.Strong;_n.Elastic;_n.Back;_n.SteppedEase;_n.Bounce;_n.Sine;_n.Expo;_n.Circ;/*!
 * CSSPlugin 3.12.5
 * https://gsap.com
 *
 * Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var QO,Uc,mp,SM,hf,JO,EM,PH=function(){return typeof window<"u"},Lu={},af=180/Math.PI,_p=Math.PI/180,Vd=Math.atan2,eD=1e8,MM=/([A-Z])/g,OH=/(left|right|width|margin|padding|x)/i,DH=/[\s,\(]\S/,kl={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},jS=function(n,h){return h.set(h.t,h.p,Math.round((h.s+h.c*n)*1e4)/1e4+h.u,h)},RH=function(n,h){return h.set(h.t,h.p,n===1?h.e:Math.round((h.s+h.c*n)*1e4)/1e4+h.u,h)},kH=function(n,h){return h.set(h.t,h.p,n?Math.round((h.s+h.c*n)*1e4)/1e4+h.u:h.b,h)},LH=function(n,h){var m=h.s+h.c*n;h.set(h.t,h.p,~~(m+(m<0?-.5:.5))+h.u,h)},Xz=function(n,h){return h.set(h.t,h.p,n?h.e:h.b,h)},Yz=function(n,h){return h.set(h.t,h.p,n!==1?h.b:h.e,h)},zH=function(n,h,m){return n.style[h]=m},FH=function(n,h,m){return n.style.setProperty(h,m)},BH=function(n,h,m){return n._gsap[h]=m},NH=function(n,h,m){return n._gsap.scaleX=n._gsap.scaleY=m},UH=function(n,h,m,y,b){var M=n._gsap;M.scaleX=M.scaleY=m,M.renderTransform(b,M)},jH=function(n,h,m,y,b){var M=n._gsap;M[h]=m,M.renderTransform(b,M)},mi="transform",xs=mi+"Origin",VH=function a(n,h){var m=this,y=this.target,b=y.style,M=y._gsap;if(n in Lu&&b){if(this.tfm=this.tfm||{},n!=="transform")n=kl[n]||n,~n.indexOf(",")?n.split(",").forEach(function(P){return m.tfm[P]=Eu(y,P)}):this.tfm[n]=M.x?M[n]:Eu(y,n),n===xs&&(this.tfm.zOrigin=M.zOrigin);else return kl.transform.split(",").forEach(function(P){return a.call(m,P,h)});if(this.props.indexOf(mi)>=0)return;M.svg&&(this.svgo=y.getAttribute("data-svg-origin"),this.props.push(xs,h,"")),n=mi}(b||h)&&this.props.push(n,h,b[n])},Kz=function(n){n.translate&&(n.removeProperty("translate"),n.removeProperty("scale"),n.removeProperty("rotate"))},$H=function(){var n=this.props,h=this.target,m=h.style,y=h._gsap,b,M;for(b=0;b<n.length;b+=3)n[b+1]?h[n[b]]=n[b+2]:n[b+2]?m[n[b]]=n[b+2]:m.removeProperty(n[b].substr(0,2)==="--"?n[b]:n[b].replace(MM,"-$1").toLowerCase());if(this.tfm){for(M in this.tfm)y[M]=this.tfm[M];y.svg&&(y.renderTransform(),h.setAttribute("data-svg-origin",this.svgo||"")),b=EM(),(!b||!b.isStart)&&!m[mi]&&(Kz(m),y.zOrigin&&m[xs]&&(m[xs]+=" "+y.zOrigin+"px",y.zOrigin=0,y.renderTransform()),y.uncache=1)}},Qz=function(n,h){var m={target:n,props:[],revert:$H,save:VH};return n._gsap||bs.core.getCache(n),h&&h.split(",").forEach(function(y){return m.save(y)}),m},Jz,VS=function(n,h){var m=Uc.createElementNS?Uc.createElementNS((h||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),n):Uc.createElement(n);return m&&m.style?m:Uc.createElement(n)},Fl=function a(n,h,m){var y=getComputedStyle(n);return y[h]||y.getPropertyValue(h.replace(MM,"-$1").toLowerCase())||y.getPropertyValue(h)||!m&&a(n,Rp(h)||h,1)||""},tD="O,Moz,ms,Ms,Webkit".split(","),Rp=function(n,h,m){var y=h||hf,b=y.style,M=5;if(n in b&&!m)return n;for(n=n.charAt(0).toUpperCase()+n.substr(1);M--&&!(tD[M]+n in b););return M<0?null:(M===3?"ms":M>=0?tD[M]:"")+n},$S=function(){PH()&&window.document&&(QO=window,Uc=QO.document,mp=Uc.documentElement,hf=VS("div")||{style:{}},VS("div"),mi=Rp(mi),xs=mi+"Origin",hf.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Jz=!!Rp("perspective"),EM=bs.core.reverting,SM=1)},cT=function a(n){var h=VS("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),m=this.parentNode,y=this.nextSibling,b=this.style.cssText,M;if(mp.appendChild(h),h.appendChild(this),this.style.display="block",n)try{M=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=a}catch{}else this._gsapBBox&&(M=this._gsapBBox());return m&&(y?m.insertBefore(this,y):m.appendChild(this)),mp.removeChild(h),this.style.cssText=b,M},rD=function(n,h){for(var m=h.length;m--;)if(n.hasAttribute(h[m]))return n.getAttribute(h[m])},e4=function(n){var h;try{h=n.getBBox()}catch{h=cT.call(n,!0)}return h&&(h.width||h.height)||n.getBBox===cT||(h=cT.call(n,!0)),h&&!h.width&&!h.x&&!h.y?{x:+rD(n,["x","cx","x1"])||0,y:+rD(n,["y","cy","y1"])||0,width:0,height:0}:h},t4=function(n){return!!(n.getCTM&&(!n.parentNode||n.ownerSVGElement)&&e4(n))},If=function(n,h){if(h){var m=n.style,y;h in Lu&&h!==xs&&(h=mi),m.removeProperty?(y=h.substr(0,2),(y==="ms"||h.substr(0,6)==="webkit")&&(h="-"+h),m.removeProperty(y==="--"?h:h.replace(MM,"-$1").toLowerCase())):m.removeAttribute(h)}},jc=function(n,h,m,y,b,M){var P=new vs(n._pt,h,m,0,1,M?Yz:Xz);return n._pt=P,P.b=y,P.e=b,n._props.push(m),P},nD={deg:1,rad:1,turn:1},GH={grid:1,flex:1},rh=function a(n,h,m,y){var b=parseFloat(m)||0,M=(m+"").trim().substr((b+"").length)||"px",P=hf.style,o=OH.test(h),R=n.tagName.toLowerCase()==="svg",U=(R?"client":"offset")+(o?"Width":"Height"),V=100,Z=y==="px",te=y==="%",se,re,Te,ae;if(y===M||!b||nD[y]||nD[M])return b;if(M!=="px"&&!Z&&(b=a(n,h,m,"px")),ae=n.getCTM&&t4(n),(te||M==="%")&&(Lu[h]||~h.indexOf("adius")))return se=ae?n.getBBox()[o?"width":"height"]:n[U],Ei(te?b/se*V:b/100*se);if(P[o?"width":"height"]=V+(Z?M:y),re=~h.indexOf("adius")||y==="em"&&n.appendChild&&!R?n:n.parentNode,ae&&(re=(n.ownerSVGElement||{}).parentNode),(!re||re===Uc||!re.appendChild)&&(re=Uc.body),Te=re._gsap,Te&&te&&Te.width&&o&&Te.time===Hs.time&&!Te.uncache)return Ei(b/Te.width*V);if(te&&(h==="height"||h==="width")){var q=n.style[h];n.style[h]=V+y,se=n[U],q?n.style[h]=q:If(n,h)}else(te||M==="%")&&!GH[Fl(re,"display")]&&(P.position=Fl(n,"position")),re===n&&(P.position="static"),re.appendChild(hf),se=hf[U],re.removeChild(hf),P.position="absolute";return o&&te&&(Te=gf(re),Te.time=Hs.time,Te.width=re[U]),Ei(Z?se*b/V:se&&b?V/se*b:0)},Eu=function(n,h,m,y){var b;return SM||$S(),h in kl&&h!=="transform"&&(h=kl[h],~h.indexOf(",")&&(h=h.split(",")[0])),Lu[h]&&h!=="transform"?(b=Lg(n,y),b=h!=="transformOrigin"?b[h]:b.svg?b.origin:Rx(Fl(n,xs))+" "+b.zOrigin+"px"):(b=n.style[h],(!b||b==="auto"||y||~(b+"").indexOf("calc("))&&(b=Dx[h]&&Dx[h](n,h,m)||Fl(n,h)||gz(n,h)||(h==="opacity"?1:0))),m&&!~(b+"").trim().indexOf(" ")?rh(n,h,b,m)+m:b},WH=function(n,h,m,y){if(!m||m==="none"){var b=Rp(h,n,1),M=b&&Fl(n,b,1);M&&M!==m?(h=b,m=M):h==="borderColor"&&(m=Fl(n,"borderTopColor"))}var P=new vs(this._pt,n.style,h,0,1,qz),o=0,R=0,U,V,Z,te,se,re,Te,ae,q,Q,le,ye;if(P.b=m,P.e=y,m+="",y+="",y==="auto"&&(re=n.style[h],n.style[h]=y,y=Fl(n,h)||y,re?n.style[h]=re:If(n,h)),U=[m,y],zz(U),m=U[0],y=U[1],Z=m.match(np)||[],ye=y.match(np)||[],ye.length){for(;V=np.exec(y);)Te=V[0],q=y.substring(o,V.index),se?se=(se+1)%5:(q.substr(-5)==="rgba("||q.substr(-5)==="hsla(")&&(se=1),Te!==(re=Z[R++]||"")&&(te=parseFloat(re)||0,le=re.substr((te+"").length),Te.charAt(1)==="="&&(Te=pp(te,Te)+le),ae=parseFloat(Te),Q=Te.substr((ae+"").length),o=np.lastIndex-Q.length,Q||(Q=Q||Ks.units[h]||le,o===y.length&&(y+=Q,P.e+=Q)),le!==Q&&(te=rh(n,h,re,Q)||0),P._pt={_next:P._pt,p:q||R===1?q:",",s:te,c:ae-te,m:se&&se<4||h==="zIndex"?Math.round:0});P.c=o<y.length?y.substring(o,y.length):""}else P.r=h==="display"&&y==="none"?Yz:Xz;return hz.test(y)&&(P.e=0),this._pt=P,P},iD={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},qH=function(n){var h=n.split(" "),m=h[0],y=h[1]||"50%";return(m==="top"||m==="bottom"||y==="left"||y==="right")&&(n=m,m=y,y=n),h[0]=iD[m]||m,h[1]=iD[y]||y,h.join(" ")},HH=function(n,h){if(h.tween&&h.tween._time===h.tween._dur){var m=h.t,y=m.style,b=h.u,M=m._gsap,P,o,R;if(b==="all"||b===!0)y.cssText="",o=1;else for(b=b.split(","),R=b.length;--R>-1;)P=b[R],Lu[P]&&(o=1,P=P==="transformOrigin"?xs:mi),If(m,P);o&&(If(m,mi),M&&(M.svg&&m.removeAttribute("transform"),Lg(m,1),M.uncache=1,Kz(y)))}},Dx={clearProps:function(n,h,m,y,b){if(b.data!=="isFromStart"){var M=n._pt=new vs(n._pt,h,m,0,0,HH);return M.u=y,M.pr=-10,M.tween=b,n._props.push(m),1}}},kg=[1,0,0,1,0,0],r4={},n4=function(n){return n==="matrix(1, 0, 0, 1, 0, 0)"||n==="none"||!n},oD=function(n){var h=Fl(n,mi);return n4(h)?kg:h.substr(7).match(cz).map(Ei)},IM=function(n,h){var m=n._gsap||gf(n),y=n.style,b=oD(n),M,P,o,R;return m.svg&&n.getAttribute("transform")?(o=n.transform.baseVal.consolidate().matrix,b=[o.a,o.b,o.c,o.d,o.e,o.f],b.join(",")==="1,0,0,1,0,0"?kg:b):(b===kg&&!n.offsetParent&&n!==mp&&!m.svg&&(o=y.display,y.display="block",M=n.parentNode,(!M||!n.offsetParent)&&(R=1,P=n.nextElementSibling,mp.appendChild(n)),b=oD(n),o?y.display=o:If(n,"display"),R&&(P?M.insertBefore(n,P):M?M.appendChild(n):mp.removeChild(n))),h&&b.length>6?[b[0],b[1],b[4],b[5],b[12],b[13]]:b)},GS=function(n,h,m,y,b,M){var P=n._gsap,o=b||IM(n,!0),R=P.xOrigin||0,U=P.yOrigin||0,V=P.xOffset||0,Z=P.yOffset||0,te=o[0],se=o[1],re=o[2],Te=o[3],ae=o[4],q=o[5],Q=h.split(" "),le=parseFloat(Q[0])||0,ye=parseFloat(Q[1])||0,ze,He,Ne,xe;m?o!==kg&&(He=te*Te-se*re)&&(Ne=le*(Te/He)+ye*(-re/He)+(re*q-Te*ae)/He,xe=le*(-se/He)+ye*(te/He)-(te*q-se*ae)/He,le=Ne,ye=xe):(ze=e4(n),le=ze.x+(~Q[0].indexOf("%")?le/100*ze.width:le),ye=ze.y+(~(Q[1]||Q[0]).indexOf("%")?ye/100*ze.height:ye)),y||y!==!1&&P.smooth?(ae=le-R,q=ye-U,P.xOffset=V+(ae*te+q*re)-ae,P.yOffset=Z+(ae*se+q*Te)-q):P.xOffset=P.yOffset=0,P.xOrigin=le,P.yOrigin=ye,P.smooth=!!y,P.origin=h,P.originIsAbsolute=!!m,n.style[xs]="0px 0px",M&&(jc(M,P,"xOrigin",R,le),jc(M,P,"yOrigin",U,ye),jc(M,P,"xOffset",V,P.xOffset),jc(M,P,"yOffset",Z,P.yOffset)),n.setAttribute("data-svg-origin",le+" "+ye)},Lg=function(n,h){var m=n._gsap||new Uz(n);if("x"in m&&!h&&!m.uncache)return m;var y=n.style,b=m.scaleX<0,M="px",P="deg",o=getComputedStyle(n),R=Fl(n,xs)||"0",U,V,Z,te,se,re,Te,ae,q,Q,le,ye,ze,He,Ne,xe,Me,Ie,Je,Be,Ce,Re,rt,st,at,Ve,Dt,Bt,Gt,qt,or,et;return U=V=Z=re=Te=ae=q=Q=le=0,te=se=1,m.svg=!!(n.getCTM&&t4(n)),o.translate&&((o.translate!=="none"||o.scale!=="none"||o.rotate!=="none")&&(y[mi]=(o.translate!=="none"?"translate3d("+(o.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(o.rotate!=="none"?"rotate("+o.rotate+") ":"")+(o.scale!=="none"?"scale("+o.scale.split(" ").join(",")+") ":"")+(o[mi]!=="none"?o[mi]:"")),y.scale=y.rotate=y.translate="none"),He=IM(n,m.svg),m.svg&&(m.uncache?(at=n.getBBox(),R=m.xOrigin-at.x+"px "+(m.yOrigin-at.y)+"px",st=""):st=!h&&n.getAttribute("data-svg-origin"),GS(n,st||R,!!st||m.originIsAbsolute,m.smooth!==!1,He)),ye=m.xOrigin||0,ze=m.yOrigin||0,He!==kg&&(Ie=He[0],Je=He[1],Be=He[2],Ce=He[3],U=Re=He[4],V=rt=He[5],He.length===6?(te=Math.sqrt(Ie*Ie+Je*Je),se=Math.sqrt(Ce*Ce+Be*Be),re=Ie||Je?Vd(Je,Ie)*af:0,q=Be||Ce?Vd(Be,Ce)*af+re:0,q&&(se*=Math.abs(Math.cos(q*_p))),m.svg&&(U-=ye-(ye*Ie+ze*Be),V-=ze-(ye*Je+ze*Ce))):(et=He[6],qt=He[7],Dt=He[8],Bt=He[9],Gt=He[10],or=He[11],U=He[12],V=He[13],Z=He[14],Ne=Vd(et,Gt),Te=Ne*af,Ne&&(xe=Math.cos(-Ne),Me=Math.sin(-Ne),st=Re*xe+Dt*Me,at=rt*xe+Bt*Me,Ve=et*xe+Gt*Me,Dt=Re*-Me+Dt*xe,Bt=rt*-Me+Bt*xe,Gt=et*-Me+Gt*xe,or=qt*-Me+or*xe,Re=st,rt=at,et=Ve),Ne=Vd(-Be,Gt),ae=Ne*af,Ne&&(xe=Math.cos(-Ne),Me=Math.sin(-Ne),st=Ie*xe-Dt*Me,at=Je*xe-Bt*Me,Ve=Be*xe-Gt*Me,or=Ce*Me+or*xe,Ie=st,Je=at,Be=Ve),Ne=Vd(Je,Ie),re=Ne*af,Ne&&(xe=Math.cos(Ne),Me=Math.sin(Ne),st=Ie*xe+Je*Me,at=Re*xe+rt*Me,Je=Je*xe-Ie*Me,rt=rt*xe-Re*Me,Ie=st,Re=at),Te&&Math.abs(Te)+Math.abs(re)>359.9&&(Te=re=0,ae=180-ae),te=Ei(Math.sqrt(Ie*Ie+Je*Je+Be*Be)),se=Ei(Math.sqrt(rt*rt+et*et)),Ne=Vd(Re,rt),q=Math.abs(Ne)>2e-4?Ne*af:0,le=or?1/(or<0?-or:or):0),m.svg&&(st=n.getAttribute("transform"),m.forceCSS=n.setAttribute("transform","")||!n4(Fl(n,mi)),st&&n.setAttribute("transform",st))),Math.abs(q)>90&&Math.abs(q)<270&&(b?(te*=-1,q+=re<=0?180:-180,re+=re<=0?180:-180):(se*=-1,q+=q<=0?180:-180)),h=h||m.uncache,m.x=U-((m.xPercent=U&&(!h&&m.xPercent||(Math.round(n.offsetWidth/2)===Math.round(-U)?-50:0)))?n.offsetWidth*m.xPercent/100:0)+M,m.y=V-((m.yPercent=V&&(!h&&m.yPercent||(Math.round(n.offsetHeight/2)===Math.round(-V)?-50:0)))?n.offsetHeight*m.yPercent/100:0)+M,m.z=Z+M,m.scaleX=Ei(te),m.scaleY=Ei(se),m.rotation=Ei(re)+P,m.rotationX=Ei(Te)+P,m.rotationY=Ei(ae)+P,m.skewX=q+P,m.skewY=Q+P,m.transformPerspective=le+M,(m.zOrigin=parseFloat(R.split(" ")[2])||!h&&m.zOrigin||0)&&(y[xs]=Rx(R)),m.xOffset=m.yOffset=0,m.force3D=Ks.force3D,m.renderTransform=m.svg?XH:Jz?i4:ZH,m.uncache=0,m},Rx=function(n){return(n=n.split(" "))[0]+" "+n[1]},hT=function(n,h,m){var y=Ro(h);return Ei(parseFloat(h)+parseFloat(rh(n,"x",m+"px",y)))+y},ZH=function(n,h){h.z="0px",h.rotationY=h.rotationX="0deg",h.force3D=0,i4(n,h)},rf="0deg",z_="0px",nf=") ",i4=function(n,h){var m=h||this,y=m.xPercent,b=m.yPercent,M=m.x,P=m.y,o=m.z,R=m.rotation,U=m.rotationY,V=m.rotationX,Z=m.skewX,te=m.skewY,se=m.scaleX,re=m.scaleY,Te=m.transformPerspective,ae=m.force3D,q=m.target,Q=m.zOrigin,le="",ye=ae==="auto"&&n&&n!==1||ae===!0;if(Q&&(V!==rf||U!==rf)){var ze=parseFloat(U)*_p,He=Math.sin(ze),Ne=Math.cos(ze),xe;ze=parseFloat(V)*_p,xe=Math.cos(ze),M=hT(q,M,He*xe*-Q),P=hT(q,P,-Math.sin(ze)*-Q),o=hT(q,o,Ne*xe*-Q+Q)}Te!==z_&&(le+="perspective("+Te+nf),(y||b)&&(le+="translate("+y+"%, "+b+"%) "),(ye||M!==z_||P!==z_||o!==z_)&&(le+=o!==z_||ye?"translate3d("+M+", "+P+", "+o+") ":"translate("+M+", "+P+nf),R!==rf&&(le+="rotate("+R+nf),U!==rf&&(le+="rotateY("+U+nf),V!==rf&&(le+="rotateX("+V+nf),(Z!==rf||te!==rf)&&(le+="skew("+Z+", "+te+nf),(se!==1||re!==1)&&(le+="scale("+se+", "+re+nf),q.style[mi]=le||"translate(0, 0)"},XH=function(n,h){var m=h||this,y=m.xPercent,b=m.yPercent,M=m.x,P=m.y,o=m.rotation,R=m.skewX,U=m.skewY,V=m.scaleX,Z=m.scaleY,te=m.target,se=m.xOrigin,re=m.yOrigin,Te=m.xOffset,ae=m.yOffset,q=m.forceCSS,Q=parseFloat(M),le=parseFloat(P),ye,ze,He,Ne,xe;o=parseFloat(o),R=parseFloat(R),U=parseFloat(U),U&&(U=parseFloat(U),R+=U,o+=U),o||R?(o*=_p,R*=_p,ye=Math.cos(o)*V,ze=Math.sin(o)*V,He=Math.sin(o-R)*-Z,Ne=Math.cos(o-R)*Z,R&&(U*=_p,xe=Math.tan(R-U),xe=Math.sqrt(1+xe*xe),He*=xe,Ne*=xe,U&&(xe=Math.tan(U),xe=Math.sqrt(1+xe*xe),ye*=xe,ze*=xe)),ye=Ei(ye),ze=Ei(ze),He=Ei(He),Ne=Ei(Ne)):(ye=V,Ne=Z,ze=He=0),(Q&&!~(M+"").indexOf("px")||le&&!~(P+"").indexOf("px"))&&(Q=rh(te,"x",M,"px"),le=rh(te,"y",P,"px")),(se||re||Te||ae)&&(Q=Ei(Q+se-(se*ye+re*He)+Te),le=Ei(le+re-(se*ze+re*Ne)+ae)),(y||b)&&(xe=te.getBBox(),Q=Ei(Q+y/100*xe.width),le=Ei(le+b/100*xe.height)),xe="matrix("+ye+","+ze+","+He+","+Ne+","+Q+","+le+")",te.setAttribute("transform",xe),q&&(te.style[mi]=xe)},YH=function(n,h,m,y,b){var M=360,P=so(b),o=parseFloat(b)*(P&&~b.indexOf("rad")?af:1),R=o-y,U=y+R+"deg",V,Z;return P&&(V=b.split("_")[1],V==="short"&&(R%=M,R!==R%(M/2)&&(R+=R<0?M:-M)),V==="cw"&&R<0?R=(R+M*eD)%M-~~(R/M)*M:V==="ccw"&&R>0&&(R=(R-M*eD)%M-~~(R/M)*M)),n._pt=Z=new vs(n._pt,h,m,y,R,RH),Z.e=U,Z.u="deg",n._props.push(m),Z},sD=function(n,h){for(var m in h)n[m]=h[m];return n},KH=function(n,h,m){var y=sD({},m._gsap),b="perspective,force3D,transformOrigin,svgOrigin",M=m.style,P,o,R,U,V,Z,te,se;y.svg?(R=m.getAttribute("transform"),m.setAttribute("transform",""),M[mi]=h,P=Lg(m,1),If(m,mi),m.setAttribute("transform",R)):(R=getComputedStyle(m)[mi],M[mi]=h,P=Lg(m,1),M[mi]=R);for(o in Lu)R=y[o],U=P[o],R!==U&&b.indexOf(o)<0&&(te=Ro(R),se=Ro(U),V=te!==se?rh(m,o,R,se):parseFloat(R),Z=parseFloat(U),n._pt=new vs(n._pt,P,o,V,Z-V,jS),n._pt.u=se||0,n._props.push(o));sD(P,y)};ys("padding,margin,Width,Radius",function(a,n){var h="Top",m="Right",y="Bottom",b="Left",M=(n<3?[h,m,y,b]:[h+b,h+m,y+m,y+b]).map(function(P){return n<2?a+P:"border"+P+a});Dx[n>1?"border"+a:a]=function(P,o,R,U,V){var Z,te;if(arguments.length<4)return Z=M.map(function(se){return Eu(P,se,R)}),te=Z.join(" "),te.split(Z[0]).length===5?Z[0]:te;Z=(U+"").split(" "),te={},M.forEach(function(se,re){return te[se]=Z[re]=Z[re]||Z[(re-1)/2|0]}),P.init(o,te,V)}});var o4={name:"css",register:$S,targetTest:function(n){return n.style&&n.nodeType},init:function(n,h,m,y,b){var M=this._props,P=n.style,o=m.vars.startAt,R,U,V,Z,te,se,re,Te,ae,q,Q,le,ye,ze,He,Ne;SM||$S(),this.styles=this.styles||Qz(n),Ne=this.styles.props,this.tween=m;for(re in h)if(re!=="autoRound"&&(U=h[re],!(qs[re]&&jz(re,h,m,y,n,b)))){if(te=typeof U,se=Dx[re],te==="function"&&(U=U.call(m,y,n,b),te=typeof U),te==="string"&&~U.indexOf("random(")&&(U=Og(U)),se)se(this,n,re,U,m)&&(He=1);else if(re.substr(0,2)==="--")R=(getComputedStyle(n).getPropertyValue(re)+"").trim(),U+="",Kc.lastIndex=0,Kc.test(R)||(Te=Ro(R),ae=Ro(U)),ae?Te!==ae&&(R=rh(n,re,R,ae)+ae):Te&&(U+=Te),this.add(P,"setProperty",R,U,y,b,0,0,re),M.push(re),Ne.push(re,0,P[re]);else if(te!=="undefined"){if(o&&re in o?(R=typeof o[re]=="function"?o[re].call(m,y,n,b):o[re],so(R)&&~R.indexOf("random(")&&(R=Og(R)),Ro(R+"")||R==="auto"||(R+=Ks.units[re]||Ro(Eu(n,re))||""),(R+"").charAt(1)==="="&&(R=Eu(n,re))):R=Eu(n,re),Z=parseFloat(R),q=te==="string"&&U.charAt(1)==="="&&U.substr(0,2),q&&(U=U.substr(2)),V=parseFloat(U),re in kl&&(re==="autoAlpha"&&(Z===1&&Eu(n,"visibility")==="hidden"&&V&&(Z=0),Ne.push("visibility",0,P.visibility),jc(this,P,"visibility",Z?"inherit":"hidden",V?"inherit":"hidden",!V)),re!=="scale"&&re!=="transform"&&(re=kl[re],~re.indexOf(",")&&(re=re.split(",")[0]))),Q=re in Lu,Q){if(this.styles.save(re),le||(ye=n._gsap,ye.renderTransform&&!h.parseTransform||Lg(n,h.parseTransform),ze=h.smoothOrigin!==!1&&ye.smooth,le=this._pt=new vs(this._pt,P,mi,0,1,ye.renderTransform,ye,0,-1),le.dep=1),re==="scale")this._pt=new vs(this._pt,ye,"scaleY",ye.scaleY,(q?pp(ye.scaleY,q+V):V)-ye.scaleY||0,jS),this._pt.u=0,M.push("scaleY",re),re+="X";else if(re==="transformOrigin"){Ne.push(xs,0,P[xs]),U=qH(U),ye.svg?GS(n,U,0,ze,0,this):(ae=parseFloat(U.split(" ")[2])||0,ae!==ye.zOrigin&&jc(this,ye,"zOrigin",ye.zOrigin,ae),jc(this,P,re,Rx(R),Rx(U)));continue}else if(re==="svgOrigin"){GS(n,U,1,ze,0,this);continue}else if(re in r4){YH(this,ye,re,Z,q?pp(Z,q+U):U);continue}else if(re==="smoothOrigin"){jc(this,ye,"smooth",ye.smooth,U);continue}else if(re==="force3D"){ye[re]=U;continue}else if(re==="transform"){KH(this,U,n);continue}}else re in P||(re=Rp(re)||re);if(Q||(V||V===0)&&(Z||Z===0)&&!DH.test(U)&&re in P)Te=(R+"").substr((Z+"").length),V||(V=0),ae=Ro(U)||(re in Ks.units?Ks.units[re]:Te),Te!==ae&&(Z=rh(n,re,R,ae)),this._pt=new vs(this._pt,Q?ye:P,re,Z,(q?pp(Z,q+V):V)-Z,!Q&&(ae==="px"||re==="zIndex")&&h.autoRound!==!1?LH:jS),this._pt.u=ae||0,Te!==ae&&ae!=="%"&&(this._pt.b=R,this._pt.r=kH);else if(re in P)WH.call(this,n,re,R,q?q+U:U);else if(re in n)this.add(n,re,R||n[re],q?q+U:U,y,b);else if(re!=="parseTransform"){mM(re,U);continue}Q||(re in P?Ne.push(re,0,P[re]):Ne.push(re,1,R||n[re])),M.push(re)}}He&&Hz(this)},render:function(n,h){if(h.tween._time||!EM())for(var m=h._pt;m;)m.r(n,m.d),m=m._next;else h.styles.revert()},get:Eu,aliases:kl,getSetter:function(n,h,m){var y=kl[h];return y&&y.indexOf(",")<0&&(h=y),h in Lu&&h!==xs&&(n._gsap.x||Eu(n,"x"))?m&&JO===m?h==="scale"?NH:BH:(JO=m||{})&&(h==="scale"?UH:jH):n.style&&!fM(n.style[h])?zH:~h.indexOf("-")?FH:wM(n,h)},core:{_removeProperty:If,_getMatrix:IM}};bs.utils.checkPrefix=Rp;bs.core.getStyleSaver=Qz;(function(a,n,h,m){var y=ys(a+","+n+","+h,function(b){Lu[b]=1});ys(n,function(b){Ks.units[b]="deg",r4[b]=1}),kl[y[13]]=a+","+n,ys(m,function(b){var M=b.split(":");kl[M[1]]=y[M[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");ys("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(a){Ks.units[a]="px"});bs.registerPlugin(o4);var WS=bs.registerPlugin(o4)||bs;WS.core.Tween;const QH="/assets/image1-C9z18RPI.jpg",JH="/assets/image2-yUZwG_Zw.png";function e7(){const a=rj(),n=()=>{a("/directions")};return ir.jsx("div",{className:"flex flex-col text-gray-800",children:ir.jsxs("div",{className:"container mx-auto px-6 pt-16 flex-1 text-center",children:[ir.jsx("h2",{className:"text-2xl md:text-4xl lg:text-6xl uppercase text-gray-700",children:"Welcome to"}),ir.jsx("h1",{className:"text-3xl md:text-6xl lg:text-8xl uppercase font-black mb-8 text-gray-900",children:"SafeCycle"}),ir.jsx("p",{className:"text-base md:text-lg lg:text-2xl mb-8 text-gray-700",children:"A place for people looking to ride bicycle freely and safely in Melbourne."}),ir.jsx("button",{onClick:n,className:"flex items-center font-black justify-center text-lg md:text-2xl lg:text-3xl py-2 px-4 md:py-4 md:px-10 lg:py-6 lg:px-12 bg-blue-500 bg-opacity-10 w-fit mx-auto mb-8 rounded-full text-blue-900 shadow-lg",children:" START "}),ir.jsxs("div",{className:"container mx-auto px-6 py-16 flex flex-col md:flex-row gap-100",children:[ir.jsxs("div",{className:"flex-1 flex flex-col items-center text-center",children:[ir.jsx("img",{src:QH,alt:"Stay Informed",className:"w-full h-auto rounded-lg shadow-lg mb-4"}),ir.jsx("p",{className:"text-lg md:text-xl text-gray-700",children:"Thanks for using SafeCycle! Here, you can discover the safest routes for your commute, avoid heavy traffic, and find useful cycling resources. Plan your journey, check risk levels, and stay informed about cycling conditions."})]}),ir.jsxs("div",{className:"flex-1 flex flex-col items-center text-center",children:[ir.jsx("img",{src:JH,alt:"Stay Safe",className:"w-full h-auto rounded-lg shadow-lg mb-4"}),ir.jsx("p",{className:"text-lg md:text-xl text-gray-700",children:"At SafeCycle, we regard your safety as our number one priority. Please follow the link to find out more on how to stay safe while cycling!"})]})]})]})})}function t7(){const a=rr.useRef(null);return rr.useLayoutEffect(()=>{let n=WS.context(()=>{WS.timeline().from("#intro-slider",{xPercent:"-100",duration:1.3,delay:.3}).from(["#title-1","#title-2","#title-3"],{opacity:0,y:"+=30",stagger:.5}).to(["#title-1","#title-2","#title-3"],{opacity:0,y:"-=30",delay:.3,stagger:.5}).from("#outro-slider",{opacity:0,y:"-=30",duration:1})},a);return()=>n.revert()}),ir.jsxs("div",{className:"relative",ref:a,children:[ir.jsxs("div",{id:"intro-slider",className:"h-screen p-10 bg-gray-50 font-robotoSlab absolute top-0 left-0 z-10 w-full flex flex-col gap-10 tracking-tight",children:[ir.jsx("h1",{className:"text-9xl",id:"title-1",children:"Choropleth Map"}),ir.jsx("h1",{className:"text-9xl",id:"title-2",children:"Cycling Directions"}),ir.jsx("h1",{className:"text-9xl",id:"title-3",children:"And More..."})]}),ir.jsxs("div",{id:"outro-slider",className:"h-screen p-10 bg-gray-50 font-robotoSlab absolute top-0 left-0 z-10 w-full flex flex-col gap-10 tracking-tight",children:[ir.jsx("div",{id:"navbar",className:"navbar",children:ir.jsx(jE,{})}),ir.jsx("div",{id:"feature",className:"feature",children:ir.jsx(e7,{})})]}),ir.jsx("div",{className:"h-screen flex bg-gray-950 justify-center place-items-center",children:ir.jsx("h1",{className:'text-9xl font-bold text-gray-100 font-robotoSlab id="welcome"',children:"Welcome."})})]})}function r7(){return ir.jsxs("div",{id:"outro-slider",className:"h-screen p-10 bg-gray-50 font-robotoSlab absolute top-0 left-0 z-10 w-full flex flex-col gap-10 tracking-tight",children:[ir.jsx("div",{id:"navbar",className:"navbar",children:ir.jsx(jE,{})}),ir.jsx("div",{id:"mapbox",children:ir.jsx(Fq,{})})]})}function n7(){return ir.jsx(xj,{children:ir.jsxs(gj,{children:[ir.jsx(Mv,{path:"/",element:ir.jsx(t7,{})}),ir.jsx(Mv,{path:"/directions",element:ir.jsx(r7,{})}),ir.jsx(Mv,{path:"/choropleth",element:ir.jsx(Tj,{})})]})})}fT.createRoot(document.getElementById("root")).render(ir.jsx(gD.StrictMode,{children:ir.jsx(n7,{})}));
